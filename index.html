<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ’çƒä¹‹æ˜Ÿ - ä»èœé¸Ÿåˆ°å† å†›</title>
    
    <!-- SEOä¼˜åŒ– -->
    <meta name="description" content="ä½“éªŒä»å¤§ä¸€æ–°ç”Ÿåˆ°å¸‚çº§å† å†›çš„æ’çƒä¹‹æ—…ï¼è®­ç»ƒã€æ¯”èµ›ã€æˆé•¿ï¼Œä¹¦å†™ä½ çš„æ’çƒä¼ å¥‡ï¼">
    <meta name="keywords" content="æ’çƒæ¸¸æˆ,æ–‡å­—å†’é™©,ä½“è‚²æ¸¸æˆ,æˆé•¿æ¸¸æˆ,æ’çƒä¹‹æ˜Ÿ">
    <meta name="author" content="å°æ°´">
    
    <!-- å¾®ä¿¡åˆ†äº«ä¼˜åŒ– -->
    <meta property="og:title" content="æ’çƒä¹‹æ˜Ÿ - ä»èœé¸Ÿåˆ°å† å†›çš„æˆé•¿ä¹‹è·¯" />
    <meta property="og:description" content="ä½“éªŒä»å¤§ä¸€æ–°ç”Ÿåˆ°å¸‚çº§å† å†›çš„æ’çƒä¹‹æ—…ï¼è®­ç»ƒã€æ¯”èµ›ã€æˆé•¿ï¼Œä¹¦å†™ä½ çš„æ’çƒä¼ å¥‡ï¼" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://via.placeholder.com/1200x630/667eea/ffffff?text=æ’çƒä¹‹æ˜Ÿ" />
    
    <!-- ç§»åŠ¨ç«¯ä¼˜åŒ– -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="æ’çƒä¹‹æ˜Ÿ">
    <meta name="theme-color" content="#667eea">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                align-items: flex-start;
            }
        }
        
        #game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 900px;
            width: 100%;
            overflow: hidden;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            #game-container {
                border-radius: 10px;
                max-width: 100%;
                margin: 0;
            }
        }
        
        #game-header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            text-align: center;
            display: none;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            #game-header {
                padding: 15px 10px;
            }
        }
        
        #game-header.show {
            display: block;
        }
        
        #game-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            #game-header h1 {
                font-size: 22px;
                margin-bottom: 8px;
            }
        }
        
        #current-goal {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        #current-goal h3 {
            margin: 0 0 5px 0;
            font-size: 16px;
        }
        
        #current-goal p {
            margin: 3px 0;
        }
        
        .goal-requirement {
            color: #fff;
            font-weight: bold;
        }
        
        .goal-met {
            color: #2ecc71;
        }
        
        .goal-not-met {
            color: #ffeb3b;
        }
        
        #event-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        #event-modal.show {
            display: flex;
        }
        
        #event-modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            #event-modal-content {
                padding: 20px;
                width: 95%;
                max-height: 85vh;
                border-radius: 10px;
            }
        }
        
        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        #event-modal-content h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        #event-modal-content p {
            line-height: 1.8;
            margin-bottom: 20px;
        }
        
        #event-modal-choices {
            display: grid;
            gap: 10px;
        }
        
        /* æ¯”èµ›å¼¹çª—æ ·å¼ */
        #match-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        #match-modal.show {
            display: flex;
        }
        
        #match-modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            color: white;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            #match-modal-content {
                padding: 20px 15px;
                width: 95%;
                max-height: 85vh;
                border-radius: 10px;
            }
        }
        
        #match-modal-content h2 {
            color: white;
            margin-bottom: 20px;
            text-align: center;
        }
        
        #match-score-display {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        #match-log {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }
        
        .match-log-item {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            animation: slideIn 0.3s ease-out;
            opacity: 0;
            animation-fill-mode: forwards;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .match-log-item.my-point {
            border-left: 4px solid #2ecc71;
            background: rgba(46, 204, 113, 0.2);
        }
        
        .match-log-item.opponent-point {
            border-left: 4px solid #e74c3c;
            background: rgba(231, 76, 60, 0.2);
        }
        
        .match-log-score {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .match-log-description {
            color: #ddd;
            font-size: 14px;
        }
        
        #match-modal-choices {
            display: grid;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* ç›®æ ‡é¢æ¿æ ·å¼ */
        #goals-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
        }
        
        #goals-panel.show {
            display: flex;
        }
        
        #goals-panel-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            color: white;
        }
        
        #goals-panel-content h2 {
            color: white;
            margin-bottom: 20px;
        }
        
        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }
        
        .goal-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid;
        }
        
        .goal-card.current {
            border-left-color: #ffd700;
            background: rgba(255, 215, 0, 0.2);
        }
        
        .goal-card.next {
            border-left-color: #4CAF50;
            background: rgba(76, 175, 80, 0.15);
        }
        
        .goal-card.future {
            border-left-color: #9E9E9E;
            background: rgba(158, 158, 158, 0.1);
        }
        
        .goal-card.completed {
            border-left-color: #2196F3;
            background: rgba(33, 150, 243, 0.15);
            opacity: 0.7;
        }
        
        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .goal-title {
            font-size: 20px;
            font-weight: bold;
        }
        
        .goal-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .goal-badge.current {
            background: #ffd700;
            color: #333;
        }
        
        .goal-badge.next {
            background: #4CAF50;
            color: white;
        }
        
        .goal-badge.completed {
            background: #2196F3;
            color: white;
        }
        
        .goal-description {
            margin: 10px 0;
            font-size: 14px;
            color: #ddd;
        }
        
        .goal-requirements {
            margin: 15px 0;
        }
        
        .goal-requirements h4 {
            font-size: 14px;
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .requirement-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 13px;
        }
        
        .requirement-met {
            color: #4CAF50;
        }
        
        .requirement-not-met {
            color: #ff6b6b;
        }
        
        .goal-tips {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            font-size: 12px;
            color: #ddd;
        }
        
        .tab-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        #stats-bar {
            display: flex;
            justify-content: space-around;
            font-size: 14px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            #stats-bar {
                font-size: 12px;
                gap: 8px;
            }
        }
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
        }

        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
        }
        
        #game-content {
            padding: 30px;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            #game-content {
                padding: 15px;
            }
        }
        
        #story-text {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            min-height: 150px;
            line-height: 1.8;
            font-size: 16px;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            #story-text {
                padding: 15px;
                font-size: 15px;
                line-height: 1.6;
                min-height: 100px;
            }
        }
        
        #choices {
            display: grid;
            gap: 10px;
        }
        
        /* è¯¾ä½™ç”Ÿæ´»åˆ†ç±»å¸ƒå±€ - ç´§å‡‘å‹ */
        .life-categories {
            display: grid;
            gap: 15px;
        }
        
        .life-category {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 12px;
            border-left: 4px solid;
        }
        
        .life-category.sports {
            border-left-color: #ff6b6b;
        }
        
        .life-category.rest {
            border-left-color: #4ecdc4;
        }
        
        .life-category.social {
            border-left-color: #95e1d3;
        }
        
        .life-category.food {
            border-left-color: #ffd93d;
        }
        
        .life-category.work {
            border-left-color: #6c5ce7;
        }
        
        .category-title {
            font-size: 15px;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .category-choices {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .life-choice-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 13px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .life-choice-card:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .life-choice-card:disabled {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .life-choice-icon {
            font-size: 28px;
            margin-bottom: 4px;
        }
        
        .life-choice-title {
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 13px;
        }
        
        .life-choice-effects {
            font-size: 10px;
            opacity: 0.9;
            line-height: 1.3;
        }
        
        @media (max-width: 768px) {
            .category-choices {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .life-choice-icon {
                font-size: 24px;
            }
            
            .life-choice-title {
                font-size: 12px;
            }
            
            .life-choice-effects {
                font-size: 9px;
            }
        }
        
        @media (min-width: 769px) {
            .category-choices {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* å•†åº—ç³»ç»Ÿæ ·å¼ - ç´§å‡‘å‹ä¸€çº§å…¥å£ */
        .shop-category-section {
            margin-bottom: 25px;
        }
        
        .shop-category-header {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }
        
        .shop-items-compact {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
        }
        
        .shop-item-compact {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .shop-item-compact:hover:not(.disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        }
        
        .shop-item-compact.disabled {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .item-compact-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 6px;
            line-height: 1.3;
        }
        
        .item-compact-desc {
            font-size: 11px;
            opacity: 0.9;
            margin-bottom: 6px;
            line-height: 1.3;
            min-height: 32px;
        }
        
        .item-compact-price {
            font-size: 13px;
            font-weight: bold;
            padding: 4px 8px;
            background: rgba(255,255,255,0.25);
            border-radius: 6px;
            display: inline-block;
        }
        
        .item-compact-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 16px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .item-compact-badge.owned {
            background: rgba(46, 204, 113, 0.9);
        }
        
        .item-compact-badge.locked {
            background: rgba(231, 76, 60, 0.9);
        }
        
        @media (max-width: 768px) {
            .shop-items-compact {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .item-compact-name {
                font-size: 13px;
            }
            
            .item-compact-price {
                font-size: 12px;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .shop-items-compact {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (min-width: 1025px) {
            .shop-items-compact {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* æ—§çš„å•†åº—æ ·å¼ï¼ˆä¿ç•™ä»¥é˜²éœ€è¦ï¼‰ */
        .shop-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .shop-category-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .shop-category-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .shop-cat-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .shop-cat-name {
            font-size: 16px;
            font-weight: bold;
        }
        
        .shop-items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .shop-item-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
            transition: all 0.3s;
        }
        
        .shop-item-card:hover:not(.disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .shop-item-card.disabled {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            opacity: 0.7;
        }
        
        .item-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .item-description {
            font-size: 13px;
            margin-bottom: 10px;
            opacity: 0.9;
            line-height: 1.4;
        }
        
        .item-price {
            font-size: 16px;
            font-weight: bold;
            margin: 10px 0;
            padding: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            text-align: center;
        }
        
        .item-owned {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(46, 204, 113, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .item-locked {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .shop-item-card button {
            width: 100%;
            background: rgba(255,255,255,0.3);
            color: white;
            border: 2px solid white;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .shop-item-card button:hover:not(:disabled) {
            background: white;
            color: #667eea;
        }
        
        .shop-item-card button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        @media (max-width: 768px) {
            .shop-categories {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .shop-items-grid {
                grid-template-columns: 1fr;
            }
            
            .shop-cat-icon {
                font-size: 36px;
            }
        }
        
        .choice-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            text-align: left;
        }
        
        /* é‡è¦æŒ‰é’®æ ·å¼ï¼ˆé‡‘é»„è‰²ï¼‰ */
        .choice-btn-important {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 50%, #ffd700 100%);
            color: white;
            border: 2px solid #ffd700;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            text-align: left;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .choice-btn {
                padding: 12px 15px;
                font-size: 15px;
                border-radius: 8px;
            }
            
            .choice-btn-important {
                padding: 12px 15px;
                font-size: 15px;
                border-radius: 8px;
            }
        }
        
        .choice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .choice-btn-important:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5);
        }
        
        .choice-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        /* èŒä¸šé€‰æ‹©å¡ç‰‡æ ·å¼ */
        .position-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .position-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            position: relative;
        }
        
        .position-card:hover:not(.disabled) {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        
        .position-card.disabled {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .position-card.recommended {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 0 20px rgba(245, 87, 108, 0.5);
        }
        
        .position-recommended {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 215, 0, 0.9);
            color: #333;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .position-match {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            padding: 5px;
            background: rgba(255,255,255,0.25);
            border-radius: 8px;
        }
        
        .position-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .position-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .position-desc {
            font-size: 13px;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        
        .position-skills {
            font-size: 12px;
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
        }
        
        .position-requirements {
            font-size: 11px;
            margin-top: 10px;
            padding: 8px;
            background: rgba(255,255,255,0.15);
            border-radius: 8px;
            line-height: 1.6;
        }
        
        .position-restrictions {
            font-size: 10px;
            margin-top: 8px;
            padding: 5px;
            background: rgba(255,100,100,0.3);
            border-radius: 5px;
            color: #ffeb3b;
        }
        
        .position-locked {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.5);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        
        @media (max-width: 768px) {
            .position-cards {
                grid-template-columns: 1fr;
            }
        }

        
        #character-panel {
            background: #e9ecef;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            #character-panel {
                padding: 12px;
                margin-bottom: 15px;
            }
        }
        
        #character-panel.show {
            display: block;
        }
        
        .skills-container {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-top: 15px;
        }
        
        .skills-left {
            flex: 1;
            min-width: 0;
        }
        
        .skills-right {
            flex-shrink: 0;
            display: none; /* éšè—é›·è¾¾å›¾ - ä¿ç•™ä»£ç ä»¥ä¾¿åç»­æ¿€æ´» */
            /* display: flex; */ /* å–æ¶ˆæ³¨é‡Šæ­¤è¡Œå¯é‡æ–°æ˜¾ç¤ºé›·è¾¾å›¾ */
            justify-content: center;
            align-items: center;
        }
        
        @media (max-width: 768px) {
            .skills-container {
                flex-direction: column;
            }
            
            .skills-left {
                width: 100%;
            }
        }
        
        #name-input-panel {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            #name-input-panel {
                padding: 20px 15px;
                border-radius: 10px;
            }
        }
        
        #name-input-panel h2 {
            color: #667eea;
            margin-bottom: 20px;
        }
        
        #name-input-panel input {
            width: calc(100% - 60px);
            padding: 15px;
            font-size: 18px;
            border: 2px solid #667eea;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.2s;
            display: inline-block;
        }
        
        #name-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
        }
        
        #random-name-btn {
            background: #f093fb;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        #random-name-btn:hover {
            background: #e082ea;
            transform: rotate(360deg) scale(1.1);
        }
        
        #initial-attributes {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        
        #initial-attributes h3 {
            text-align: center;
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .init-attr-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .init-attr-item:last-child {
            border-bottom: none;
        }
        
        .init-attr-value {
            font-weight: bold;
            color: #667eea;
        }
        
        .init-attr-rating {
            text-align: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #667eea;
            font-weight: bold;
            color: #f5576c;
        }
        
        #reroll-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        #reroll-btn {
            background: #f093fb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #reroll-btn:hover:not(:disabled) {
            background: #e082ea;
            transform: scale(1.05);
        }
        
        #reroll-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        #reroll-count {
            color: #666;
            font-size: 14px;
        }
        
        #name-input-panel button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #name-input-panel button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .hidden {
            display: none;
        }
        
        .attribute-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        
        .attribute-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .attribute-item:last-child {
            border-bottom: none;
        }
        
        .attribute-value {
            font-weight: bold;
            color: #667eea;
        }
        
        .skill-bar {
            margin: 10px 0;
        }
        
        .skill-name {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .progress-bar {
            background: #dee2e6;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
            height: 100%;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* å¼€å‘è€…ç½²å */
        .developer-credit {
            text-align: center;
            padding: 15px;
            font-size: 11px;
            color: #999;
            opacity: 0.6;
            margin-top: 20px;
            border-top: 1px solid #eee;
        }
        
        /* åˆ†äº«æŒ‰é’® */
        .share-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
        }
        
        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        .share-btn:active {
            transform: translateY(0);
        }
        
        @media (max-width: 768px) {
            .share-btn {
                bottom: 15px;
                right: 15px;
                padding: 10px 16px;
                font-size: 13px;
            }
        }
        
        /* è·³è¿‡æŒ‰é’® */
        .skip-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .skip-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .skip-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="game-header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h1>ğŸ æ’çƒä¹‹æ˜Ÿ</h1>
                <button id="goals-tab-btn" class="tab-btn" onclick="game.toggleGoalsPanel()">ğŸ¯ ç›®æ ‡</button>
            </div>
            <div id="current-goal">
                <h3>ğŸ“ å½“å‰ç›®æ ‡</h3>
                <p id="goal-text">åŠ è½½ä¸­...</p>
            </div>
            <div id="stats-bar">
                <div class="stat">
                    <span class="stat-label">å‘¨æ¬¡</span>
                    <span class="stat-value" id="week">1</span>
                </div>
                <div class="stat">
                    <span class="stat-label">è®­ç»ƒ</span>
                    <span class="stat-value" id="training-count">0/3</span>
                </div>

                <div class="stat">
                    <span class="stat-label">ä½“åŠ›</span>
                    <span class="stat-value" id="energy">100</span>
                </div>
                <div class="stat">
                    <span class="stat-label">å¿ƒæƒ…</span>
                    <span class="stat-value" id="mood">80</span>
                </div>
                <div class="stat">
                    <span class="stat-label">å‹åŠ›</span>
                    <span class="stat-value" id="stress">20</span>
                </div>
                <div class="stat">
                    <span class="stat-label">å£°æœ›</span>
                    <span class="stat-value" id="reputation">10</span>
                </div>
                <div class="stat">
                    <span class="stat-label">é‡‘é’±</span>
                    <span class="stat-value" id="money">100</span>
                </div>
                <div class="stat">
                    <span class="stat-label">è®­ç»ƒç‚¹</span>
                    <span class="stat-value" id="training-points">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">é˜Ÿä¼</span>
                    <span class="stat-value" id="team">æ— </span>
                </div>
                <div class="stat" id="position-stat" style="display: none;">
                    <span class="stat-label">èŒä¸š</span>
                    <span class="stat-value" id="position">æœªé€‰æ‹©</span>
                </div>
            </div>
        </div>
        
        <div id="game-content">
            <div id="character-panel">
                <h3>ğŸ“Š èƒ½åŠ›å€¼</h3>
                <div class="skills-container">
                    <div class="skills-left">
                        <div class="skill-bar">
                            <div class="skill-name">
                                <span>å‘çƒ</span>
                                <span id="serve-value">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="serve-bar" style="width: 0%">0</div>
                            </div>
                        </div>
                        <div class="skill-bar">
                            <div class="skill-name">
                                <span>æ‰£çƒ</span>
                                <span id="spike-value">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="spike-bar" style="width: 0%">0</div>
                            </div>
                        </div>
                        <div class="skill-bar">
                            <div class="skill-name">
                                <span>æ‹¦ç½‘</span>
                                <span id="block-value">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="block-bar" style="width: 0%">0</div>
                            </div>
                        </div>
                        <div class="skill-bar">
                            <div class="skill-name">
                                <span>å«çƒ</span>
                                <span id="dig-value">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="dig-bar" style="width: 0%">0</div>
                            </div>
                        </div>
                        <div class="skill-bar">
                            <div class="skill-name">
                                <span>æ‰˜çƒ</span>
                                <span id="set-value">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="set-bar" style="width: 0%">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="skills-right">
                        <canvas id="skills-radar" width="260" height="260"></canvas>
                    </div>
                </div>
            </div>
            
            <div id="story-text"></div>
            <div id="choices"></div>
        </div>
        
        <!-- å¼€å‘è€…ç½²å -->
        <div class="developer-credit">å¼€å‘è€…ï¼šå°æ°´</div>
    </div>
    
    <!-- åˆ†äº«æŒ‰é’® -->
    <button class="share-btn" onclick="shareGame()">
        <span>ğŸ“¤</span>
        <span>åˆ†äº«æ¸¸æˆ</span>
    </button>
    
    <!-- äº‹ä»¶å¼¹çª— -->
    <div id="event-modal">
        <div id="event-modal-content">
            <h2 id="event-modal-title">äº‹ä»¶</h2>
            <p id="event-modal-text"></p>
            <div id="event-modal-choices"></div>
        </div>
    </div>
    
    <!-- æ¯”èµ›å¼¹çª— -->
    <div id="match-modal">
        <div id="match-modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 id="match-modal-title" style="margin: 0;">ğŸ æ¯”èµ›è¿›è¡Œä¸­</h2>
                <button id="skip-match-btn" class="skip-btn" onclick="game.skipMatch()">â­ï¸ è·³è¿‡</button>
            </div>
            <div id="match-score-display">
                <span id="my-score">0</span>
                <span style="margin: 0 20px;">:</span>
                <span id="opponent-score">0</span>
            </div>
            <div id="match-log"></div>
            <div id="match-modal-choices"></div>
        </div>
    </div>
    
    <!-- ç›®æ ‡é¢æ¿ -->
    <div id="goals-panel">
        <div id="goals-panel-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>ğŸ¯ æˆé•¿ç›®æ ‡</h2>
                <button class="close-btn" onclick="game.toggleGoalsPanel()">âœ•</button>
            </div>
            <div id="goals-list"></div>
        </div>
    </div>

    <script>
        // å§“æ°åº“
        const SURNAMES = [
            // å¸¸è§å•å§“
            'å¼ ', 'ç‹', 'æ', 'åˆ˜', 'é™ˆ', 'æ¨', 'é»„', 'èµµ', 'å´', 'å‘¨',
            'å¾', 'å­™', 'é©¬', 'æœ±', 'èƒ¡', 'éƒ­', 'ä½•', 'æ—', 'é«˜', 'ç½—',
            'éƒ‘', 'æ¢', 'è°¢', 'å®‹', 'å”', 'è®¸', 'éŸ©', 'å†¯', 'é‚“', 'æ›¹',
            'å½­', 'æ›¾', 'è‚–', 'ç”°', 'è‘£', 'è¢', 'æ½˜', 'äº', 'è’‹', 'è”¡',
            // å¤å§“
            'æ¬§é˜³', 'å¸é©¬', 'ä¸Šå®˜', 'è¯¸è‘›', 'ä¸œæ–¹', 'ç‹¬å­¤', 'å—å®«', 'è¥¿é—¨',
            'æ…•å®¹', 'è½©è¾•', 'ä»¤ç‹', 'çš‡ç”«', 'å…¬å­™', 'æ¾¹å°'
        ];
        
        // åå­—åº“ï¼ˆæ’çƒ/è¿åŠ¨ç›¸å…³ï¼‰
        const GIVEN_NAMES = [
            // æ’çƒæŠ€æœ¯ç›¸å…³
            'å‘çƒ', 'æ‰£æ€', 'æ‹¦ç½‘', 'é˜²å®ˆ', 'ä¼ çƒ', 'å«çƒ', 'é£˜çƒ', 'è·³å‘',
            'æš´æ‰£', 'è½»åŠ', 'å¿«æ”»', 'å¼ºæ”»', 'åæ”»', 'è·³é£˜', 'æ•‘çƒ', 'ä¸€ä¼ ',
            
            // è¿åŠ¨ç‰¹è´¨ç›¸å…³
            'å¦‚é£', 'ä¼¼ç”µ', 'ç ´ç©º', 'å‡Œäº‘', 'å†²å¤©', 'æƒŠé›·', 'é—ªç”µ', 'ç–¾é£',
            'ç¿±ç¿”', 'è…¾è·ƒ', 'é£æ‰¬', 'å¥”é›·', 'è¿½é£', 'é€æ—¥', 'ç ´æµª', 'å‡Œç©º',
            
            // åŠ±å¿—ç›¸å…³
            'å¿…èƒœ', 'äº‰å…ˆ', 'è¶…è¶Š', 'æ‹¼æ', 'å¥‹è¿›', 'å‘å‰', 'å†²é”‹', 'çªç ´',
            'ç™»å³°', 'å¤ºå† ', 'ç§°éœ¸', 'æ— æ•Œ', 'åˆ¶éœ¸', 'ç‹è€…', 'éœ¸ä¸»', 'è‡³å°Š',
            
            // å“è´¨ç›¸å…³
            'åšéŸ§', 'åˆšæ¯…', 'å‹‡çŒ›', 'æœæ•¢', 'æ— ç•', 'è‹±å‹‡', 'å¨æ­¦', 'ç¥å‹‡',
            'çµåŠ¨', 'æ•æ·', 'è¿…æ·', 'çŸ«å¥', 'å¼ºå¥', 'é›„å£®', 'å¨çŒ›', 'åˆšå¼º',
            
            // è°éŸ³æ¢—ï¼ˆæ›´åƒåå­—ï¼‰
            'çƒèƒœ', 'ç½‘ç½—', 'æ’äº‘', 'è·ƒè¿›', 'é«˜é£', 'è¿œå¿—', 'å‡Œå³°', 'éœ‡å¤©',
            'æƒŠé¸¿', 'ç»å°˜', 'æ— åŒ', 'ç‹¬ç§€', 'å‡ºä¼—', 'è¶…ç¾¤', 'å“è¶Š', 'éå‡¡',
            
            // å•å­—å
            'è·ƒ', 'é£', 'ç¿”', 'è…¾', 'å†²', 'é—¯', 'æ‹¼', 'æ',
            'å¼º', 'åˆš', 'å‹‡', 'å¨', 'çŒ›', 'é”', 'å³°', 'æ°',
            'çµ', 'æ•', 'æ·', 'å¿«', 'è¿…', 'ç–¾', 'é€Ÿ', 'é£'
        ];
        
        // ç”Ÿæˆéšæœºåå­—
        function generateRandomName() {
            const surname = SURNAMES[Math.floor(Math.random() * SURNAMES.length)];
            const givenName = GIVEN_NAMES[Math.floor(Math.random() * GIVEN_NAMES.length)];
            return surname + givenName;
        }
        
        // éšæœºäº‹ä»¶åº“ï¼ˆæ‰©å±•ç‰ˆï¼‰
        const RANDOM_EVENTS = [
            // è®­ç»ƒç›¸å…³äº‹ä»¶
            {
                id: 'senior_guidance',
                type: 'training',
                title: 'ğŸ“ å­¦é•¿æŒ‡å¯¼',
                text: 'è®­ç»ƒæ—¶ï¼Œä¸€ä½å­¦é•¿æ³¨æ„åˆ°äº†ä½ ï¼Œä¸»åŠ¨è¿‡æ¥æŒ‡å¯¼ä½ çš„åŠ¨ä½œã€‚',
                choices: [
                    {
                        text: 'è™šå¿ƒè¯·æ•™ï¼Œè®¤çœŸå­¦ä¹ ',
                        effect: { serve: 3, spike: 3, mood: 5, reputation: 2 },
                        result: 'å­¦é•¿å¾ˆé«˜å…´ï¼Œæ•™äº†ä½ ä¸€äº›æŠ€å·§ï¼Œä½ çš„æŠ€èƒ½æœ‰æ‰€æå‡ï¼'
                    },
                    {
                        text: 'ç¤¼è²Œæ„Ÿè°¢ï¼Œè‡ªå·±ç¢ç£¨',
                        effect: { mood: 2, stress: -2 },
                        result: 'ä½ ä¿æŒäº†è‡ªå·±çš„è®­ç»ƒèŠ‚å¥ã€‚'
                    }
                ]
            },
            {
                id: 'injury_risk',
                type: 'training',
                title: 'âš ï¸ è®­ç»ƒæ„å¤–',
                text: 'è®­ç»ƒå¼ºåº¦æœ‰ç‚¹å¤§ï¼Œä½ æ„Ÿè§‰èº«ä½“æœ‰äº›ä¸é€‚...',
                condition: { energy: 30, operator: '<' },
                weight: 3,
                choices: [
                    {
                        text: 'åšæŒå®Œæˆè®­ç»ƒ',
                        effect: { serve: 2, spike: 2, energy: -10, stress: 5 },
                        result: 'ä½ å’¬ç‰™åšæŒäº†ä¸‹æ¥ï¼ŒæŠ€èƒ½æœ‰æ‰€æå‡ï¼Œä½†å¾ˆç–²æƒ«ã€‚'
                    },
                    {
                        text: 'é€‚å½“ä¼‘æ¯ï¼Œä¿æŠ¤èº«ä½“',
                        effect: { energy: 5, mood: 3, stress: -3 },
                        result: 'ä½ æ˜æ™ºåœ°é€‰æ‹©äº†ä¼‘æ¯ï¼Œèº«ä½“æ¢å¤äº†ä¸€äº›ã€‚'
                    }
                ]
            },
            {
                id: 'coach_praise',
                type: 'training',
                title: 'ğŸ‘ æ•™ç»ƒè¡¨æ‰¬',
                text: 'æ•™ç»ƒæ³¨æ„åˆ°ä½ æœ€è¿‘çš„è¿›æ­¥ï¼Œå½“ä¼—è¡¨æ‰¬äº†ä½ ï¼',
                choices: [
                    {
                        text: 'è°¦è™šå›åº”ï¼Œç»§ç»­åŠªåŠ›',
                        effect: { mood: 8, reputation: 3, stress: -3 },
                        result: 'ä½ çš„è°¦è™šèµ¢å¾—äº†å¤§å®¶çš„å¥½æ„Ÿã€‚'
                    },
                    {
                        text: 'ä¿¡å¿ƒå¤§å¢ï¼ŒåŠ ç»ƒä¸€ä¼š',
                        effect: { serve: 3, spike: 3, energy: -8, mood: 10 },
                        result: 'ä½ è¶çƒ­æ‰“é“ï¼Œåˆç»ƒäº†ä¸€ä¼šå„¿ï¼Œæ”¶è·æ»¡æ»¡ï¼'
                    }
                ]
            },
            {
                id: 'teammate_competition',
                type: 'training',
                title: 'ğŸ”¥ é˜Ÿå‹åˆ‡ç£‹',
                text: 'ä¸€ä½é˜Ÿå‹å‘ä½ å‘èµ·å‹å¥½çš„æŠ€æœ¯åˆ‡ç£‹ã€‚',
                choices: [
                    {
                        text: 'å…¨åŠ›åº”æˆ˜',
                        effect: { spike: 4, dig: 2, set: 2, energy: -10, mood: 8, relationship: 3 },
                        result: 'æ¿€çƒˆçš„å¯¹æŠ—è®©ä½ ä»¬éƒ½æœ‰æ‰€æ”¶è·ï¼Œå‹è°Šä¹ŸåŠ æ·±äº†ï¼'
                    },
                    {
                        text: 'å©‰æ‹’ï¼Œä¿å­˜ä½“åŠ›',
                        effect: { energy: 5, stress: -2 },
                        result: 'ä½ é€‰æ‹©äº†ä¼‘æ¯ï¼Œä¿å­˜ä½“åŠ›ã€‚'
                    }
                ]
            },
            
            // ç”Ÿæ´»ç›¸å…³äº‹ä»¶
            {
                id: 'meet_friend',
                type: 'life',
                title: 'ğŸ‘‹ å¶é‡æœ‹å‹',
                text: 'åœ¨é£Ÿå ‚é‡åˆ°äº†è€æœ‹å‹ï¼Œä»–é‚€è¯·ä½ ä¸€èµ·åƒé¥­èŠå¤©ã€‚',
                choices: [
                    {
                        text: 'æ„‰å¿«èŠå¤©ï¼Œåˆ†äº«è¿‘å†µ',
                        effect: { mood: 10, stress: -5, money: -15 },
                        result: 'ä½ ä»¬èŠå¾—å¾ˆå¼€å¿ƒï¼Œå¿ƒæƒ…èˆ’ç•…äº†è®¸å¤šï¼'
                    },
                    {
                        text: 'ç®€å•å¯’æš„ï¼Œå„è‡ªç¦»å¼€',
                        effect: { mood: 2 },
                        result: 'ä½ ä»¬ç®€å•èŠäº†å‡ å¥å°±åˆ†å¼€äº†ã€‚'
                    }
                ]
            },
            {
                id: 'study_pressure',
                type: 'life',
                title: 'ğŸ“ è¯¾ä¸šå‹åŠ›',
                text: 'çªç„¶æƒ³èµ·æ˜å¤©æœ‰ä¸ªä½œä¸šè¦äº¤ï¼Œè¿˜æ²¡å¼€å§‹åš...',
                choices: [
                    {
                        text: 'ç†¬å¤œèµ¶ä½œä¸š',
                        effect: { energy: -15, mood: -5, stress: 8, reputation: 2 },
                        result: 'ä½ ç†¬å¤œå®Œæˆäº†ä½œä¸šï¼Œä½†å¾ˆç–²æƒ«ã€‚'
                    },
                    {
                        text: 'å…ˆä¼‘æ¯ï¼Œæ˜æ—©æ—©èµ·åš',
                        effect: { energy: 10, stress: 3 },
                        result: 'ä½ é€‰æ‹©äº†å…ˆä¼‘æ¯ï¼Œæ˜å¤©å†è¯´ã€‚'
                    },
                    {
                        text: 'æ‰¾åŒå­¦å€Ÿé‰´ä¸€ä¸‹',
                        effect: { mood: 5, stress: -5, relationship: -2 },
                        result: 'åŒå­¦å¸®äº†ä½ ï¼Œä½†ä½ æœ‰ç‚¹ä¸å¥½æ„æ€ã€‚'
                    }
                ]
            },
            {
                id: 'lucky_money',
                type: 'life',
                title: 'ğŸ’° æ„å¤–ä¹‹è´¢',
                text: 'åœ¨è·¯ä¸Šæ¡åˆ°äº†ä¸€äº›é’±ï¼',
                choices: [
                    {
                        text: 'äº¤ç»™å¤±ç‰©æ‹›é¢†å¤„',
                        effect: { mood: 5, reputation: 5 },
                        result: 'ä½ åšäº†æ­£ç¡®çš„äº‹ï¼Œå¿ƒé‡Œå¾ˆè¸å®ã€‚'
                    },
                    {
                        text: 'è‡ªå·±ç•™ç€ç”¨',
                        effect: { money: 30, mood: 8, stress: 2 },
                        result: 'ä½ æŠŠé’±ç•™ä¸‹äº†ï¼Œä½†å¿ƒé‡Œæœ‰ç‚¹ä¸å®‰ã€‚'
                    }
                ]
            },
            {
                id: 'club_activity',
                type: 'life',
                title: 'ğŸ‰ ç¤¾å›¢æ´»åŠ¨',
                text: 'æ’çƒç¤¾å›¢ç»„ç»‡èšé¤æ´»åŠ¨ï¼Œé‚€è¯·ä½ å‚åŠ ã€‚',
                choices: [
                    {
                        text: 'ç§¯æå‚åŠ ',
                        effect: { mood: 15, stress: -8, money: -30, relationship: 8 },
                        result: 'èšé¤å¾ˆæ„‰å¿«ï¼Œä½ å’Œé˜Ÿå‹ä»¬çš„å…³ç³»æ›´è¿‘äº†ï¼'
                    },
                    {
                        text: 'å©‰æ‹’é‚€è¯·',
                        effect: { energy: 10, money: 10 },
                        result: 'ä½ é€‰æ‹©äº†ä¼‘æ¯ï¼Œçœä¸‹äº†ä¸€ç¬”å¼€é”€ã€‚'
                    }
                ]
            },
            {
                id: 'equipment_sale',
                type: 'life',
                title: 'ğŸ›ï¸ è£…å¤‡ä¿ƒé”€',
                text: 'ä½“è‚²ç”¨å“åº—åœ¨æ‰“æŠ˜ï¼Œæœ‰ä¸€åŒå¾ˆä¸é”™çš„æ’çƒé‹ã€‚',
                choices: [
                    {
                        text: 'ä¹°ä¸‹æ¥ï¼ˆèŠ±è´¹80å…ƒï¼‰',
                        effect: { money: -80, mood: 12, serve: 2, spike: 2 },
                        requirement: { money: 80 },
                        result: 'æ–°é‹å¾ˆèˆ’é€‚ï¼Œè®­ç»ƒæ•ˆæœæ›´å¥½äº†ï¼'
                    },
                    {
                        text: 'ä¸ä¹°ï¼Œçœé’±',
                        effect: { mood: -3 },
                        result: 'ä½ å¿ä½äº†è´­ä¹°çš„å†²åŠ¨ã€‚'
                    }
                ]
            },
            {
                id: 'weather_good',
                type: 'life',
                title: 'â˜€ï¸ å¥½å¤©æ°”',
                text: 'ä»Šå¤©å¤©æ°”ç‰¹åˆ«å¥½ï¼Œé˜³å…‰æ˜åªšï¼Œå¿ƒæƒ…èˆ’ç•…ã€‚',
                choices: [
                    {
                        text: 'å‡ºå»æ•£æ•£æ­¥',
                        effect: { mood: 10, stress: -5, energy: 5 },
                        result: 'ä½ äº«å—äº†ç¾å¥½çš„å¤©æ°”ï¼Œç¥æ¸…æ°”çˆ½ï¼'
                    },
                    {
                        text: 'åœ¨å®¿èˆä¼‘æ¯',
                        effect: { energy: 8, mood: 3 },
                        result: 'ä½ åœ¨å®¿èˆå¥½å¥½ä¼‘æ¯äº†ä¸€ä¸‹ã€‚'
                    }
                ]
            },
            
            // æ–°å¢äº‹ä»¶ - åŸºäºå±æ€§è§¦å‘
            {
                id: 'serious_injury',
                type: 'training',
                title: 'ğŸš‘ è¿åŠ¨æŸä¼¤',
                text: 'ç³Ÿç³•ï¼è®­ç»ƒæ—¶ä½ ä¸å°å¿ƒæ‰­ä¼¤äº†è„šè¸ï¼Œç–¼ç—›éš¾å¿...',
                condition: { energy: 20, operator: '<' },
                weight: 5,
                choices: [
                    {
                        text: 'ç«‹å³å»åŒ»åŠ¡å®¤ï¼ˆèŠ±è´¹50å…ƒï¼‰',
                        effect: { energy: -5, mood: -10, stress: 5, money: -50 },
                        requirement: { money: 50 },
                        result: 'åŒ»ç”Ÿç»™ä½ åšäº†å¤„ç†ï¼Œéœ€è¦ä¼‘æ¯å‡ å¤©ã€‚'
                    },
                    {
                        text: 'å¿ä¸€å¿ï¼Œè‡ªå·±å¤„ç†',
                        effect: { energy: -15, mood: -15, stress: 10, serve: -2, spike: -2 },
                        result: 'ä¼¤åŠ¿åŠ é‡äº†ï¼Œå½±å“äº†ä½ çš„çŠ¶æ€å’ŒæŠ€èƒ½...'
                    }
                ]
            },
            {
                id: 'perfect_state',
                type: 'training',
                title: 'âœ¨ å®Œç¾çŠ¶æ€',
                text: 'ä»Šå¤©çŠ¶æ€ç‰¹åˆ«å¥½ï¼Œæ„Ÿè§‰æµ‘èº«å……æ»¡åŠ›é‡ï¼',
                condition: { energy: 80, mood: 70, operator: '>' },
                weight: 4,
                choices: [
                    {
                        text: 'æŠ“ä½æœºä¼šï¼Œå¼ºåŒ–è®­ç»ƒ',
                        effect: { serve: 6, spike: 6, block: 6, dig: 3, set: 3, energy: -20, mood: 10 },
                        result: 'ä½ å……åˆ†åˆ©ç”¨äº†è¿™ä¸ªçŠ¶æ€ï¼ŒæŠ€èƒ½å¤§å¹…æå‡ï¼'
                    },
                    {
                        text: 'æ­£å¸¸è®­ç»ƒå³å¯',
                        effect: { serve: 3, spike: 3, energy: -10, mood: 5 },
                        result: 'ä½ å®Œæˆäº†æ­£å¸¸çš„è®­ç»ƒã€‚'
                    }
                ]
            },
            {
                id: 'technique_breakthrough',
                type: 'training',
                title: 'ğŸ’¡ æŠ€æœ¯çªç ´',
                text: 'è®­ç»ƒä¸­ä½ çªç„¶é¢†æ‚Ÿäº†ä¸€ä¸ªæ–°æŠ€å·§ï¼',
                choices: [
                    {
                        text: 'åå¤ç»ƒä¹ ï¼Œå·©å›ºæŠ€å·§',
                        effect: { serve: 5, spike: 5, energy: -15, mood: 12 },
                        result: 'ä½ æŠŠæ–°æŠ€å·§ç»ƒå¾—å¾ˆç†Ÿç»ƒäº†ï¼'
                    },
                    {
                        text: 'è®°åœ¨å¿ƒé‡Œï¼Œä¸‹æ¬¡å†ç»ƒ',
                        effect: { serve: 2, spike: 2, mood: 5 },
                        result: 'ä½ è®°ä½äº†è¿™ä¸ªæŠ€å·§ã€‚'
                    }
                ]
            },
            {
                id: 'equipment_broken',
                type: 'training',
                title: 'ğŸ’” è£…å¤‡æŸå',
                text: 'è®­ç»ƒæ—¶ä½ çš„çƒé‹å¼€èƒ¶äº†ï¼Œå½±å“äº†è®­ç»ƒæ•ˆæœã€‚',
                choices: [
                    {
                        text: 'é©¬ä¸Šå»ä¹°æ–°çš„ï¼ˆèŠ±è´¹100å…ƒï¼‰',
                        effect: { money: -100, mood: -5, serve: 3, spike: 3 },
                        requirement: { money: 100 },
                        result: 'æ–°é‹å¾ˆåˆè„šï¼Œè®­ç»ƒæ•ˆæœæ›´å¥½äº†ï¼'
                    },
                    {
                        text: 'å‡‘åˆç€ç”¨',
                        effect: { mood: -8, serve: -2, spike: -2 },
                        result: 'ç ´é‹å½±å“äº†ä½ çš„å‘æŒ¥...'
                    }
                ]
            },
            {
                id: 'depression',
                type: 'life',
                title: 'ğŸ˜” æƒ…ç»ªä½è½',
                text: 'æœ€è¿‘å¿ƒæƒ…ä¸€ç›´ä¸å¤ªå¥½ï¼Œæ„Ÿè§‰æœ‰äº›æŠ‘éƒ...',
                condition: { mood: 30, operator: '<' },
                weight: 4,
                choices: [
                    {
                        text: 'æ‰¾æœ‹å‹å€¾è¯‰',
                        effect: { mood: 15, stress: -10, relationship: 5 },
                        result: 'æœ‹å‹çš„å®‰æ…°è®©ä½ æ„Ÿè§‰å¥½å¤šäº†ã€‚'
                    },
                    {
                        text: 'è‡ªå·±è°ƒèŠ‚ï¼Œå‡ºå»èµ°èµ°',
                        effect: { mood: 8, stress: -5, energy: -5 },
                        result: 'æ•£æ­¥è®©ä½ çš„å¿ƒæƒ…ç¨å¾®å¥½äº†ä¸€äº›ã€‚'
                    },
                    {
                        text: 'ä¸€ä¸ªäººå¾…ç€',
                        effect: { mood: -5, stress: 5 },
                        result: 'ä½ ç‹¬è‡ªå¾…äº†ä¸€ä¼šå„¿ï¼Œä½†å¿ƒæƒ…æ²¡æœ‰å¥½è½¬ã€‚'
                    }
                ]
            },
            {
                id: 'stress_overload',
                type: 'life',
                title: 'ğŸ˜° å‹åŠ›çˆ†è¡¨',
                text: 'å‹åŠ›å¤ªå¤§äº†ï¼Œä½ æ„Ÿè§‰å¿«è¦å´©æºƒäº†...',
                condition: { stress: 80, operator: '>' },
                weight: 5,
                choices: [
                    {
                        text: 'æ”¾ä¸‹ä¸€åˆ‡ï¼Œå¥½å¥½ä¼‘æ¯',
                        effect: { stress: -20, mood: 10, energy: 15 },
                        result: 'ä½ ç»™è‡ªå·±æ”¾äº†ä¸ªå‡ï¼Œæ„Ÿè§‰è½»æ¾å¤šäº†ã€‚'
                    },
                    {
                        text: 'æ‰¾å¿ƒç†å’¨è¯¢ï¼ˆèŠ±è´¹50å…ƒï¼‰',
                        effect: { stress: -25, mood: 8, money: -50 },
                        requirement: { money: 50 },
                        result: 'ä¸“ä¸šçš„å¸®åŠ©è®©ä½ é‡Šæ”¾äº†å‹åŠ›ã€‚'
                    },
                    {
                        text: 'ç»§ç»­ç¡¬æ’‘',
                        effect: { stress: 5, mood: -10, energy: -10 },
                        result: 'ä½ çš„çŠ¶æ€è¶Šæ¥è¶Šå·®...'
                    }
                ]
            },
            {
                id: 'broke',
                type: 'life',
                title: 'ğŸ’¸ æ‰‹å¤´ç´§å¼ ',
                text: 'é’±å¿«èŠ±å…‰äº†ï¼Œè¿™å‘¨çš„ç”Ÿæ´»è´¹ä¸å¤Ÿç”¨äº†...',
                condition: { money: 50, operator: '<' },
                weight: 4,
                choices: [
                    {
                        text: 'æ‰¾å…¼èŒæ‰“å·¥',
                        effect: { money: 100, energy: -20, stress: 5, mood: -5 },
                        result: 'ä½ è¾›è‹¦æ‰“å·¥èµšäº†äº›é’±ã€‚'
                    },
                    {
                        text: 'å‘å®¶é‡Œè¦é’±',
                        effect: { money: 200, mood: -5, stress: 3 },
                        result: 'å®¶é‡Œç»™ä½ æ‰“äº†é’±ï¼Œä½†ä½ æœ‰äº›æ„§ç–šã€‚'
                    },
                    {
                        text: 'èŠ‚è¡£ç¼©é£Ÿ',
                        effect: { mood: -8, energy: -5 },
                        result: 'ä½ å¼€å§‹çœåƒä¿­ç”¨ã€‚'
                    }
                ]
            },
            {
                id: 'scholarship',
                type: 'life',
                title: 'ğŸ“ å¥–å­¦é‡‘é€šçŸ¥',
                text: 'ä½ è·å¾—äº†å­¦æ ¡çš„å¥–å­¦é‡‘ï¼',
                condition: { reputation: 50, operator: '>' },
                weight: 2,
                choices: [
                    {
                        text: 'å¼€å¿ƒæ¥å—',
                        effect: { money: 300, mood: 20, reputation: 5 },
                        result: 'è¿™æ˜¯å¯¹ä½ åŠªåŠ›çš„è®¤å¯ï¼'
                    }
                ]
            },
            {
                id: 'love_confession',
                type: 'life',
                title: 'ğŸ’• æœ‰äººè¡¨ç™½',
                text: 'ä¸€ä½åŒå­¦å‘ä½ è¡¨ç™½äº†ï¼',
                condition: { reputation: 60, operator: '>' },
                weight: 1,
                choices: [
                    {
                        text: 'æ¥å—ï¼Œå¼€å§‹æ‹çˆ±',
                        effect: { mood: 25, stress: -15, energy: -5, money: -50 },
                        result: 'ä½ ä»¬åœ¨ä¸€èµ·äº†ï¼Œæ„Ÿè§‰å¾ˆå¹¸ç¦ï¼'
                    },
                    {
                        text: 'å©‰æ‹’ï¼Œä¸“æ³¨æ’çƒ',
                        effect: { mood: -5, stress: 5, serve: 3, spike: 3 },
                        result: 'ä½ é€‰æ‹©äº†ä¸“æ³¨äºæ’çƒäº‹ä¸šã€‚'
                    }
                ]
            },
            {
                id: 'family_call',
                type: 'life',
                title: 'ğŸ“ å®¶äººæ¥ç”µ',
                text: 'å®¶é‡Œæ‰“æ¥ç”µè¯ï¼Œå…³å¿ƒä½ çš„è¿‘å†µã€‚',
                choices: [
                    {
                        text: 'èŠèŠè¿‘å†µ',
                        effect: { mood: 12, stress: -8 },
                        result: 'å’Œå®¶äººèŠå¤©è®©ä½ æ„Ÿåˆ°æ¸©æš–ã€‚'
                    },
                    {
                        text: 'ç®€å•æŠ¥å¹³å®‰',
                        effect: { mood: 3 },
                        result: 'ä½ ç®€å•è¯´äº†å‡ å¥å°±æŒ‚äº†ç”µè¯ã€‚'
                    }
                ]
            },
            {
                id: 'roommate_conflict',
                type: 'life',
                title: 'ğŸ˜¤ å®¤å‹çŸ›ç›¾',
                text: 'å’Œå®¤å‹å› ä¸ºä¸€äº›å°äº‹å‘ç”Ÿäº†äº‰æ‰§ã€‚',
                choices: [
                    {
                        text: 'ä¸»åŠ¨é“æ­‰å’Œè§£',
                        effect: { mood: 5, stress: -5, relationship: 3 },
                        result: 'ä½ ä»¬å’Œå¥½äº†ï¼Œå…³ç³»åè€Œæ›´è¿‘äº†ã€‚'
                    },
                    {
                        text: 'å†·æˆ˜å¤„ç†',
                        effect: { mood: -10, stress: 8 },
                        result: 'å®¿èˆæ°”æ°›å˜å¾—å¾ˆå°´å°¬...'
                    }
                ]
            },
            {
                id: 'game_addiction',
                type: 'life',
                title: 'ğŸ® æ¸¸æˆè¯±æƒ‘',
                text: 'æ–°æ¸¸æˆä¸Šçº¿äº†ï¼Œæœ‹å‹ä»¬éƒ½åœ¨ç©ï¼Œä½ ä¹Ÿå¾ˆæƒ³è¯•è¯•...',
                choices: [
                    {
                        text: 'ç©ä¸€æ•´å¤©',
                        effect: { mood: 20, stress: -15, energy: -15, serve: -2, spike: -2 },
                        result: 'æ¸¸æˆå¾ˆå¥½ç©ï¼Œä½†è’åºŸäº†è®­ç»ƒ...'
                    },
                    {
                        text: 'ç©ä¸€ä¼šå°±åœ',
                        effect: { mood: 10, stress: -5, energy: -5 },
                        result: 'ä½ é€‚åº¦å¨±ä¹ï¼Œä¿æŒäº†å¹³è¡¡ã€‚'
                    },
                    {
                        text: 'æ‹’ç»è¯±æƒ‘',
                        effect: { mood: -3, serve: 3, spike: 3 },
                        result: 'ä½ åšæŒè®­ç»ƒï¼ŒæŠ€èƒ½æœ‰æ‰€æå‡ã€‚'
                    }
                ]
            },
            {
                id: 'food_poisoning',
                type: 'life',
                title: 'ğŸ¤¢ é£Ÿç‰©ä¸­æ¯’',
                text: 'åƒäº†ä¸å¹²å‡€çš„ä¸œè¥¿ï¼Œè‚šå­å¾ˆä¸èˆ’æœ...',
                choices: [
                    {
                        text: 'å»åŒ»é™¢çœ‹ç—…ï¼ˆèŠ±è´¹80å…ƒï¼‰',
                        effect: { energy: -10, mood: -5, money: -80 },
                        requirement: { money: 80 },
                        result: 'åŒ»ç”Ÿç»™ä½ å¼€äº†è¯ï¼Œä¼‘æ¯å‡ å¤©å°±å¥½äº†ã€‚'
                    },
                    {
                        text: 'è‡ªå·±ä¹°è¯åƒï¼ˆèŠ±è´¹20å…ƒï¼‰',
                        effect: { energy: -15, mood: -8, money: -20 },
                        requirement: { money: 20 },
                        result: 'åƒäº†è¯ï¼Œä½†è¿˜æ˜¯å¾ˆéš¾å—ã€‚'
                    }
                ]
            },
            {
                id: 'volunteer_activity',
                type: 'life',
                title: 'ğŸ¤ å¿—æ„¿è€…æ´»åŠ¨',
                text: 'å­¦æ ¡ç»„ç»‡å¿—æ„¿è€…æ´»åŠ¨ï¼Œé‚€è¯·ä½ å‚åŠ ã€‚',
                choices: [
                    {
                        text: 'ç§¯æå‚ä¸',
                        effect: { mood: 15, stress: -5, energy: -10, reputation: 8 },
                        result: 'å¸®åŠ©ä»–äººè®©ä½ æ„Ÿåˆ°å¾ˆå……å®ï¼'
                    },
                    {
                        text: 'å©‰æ‹’é‚€è¯·',
                        effect: { energy: 5 },
                        result: 'ä½ é€‰æ‹©äº†ä¼‘æ¯ã€‚'
                    }
                ]
            },
            {
                id: 'talent_show',
                type: 'life',
                title: 'ğŸ¤ æ‰è‰ºè¡¨æ¼”',
                text: 'å­¦æ ¡ä¸¾åŠæ‰è‰ºè¡¨æ¼”ï¼Œæœ‰äººå»ºè®®ä½ å±•ç¤ºæ’çƒæŠ€å·§ã€‚',
                condition: { serve: 40, spike: 40, operator: '>' },
                weight: 2,
                choices: [
                    {
                        text: 'ä¸Šå°è¡¨æ¼”',
                        effect: { mood: 18, stress: 5, reputation: 10, relationship: 8 },
                        result: 'ä½ çš„è¡¨æ¼”èµ¢å¾—äº†çƒ­çƒˆæŒå£°ï¼'
                    },
                    {
                        text: 'å®³ç¾æ‹’ç»',
                        effect: { mood: -3, stress: -2 },
                        result: 'ä½ ä¸å¥½æ„æ€ä¸Šå°ã€‚'
                    }
                ]
            },
            {
                id: 'exam_week',
                type: 'life',
                title: 'ğŸ“š è€ƒè¯•å‘¨',
                text: 'æœŸæœ«è€ƒè¯•å‘¨åˆ°äº†ï¼Œéœ€è¦å¹³è¡¡å­¦ä¹ å’Œè®­ç»ƒã€‚',
                choices: [
                    {
                        text: 'ä¸“å¿ƒå¤ä¹ ï¼Œæš‚åœè®­ç»ƒ',
                        effect: { stress: 10, energy: -10, serve: -3, spike: -3, reputation: 5 },
                        result: 'ä½ é€šè¿‡äº†è€ƒè¯•ï¼Œä½†æŠ€èƒ½æœ‰æ‰€é€€æ­¥ã€‚'
                    },
                    {
                        text: 'ä¸¤è€…å…¼é¡¾',
                        effect: { stress: 15, energy: -20, mood: -10 },
                        result: 'ä½ å¾ˆç´¯ï¼Œä½†éƒ½åšæŒäº†ä¸‹æ¥ã€‚'
                    },
                    {
                        text: 'ä¼˜å…ˆè®­ç»ƒ',
                        effect: { serve: 5, spike: 5, stress: 8, reputation: -5 },
                        result: 'è®­ç»ƒæ•ˆæœä¸é”™ï¼Œä½†æˆç»©ä¸å¤ªç†æƒ³ã€‚'
                    }
                ]
            },
            {
                id: 'birthday',
                type: 'life',
                title: 'ğŸ‚ ç”Ÿæ—¥å¿«ä¹',
                text: 'ä»Šå¤©æ˜¯ä½ çš„ç”Ÿæ—¥ï¼Œé˜Ÿå‹ä»¬ç»™ä½ å‡†å¤‡äº†æƒŠå–œï¼',
                choices: [
                    {
                        text: 'å¼€å¿ƒåº†ç¥',
                        effect: { mood: 25, stress: -15, relationship: 10, money: -30 },
                        result: 'è¿™æ˜¯éš¾å¿˜çš„ä¸€å¤©ï¼'
                    }
                ]
            },
            {
                id: 'rainy_day',
                type: 'life',
                title: 'ğŸŒ§ï¸ é˜´é›¨å¤©',
                text: 'è¿ç»­ä¸‹äº†å¥½å‡ å¤©é›¨ï¼Œå¿ƒæƒ…æœ‰äº›ä½è½ã€‚',
                choices: [
                    {
                        text: 'å®¤å†…è®­ç»ƒ',
                        effect: { serve: 3, spike: 3, energy: -10, mood: -3 },
                        result: 'è™½ç„¶å¤©æ°”ä¸å¥½ï¼Œä½†ä½ åšæŒäº†è®­ç»ƒã€‚'
                    },
                    {
                        text: 'ä¼‘æ¯æ”¾æ¾',
                        effect: { energy: 10, mood: 5, stress: -5 },
                        result: 'ä½ å¥½å¥½ä¼‘æ¯äº†ä¸€ä¸‹ã€‚'
                    }
                ]
            },
            {
                id: 'inspiration',
                type: 'life',
                title: 'ğŸ’« è§‚èµ›å¯å‘',
                text: 'çœ‹äº†ä¸€åœºç²¾å½©çš„æ’çƒæ¯”èµ›ï¼Œæ·±å—å¯å‘ï¼',
                choices: [
                    {
                        text: 'é©¬ä¸Šå»è®­ç»ƒ',
                        effect: { serve: 5, spike: 5, block: 5, energy: -15, mood: 15 },
                        result: 'ä½ å……æ»¡åŠ¨åŠ›ï¼Œè®­ç»ƒæ•ˆæœå¾ˆå¥½ï¼'
                    },
                    {
                        text: 'è®°åœ¨å¿ƒé‡Œ',
                        effect: { mood: 8, serve: 2, spike: 2 },
                        result: 'ä½ å­¦åˆ°äº†ä¸€äº›æ–°ä¸œè¥¿ã€‚'
                    }
                ]
            },
            {
                id: 'senior_retire',
                type: 'life',
                title: 'ğŸ‘‹ å­¦é•¿æ¯•ä¸š',
                text: 'ä¸€ç›´æŒ‡å¯¼ä½ çš„å­¦é•¿è¦æ¯•ä¸šäº†ï¼Œä»–é€ç»™ä½ ä¸€äº›è®­ç»ƒå¿ƒå¾—ã€‚',
                condition: { reputation: 40, operator: '>' },
                weight: 2,
                choices: [
                    {
                        text: 'è®¤çœŸå­¦ä¹ å¿ƒå¾—',
                        effect: { serve: 4, spike: 4, block: 4, dig: 2, set: 2, mood: 10, reputation: 5 },
                        result: 'å­¦é•¿çš„ç»éªŒè®©ä½ å—ç›ŠåŒªæµ…ï¼'
                    },
                    {
                        text: 'æ„Ÿè°¢å¹¶é“åˆ«',
                        effect: { mood: 5, reputation: 2 },
                        result: 'ä½ ä»¬äº’ç›¸ç¥ç¦ã€‚'
                    }
                ]
            },
            {
                id: 'media_interview',
                type: 'life',
                title: 'ğŸ“° åª’ä½“é‡‡è®¿',
                text: 'æ ¡æŠ¥è®°è€…æƒ³é‡‡è®¿ä½ è¿™ä½æ’çƒæ–°æ˜Ÿã€‚',
                condition: { reputation: 80, operator: '>' },
                weight: 2,
                choices: [
                    {
                        text: 'æ¥å—é‡‡è®¿',
                        effect: { mood: 12, stress: 5, reputation: 10 },
                        result: 'ä½ çš„æ•…äº‹ç™»ä¸Šäº†æ ¡æŠ¥ï¼'
                    },
                    {
                        text: 'ä½è°ƒæ‹’ç»',
                        effect: { mood: 3, stress: -3 },
                        result: 'ä½ é€‰æ‹©ä¿æŒä½è°ƒã€‚'
                    }
                ]
            },
            {
                id: 'lucky_day',
                type: 'life',
                title: 'ğŸ€ å¹¸è¿æ—¥',
                text: 'ä»Šå¤©è¿æ°”ç‰¹åˆ«å¥½ï¼Œå¥½äº‹è¿è¿ï¼',
                choices: [
                    {
                        text: 'äº«å—è¿™ä¸€å¤©',
                        effect: { mood: 15, stress: -10, money: 50, reputation: 3 },
                        result: 'çœŸæ˜¯ç¾å¥½çš„ä¸€å¤©ï¼'
                    }
                ]
            },
            {
                id: 'part_time_offer',
                type: 'life',
                title: 'ğŸ’¼ å…¼èŒæœºä¼š',
                text: 'ä½“è‚²ç”¨å“åº—è€æ¿çœ‹ä¸­äº†ä½ ï¼Œé‚€è¯·ä½ æ¥åº—é‡Œåšå…¼èŒã€‚',
                choices: [
                    {
                        text: 'æ¥å—å…¼èŒï¼ˆé‡‘é’±+200ï¼Œä½“åŠ›-15ï¼Œå‹åŠ›+5ï¼‰',
                        effect: { money: 200, energy: -15, stress: 5, mood: 5 },
                        result: 'ä½ åœ¨åº—é‡Œå·¥ä½œäº†ä¸€æ®µæ—¶é—´ï¼Œèµšäº†ä¸å°‘é’±ã€‚'
                    },
                    {
                        text: 'å©‰æ‹’ï¼Œä¸“æ³¨è®­ç»ƒ',
                        effect: { serve: 3, spike: 3, mood: 3 },
                        result: 'ä½ é€‰æ‹©æŠŠæ—¶é—´ç”¨åœ¨è®­ç»ƒä¸Šã€‚'
                    }
                ]
            },
            {
                id: 'shopping_temptation',
                type: 'life',
                title: 'ğŸ›ï¸ è´­ç‰©è¯±æƒ‘',
                text: 'è·¯è¿‡å•†åœºï¼Œçœ‹åˆ°å¾ˆå¤šæƒ³ä¹°çš„ä¸œè¥¿...',
                condition: { money: 200, operator: '>' },
                weight: 2,
                choices: [
                    {
                        text: 'ç–¯ç‹‚è´­ç‰©ï¼ˆå¿ƒæƒ…+30ï¼ŒèŠ±è´¹300å…ƒï¼‰',
                        effect: { mood: 30, stress: -15, money: -300 },
                        requirement: { money: 300 },
                        result: 'ä¹°ä¹°ä¹°ï¼å¿ƒæƒ…å¤§å¥½ï¼'
                    },
                    {
                        text: 'ç†æ€§æ¶ˆè´¹ï¼ˆå¿ƒæƒ…+10ï¼ŒèŠ±è´¹50å…ƒï¼‰',
                        effect: { mood: 10, money: -50 },
                        requirement: { money: 50 },
                        result: 'ä½ åªä¹°äº†å¿…éœ€å“ã€‚'
                    },
                    {
                        text: 'å¿ä½ä¸ä¹°',
                        effect: { mood: -5, stress: 3 },
                        result: 'ä½ å¿ä½äº†è´­ç‰©çš„å†²åŠ¨ï¼Œä½†æœ‰ç‚¹ä¸å¼€å¿ƒã€‚'
                    }
                ]
            },
            {
                id: 'sponsor_offer',
                type: 'life',
                title: 'ğŸ¤ èµåŠ©é‚€çº¦',
                text: 'ä¸€å®¶è¿åŠ¨å“ç‰Œçœ‹ä¸­äº†ä½ çš„æ½œåŠ›ï¼Œæ„¿æ„æä¾›èµåŠ©ï¼',
                condition: { reputation: 70, operator: '>' },
                weight: 2,
                choices: [
                    {
                        text: 'æ¥å—èµåŠ©',
                        effect: { money: 500, mood: 20, reputation: 10, serve: 3, spike: 3 },
                        result: 'ä½ è·å¾—äº†å“ç‰ŒèµåŠ©ï¼Œè¿˜å¾—åˆ°äº†ä¸“ä¸šè£…å¤‡ï¼'
                    },
                    {
                        text: 'æš‚æ—¶æ‹’ç»',
                        effect: { mood: 5 },
                        result: 'ä½ è§‰å¾—æ—¶æœºè¿˜ä¸æˆç†Ÿã€‚'
                    }
                ]
            },
            {
                id: 'lottery_win',
                type: 'life',
                title: 'ğŸ° ä¸­å¥–äº†',
                text: 'ä½ ä¹°çš„å½©ç¥¨ä¸­äº†å°å¥–ï¼',
                choices: [
                    {
                        text: 'å¼€å¿ƒæ”¶é’±',
                        effect: { money: 100, mood: 15 },
                        result: 'æ„å¤–ä¹‹è´¢ï¼ŒçœŸå¼€å¿ƒï¼'
                    }
                ]
            },
            {
                id: 'friend_borrow',
                type: 'life',
                title: 'ğŸ’¸ æœ‹å‹å€Ÿé’±',
                text: 'ä¸€ä½æœ‹å‹é‡åˆ°å›°éš¾ï¼Œå‘ä½ å€Ÿ200å…ƒã€‚',
                condition: { money: 200, operator: '>' },
                weight: 2,
                choices: [
                    {
                        text: 'å€Ÿç»™ä»–',
                        effect: { money: -200, mood: 5, relationship: 10, reputation: 5 },
                        result: 'æœ‹å‹å¾ˆæ„Ÿæ¿€ä½ çš„å¸®åŠ©ã€‚'
                    },
                    {
                        text: 'å©‰æ‹’',
                        effect: { mood: -5, relationship: -5 },
                        result: 'ä½ æ‹’ç»äº†ï¼Œä½†å¿ƒé‡Œæœ‰äº›ä¸å®‰ã€‚'
                    }
                ]
            },
            {
                id: 'expensive_equipment',
                type: 'life',
                title: 'â­ é¡¶çº§è£…å¤‡',
                text: 'å‘ç°ä¸€å¥—é¡¶çº§æ’çƒè£…å¤‡ï¼Œä½†ä»·æ ¼æ˜‚è´µï¼ˆ500å…ƒï¼‰ã€‚',
                condition: { money: 500, operator: '>' },
                weight: 2,
                choices: [
                    {
                        text: 'ä¹°ä¸‹æ¥',
                        effect: { money: -500, mood: 25, serve: 5, spike: 5, block: 5, dig: 3, set: 3 },
                        requirement: { money: 500 },
                        result: 'é¡¶çº§è£…å¤‡è®©ä½ çš„è®­ç»ƒæ•ˆæœå¤§å¹…æå‡ï¼'
                    },
                    {
                        text: 'å¤ªè´µäº†ï¼Œä¸ä¹°',
                        effect: { mood: -8 },
                        result: 'ä½ å¿ç—›æ”¾å¼ƒäº†ã€‚'
                    }
                ]
            },
            {
                id: 'treat_teammates',
                type: 'life',
                title: 'ğŸ• è¯·å®¢åƒé¥­',
                text: 'é˜Ÿå‹ä»¬æè®®èšé¤ï¼Œå¤§å®¶éƒ½çœ‹ç€ä½ ...',
                choices: [
                    {
                        text: 'æˆ‘è¯·å®¢ï¼ï¼ˆèŠ±è´¹150å…ƒï¼‰',
                        effect: { money: -150, mood: 15, relationship: 20, reputation: 8 },
                        requirement: { money: 150 },
                        result: 'ä½ çš„æ…·æ…¨èµ¢å¾—äº†å¤§å®¶çš„å¥½æ„Ÿï¼'
                    },
                    {
                        text: 'AAåˆ¶å§ï¼ˆèŠ±è´¹30å…ƒï¼‰',
                        effect: { money: -30, mood: 8, relationship: 5 },
                        requirement: { money: 30 },
                        result: 'å¤§å®¶AAåˆ¶ï¼Œæ°”æ°›ä¹Ÿä¸é”™ã€‚'
                    },
                    {
                        text: 'æˆ‘æ²¡é’±ï¼Œä¸å»äº†',
                        effect: { mood: -10, relationship: -5 },
                        result: 'ä½ é”™è¿‡äº†è¿™æ¬¡èšé¤ã€‚'
                    }
                ]
            }
        ];
        
        const SCENES = {
            nameInput: {
                text: `<div id="name-input-panel">
                    <h2>ğŸ æ¬¢è¿æ¥åˆ°æ’çƒä¹‹æ˜Ÿ</h2>
                    <p style="margin-bottom: 20px; color: #666;">ä½ å³å°†å¼€å§‹ä¸€æ®µä»èœé¸Ÿåˆ°å† å†›çš„æ’çƒä¹‹æ—…</p>
                    <div id="name-input-container">
                        <input type="text" id="player-name-input" placeholder="è¯·è¾“å…¥ä½ çš„åå­—" maxlength="10" />
                        <button id="random-name-btn" onclick="game.randomName()" title="éšæœºåå­—">ğŸ²</button>
                    </div>
                    <div id="initial-attributes">
                        <h3>ğŸ² åˆå§‹èƒ½åŠ›</h3>
                        <div class="init-attr-item">
                            <span>ğŸ¯ å‘çƒ</span>
                            <span class="init-attr-value" id="init-serve">0</span>
                        </div>
                        <div class="init-attr-item">
                            <span>âš¡ æ‰£çƒ</span>
                            <span class="init-attr-value" id="init-spike">0</span>
                        </div>
                        <div class="init-attr-item">
                            <span>ğŸ›¡ï¸ æ‹¦ç½‘</span>
                            <span class="init-attr-value" id="init-block">0</span>
                        </div>
                        <div class="init-attr-item">
                            <span>ğŸ å«çƒ</span>
                            <span class="init-attr-value" id="init-dig">0</span>
                        </div>
                        <div class="init-attr-item">
                            <span>ğŸ¤² æ‰˜çƒ</span>
                            <span class="init-attr-value" id="init-set">0</span>
                        </div>
                        <div class="init-attr-item">
                            <span>ğŸ’ª ä½“åŠ›ä¸Šé™</span>
                            <span class="init-attr-value" id="init-energy">100</span>
                        </div>
                        <div class="init-attr-item">
                            <span>ğŸ’° åˆå§‹é‡‘é’±</span>
                            <span class="init-attr-value" id="init-money">500</span>
                        </div>
                        <div id="reroll-container">
                            <button id="reroll-btn" onclick="game.rerollAttributes()">ğŸ² é‡æ–°éšæœº</button>
                            <span id="reroll-count">å‰©ä½™æ¬¡æ•°ï¼š5/5</span>
                        </div>
                    </div>
                    <button onclick="game.submitName()">å¼€å§‹æ¸¸æˆ</button>
                </div>`,
                choices: []
            },
            
            start: {
                text: `<h2>ğŸ“ å¤§å­¦æ–°ç”Ÿæ´»</h2>
                <p>ä½ æ˜¯ä¸€ååˆšå…¥å­¦çš„å¤§ä¸€æ–°ç”Ÿï¼Œä»æœªæ¥è§¦è¿‡æ’çƒã€‚</p>
                <p>å¼€å­¦ç¬¬ä¸€å‘¨ï¼Œä½ è·¯è¿‡ä½“è‚²é¦†ï¼Œçœ‹åˆ°æ’çƒç¤¾å›¢æ­£åœ¨æ‹›æ–°ã€‚é˜³å…‰é€è¿‡çª—æˆ·æ´’åœ¨çƒåœºä¸Šï¼Œå­¦é•¿å­¦å§ä»¬çŸ«å¥çš„èº«å½±è®©ä½ å¿ƒç”Ÿå‘å¾€ã€‚</p>
                <p>"æƒ³è¯•è¯•å—ï¼Ÿ"ä¸€ä½å­¦å§ç¬‘ç€å‘ä½ æ‹›æ‰‹ã€‚</p>`,
                choices: [
                    {
                        text: 'ğŸ åŠ å…¥æ’çƒç¤¾å›¢ï¼Œå¼€å§‹è®­ç»ƒï¼',
                        next: 'weeklyHub'
                    },
                    {
                        text: 'ğŸ“š å…ˆè§‚å¯Ÿä¸€ä¸‹ï¼Œäº†è§£æ›´å¤šä¿¡æ¯',
                        next: 'observe'
                    }
                ]
            },

            
            observe: {
                text: `<h2>ğŸ‘€ è§‚å¯Ÿå­¦ä¹ </h2>
                <p>ä½ åœ¨åœºè¾¹è§‚å¯Ÿäº†ä¸€ä¼šå„¿ï¼Œçœ‹åˆ°å­¦é•¿å­¦å§ä»¬åœ¨ç»ƒä¹ å„ç§æŠ€æœ¯ï¼š</p>
                <p>â€¢ å‘çƒï¼šå°†çƒé«˜é«˜æŠ›èµ·ï¼Œç”¨åŠ›å‡»æ‰“è¿‡ç½‘<br>
                â€¢ æ‰£çƒï¼šè·³èµ·æ¥ç”¨åŠ›å°†çƒç ¸å‘å¯¹æ–¹åœºåœ°<br>
                â€¢ æ‹¦ç½‘ï¼šåœ¨ç½‘å‰è·³èµ·é˜»æŒ¡å¯¹æ–¹çš„è¿›æ”»<br>
                â€¢ é˜²å®ˆï¼šå¿«é€Ÿç§»åŠ¨æ¥èµ·å¯¹æ–¹çš„æ”»å‡»</p>
                <p>çœ‹èµ·æ¥å¾ˆæœ‰è¶£ï¼ä½ å†³å®š...</p>`,
                choices: [
                    {
                        text: 'ğŸ’ª ç°åœ¨å°±åŠ å…¥ï¼Œå¼€å§‹è®­ç»ƒï¼',
                        next: 'weeklyHub'
                    }
                ]
            },
            
            weeklyHub: {
                text: '',
                choices: []
            },
            
            shopMain: {
                text: '',
                choices: []
            },
            
            lifeChoice: {
                text: '',
                choices: []
            },
            
            trainingChoice: {
                text: `<h2>ğŸ‹ï¸ é€‰æ‹©è®­ç»ƒé¡¹ç›®</h2>
                <p>ä»Šå¤©ä½ æƒ³é‡ç‚¹è®­ç»ƒå“ªä¸ªæŠ€èƒ½ï¼Ÿ</p>
                <p style="color: #999; font-size: 14px;">è®­ç»ƒä¼šæ¶ˆè€—ä½“åŠ›å’Œå¿ƒæƒ…ï¼Œä½†èƒ½æå‡æŠ€èƒ½</p>`,
                choices: [
                    {
                        text: 'ğŸ¯ å‘çƒè®­ç»ƒï¼ˆä½“åŠ›-15ï¼Œå¿ƒæƒ…-5ï¼‰',
                        next: 'lifeChoice',
                        requirement: { energy: 15 },
                        effect: { serve: 3, energy: -15, mood: -5, stress: 3, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'âš¡ æ‰£çƒè®­ç»ƒï¼ˆä½“åŠ›-20ï¼Œå¿ƒæƒ…-8ï¼‰',
                        next: 'lifeChoice',
                        requirement: { energy: 20 },
                        effect: { spike: 3, energy: -20, mood: -8, stress: 5, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'ğŸ›¡ï¸ æ‹¦ç½‘è®­ç»ƒï¼ˆä½“åŠ›-18ï¼Œå¿ƒæƒ…-6ï¼‰',
                        next: 'lifeChoice',
                        requirement: { energy: 18 },
                        effect: { block: 3, energy: -18, mood: -6, stress: 4, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'ğŸ¤¸ å«çƒè®­ç»ƒï¼ˆä½“åŠ›-15ï¼Œå¿ƒæƒ…-5ï¼‰',
                        next: 'lifeChoice',
                        requirement: { energy: 15 },
                        effect: { dig: 3, energy: -15, mood: -5, stress: 3, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'ğŸ™Œ æ‰˜çƒè®­ç»ƒï¼ˆä½“åŠ›-15ï¼Œå¿ƒæƒ…-5ï¼‰',
                        next: 'lifeChoice',
                        requirement: { energy: 15 },
                        effect: { set: 3, energy: -15, mood: -5, stress: 3, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'â­ï¸ è·³è¿‡è®­ç»ƒï¼Œç›´æ¥è¯¾ä½™ç”Ÿæ´»',
                        next: 'lifeChoice'
                    },
                    {
                        text: 'ğŸ”™ è¿”å›',
                        next: 'weeklyHub'
                    }
                ]
            },
            
            lifeChoice: {
                text: `<h2>ğŸŒŸ è¯¾ä½™ç”Ÿæ´»</h2>
                <p>è®­ç»ƒç»“æŸäº†ï¼Œä½ æƒ³åšäº›ä»€ä¹ˆæ¥æ”¾æ¾ä¸€ä¸‹ï¼Ÿ</p>`,
                choices: [
                    {
                        text: 'ğŸœ åƒå¤œå®µï¼ˆå¿ƒæƒ…+15ï¼Œä½“åŠ›-5ï¼Œå‹åŠ›-5ï¼ŒèŠ±è´¹20å…ƒï¼‰',
                        next: 'checkRandomEvent',
                        requirement: { money: 20 },
                        effect: { mood: 15, energy: -5, stress: -5, money: -20, eventType: 'life' }
                    },
                    {
                        text: 'ğŸ æ‰“é‡çƒï¼ˆ25åˆ†åˆ¶æ¯”èµ›ï¼Œä½“åŠ›-20ï¼‰',
                        next: 'casualMatch',
                        requirement: { energy: 20 },
                        effect: { matchType: 'casual', energy: -20 }
                    },
                    {
                        text: 'ğŸ® æ‰“æ¸¸æˆï¼ˆå¿ƒæƒ…+10ï¼Œå‹åŠ›-8ï¼Œä½“åŠ›-3ï¼‰',
                        next: 'checkRandomEvent',
                        effect: { mood: 10, stress: -8, energy: -3, eventType: 'life' }
                    },
                    {
                        text: 'ï¿½ å»å›¾ä¹¦é¦†ï¼ˆå¿ƒæƒ…+5ï¼Œå‹åŠ›+3ï¼Œå£°æœ›+2ï¼‰',
                        next: 'checkRandomEvent',
                        effect: { mood: 5, stress: 3, reputation: 2, eventType: 'life' }
                    },
                    {
                        text: 'ï¿½ æ—©ç‚¹ä¼‘æ¯ï¼ˆä½“åŠ›+20ï¼Œå¿ƒæƒ…+8ï¼Œå‹åŠ›-5ï¼‰',
                        next: 'checkRandomEvent',
                        effect: { energy: 20, mood: 8, stress: -5, eventType: 'life' }
                    },
                    {
                        text: 'ğŸ‘¥ å’Œé˜Ÿå‹èŠå¤©ï¼ˆå¿ƒæƒ…+12ï¼Œå‹åŠ›-6ï¼Œå…³ç³»+5ï¼‰',
                        next: 'checkRandomEvent',
                        effect: { mood: 12, stress: -6, relationship: 5, eventType: 'life' }
                    },
                    {
                        text: 'ğŸ¿ çœ‹ç”µå½±ï¼ˆå¿ƒæƒ…+18ï¼Œå‹åŠ›-10ï¼ŒèŠ±è´¹50å…ƒï¼‰',
                        next: 'checkRandomEvent',
                        requirement: { money: 50 },
                        effect: { mood: 18, stress: -10, money: -50, eventType: 'life' }
                    },
                    {
                        text: 'ğŸ›’ ä¹°è¿åŠ¨è£…å¤‡ï¼ˆæŠ€èƒ½+2ï¼Œå¿ƒæƒ…+10ï¼ŒèŠ±è´¹150å…ƒï¼‰',
                        next: 'checkRandomEvent',
                        requirement: { money: 150 },
                        effect: { serve: 2, spike: 2, block: 2, dig: 1, set: 1, mood: 10, money: -150, eventType: 'life' }
                    },
                    {
                        text: 'ğŸ’¼ å…¼èŒæ‰“å·¥ï¼ˆé‡‘é’±+150ï¼Œä½“åŠ›-20ï¼Œå‹åŠ›+8ï¼‰',
                        next: 'checkRandomEvent',
                        requirement: { energy: 20 },
                        effect: { money: 150, energy: -20, stress: 8, mood: -5, eventType: 'life' }
                    },
                    {
                        text: 'ğŸ” åƒå¤§é¤ï¼ˆå¿ƒæƒ…+25ï¼Œä½“åŠ›+10ï¼ŒèŠ±è´¹100å…ƒï¼‰',
                        next: 'checkRandomEvent',
                        requirement: { money: 100 },
                        effect: { mood: 25, energy: 10, stress: -8, money: -100, eventType: 'life' }
                    },
                    {
                        text: 'ğŸ ç»™é˜Ÿå‹ä¹°ç¤¼ç‰©ï¼ˆå…³ç³»+15ï¼Œå£°æœ›+5ï¼ŒèŠ±è´¹80å…ƒï¼‰',
                        next: 'checkRandomEvent',
                        requirement: { money: 80 },
                        effect: { relationship: 15, reputation: 5, mood: 8, money: -80, eventType: 'life' }
                    },
                    {
                        text: 'ğŸ“± ä¹°æ–°æ‰‹æœºï¼ˆå¿ƒæƒ…+20ï¼Œå‹åŠ›-5ï¼ŒèŠ±è´¹800å…ƒï¼‰',
                        next: 'checkRandomEvent',
                        requirement: { money: 800 },
                        effect: { mood: 20, stress: -5, money: -800, eventType: 'life' }
                    }
                ]
            },
            
            casualMatch: {
                text: '',
                choices: []
            },
            
            matchResult: {
                text: '',
                choices: []
            },
            
            checkRandomEvent: {
                text: '',
                choices: []
            },
            
            randomEvent: {
                text: '',
                choices: []
            },

            
            basicTraining: {
                text: `<h2>ğŸ“ˆ åŸºç¡€è®­ç»ƒé˜¶æ®µ</h2>
                <p>ç»è¿‡å‡ å‘¨çš„è®­ç»ƒï¼Œä½ å·²ç»æŒæ¡äº†åŸºæœ¬çš„æ’çƒæŠ€æœ¯ã€‚æ•™ç»ƒè¯´ä½ å¾ˆæœ‰å¤©èµ‹ã€‚</p>
                <p>ç°åœ¨ä½ å¯ä»¥é€‰æ‹©é‡ç‚¹è®­ç»ƒæŸé¡¹æŠ€èƒ½ï¼Œæˆ–è€…å‚åŠ é™¢é˜Ÿçš„é€‰æ‹”ã€‚</p>`,
                choices: [
                    {
                        text: 'ç»§ç»­è®­ç»ƒ',
                        next: 'weeklyHub'
                    }
                ]
            },
            
            weekEnd: {
                text: `<h2>ğŸ“Š æœ¬å‘¨æ€»ç»“</h2>
                <p>ç¬¬ ${this.player ? this.player.week : 1} å‘¨ç»“æŸäº†ï¼</p>
                <p>æœ¬å‘¨è®­ç»ƒäº† ${this.player ? this.player.trainingCount : 0} æ¬¡</p>
                <p>è·å¾—é›¶èŠ±é’± +500å…ƒ</p>
                <p>ä½“åŠ›ã€å¿ƒæƒ…è‡ªç„¶æ¢å¤ï¼Œå‹åŠ›å‡è½»</p>`,
                choices: [
                    {
                        text: 'å¼€å§‹æ–°çš„ä¸€å‘¨',
                        next: 'weeklyHub',
                        effect: { nextWeek: true }
                    }
                ]
            },
            
            eventResult: {
                text: '',
                choices: [
                    {
                        text: 'ç»§ç»­',
                        next: 'weeklyHub'
                    }
                ]
            },

            
            rest: {
                text: `<h2>ğŸ’¤ ä¼‘æ¯æ¢å¤</h2>
                <p>ä½ å¥½å¥½ä¼‘æ¯äº†ä¸€æ®µæ—¶é—´ï¼Œä½“åŠ›æ¢å¤äº†ã€‚</p>
                <p>æ˜å¤©ç»§ç»­åŠ æ²¹ï¼</p>`,
                choices: [
                    { text: 'ç»§ç»­è®­ç»ƒ', next: 'basicTraining' }
                ]
            },
            
            collegeTryout: {
                text: `<h2>ğŸ¯ é™¢é˜Ÿé€‰æ‹”</h2>
                <p>é™¢é˜Ÿçš„é€‰æ‹”èµ›å¼€å§‹äº†ï¼ä½ éœ€è¦åœ¨æ•™ç»ƒå’Œå­¦é•¿é¢å‰å±•ç¤ºä½ çš„æŠ€æœ¯ã€‚</p>
                <p>å‘çƒã€æ¥çƒã€æ‰£çƒ...ä½ å…¨åŠ›ä»¥èµ´åœ°å®Œæˆäº†æ¯ä¸€ä¸ªåŠ¨ä½œã€‚</p>
                <p>æ•™ç»ƒæ»¡æ„åœ°ç‚¹äº†ç‚¹å¤´ï¼š"ä¸é”™ï¼Œæ¬¢è¿åŠ å…¥é™¢é˜Ÿï¼"</p>
                <p><strong>æˆå°±è¾¾æˆï¼šåŠ å…¥é™¢é˜Ÿï¼</strong></p>
                <p><strong>å£°æœ› +20</strong></p>`,
                choices: [
                    {
                        text: 'ğŸ‰ å¤ªå¥½äº†ï¼é€‰æ‹©åœºä¸Šä½ç½®',
                        next: 'positionSelection',
                        effect: { reputation: 20, team: 'college', goalUpdate: 'collegeMatch' }
                    }
                ]
            },
            
            positionSelection: {
                text: `<h2>ğŸ é€‰æ‹©ä½ çš„åœºä¸Šä½ç½®</h2>
                <p>æ•™ç»ƒï¼š"ä½ å·²ç»æŒæ¡äº†åŸºæœ¬æŠ€èƒ½ï¼Œç°åœ¨éœ€è¦é€‰æ‹©ä¸€ä¸ªä¸“ç²¾çš„ä½ç½®ã€‚"</p>
                <p>"æ¯ä¸ªä½ç½®éƒ½æœ‰ä¸åŒçš„èŒè´£å’Œè¦æ±‚ï¼Œé€‰æ‹©é€‚åˆä½ çš„ä½ç½®å§ï¼"</p>
                <div id="position-cards"></div>`,
                choices: [] // åŠ¨æ€ç”Ÿæˆ
            },
            
            collegeTeam: {
                text: `<h2>ğŸ« é™¢é˜Ÿè®­ç»ƒ</h2>
                <p>ä½œä¸ºé™¢é˜Ÿçš„ä¸€å‘˜ï¼Œè®­ç»ƒå¼ºåº¦æ˜æ˜¾æå‡äº†ã€‚ä½ å’Œé˜Ÿå‹ä»¬ä¸€èµ·è®­ç»ƒï¼ŒæŠ€æœ¯è¿›æ­¥å¾ˆå¿«ã€‚</p>`,
                choices: [
                    // åŸºç¡€è®­ç»ƒåˆ†ç±»æ ‡é¢˜
                    {
                        text: '',
                        separator: true,
                        separatorText: '<h3>ğŸ“‹ åŸºç¡€è®­ç»ƒï¼ˆä½“åŠ›-25ï¼‰</h3>'
                    },
                    // åŸºç¡€è®­ç»ƒ
                    {
                        text: 'ğŸ¯ å‘çƒè®­ç»ƒ',
                        next: 'lifeChoice',
                        requirement: { energy: 25 },
                        effect: { serve: 12, energy: -25, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'âš¡ æ‰£çƒè®­ç»ƒ',
                        next: 'lifeChoice',
                        requirement: { energy: 25 },
                        effect: { spike: 12, energy: -25, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'ğŸ›¡ï¸ æ‹¦ç½‘è®­ç»ƒ',
                        next: 'lifeChoice',
                        requirement: { energy: 25 },
                        effect: { block: 12, energy: -25, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'ğŸƒ é˜²å®ˆè®­ç»ƒ',
                        next: 'lifeChoice',
                        requirement: { energy: 25 },
                        effect: { dig: 6, set: 6, energy: -25, trained: true, eventType: 'training' }
                    },
                    // ç»„åˆè®­ç»ƒåˆ†ç±»æ ‡é¢˜
                    {
                        text: '',
                        separator: true,
                        separatorText: '<h3>ğŸ”¥ ç»„åˆè®­ç»ƒï¼ˆä½“åŠ›-25ï¼‰</h3>'
                    },
                    // ç»„åˆè®­ç»ƒ
                    {
                        text: 'ï¿½ è¿›æ”»ç»„åˆ',
                        next: 'lifeChoice',
                        requirement: { energy: 25 },
                        effect: { spike: 7, serve: 5, energy: -25, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'ğŸ›¡ï¸ é˜²å®ˆç»„åˆ',
                        next: 'lifeChoice',
                        requirement: { energy: 25 },
                        effect: { block: 7, dig: 5, energy: -25, trained: true, eventType: 'training' }
                    },
                    // å…¶ä»–é€‰é¡¹åˆ†éš”
                    {
                        text: '',
                        separator: true,
                        separatorText: '<div style="margin-top: 15px;"></div>'
                    },
                    // å…¶ä»–é€‰é¡¹
                    {
                        text: 'â­ï¸ è·³è¿‡è®­ç»ƒ',
                        next: 'lifeChoice'
                    },
                    {
                        text: 'ğŸ”™ è¿”å›',
                        next: 'weeklyHub'
                    }
                ]
            },
            
            rest2: {
                text: `<h2>ğŸ’¤ ä¼‘æ¯æ¢å¤</h2>
                <p>ä½ å¥½å¥½ä¼‘æ¯äº†ä¸€æ®µæ—¶é—´ï¼Œä½“åŠ›æ¢å¤äº†ã€‚</p>
                <p>ç»§ç»­ä¸ºæ¯”èµ›åšå‡†å¤‡ï¼</p>`,
                choices: [
                    { text: 'ç»§ç»­è®­ç»ƒ', next: 'collegeTeam' }
                ]
            },

            
            collegeMatch: {
                text: `<h2>ğŸ é™¢é™…æ¯”èµ›</h2>
                <p>æ¯”èµ›æ—¥åˆ°äº†ï¼ä½“è‚²é¦†é‡ŒæŒ¤æ»¡äº†ä¸ºå„è‡ªå­¦é™¢åŠ æ²¹çš„åŒå­¦ã€‚</p>
                <p>ç¬¬ä¸€å±€ï¼Œä½ çš„å‘çƒç›´æ¥å¾—åˆ†ï¼è§‚ä¼—å¸­ä¼ æ¥æ¬¢å‘¼å£°ã€‚</p>
                <p>ç¬¬äºŒå±€ï¼Œä½ æˆåŠŸæ‹¦ä¸‹äº†å¯¹æ–¹çš„æ‰£çƒï¼Œä¸ºé˜Ÿä¼èµ¢å¾—äº†å…³é”®åˆ†æ•°ã€‚</p>
                <p>æœ€ç»ˆï¼Œä½ ä»¬å­¦é™¢ä»¥3:1è·èƒœï¼</p>
                <p><strong>å£°æœ› +30ï¼Œå…¨æŠ€èƒ½ +5</strong></p>`,
                choices: [
                    {
                        text: 'ğŸ‰ å¤ªæ£’äº†ï¼ç»§ç»­åŠªåŠ›',
                        next: 'weeklyHub',
                        effect: { reputation: 30, serve: 5, spike: 5, block: 5, dig: 3, set: 3 }
                    }
                ]
            },
            
            universityTryout: {
                text: `<h2>â­ æ ¡é˜Ÿé€‰æ‹”</h2>
                <p>æ ¡é˜Ÿçš„é€‰æ‹”éå¸¸ä¸¥æ ¼ï¼Œæ¥è‡ªå„ä¸ªå­¦é™¢çš„é«˜æ‰‹é½èšä¸€å ‚ã€‚</p>
                <p>ä½ å±•ç¤ºäº†ç²¾å‡†çš„å‘çƒã€å¼ºåŠ›çš„æ‰£çƒã€ç¨³å›ºçš„æ‹¦ç½‘å’Œçµæ´»çš„é˜²å®ˆã€‚</p>
                <p>ä¸»æ•™ç»ƒä»”ç»†è§‚å¯Ÿç€æ¯ä¸€ä¸ªäººçš„è¡¨ç°...</p>
                <p>"æ­å–œä½ ï¼Œæ¬¢è¿åŠ å…¥æ ¡é˜Ÿï¼"</p>
                <p><strong>æˆå°±è¾¾æˆï¼šåŠ å…¥æ ¡é˜Ÿï¼</strong></p>
                <p><strong>å£°æœ› +50</strong></p>`,
                choices: [
                    {
                        text: 'ğŸŒŸ å¼€å§‹æ ¡é˜Ÿè®­ç»ƒ',
                        next: 'weeklyHub',
                        effect: { reputation: 50, team: 'university', goalUpdate: 'universityLeague' }
                    }
                ]
            },
            
            universityLeague: {
                text: `<h2>ğŸ… æ ¡é™…è”èµ›</h2>
                <p>æ ¡é™…è”èµ›æ±‡èšäº†å…¨å¸‚å„å¤§é«˜æ ¡çš„ç²¾è‹±é˜Ÿä¼ã€‚</p>
                <p>è¿™æ˜¯ä½ å¤§å­¦æ’çƒç”Ÿæ¶¯çš„æœ€åä¸€æˆ˜ï¼</p>
                <p>ä½ å‡†å¤‡å¥½äº†å—ï¼Ÿ</p>`,
                choices: [
                    {
                        text: 'ğŸ å¼€å§‹æ¯”èµ›',
                        next: 'weeklyHub',
                        effect: { startFormalMatch: { matchType: 'universityLeague', matchName: 'æ ¡é™…è”èµ›' } }
                    }
                ]
            },

            
            universityTeam: {
                text: `<h2>ğŸŒŸ æ ¡é˜Ÿè®­ç»ƒ</h2>
                <p>æ ¡é˜Ÿçš„è®­ç»ƒæ›´åŠ ä¸“ä¸šå’Œç³»ç»Ÿã€‚ä½ å’Œå…¨æ ¡æœ€ä¼˜ç§€çš„æ’çƒé€‰æ‰‹ä¸€èµ·è®­ç»ƒã€‚</p>`,
                choices: [
                    // åŸºç¡€è®­ç»ƒåˆ†ç±»æ ‡é¢˜
                    {
                        text: '',
                        separator: true,
                        separatorText: '<h3>ğŸ“‹ åŸºç¡€è®­ç»ƒï¼ˆä½“åŠ›-25ï¼‰</h3>'
                    },
                    // åŸºç¡€è®­ç»ƒ
                    {
                        text: 'ğŸ¯ å‘çƒè®­ç»ƒ',
                        next: 'lifeChoice',
                        requirement: { energy: 25 },
                        effect: { serve: 15, energy: -25, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'âš¡ æ‰£çƒè®­ç»ƒ',
                        next: 'lifeChoice',
                        requirement: { energy: 25 },
                        effect: { spike: 15, energy: -25, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'ğŸ›¡ï¸ æ‹¦ç½‘è®­ç»ƒ',
                        next: 'lifeChoice',
                        requirement: { energy: 25 },
                        effect: { block: 15, energy: -25, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'ğŸƒ é˜²å®ˆè®­ç»ƒ',
                        next: 'lifeChoice',
                        requirement: { energy: 25 },
                        effect: { dig: 8, set: 7, energy: -25, trained: true, eventType: 'training' }
                    },
                    // ç»„åˆè®­ç»ƒåˆ†ç±»æ ‡é¢˜
                    {
                        text: '',
                        separator: true,
                        separatorText: '<h3>ğŸ”¥ ç»„åˆè®­ç»ƒï¼ˆä½“åŠ›-25ï¼‰</h3>'
                    },
                    // ç»„åˆè®­ç»ƒ
                    {
                        text: 'ï¿½ è¿›æ”»ç»„åˆ',
                        next: 'lifeChoice',
                        requirement: { energy: 25 },
                        effect: { spike: 9, serve: 6, energy: -25, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'ğŸ›¡ï¸ é˜²å®ˆç»„åˆ',
                        next: 'lifeChoice',
                        requirement: { energy: 25 },
                        effect: { block: 9, dig: 6, energy: -25, trained: true, eventType: 'training' }
                    },
                    // é«˜çº§è®­ç»ƒåˆ†ç±»æ ‡é¢˜
                    {
                        text: '',
                        separator: true,
                        separatorText: '<h3>â­ é«˜çº§è®­ç»ƒï¼ˆä½“åŠ›-30ï¼‰</h3>'
                    },
                    // é«˜çº§è®­ç»ƒï¼ˆä»…æ ¡é˜Ÿï¼‰
                    {
                        text: 'ğŸ¯ ç»„ç»‡ç»„åˆ',
                        next: 'lifeChoice',
                        requirement: { energy: 30 },
                        effect: { set: 7, dig: 5, energy: -30, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'â­ å…¨é¢å‘å±•',
                        next: 'lifeChoice',
                        requirement: { energy: 30 },
                        effect: { serve: 3, spike: 3, block: 3, dig: 3, set: 3, energy: -30, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'ï¿½ ä½“èƒ½å¼ºåŒ–',
                        next: 'lifeChoice',
                        requirement: { energy: 30 },
                        effect: { serve: 2, spike: 2, block: 2, dig: 2, set: 2, maxEnergyBonus: 2, energy: -30, trained: true, eventType: 'training' }
                    },
                    // å…¶ä»–é€‰é¡¹åˆ†éš”
                    {
                        text: '',
                        separator: true,
                        separatorText: '<div style="margin-top: 15px;"></div>'
                    },
                    // å…¶ä»–é€‰é¡¹
                    {
                        text: 'â­ï¸ è·³è¿‡è®­ç»ƒ',
                        next: 'lifeChoice'
                    },
                    {
                        text: 'ğŸ”™ è¿”å›',
                        next: 'weeklyHub'
                    }
                ]
            },

            
            // ==================== ç»“å±€åœºæ™¯ ====================
            // æ ¹æ®æ ¡é™…è”èµ›è¡¨ç°è§¦å‘ä¸åŒç»“å±€
            
            // é”¦æ ‡èµ›å¼€å¹•åœºæ™¯
            tournamentStart: {
                text: function() {
                    return `<h2>ğŸ† æ ¡é™…æ’çƒè”èµ› - æ·˜æ±°èµ›å¼€å§‹ï¼</h2>
                    <div style="margin: 20px 0; padding: 20px; background: rgba(255,215,0,0.1); border: 2px solid #ffd700; border-radius: 10px;">
                        <p>ç»è¿‡æ¼«é•¿çš„å‡†å¤‡ï¼Œä½ ç»ˆäºç«™åœ¨äº†æ ¡é™…è”èµ›çš„èµ›åœºä¸Šï¼</p>
                        <br>
                        <p><strong>ğŸ“‹ èµ›åˆ¶è¯´æ˜ï¼š</strong></p>
                        <ul style="text-align: left; margin-left: 20px;">
                            <li>å•è´¥æ·˜æ±°åˆ¶ï¼Œè¾“ä¸€åœºå³æ·˜æ±°</li>
                            <li>ä»16å¼ºå¼€å§‹ï¼Œé€è½®æ™‹çº§</li>
                            <li>æ¯è½®æ¯”èµ›é‡‡ç”¨äº”å±€ä¸‰èƒœåˆ¶</li>
                        </ul>
                        <br>
                        <p><strong>ğŸ¯ ä½ çš„ç›®æ ‡ï¼š</strong></p>
                        <p>å°½å¯èƒ½èµ°å¾—æ›´è¿œï¼Œäº‰å–å† å†›ï¼</p>
                    </div>
                    <div style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <p><strong>å½“å‰çŠ¶æ€ï¼š</strong></p>
                        <p>ğŸ¯ å‘çƒ: ${game.player.skills.serve}  âš¡ æ‰£çƒ: ${game.player.skills.spike}</p>
                        <p>ğŸ›¡ï¸ æ‹¦ç½‘: ${game.player.skills.block}  ğŸ¤¸ å«çƒ: ${game.player.skills.dig}</p>
                        <p>ğŸ™Œ æ‰˜çƒ: ${game.player.skills.set}</p>
                    </div>`;
                },
                choices: [
                    {
                        text: 'å¼€å§‹é¦–è½®æ¯”èµ›',
                        next: null,  // ä¸è·³è½¬åœºæ™¯
                        effect: () => {
                            // ç›´æ¥å¼€å§‹ç¬¬ä¸€è½®
                            game.startTournamentRound('round16');
                        }
                    }
                ]
            },
            
            champion: {
                text: function() {
                    return game.generateEndingText('champion');
                },
                choices: [
                    {
                        text: 'ğŸ”„ é‡æ–°å¼€å§‹',
                        next: 'nameInput',
                        effect: { reset: true }
                    }
                ]
            },
            
            runner_up: {
                text: function() {
                    return game.generateEndingText('runner_up');
                },
                choices: [
                    {
                        text: 'ğŸ”„ é‡æ–°å¼€å§‹',
                        next: 'nameInput',
                        effect: { reset: true }
                    }
                ]
            },
            
            participant: {
                text: function() {
                    return game.generateEndingText('participant');
                },
                choices: [
                    {
                        text: 'ğŸ”„ é‡æ–°å¼€å§‹',
                        next: 'nameInput',
                        effect: { reset: true }
                    }
                ]
            },
            
            early_exit: {
                text: function() {
                    return game.generateEndingText('early_exit');
                },
                choices: [
                    {
                        text: 'ğŸ”„ é‡æ–°å¼€å§‹',
                        next: 'nameInput',
                        effect: { reset: true }
                    }
                ]
            }
        };

        // ==================== æµ‹è¯•æ¨¡å¼é…ç½® ====================
        // è®¾ç½® TEST_MODE = true æ¥å¯ç”¨æµ‹è¯•æ¨¡å¼
        // æµ‹è¯•æ¨¡å¼ä¼šç»™äºˆé«˜åˆå§‹å±æ€§ï¼Œæ–¹ä¾¿å¿«é€Ÿæµ‹è¯•æ¸¸æˆåŠŸèƒ½
        const TEST_MODE = false;  // æ”¹ä¸º true å¯ç”¨æµ‹è¯•æ¨¡å¼
        
        const TEST_CONFIG = {
            initialSkills: 80,      // åˆå§‹æŠ€èƒ½å€¼ï¼ˆæ­£å¸¸æ˜¯0ï¼‰
            initialMoney: 10000,    // åˆå§‹é‡‘é’±ï¼ˆæ­£å¸¸æ˜¯500ï¼‰
            initialEnergy: 100,     // åˆå§‹ä½“åŠ›ï¼ˆæ­£å¸¸æ˜¯100ï¼‰
            initialMood: 100,       // åˆå§‹å¿ƒæƒ…ï¼ˆæ­£å¸¸æ˜¯80ï¼‰
            initialStress: 0,       // åˆå§‹å‹åŠ›ï¼ˆæ­£å¸¸æ˜¯20ï¼‰
            initialReputation: 100, // åˆå§‹å£°æœ›ï¼ˆæ­£å¸¸æ˜¯10ï¼‰
            maxTrainingPerWeek: 10, // æ¯å‘¨æœ€å¤§è®­ç»ƒæ¬¡æ•°ï¼ˆæ­£å¸¸æ˜¯3ï¼‰
            skipToWeek: 1           // è·³è½¬åˆ°æŒ‡å®šå‘¨ï¼ˆ1=ä¸è·³è½¬ï¼‰
        };
        // ====================================================

        class VolleyballGame {
            constructor() {
                this.player = {
                    name: 'æ–°ç”Ÿ',
                    week: TEST_MODE ? TEST_CONFIG.skipToWeek : 1,
                    trainingCount: 0,
                    maxTrainingPerWeek: TEST_MODE ? TEST_CONFIG.maxTrainingPerWeek : 3,
                    energy: TEST_MODE ? TEST_CONFIG.initialEnergy : 100,
                    maxEnergy: TEST_MODE ? TEST_CONFIG.initialEnergy : 100,
                    mood: TEST_MODE ? TEST_CONFIG.initialMood : 80,
                    stress: TEST_MODE ? TEST_CONFIG.initialStress : 20,
                    reputation: TEST_MODE ? TEST_CONFIG.initialReputation : 10,
                    money: TEST_MODE ? TEST_CONFIG.initialMoney : 500,
                    team: 'none',
                    position: 'none',  // èŒä¸šä½ç½®
                    positionLevel: 0,  // èŒä¸šç­‰çº§
                    adaptationWeeks: 0, // è½¬èŒé€‚åº”æœŸå‰©ä½™å‘¨æ•°
                    skills: {
                        serve: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        spike: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        block: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        dig: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        set: TEST_MODE ? TEST_CONFIG.initialSkills : 0
                    },
                    weekStartStats: {  // æ¯å‘¨å¼€å§‹æ—¶çš„æ•°æ®å¿«ç…§
                        serve: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        spike: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        block: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        dig: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        set: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        maxEnergy: TEST_MODE ? TEST_CONFIG.initialEnergy : 100
                    },
                    attributes: {
                        strength: 0,    // åŠ›é‡
                        agility: 0,     // æ•æ·
                        stamina: 0,     // è€åŠ›
                        coordination: 0 // åè°ƒæ€§
                    },
                    relationships: {
                        coach: 50,
                        teammates: 50
                    },
                    achievements: [],  // æˆå°±åˆ—è¡¨
                    // æ–°å¢ï¼šè¿›åº¦è¿½è¸ª
                    trainingPoints: 0,  // è®­ç»ƒç‚¹æ•°
                    performanceHistory: [],  // æ¯”èµ›è¡¨ç°å†å²
                    averagePerformance: 0,  // å¹³å‡è¡¨ç°
                    matchesPlayed: 0,  // æ¯”èµ›åœºæ¬¡
                    matchesWon: 0,  // èƒœåœº
                    completedStoryEvents: [],  // å®Œæˆçš„æ•…äº‹äº‹ä»¶
                    storyChoices: {},  // æ•…äº‹é€‰æ‹©è®°å½•
                    trainingHistory: [],  // è®­ç»ƒå†å²ï¼ˆç”¨äºé€’å‡æ”¶ç›Šï¼‰
                    goalProgress: {}  // ç›®æ ‡è¿›åº¦
                };
                
                // æ–°å¢ï¼šç©å®¶è¡Œä¸ºç»Ÿè®¡ï¼ˆç”¨äºç»“å±€ç”Ÿæˆï¼‰
                this.playerStats = {
                    // è®­ç»ƒç›¸å…³
                    totalTrainings: 0,
                    trainingByType: {
                        serve: 0,
                        spike: 0,
                        block: 0,
                        dig: 0,
                        set: 0,
                        composite: 0
                    },
                    
                    // æ¯”èµ›ç›¸å…³
                    casualMatchesPlayed: 0,
                    casualMatchesWon: 0,
                    formalMatchesPlayed: 0,
                    formalMatchesWon: 0,
                    tournamentRoundsWon: 0,
                    
                    // æ¶ˆè´¹ç›¸å…³
                    totalMoneySpent: 0,
                    equipmentPurchased: 0,
                    coachingPurchased: 0,
                    entertainmentSpent: 0,
                    
                    // ç”Ÿæ´»ç›¸å…³
                    gamesPlayed: 0,
                    moviesWatched: 0,
                    socialEvents: 0,
                    restTaken: 0,
                    
                    // ç‰¹æ®Šè¡Œä¸º
                    positionChanges: 0,
                    perfectWeeks: 0,
                    burnoutWeeks: 0,
                    richestWeek: 0,
                    brokestWeek: Infinity,
                    
                    // æŠ€èƒ½å‘å±•
                    initialSkills: {
                        serve: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        spike: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        block: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        dig: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        set: TEST_MODE ? TEST_CONFIG.initialSkills : 0
                    }
                };
                
                // èŒä¸šé…ç½®
                this.positions = {
                    outsideHitter: {
                        id: 'outsideHitter',
                        name: 'ä¸»æ”»æ‰‹',
                        icon: 'ğŸ”¥',
                        description: 'å¾—åˆ†ä¸»åŠ›ï¼Œæ‰¿æ‹…å¤§é‡è¿›æ”»ä»»åŠ¡',
                        coreSkills: ['spike', 'serve'],
                        secondarySkills: ['dig'],
                        baseRequirements: { spike: 15, serve: 12 },  // é™ä½ï¼šspike 25â†’15, serve 20â†’12
                        trainingBonus: { core: 0.5, secondary: 0.25, other: -0.25 },
                        matchWeights: { spike: 40, serve: 20, dig: 20, block: 10, set: 10 },
                        specialDescriptions: {
                            spike: ['å¼ºåŠ›è·³å‘ç›´æ¥å¾—åˆ†ï¼', 'åæ’è¿›æ”»ï¼Œå¤§åŠ›æ‰£æ€å¾—åˆ†ï¼', 'å…³é”®çƒï¼Œä¸»æ”»æ‰‹æŒºèº«è€Œå‡ºï¼'],
                            serve: ['è·³å‘çƒç›´æ¥å¾—åˆ†ï¼', 'å‘çƒç ´åå¯¹æ–¹ä¸€ä¼ ï¼', 'è¿ç»­å‘çƒæ–½å‹ï¼'],
                            dig: ['ä¸»æ”»æ‰‹åæ’é˜²å®ˆæˆåŠŸï¼', 'åŠæ—¶è¡¥ä½ï¼Œæ•‘èµ·å…³é”®çƒï¼']
                        }
                    },
                    middleBlocker: {
                        id: 'middleBlocker',
                        name: 'å‰¯æ”»æ‰‹',
                        icon: 'ğŸ›¡ï¸',
                        description: 'æ‹¦ç½‘ä¸“å®¶ï¼Œå¿«æ”»æ‰‹',
                        coreSkills: ['block', 'spike'],
                        secondarySkills: ['set'],
                        baseRequirements: { block: 15, spike: 12 },  // é™ä½ï¼šblock 25â†’15, spike 20â†’12
                        trainingBonus: { core: 0.5, secondary: 0.25, other: -0.25 },
                        matchWeights: { block: 40, spike: 30, set: 10, serve: 10, dig: 10 },
                        specialDescriptions: {
                            block: ['å•äººæ‹¦ç½‘ç›´æ¥å¾—åˆ†ï¼', 'åŒäººæ‹¦ç½‘ï¼Œä¸¥å¯†é˜²å®ˆï¼', 'æ‹¦ç½‘åˆ¤æ–­ç²¾å‡†ï¼'],
                            spike: ['å¿«é€ŸçŸ­å¹³å¿«ï¼Œå¯¹æ–¹æ¥ä¸åŠååº”ï¼', 'æ—¶é—´å·®è¿›æ”»å¾—åˆ†ï¼', 'èƒŒå¿«çªç ´é˜²çº¿ï¼'],
                            set: ['å‰¯æ”»æ‰‹è°ƒæ•´ä¼ çƒï¼', 'ç½‘å‰å‡åŠ¨ä½œï¼ŒåŠ©æ”»å¾—åˆ†ï¼']
                        }
                    },
                    setter: {
                        id: 'setter',
                        name: 'äºŒä¼ æ‰‹',
                        icon: 'ğŸ¯',
                        description: 'ç»„ç»‡æ ¸å¿ƒï¼Œæˆ˜æœ¯å¤§è„‘',
                        coreSkills: ['set', 'serve'],
                        secondarySkills: ['dig'],
                        baseRequirements: { set: 18, serve: 12 },  // é™ä½ï¼šset 30â†’18, serve 20â†’12
                        trainingBonus: { core: 0.5, secondary: 0.25, other: -0.25 },
                        matchWeights: { set: 50, serve: 20, dig: 15, spike: 10, block: 5 },
                        specialDescriptions: {
                            set: ['ç²¾å‡†äºŒä¼ ï¼ŒåŠ©æ”»é˜Ÿå‹å¾—åˆ†ï¼', 'èƒŒä¼ å‡ºå…¶ä¸æ„ï¼Œé˜Ÿå‹è½»æ¾å¾—åˆ†ï¼', 'è·³ä¼ è°ƒæ•´ï¼ŒåŒ–è§£å›°å¢ƒï¼'],
                            serve: ['äºŒä¼ æ‰‹å‘çƒç›´æ¥å¾—åˆ†ï¼', 'å‘çƒç ´åå¯¹æ–¹è¿›æ”»èŠ‚å¥ï¼'],
                            dig: ['äºŒä¼ æ‰‹é˜²å®ˆåˆ°ä½ï¼', 'ä¸€ä¼ ç¨³å®šï¼Œç»„ç»‡åå‡»ï¼']
                        }
                    },
                    oppositeHitter: {
                        id: 'oppositeHitter',
                        name: 'æ¥åº”äºŒä¼ ',
                        icon: 'âš¡',
                        description: 'å…¨èƒ½æˆ˜å£«ï¼Œåæ’è¿›æ”»æ ¸å¿ƒ',
                        coreSkills: ['spike', 'set'],
                        secondarySkills: ['serve'],
                        baseRequirements: { spike: 15, set: 15 },  // é™ä½ï¼šspike 22â†’15, set 22â†’15
                        trainingBonus: { core: 0.5, secondary: 0.25, other: -0.25 },
                        matchWeights: { spike: 35, set: 25, serve: 20, block: 10, dig: 10 },
                        specialDescriptions: {
                            spike: ['åæ’å¼ºæ”»ï¼Œçªç ´å¯¹æ–¹é˜²çº¿ï¼', 'è°ƒæ•´çƒäºŒæ¬¡è¿›æ”»å¾—åˆ†ï¼', 'å…³é”®æ—¶åˆ»æ¥åº”ç«™å‡ºæ¥ï¼'],
                            set: ['æ¥åº”äºŒä¼ ç»„ç»‡è¿›æ”»ï¼', 'æ›¿è¡¥äºŒä¼ ä½ç½®ï¼Œä¼ çƒåˆ°ä½ï¼'],
                            serve: ['æ¥åº”å‘çƒæ–½å‹ï¼', 'è·³é£˜çƒç ´åå¯¹æ–¹ï¼']
                        }
                    },
                    libero: {
                        id: 'libero',
                        name: 'è‡ªç”±äºº',
                        icon: 'ğŸƒ',
                        description: 'é˜²å®ˆä¸“å®¶ï¼Œä¸€ä¼ ä¿éšœ',
                        coreSkills: ['dig', 'set'],
                        secondarySkills: [],
                        baseRequirements: { dig: 18, set: 15 },  // é™ä½ï¼šdig 30â†’18, set 25â†’15
                        trainingBonus: { core: 0.5, secondary: 0.25, other: -0.25 },
                        matchWeights: { dig: 60, set: 30, spike: 0, block: 0, serve: 0 },
                        specialDescriptions: {
                            dig: ['é±¼è·ƒæ•‘çƒï¼Œç²¾å½©é˜²å®ˆï¼', 'å®Œç¾ä¸€ä¼ ï¼Œç»„ç»‡åå‡»ï¼', 'è¿ç»­é˜²å®ˆï¼ŒåŒ–è§£å¯¹æ–¹æ”»åŠ¿ï¼'],
                            set: ['è‡ªç”±äººäºŒä¼ åˆ°ä½ï¼', 'åæ’ä¼ çƒç»„ç»‡ï¼', 'é˜²å®ˆåå‡»çš„èµ·ç‚¹ï¼']
                        },
                        restrictions: ['ä¸èƒ½æ‰£çƒ', 'ä¸èƒ½æ‹¦ç½‘', 'ä¸èƒ½å‘çƒ']
                    }
                };
                
                this.rerollsRemaining = 5;
                this.currentScene = 'nameInput';
                this.justTrained = false;
                this.lastEventType = null;
                this.currentEvent = null;
                this.currentEventType = null;
                this.currentGoal = 'collegeTryout'; // å½“å‰ç›®æ ‡
                
                // é”¦æ ‡èµ›ç³»ç»Ÿ
                this.tournament = {
                    active: false,
                    type: null,
                    currentRound: null,
                    roundsCompleted: [],
                    matchesWon: 0,
                    matchesLost: 0,
                    eliminated: false,
                    finalRank: null
                };
                
                // é”¦æ ‡èµ›è½®æ¬¡å®šä¹‰
                this.TOURNAMENT_ROUNDS = {
                    round16: {
                        id: 'round16',
                        name: '1/8å†³èµ›ï¼ˆ16å¼ºï¼‰',
                        shortName: '16å¼ºèµ›',
                        emoji: 'ğŸ',
                        nextRound: 'round8',
                        eliminationRank: 'top16',
                        opponentStrength: 60
                    },
                    round8: {
                        id: 'round8',
                        name: '1/4å†³èµ›ï¼ˆ8å¼ºï¼‰',
                        shortName: '8å¼ºèµ›',
                        emoji: 'âš¡',
                        nextRound: 'round4',
                        eliminationRank: 'top8',
                        opponentStrength: 70
                    },
                    round4: {
                        id: 'round4',
                        name: 'åŠå†³èµ›ï¼ˆ4å¼ºï¼‰',
                        shortName: 'åŠå†³èµ›',
                        emoji: 'ğŸ”¥',
                        nextRound: 'final',
                        eliminationRank: 'top4',
                        opponentStrength: 80
                    },
                    final: {
                        id: 'final',
                        name: 'å†³èµ›',
                        shortName: 'å†³èµ›',
                        emoji: 'ğŸ†',
                        nextRound: null,
                        eliminationRank: 'runner_up',
                        opponentStrength: 90
                    }
                };
                
                // å•†åº—ç³»ç»Ÿæ•°æ®
                this.shopItems = this.initShopItems();
                this.player.ownedItems = {
                    shoes: 'basic',  // é‹å­ç­‰çº§
                    protection: false,  // æŠ¤å…·
                    jersey: false,  // çƒè¡£
                    trainingEquipment: [],  // è®­ç»ƒå™¨æ
                    electronics: [],  // ç”µå­äº§å“
                    books: []  // ä¹¦ç±
                };
                this.player.activeBuffs = [];  // æ¿€æ´»çš„buff
                
                this.init();
            }
            
            init() {
                console.log('init() called');
                console.log('currentScene:', this.currentScene);
                this.updateUI();
                this.updateGoalDisplay();
                this.showScene(this.currentScene);
                // åˆå§‹åŒ–æ—¶è®¾ç½®ä¸€ä¸ªéšæœºåå­—å’ŒæŠ€èƒ½
                setTimeout(() => {
                    console.log('Setting random name and skills...');
                    this.randomName();
                    this.rollAttributes();
                    this.updateInitialSkillsDisplay();
                }, 100);
            }
            
            // åˆå§‹åŒ–å•†åº—ç‰©å“
            initShopItems() {
                return {
                    training: {
                        name: 'è®­ç»ƒæœåŠ¡',
                        icon: 'ğŸ“',
                        items: [
                            { id: 'coach_serve', name: 'å‘çƒç§æ•™', price: 300, effect: { serve: 8 }, description: 'å‘çƒ+8' },
                            { id: 'coach_spike', name: 'æ‰£çƒç§æ•™', price: 300, effect: { spike: 8 }, description: 'æ‰£çƒ+8' },
                            { id: 'coach_block', name: 'æ‹¦ç½‘ç§æ•™', price: 300, effect: { block: 8 }, description: 'æ‹¦ç½‘+8' },
                            { id: 'coach_dig', name: 'å«çƒç§æ•™', price: 300, effect: { dig: 8 }, description: 'å«çƒ+8' },
                            { id: 'coach_set', name: 'æ‰˜çƒç§æ•™', price: 300, effect: { set: 8 }, description: 'æ‰˜çƒ+8' },
                            { id: 'weekend_camp', name: 'å‘¨æœ«è®­ç»ƒè¥', price: 500, effect: { serve: 5, spike: 5, block: 5, dig: 5, set: 5, energy: -15 }, description: 'å…¨æŠ€èƒ½+5ï¼Œä½“åŠ›-15' }
                        ]
                    },
                    equipment: {
                        name: 'è£…å¤‡å•†åº—',
                        icon: 'ğŸ‘Ÿ',
                        items: [
                            { id: 'pro_shoes', name: 'ä¸“ä¸šçƒé‹', price: 400, type: 'permanent', effect: { trainingBonus: 10 }, description: 'è®­ç»ƒæ•ˆæœ+10%ï¼ˆæ°¸ä¹…ï¼‰' },
                            { id: 'protection', name: 'æŠ¤è†æŠ¤è…•å¥—è£…', price: 250, type: 'permanent', effect: { injuryResist: 50 }, description: 'å‡å°‘å—ä¼¤æ¦‚ç‡50%ï¼ˆæ°¸ä¹…ï¼‰' },
                            { id: 'jersey', name: 'ä¸“ä¸šçƒè¡£', price: 350, type: 'permanent', effect: { mood: 15, reputation: 10, trainingBonus: 5 }, description: 'å¿ƒæƒ…+15ï¼Œå£°æœ›+10ï¼Œè®­ç»ƒæ•ˆæœ+5%ï¼ˆæ°¸ä¹…ï¼‰' },
                            { id: 'training_ball', name: 'ä¸“ä¸šè®­ç»ƒçƒ', price: 600, type: 'permanent', effect: { trainingBonus: 15 }, description: 'æŠ€èƒ½è®­ç»ƒ+15%ï¼ˆæ°¸ä¹…ï¼‰' }
                        ]
                    },
                    recovery: {
                        name: 'æ¢å¤ä¸­å¿ƒ',
                        icon: 'ğŸ’Š',
                        items: [
                            { id: 'energy_drink', name: 'è¿åŠ¨é¥®æ–™', price: 50, effect: { energy: 20 }, description: 'ä½“åŠ›+20' },
                            { id: 'massage', name: 'è¿åŠ¨æŒ‰æ‘©', price: 150, effect: { energy: 40, mood: 15, stress: -10 }, description: 'ä½“åŠ›+40ï¼Œå¿ƒæƒ…+15ï¼Œå‹åŠ›-10' },
                            { id: 'therapy', name: 'æ·±åº¦ç†ç–—', price: 300, effect: { energy: 60, mood: 25, stress: -20 }, description: 'ä½“åŠ›+60ï¼Œå¿ƒæƒ…+25ï¼Œå‹åŠ›-20' },
                            { id: 'nutrition_plan', name: 'è¥å…»é¤è®¡åˆ’', price: 400, type: 'buff', effect: { maxEnergyBonus: 15 }, duration: 4, description: 'ä½“åŠ›ä¸Šé™+15ï¼ˆæŒç»­4å‘¨ï¼‰' }
                        ]
                    },
                    gifts: {
                        name: 'ç¤¼å“åº—',
                        icon: 'ğŸ',
                        items: [
                            { id: 'small_gift', name: 'å°ç¤¼ç‰©', price: 80, effect: { relationship: 10, mood: 8 }, description: 'é˜Ÿå‹å…³ç³»+10ï¼Œå¿ƒæƒ…+8' },
                            { id: 'nice_gift', name: 'ç²¾ç¾ç¤¼ç‰©', price: 180, effect: { relationship: 20, reputation: 10, mood: 15 }, description: 'é˜Ÿå‹å…³ç³»+20ï¼Œå£°æœ›+10ï¼Œå¿ƒæƒ…+15' },
                            { id: 'coach_gift', name: 'æ•™ç»ƒç¤¼ç‰©', price: 350, type: 'buff', effect: { trainingQuality: 10 }, duration: 3, description: 'è®­ç»ƒè´¨é‡+10%ï¼ˆæŒç»­3å‘¨ï¼‰' },
                            { id: 'team_dinner', name: 'è¯·é˜Ÿå‹åƒé¥­', price: 250, effect: { relationship: 25, reputation: 15, mood: 20 }, description: 'é˜Ÿå‹å…³ç³»+25ï¼Œå£°æœ›+15ï¼Œå¿ƒæƒ…+20' }
                        ]
                    },
                    daily: {
                        name: 'ç”Ÿæ´»ç”¨å“',
                        icon: 'ğŸ“±',
                        items: [
                            { id: 'sports_watch', name: 'è¿åŠ¨æ‰‹ç¯', price: 400, type: 'permanent', effect: { mood: 15, weeklyStressReduction: 5 }, description: 'å¿ƒæƒ…+15ï¼Œæ¯å‘¨è‡ªåŠ¨æ¢å¤å‹åŠ›-5ï¼ˆæ°¸ä¹…ï¼‰' },
                            { id: 'new_phone', name: 'æ–°æ‰‹æœº', price: 1200, type: 'permanent', effect: { mood: 30, stress: -20, reputation: 15, weeklyMoodBonus: 3 }, description: 'å¿ƒæƒ…+30ï¼Œå‹åŠ›-20ï¼Œå£°æœ›+15ï¼Œæ¯å‘¨å¿ƒæƒ…+3ï¼ˆæ°¸ä¹…ï¼‰' },
                            { id: 'volleyball_book', name: 'æ’çƒæ•™å­¦ä¹¦', price: 200, effect: { randomSkill: 5 }, description: 'éšæœºæŠ€èƒ½+5' },
                            { id: 'game_console', name: 'æ¸¸æˆæœº', price: 800, type: 'permanent', effect: { mood: 25, stress: -15, weeklyRelax: true }, description: 'å¿ƒæƒ…+25ï¼Œå‹åŠ›-15ï¼Œæ¯å‘¨å¯ç©æ¸¸æˆï¼ˆæ°¸ä¹…ï¼‰' }
                        ]
                    }
                };
            }
            
            getGoalInfo() {
                const goals = {
                    collegeTryout: {
                        id: 'collegeTryout',
                        type: 'tryout',  // é€‰æ‹”ç±»
                        title: 'ğŸ¯ åŠ å…¥é™¢é˜Ÿ',
                        icon: 'ğŸ¯',
                        timeWindow: 'ç¬¬1-4å‘¨',
                        nextEvent: 'ç¬¬5å‘¨é™¢é™…æ¯”èµ›',
                        // ç®€åŒ–è¦æ±‚ï¼šåªçœ‹æŠ€èƒ½ï¼Œä»»æ„2é¡¹æŠ€èƒ½â‰¥15å³å¯
                        criteria: {
                            skillCount: {
                                minSkills: 2,  // è‡³å°‘2é¡¹æŠ€èƒ½è¾¾æ ‡
                                threshold: 15  // æ¯é¡¹æŠ€èƒ½çš„é—¨æ§›
                            }
                        },
                        requirements: {  // ä¿ç•™ç”¨äºæ˜¾ç¤º
                            anyTwo: 15  // ä»»æ„2é¡¹â‰¥15
                        },
                        tips: 'å»ºè®®ç¬¬4å‘¨å‰å®Œæˆé€‰æ‹”ï¼Œä¸ºæ¯”èµ›åšå‡†å¤‡',
                        nextGoal: 'collegeMatch'
                    },
                    collegeMatch: {
                        id: 'collegeMatch',
                        type: 'match',  // æ¯”èµ›ç±»
                        title: 'ğŸ é™¢é™…æ¯”èµ›',
                        icon: 'ğŸ',
                        triggerWeek: 5,
                        description: 'å°½å¯èƒ½å–å¾—å¥½æˆç»©',
                        tips: 'ä¿æŒæœ€ä½³çŠ¶æ€å‚èµ›',  // æ·»åŠ tipså­—æ®µä½œä¸ºåå¤‡
                        preparation: [
                            'æå‡ä¸»è¦æŠ€èƒ½åˆ°20+',
                            'ä¿æŒè‰¯å¥½çŠ¶æ€ï¼ˆå¿ƒæƒ…ã€ä½“åŠ›ï¼‰',
                            'é€‰æ‹©åˆé€‚çš„åœºä¸Šä½ç½®'
                        ],
                        performanceLevels: [
                            'ä¼˜ç§€ï¼šå…¨é¢å‘æŒ¥ï¼Œä¸»å¯¼æ¯”èµ›',
                            'è‰¯å¥½ï¼šç¨³å®šå‘æŒ¥ï¼Œå¸®åŠ©çƒé˜Ÿ',
                            'ä¸€èˆ¬ï¼šä¸­è§„ä¸­çŸ©',
                            'ä¸ä½³ï¼šå‘æŒ¥å¤±å¸¸'
                        ],
                        nextGoal: 'universityTryout'
                    },
                    universityTryout: {
                        id: 'universityTryout',
                        type: 'tryout',  // é€‰æ‹”ç±»
                        title: 'ğŸ¯ åŠ å…¥æ ¡é˜Ÿ',
                        icon: 'ğŸ¯',
                        timeWindow: 'ç¬¬6-11å‘¨',
                        nextEvent: 'ç¬¬12å‘¨æ ¡é™…è”èµ›',
                        // ç®€åŒ–è¦æ±‚ï¼šä»»æ„3é¡¹æŠ€èƒ½â‰¥40ï¼Œå£°æœ›â‰¥50
                        criteria: {
                            skillCount: {
                                minSkills: 3,
                                threshold: 40
                            },
                            stats: {
                                reputation: { min: 50 }
                            }
                        },
                        requirements: {
                            anyThree: 40,
                            reputation: 50
                        },
                        tips: 'å»ºè®®ç¬¬11å‘¨å‰å®Œæˆé€‰æ‹”ï¼Œä¸ºè”èµ›åšå‡†å¤‡ã€‚é™¢é™…æ¯”èµ›è¡¨ç°å¥½å¯è·å¾—å¤§é‡å£°æœ›',
                        nextGoal: 'universityLeague'
                    },
                    universityLeague: {
                        id: 'universityLeague',
                        type: 'match',  // æ¯”èµ›ç±»
                        title: 'ğŸ† æ ¡é™…è”èµ›',
                        icon: 'ğŸ†',
                        triggerWeek: 12,
                        description: 'è¿™æ˜¯æœ€åçš„æ¯”èµ›ï¼ä½ çš„è¡¨ç°å°†å†³å®šæœ€ç»ˆç»“å±€',
                        tips: 'å…¨åŠ›ä»¥èµ´ï¼Œåˆ›é€ å¥‡è¿¹ï¼',  // æ·»åŠ tipså­—æ®µä½œä¸ºåå¤‡
                        preparation: [
                            'å…¨é¢æå‡æŠ€èƒ½åˆ°50+',
                            'è´­ä¹°è£…å¤‡æå‡è®­ç»ƒæ•ˆç‡',
                            'ä¿æŒæœ€ä½³çŠ¶æ€å‚èµ›'
                        ],
                        endings: [
                            'ğŸ† å† å†›ï¼šå®Œç¾è¡¨ç°ï¼Œæ¨ªæ‰«å¯¹æ‰‹',
                            'ğŸ¥ˆ äºšå†›ï¼šå‡ºè‰²å‘æŒ¥ï¼Œæƒœè´¥å†³èµ›',
                            'ğŸ å››å¼ºï¼šç¨³å®šè¡¨ç°ï¼Œæ­¢æ­¥åŠå†³èµ›',
                            'ğŸ“– å‡ºå±€ï¼šé¦–è½®æ·˜æ±°ï¼Œç»§ç»­åŠªåŠ›'
                        ],
                        nextGoal: null  // æ¯”èµ›åè¿›å…¥ç»“å±€
                    }
                };
                
                return goals[this.currentGoal] || goals.collegeTryout;
            }
            
            getAllGoals() {
                // è¿”å›æ‰€æœ‰ç›®æ ‡çš„æœ‰åºåˆ—è¡¨ï¼ˆåŒ…æ‹¬é€‰æ‹”å’Œæ¯”èµ›ï¼‰
                return [
                    'collegeTryout',      // é˜¶æ®µä¸€ï¼šåŠ å…¥é™¢é˜Ÿï¼ˆç¬¬1-4å‘¨é€‰æ‹”ï¼‰
                    'collegeMatch',       // é˜¶æ®µäºŒï¼šé™¢é™…æ¯”èµ›ï¼ˆç¬¬5å‘¨è‡ªåŠ¨ï¼‰
                    'universityTryout',   // é˜¶æ®µä¸‰ï¼šåŠ å…¥æ ¡é˜Ÿï¼ˆç¬¬6-11å‘¨é€‰æ‹”ï¼‰
                    'universityLeague'    // é˜¶æ®µå››ï¼šæ ¡é™…è”èµ›ï¼ˆç¬¬12å‘¨è‡ªåŠ¨ï¼Œå†³å®šç»“å±€ï¼‰
                ];
            }
            
            getGoalStatus(goalId) {
                const allGoals = this.getAllGoals();
                const currentIndex = allGoals.indexOf(this.currentGoal);
                const goalIndex = allGoals.indexOf(goalId);
                
                if (goalIndex < currentIndex) {
                    return 'completed';
                } else if (goalIndex === currentIndex) {
                    return 'current';
                } else if (goalIndex === currentIndex + 1) {
                    return 'next';
                } else {
                    return 'future';
                }
            }
            
            // æ–°å¢ï¼šå¤šç»´åº¦ç›®æ ‡è¯„ä¼°
            evaluateGoal(goal) {
                if (!goal || !goal.criteria) {
                    return { passed: false, score: 0, breakdown: {} };
                }
                
                let totalScore = 0;
                let maxScore = 0;
                let breakdown = {
                    skillCount: { score: 0, max: 0, details: {} },
                    stats: { score: 0, max: 0, details: {} },
                    performance: { score: 0, max: 0, details: {} }
                };
                
                // è¯„ä¼°æŠ€èƒ½æ•°é‡æ ‡å‡†ï¼ˆæ–°å¢ï¼‰
                if (goal.criteria.skillCount) {
                    const sc = goal.criteria.skillCount;
                    const weight = sc.weight || 1.0;  // é»˜è®¤æƒé‡1.0
                    maxScore += weight;
                    breakdown.skillCount.max += weight;
                    
                    // ç»Ÿè®¡è¾¾æ ‡çš„æŠ€èƒ½æ•°é‡
                    const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                    let qualifiedSkills = [];
                    
                    skills.forEach(skill => {
                        if (this.player.skills[skill] >= sc.threshold) {
                            qualifiedSkills.push({
                                name: skill,
                                value: this.player.skills[skill]
                            });
                        }
                    });
                    
                    // è®¡ç®—å¾—åˆ†ï¼šè¾¾æ ‡æŠ€èƒ½æ•° / è¦æ±‚æŠ€èƒ½æ•°
                    const progress = Math.min(qualifiedSkills.length / sc.minSkills, 1.0);
                    const score = progress * weight;
                    
                    totalScore += score;
                    breakdown.skillCount.score += score;
                    breakdown.skillCount.details = {
                        qualified: qualifiedSkills.length,
                        required: sc.minSkills,
                        threshold: sc.threshold,
                        qualifiedSkills: qualifiedSkills,
                        progress: progress,
                        score: score,
                        weight: weight
                    };
                }
                
                // è¯„ä¼°å±æ€§æ ‡å‡†ï¼ˆå£°æœ›ç­‰ï¼‰
                if (goal.criteria.stats) {
                    for (let [stat, requirement] of Object.entries(goal.criteria.stats)) {
                        const weight = requirement.weight || 1.0;  // é»˜è®¤æƒé‡1.0
                        maxScore += weight;
                        breakdown.stats.max += weight;
                        
                        let statValue = stat === 'reputation' ? this.player.reputation : this.player.skills[stat];
                        let progress = Math.min(statValue / requirement.min, 1.0);
                        let score = progress * weight;
                        
                        totalScore += score;
                        breakdown.stats.score += score;
                        breakdown.stats.details[stat] = {
                            current: statValue,
                            required: requirement.min,
                            progress: progress,
                            score: score,
                            weight: weight
                        };
                    }
                }
                
                // è¯„ä¼°è¡¨ç°æ ‡å‡†
                if (goal.criteria.performance) {
                    for (let [metric, requirement] of Object.entries(goal.criteria.performance)) {
                        const weight = requirement.weight || 1.0;  // é»˜è®¤æƒé‡1.0
                        maxScore += weight;
                        breakdown.performance.max += weight;
                        
                        let metricValue = this.player[metric] || 0;
                        let progress = Math.min(metricValue / requirement.min, 1.0);
                        let score = progress * weight;
                        
                        totalScore += score;
                        breakdown.performance.score += score;
                        breakdown.performance.details[metric] = {
                            current: metricValue,
                            required: requirement.min,
                            progress: progress,
                            score: score,
                            weight: weight
                        };
                    }
                }
                
                // è®¡ç®—æœ€ç»ˆå¾—åˆ†
                let finalScore = maxScore > 0 ? totalScore / maxScore : 0;
                let passed = finalScore >= (goal.passingScore || 1.0);  // é»˜è®¤è¦æ±‚100%è¾¾æ ‡
                
                return {
                    passed,
                    score: finalScore,
                    breakdown
                };
            }
            
            // æ£€æŸ¥ç›®æ ‡æ˜¯å¦è¾¾æˆï¼ˆä½¿ç”¨æ–°çš„è¯„ä¼°ç³»ç»Ÿï¼‰
            checkGoalCompletion() {
                const goal = this.getGoalInfo();
                
                // åªæ£€æŸ¥é€‰æ‹”ç±»ç›®æ ‡ï¼Œæ¯”èµ›ç±»ç›®æ ‡è‡ªåŠ¨è§¦å‘
                if (!goal || goal.type !== 'tryout') return false;
                
                // ä½¿ç”¨æ–°çš„è¯„ä¼°ç³»ç»Ÿ
                const evaluation = this.evaluateGoal(goal);
                
                if (evaluation.passed) {
                    // æ„å»ºè¯¦ç»†ä¿¡æ¯
                    let detailsText = `ç»¼åˆè¯„åˆ†ï¼š${(evaluation.score * 100).toFixed(1)}%\n\n`;
                    
                    // æŠ€èƒ½æ•°é‡å¾—åˆ†
                    if (evaluation.breakdown.skillCount && evaluation.breakdown.skillCount.max > 0) {
                        const sc = evaluation.breakdown.skillCount.details;
                        detailsText += `âœ… æŠ€èƒ½è¾¾æ ‡ï¼š${sc.qualified}/${sc.required}é¡¹ï¼ˆé—¨æ§›${sc.threshold}ï¼‰\n`;
                        if (sc.qualifiedSkills.length > 0) {
                            detailsText += `   è¾¾æ ‡æŠ€èƒ½ï¼š${sc.qualifiedSkills.map(s => {
                                const names = {serve:'å‘çƒ',spike:'æ‰£çƒ',block:'æ‹¦ç½‘',dig:'å«çƒ',set:'æ‰˜çƒ'};
                                return names[s.name] + s.value;
                            }).join('ã€')}\n`;
                        }
                        detailsText += '\n';
                    }
                    
                    // å±æ€§å¾—åˆ†
                    if (evaluation.breakdown.stats && evaluation.breakdown.stats.max > 0) {
                        detailsText += `ğŸ“Š å±æ€§è¯„åˆ†ï¼š${(evaluation.breakdown.stats.score / evaluation.breakdown.stats.max * 100).toFixed(1)}%\n`;
                    }
                    
                    // è¡¨ç°å¾—åˆ†
                    if (evaluation.breakdown.performance && evaluation.breakdown.performance.max > 0) {
                        detailsText += `ğŸ è¡¨ç°è¯„åˆ†ï¼š${(evaluation.breakdown.performance.score / evaluation.breakdown.performance.max * 100).toFixed(1)}%\n`;
                    }
                    
                    // ç›®æ ‡è¾¾æˆ - ä½¿ç”¨åœºæ™¯ç³»ç»Ÿæ˜¾ç¤º
                    // å¥–åŠ±è®­ç»ƒç‚¹æ•°
                    this.player.trainingPoints += 50;
                    
                    // åˆ›å»ºç›®æ ‡è¾¾æˆåœºæ™¯
                    SCENES.goalAchieved = {
                        text: `<h2>ğŸ‰ ç›®æ ‡è¾¾æˆï¼</h2><p>æ­å–œä½ å®Œæˆäº†${goal.title}ï¼</p><pre>${detailsText}</pre><p>å¥–åŠ±ï¼šè®­ç»ƒç‚¹æ•° +50</p>`,
                        choices: [{
                            text: 'ç»§ç»­',
                            next: goal.nextGoal ? 'weeklyHub' : 'ending',
                            effect: goal.nextGoal ? { goalUpdate: goal.nextGoal } : {}
                        }]
                    };
                    
                    this.showScene('goalAchieved');
                    return true;
                } else {
                    // æ„å»ºæœªè¾¾æˆè¯¦ç»†ä¿¡æ¯
                    const scorePercent = (evaluation.score * 100).toFixed(1);
                    const neededPercent = ((goal.passingScore || 0.7) * 100).toFixed(0);
                    
                    let detailsText = `ä½ çš„ç»¼åˆè¯„åˆ†ï¼š${scorePercent}%\néœ€è¦è¾¾åˆ°ï¼š${neededPercent}%\n\n`;
                    
                    // æ˜¾ç¤ºå·®è·
                    if (evaluation.breakdown.skillCount && evaluation.breakdown.skillCount.max > 0) {
                        const sc = evaluation.breakdown.skillCount.details;
                        detailsText += `âŒ æŠ€èƒ½è¾¾æ ‡ï¼š${sc.qualified}/${sc.required}é¡¹ï¼ˆè¿˜å·®${sc.required - sc.qualified}é¡¹ï¼‰\n`;
                    }
                    
                    // ç›®æ ‡æœªè¾¾æˆ - ä½¿ç”¨åœºæ™¯ç³»ç»Ÿæ˜¾ç¤º
                    SCENES.goalFailed = {
                        text: `<h2>ğŸ˜¢ ç›®æ ‡æœªè¾¾æˆ</h2><p>å¾ˆé—æ†¾ï¼Œä½ æœªèƒ½å®Œæˆ${goal.title}ã€‚</p><pre>${detailsText}</pre><p>ä¸è¦æ°”é¦ï¼Œç»§ç»­åŠªåŠ›ï¼æ¸¸æˆå°†ç»§ç»­ã€‚</p>`,
                        choices: [{
                            text: 'ç»§ç»­',
                            next: 'weeklyHub'
                        }]
                    };
                    
                    this.showScene('goalFailed');
                    return false;
                }
            }
            
            updateGoalDisplay() {
                const goalInfo = this.getGoalInfo();
                const goalText = document.getElementById('goal-text');
                
                if (!goalText) return;
                
                let html = `<strong>${goalInfo.title}</strong><br>`;
                
                // æ ¹æ®ç›®æ ‡ç±»å‹æ˜¾ç¤ºä¸åŒå†…å®¹
                if (goalInfo.type === 'tryout') {
                    // é€‰æ‹”ç±»ç›®æ ‡ï¼šæ˜¾ç¤ºè¦æ±‚å’Œè¾¾æ ‡æƒ…å†µ
                    const evaluation = this.evaluateGoal(goalInfo);
                    
                    html += `<span style="font-size: 12px; color: #aaa;">â° ${goalInfo.timeWindow}å¯é€‰æ‹”</span><br><br>`;
                    
                    // æ˜¾ç¤ºæŠ€èƒ½æ•°é‡è¦æ±‚
                    if (goalInfo.criteria && goalInfo.criteria.skillCount) {
                        const sc = goalInfo.criteria.skillCount;
                        const details = evaluation.breakdown.skillCount.details;
                        
                        html += `<span style="font-size: 13px;">ğŸ“‹ é€‰æ‹”è¦æ±‚ï¼š</span><br>`;
                        
                        const statusClass = details.qualified >= sc.minSkills ? 'goal-met' : 'goal-not-met';
                        const statusIcon = details.qualified >= sc.minSkills ? 'âœ“' : 'â—‹';
                        
                        let reqText = '';
                        if (goalInfo.requirements.anyTwo) {
                            reqText = `ä»»æ„2é¡¹â‰¥${goalInfo.requirements.anyTwo}`;
                        } else if (goalInfo.requirements.anyThree) {
                            reqText = `ä»»æ„3é¡¹â‰¥${goalInfo.requirements.anyThree}`;
                        }
                        
                        html += `<span class="${statusClass}">${statusIcon} ${reqText}ï¼ˆå·²è¾¾æ ‡${details.qualified}é¡¹ï¼‰</span><br>`;
                        
                        // æ˜¾ç¤ºå½“å‰æŠ€èƒ½å€¼
                        html += `<div style="font-size: 12px; margin-top: 5px; color: #aaa;">`;
                        const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                        const skillNames = {serve:'å‘çƒ',spike:'æ‰£çƒ',block:'æ‹¦ç½‘',dig:'å«çƒ',set:'æ‰˜çƒ'};
                        skills.forEach(skill => {
                            const value = this.player.skills[skill];
                            const qualified = value >= sc.threshold;
                            const color = qualified ? '#2ecc71' : '#999';
                            html += `<span style="color: ${color};">${skillNames[skill]}${value}</span> `;
                        });
                        html += `</div>`;
                    }
                    
                    // æ˜¾ç¤ºå£°æœ›è¦æ±‚
                    if (goalInfo.requirements.reputation) {
                        html += `<br><span style="font-size: 13px;">â­ å£°æœ›è¦æ±‚ï¼š</span><br>`;
                        const current = this.player.reputation;
                        const required = goalInfo.requirements.reputation;
                        const met = current >= required;
                        const statusClass = met ? 'goal-met' : 'goal-not-met';
                        const statusIcon = met ? 'âœ“' : 'â—‹';
                        html += `<span class="${statusClass}">${statusIcon} å£°æœ›: ${current}/${required}</span><br>`;
                    }
                    
                    html += `<br><span style="font-size: 11px; color: #f39c12;">â° ${goalInfo.nextEvent}</span><br>`;
                    html += `<span style="font-size: 11px; color: #ddd;">ğŸ’¡ ${goalInfo.tips}</span>`;
                    
                } else if (goalInfo.type === 'match') {
                    // æ¯”èµ›ç±»ç›®æ ‡ï¼šæ˜¾ç¤ºæ¯”èµ›ä¿¡æ¯å’Œå‡†å¤‡å»ºè®®
                    const weeksUntil = goalInfo.triggerWeek - this.player.week;
                    
                    if (weeksUntil > 0) {
                        html += `<span style="font-size: 12px; color: #aaa;">ğŸ“… ç¬¬${goalInfo.triggerWeek}å‘¨è‡ªåŠ¨å¼€å§‹ï¼ˆè¿˜æœ‰${weeksUntil}å‘¨ï¼‰</span><br><br>`;
                    } else if (weeksUntil === 0) {
                        html += `<span style="font-size: 12px; color: #f39c12;">ï¿½ æœ¬å‘¨å°†è¿›è¡Œæ¯”èµ›ï¼</span><br><br>`;
                    } else {
                        html += `<span style="font-size: 12px; color: #22c55e;">ğŸ“… æ¯”èµ›å·²å®Œæˆ</span><br><br>`;
                    }
                    
                    html += `<span style="font-size: 13px;">ğŸ¯ æ¯”èµ›ç›®æ ‡ï¼š</span><br>`;
                    html += `<span style="font-size: 12px; color: #ddd;">${goalInfo.description}</span><br><br>`;
                    
                    html += `<span style="font-size: 13px;">ğŸ’ª å‡†å¤‡å»ºè®®ï¼š</span><br>`;
                    html += `<div style="font-size: 11px; color: #aaa; line-height: 1.6;">`;
                    goalInfo.preparation.forEach(tip => {
                        html += `â€¢ ${tip}<br>`;
                    });
                    html += `</div>`;
                    
                    // å¦‚æœæ˜¯æ ¡é™…è”èµ›ï¼Œæ˜¾ç¤ºå¯èƒ½çš„ç»“å±€
                    if (goalInfo.endings) {
                        html += `<br><span style="font-size: 13px;">ğŸ… å¯èƒ½çš„ç»“å±€ï¼š</span><br>`;
                        html += `<div style="font-size: 11px; color: #aaa; line-height: 1.6;">`;
                        goalInfo.endings.forEach(ending => {
                            html += `${ending}<br>`;
                        });
                        html += `</div>`;
                    } else if (goalInfo.performanceLevels) {
                        // å…¶ä»–æ¯”èµ›æ˜¾ç¤ºè¡¨ç°è¯„çº§
                        html += `<br><span style="font-size: 13px;">ğŸ“Š è¡¨ç°è¯„çº§ï¼š</span><br>`;
                        html += `<div style="font-size: 11px; color: #aaa; line-height: 1.6;">`;
                        goalInfo.performanceLevels.forEach(level => {
                            html += `${level}<br>`;
                        });
                        html += `</div>`;
                    }
                }
                
                goalText.innerHTML = html;
            }
            
            toggleGoalsPanel() {
                const panel = document.getElementById('goals-panel');
                if (panel.classList.contains('show')) {
                    panel.classList.remove('show');
                } else {
                    this.renderGoalsPanel();
                    panel.classList.add('show');
                }
            }
            
            renderGoalsPanel() {
                const goalsList = document.getElementById('goals-list');
                const allGoalIds = this.getAllGoals();
                
                let html = '';
                
                allGoalIds.forEach(goalId => {
                    // ä½¿ç”¨getGoalInfoè·å–æ­£ç¡®çš„ç›®æ ‡ä¿¡æ¯
                    const tempGame = { currentGoal: goalId, player: this.player };
                    const goal = this.getGoalInfo.call(tempGame);
                    
                    const status = this.getGoalStatus(goalId);
                    
                    let badgeText = '';
                    let badgeClass = '';
                    if (status === 'current') {
                        badgeText = 'è¿›è¡Œä¸­';
                        badgeClass = 'current';
                    } else if (status === 'next') {
                        badgeText = 'ä¸‹ä¸€ä¸ª';
                        badgeClass = 'next';
                    } else if (status === 'completed') {
                        badgeText = 'å·²å®Œæˆ';
                        badgeClass = 'completed';
                    } else {
                        badgeText = 'æœªè§£é”';
                        badgeClass = 'future';
                    }
                    
                    html += `<div class="goal-card ${status}">
                        <div class="goal-header">
                            <div class="goal-title">${goal.title}</div>
                            <div class="goal-badge ${badgeClass}">${badgeText}</div>
                        </div>`;
                    
                    // æ ¹æ®ç›®æ ‡ç±»å‹æ˜¾ç¤ºä¸åŒå†…å®¹
                    if (goal.type === 'tryout') {
                        // é€‰æ‹”ç±»ç›®æ ‡ï¼šæ˜¾ç¤ºæ—¶é—´çª—å£å’Œè¦æ±‚
                        html += `<div class="goal-description">${goal.timeWindow}å¯é€‰æ‹”</div>`;
                        
                        // æ˜¾ç¤ºè¦æ±‚
                        if (goal.requirements) {
                            html += `<div class="goal-requirements">
                                <h4>ğŸ“‹ è¦æ±‚ï¼š</h4>`;
                            
                            // æ˜¾ç¤ºæŠ€èƒ½æ•°é‡è¦æ±‚
                            if (goal.requirements.anyTwo) {
                                html += `<div class="requirement-item">
                                    <span>ğŸ¯ ä»»æ„2é¡¹æŠ€èƒ½</span>
                                    <span>â‰¥ ${goal.requirements.anyTwo}</span>
                                </div>`;
                            } else if (goal.requirements.anyThree) {
                                html += `<div class="requirement-item">
                                    <span>ğŸ¯ ä»»æ„3é¡¹æŠ€èƒ½</span>
                                    <span>â‰¥ ${goal.requirements.anyThree}</span>
                                </div>`;
                            }
                            
                            // æ˜¾ç¤ºå£°æœ›è¦æ±‚
                            if (goal.requirements.reputation) {
                                const current = this.player.reputation;
                                const required = goal.requirements.reputation;
                                const met = current >= required;
                                const statusClass = met ? 'requirement-met' : 'requirement-not-met';
                                const statusIcon = met ? 'âœ“' : 'â—‹';
                                
                                html += `<div class="requirement-item ${statusClass}">
                                    <span>${statusIcon} å£°æœ›</span>
                                    <span>${current} / ${required}</span>
                                </div>`;
                            }
                            
                            html += `</div>`;
                        }
                        
                        html += `<div class="goal-tips">ğŸ’¡ ${goal.tips}</div>`;
                        
                    } else if (goal.type === 'match') {
                        // æ¯”èµ›ç±»ç›®æ ‡ï¼šæ˜¾ç¤ºæ¯”èµ›æ—¶é—´å’Œå‡†å¤‡å»ºè®®
                        html += `<div class="goal-description">ç¬¬${goal.triggerWeek}å‘¨è‡ªåŠ¨å¼€å§‹</div>`;
                        html += `<div class="goal-requirements">
                            <h4>ğŸ¯ æ¯”èµ›ç›®æ ‡ï¼š</h4>
                            <p style="margin: 5px 0; color: #333; font-size: 14px;">${goal.description}</p>
                        </div>`;
                        
                        if (goal.preparation && goal.preparation.length > 0) {
                            html += `<div class="goal-requirements">
                                <h4>ğŸ’ª å‡†å¤‡å»ºè®®ï¼š</h4>`;
                            goal.preparation.forEach(tip => {
                                html += `<p style="margin: 5px 0; color: #333; font-size: 13px;">â€¢ ${tip}</p>`;
                            });
                            html += `</div>`;
                        }
                    }
                    
                    html += `</div>`;
                });
                
                goalsList.innerHTML = html;
            }
            
            renderLifeChoice() {
                const storyText = document.getElementById('story-text');
                const choicesDiv = document.getElementById('choices');
                
                storyText.innerHTML = `<h2>ğŸŒŸ è¯¾ä½™ç”Ÿæ´»</h2>
                    <p>è®­ç»ƒç»“æŸäº†ï¼Œä½ æƒ³åšäº›ä»€ä¹ˆæ¥æ”¾æ¾ä¸€ä¸‹ï¼Ÿ</p>`;
                
                // å®šä¹‰åˆ†ç±»
                const categories = {
                    sports: {
                        title: 'ğŸ è¿åŠ¨å¨±ä¹',
                        color: '#ff6b6b',
                        choices: [
                            {
                                icon: 'ğŸ',
                                title: 'æ‰“é‡çƒ',
                                effects: '25åˆ†åˆ¶æ¯”èµ› ä½“åŠ›-20',
                                next: 'casualMatch',
                                requirement: { energy: 20 },
                                effect: { matchType: 'casual', energy: -20 }
                            }
                        ]
                    },
                    rest: {
                        title: 'ğŸ˜´ ä¼‘æ¯æ¢å¤',
                        color: '#4ecdc4',
                        choices: [
                            {
                                icon: 'ğŸ˜´',
                                title: 'æ—©ç‚¹ä¼‘æ¯',
                                effects: 'ä½“åŠ›+25 å¿ƒæƒ…+10 å‹åŠ›-8',
                                next: 'checkRandomEvent',
                                effect: { energy: 25, mood: 10, stress: -8, eventType: 'life', lifeActivity: 'rest' }
                            },
                            {
                                icon: 'ğŸ’†',
                                title: 'é©¬æ€é¸¡ï¼ˆæŒ‰æ‘©ï¼‰',
                                effects: 'ä½“åŠ›+40 å¿ƒæƒ…+18 å‹åŠ›-15 ğŸ’°120',
                                next: 'checkRandomEvent',
                                requirement: { money: 120 },
                                effect: { energy: 40, mood: 18, stress: -15, money: -120, eventType: 'life', lifeActivity: 'rest' }
                            },
                            {
                                icon: 'ğŸ®',
                                title: 'æ‰“æ¸¸æˆ',
                                effects: 'ä½“åŠ›+8 å¿ƒæƒ…+12 å‹åŠ›-10',
                                next: 'checkRandomEvent',
                                effect: { energy: 8, mood: 12, stress: -10, eventType: 'life', lifeActivity: 'game' }
                            },
                            {
                                icon: 'ğŸ“š',
                                title: 'å»å›¾ä¹¦é¦†',
                                effects: 'ä½“åŠ›+5 å¿ƒæƒ…+8 å‹åŠ›-3 å£°æœ›+3',
                                next: 'checkRandomEvent',
                                effect: { energy: 5, mood: 8, stress: -3, reputation: 3, eventType: 'life' }
                            }
                        ]
                    },
                    social: {
                        title: 'ğŸ‘¥ ç¤¾äº¤æ´»åŠ¨',
                        color: '#95e1d3',
                        choices: [
                            {
                                icon: 'ğŸ‘¥',
                                title: 'å’Œé˜Ÿå‹èŠå¤©',
                                effects: 'ä½“åŠ›+10 å¿ƒæƒ…+15 å‹åŠ›-8 å…³ç³»+5',
                                next: 'checkRandomEvent',
                                effect: { energy: 10, mood: 15, stress: -8, relationship: 5, eventType: 'life', lifeActivity: 'social' }
                            },
                            {
                                icon: 'ğŸ¿',
                                title: 'çœ‹ç”µå½±',
                                effects: 'ä½“åŠ›+12 å¿ƒæƒ…+20 å‹åŠ›-12 ğŸ’°50',
                                next: 'checkRandomEvent',
                                requirement: { money: 50 },
                                effect: { energy: 12, mood: 20, stress: -12, money: -50, eventType: 'life', lifeActivity: 'movie' }
                            },
                            {
                                icon: 'ğŸ',
                                title: 'ç»™é˜Ÿå‹ä¹°ç¤¼ç‰©',
                                effects: 'å¿ƒæƒ…+10 å…³ç³»+15 å£°æœ›+5 ğŸ’°80',
                                next: 'checkRandomEvent',
                                requirement: { money: 80 },
                                effect: { relationship: 15, reputation: 5, mood: 10, money: -80, eventType: 'life', lifeActivity: 'social' }
                            }
                        ]
                    },
                    food: {
                        title: 'ğŸ” ç¾é£Ÿäº«å—',
                        color: '#ffd93d',
                        choices: [
                            {
                                icon: 'ğŸœ',
                                title: 'åƒå¤œå®µ',
                                effects: 'ä½“åŠ›+8 å¿ƒæƒ…+15 å‹åŠ›-5 ğŸ’°20',
                                next: 'checkRandomEvent',
                                requirement: { money: 20 },
                                effect: { energy: 8, mood: 15, stress: -5, money: -20, eventType: 'life' }
                            },
                            {
                                icon: 'ğŸ”',
                                title: 'åƒå¤§é¤',
                                effects: 'ä½“åŠ›+15 å¿ƒæƒ…+25 å‹åŠ›-10 ğŸ’°100',
                                next: 'checkRandomEvent',
                                requirement: { money: 100 },
                                effect: { energy: 15, mood: 25, stress: -10, money: -100, eventType: 'life' }
                            }
                        ]
                    },
                    work: {
                        title: 'ğŸ’¼ å…¼èŒèµšé’±',
                        color: '#6c5ce7',
                        choices: [
                            {
                                icon: 'ğŸ’¼',
                                title: 'å…¼èŒæ‰“å·¥',
                                effects: 'ğŸ’°+120 ä½“åŠ›-20 å‹åŠ›+8',
                                next: 'checkRandomEvent',
                                requirement: { energy: 20 },
                                effect: { money: 120, energy: -20, stress: 8, mood: -3, eventType: 'life' }
                            }
                        ]
                    }
                };
                
                let html = '<div class="life-categories">';
                
                for (let catKey in categories) {
                    const category = categories[catKey];
                    html += `<div class="life-category ${catKey}">
                        <div class="category-title">${category.title}</div>
                        <div class="category-choices">`;
                    
                    category.choices.forEach(choice => {
                        const meetsRequirement = choice.requirement ? this.checkRequirement(choice.requirement) : true;
                        const disabledClass = meetsRequirement ? '' : 'disabled';
                        const disabledAttr = meetsRequirement ? '' : 'disabled';
                        
                        // åŠ¨æ€ç”Ÿæˆæ•ˆæœæ–‡æœ¬
                        const effectText = this.getEffectPreview(choice.effect);
                        
                        html += `<button class="life-choice-card ${disabledClass}" ${disabledAttr} 
                            onclick="game.handleLifeChoice('${choice.next}', ${JSON.stringify(choice.effect || {}).replace(/"/g, '&quot;')})">
                            <div class="life-choice-icon">${choice.icon}</div>
                            <div class="life-choice-title">${choice.title}</div>
                            <div class="life-choice-effects">${effectText || choice.effects}</div>
                            ${!meetsRequirement ? '<div style="color: #ffeb3b; font-size: 10px; margin-top: 3px;">æ¡ä»¶ä¸è¶³</div>' : ''}
                        </button>`;
                    });
                    
                    html += `</div></div>`;
                }
                
                html += '</div>';
                
                choicesDiv.innerHTML = html;
            }
            
            handleLifeChoice(nextScene, effect) {
                if (effect && Object.keys(effect).length > 0) {
                    this.applyEffect(effect);
                    
                    // æ£€æŸ¥æ˜¯å¦éœ€è¦è§¦å‘éšæœºäº‹ä»¶
                    if (effect.eventType) {
                        const event = this.triggerRandomEvent(effect.eventType);
                        if (event) {
                            this.showRandomEvent(event);
                            return;
                        }
                    }
                }
                
                if (nextScene) {
                    this.currentScene = nextScene;
                    this.showScene(nextScene);
                }
            }
            
            // å•†åº—ç³»ç»Ÿæ–¹æ³•
            renderShopMain() {
                const storyText = document.getElementById('story-text');
                const choicesDiv = document.getElementById('choices');
                
                storyText.innerHTML = `<h2>ğŸ›’ å•†åº—</h2>
                    <p>ğŸ’° å½“å‰é‡‘é’±ï¼š<strong>${this.player.money}å…ƒ</strong></p>`;
                
                let html = '';
                
                // éå†æ‰€æœ‰åˆ†ç±»ï¼Œç›´æ¥æ˜¾ç¤ºå•†å“
                for (let catKey in this.shopItems) {
                    const category = this.shopItems[catKey];
                    
                    html += `<div class="shop-category-section">
                        <div class="shop-category-header">${category.icon} ${category.name}</div>
                        <div class="shop-items-compact">`;
                    
                    category.items.forEach(item => {
                        const canAfford = this.player.money >= item.price;
                        const owned = this.checkItemOwned(item);
                        const disabledClass = (!canAfford || owned) ? 'disabled' : '';
                        
                        html += `<div class="shop-item-compact ${disabledClass}" onclick="game.buyItem('${catKey}', '${item.id}')">
                            <div class="item-compact-name">${item.name}</div>
                            <div class="item-compact-desc">${item.description}</div>
                            <div class="item-compact-price">ğŸ’°${item.price}</div>
                            ${owned ? '<div class="item-compact-badge owned">âœ“</div>' : ''}
                            ${!canAfford && !owned ? '<div class="item-compact-badge locked">ğŸ”’</div>' : ''}
                        </div>`;
                    });
                    
                    html += `</div></div>`;
                }
                
                html += '<div class="choices"><button class="choice-btn" onclick="game.showScene(\'weeklyHub\')">ğŸ”™ è¿”å›</button></div>';
                
                choicesDiv.innerHTML = html;
            }
            
            renderShopCategory(categoryKey) {
                const storyText = document.getElementById('story-text');
                const choicesDiv = document.getElementById('choices');
                const category = this.shopItems[categoryKey];
                
                if (!category) {
                    alert('å•†å“åˆ†ç±»ä¸å­˜åœ¨');
                    this.showScene('shopMain');
                    return;
                }
                
                storyText.innerHTML = `<h2>${category.icon} ${category.name}</h2>
                    <p>ğŸ’° å½“å‰é‡‘é’±ï¼š<strong>${this.player.money}å…ƒ</strong></p>`;
                
                let html = '<div class="shop-items-grid">';
                
                category.items.forEach(item => {
                    const canAfford = this.player.money >= item.price;
                    const owned = this.checkItemOwned(item);
                    const disabledClass = (!canAfford || owned) ? 'disabled' : '';
                    
                    html += `<div class="shop-item-card ${disabledClass}">
                        <div class="item-name">${item.name}</div>
                        <div class="item-description">${item.description}</div>
                        <div class="item-price">ğŸ’° ${item.price}å…ƒ</div>
                        ${owned ? '<div class="item-owned">âœ“ å·²æ‹¥æœ‰</div>' : ''}
                        ${!canAfford && !owned ? '<div class="item-locked">ğŸ’° é‡‘é’±ä¸è¶³</div>' : ''}
                        <button onclick="game.buyItem('${categoryKey}', '${item.id}')" ${!canAfford || owned ? 'disabled' : ''}>
                            è´­ä¹°
                        </button>
                    </div>`;
                });
                
                html += '</div>';
                html += '<div class="choices">';
                html += '<button class="choice-btn" onclick="game.showScene(\'shopMain\')">ğŸ”™ è¿”å›å•†åº—</button>';
                html += '<button class="choice-btn" onclick="game.showScene(\'weeklyHub\')">ğŸ  è¿”å›å‘¨é€‰æ‹©</button>';
                html += '</div>';
                
                choicesDiv.innerHTML = html;
            }
            
            checkItemOwned(item) {
                if (item.type !== 'permanent') return false;
                
                // æ£€æŸ¥å„ç±»æ°¸ä¹…ç‰©å“æ˜¯å¦å·²æ‹¥æœ‰
                if (item.id === 'pro_shoes') return this.player.ownedItems.shoes === 'pro';
                if (item.id === 'protection') return this.player.ownedItems.protection;
                if (item.id === 'jersey') return this.player.ownedItems.jersey;
                if (item.id === 'training_ball') return this.player.ownedItems.trainingEquipment.includes('ball');
                if (item.id === 'sports_watch') return this.player.ownedItems.electronics.includes('watch');
                if (item.id === 'new_phone') return this.player.ownedItems.electronics.includes('phone');
                if (item.id === 'game_console') return this.player.ownedItems.electronics.includes('console');
                
                return false;
            }
            
            buyItem(categoryKey, itemId) {
                const category = this.shopItems[categoryKey];
                const item = category.items.find(i => i.id === itemId);
                
                if (!item) {
                    alert('å•†å“ä¸å­˜åœ¨');
                    return;
                }
                
                if (this.player.money < item.price) {
                    alert('é‡‘é’±ä¸è¶³ï¼');
                    return;
                }
                
                if (this.checkItemOwned(item)) {
                    alert('ä½ å·²ç»æ‹¥æœ‰è¿™ä¸ªç‰©å“äº†ï¼');
                    return;
                }
                
                // æ‰£é™¤é‡‘é’±
                this.player.money -= item.price;
                
                // ç»Ÿè®¡æ¶ˆè´¹
                this.playerStats.totalMoneySpent += item.price;
                
                // æ ¹æ®ç±»åˆ«ç»Ÿè®¡
                if (category === 'training') {
                    this.playerStats.coachingPurchased++;
                } else if (category === 'equipment') {
                    this.playerStats.equipmentPurchased++;
                } else if (category === 'entertainment') {
                    this.playerStats.entertainmentSpent += item.price;
                }
                
                // å¤„ç†ç‰¹æ®Šæ•ˆæœ
                let resultMessage = `è´­ä¹°æˆåŠŸï¼\n\n${item.name}\n\n`;
                
                // å¤„ç†éšæœºæŠ€èƒ½ä¹¦
                if (item.effect && item.effect.randomSkill) {
                    const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                    const randomSkill = skills[Math.floor(Math.random() * skills.length)];
                    this.player.skills[randomSkill] = Math.min(100, this.player.skills[randomSkill] + item.effect.randomSkill);
                    resultMessage += `ä½ çš„${this.getSkillName(randomSkill)}æå‡äº†${item.effect.randomSkill}ç‚¹ï¼`;
                } else {
                    // åº”ç”¨æ™®é€šæ•ˆæœ
                    if (item.effect) {
                        // å¤„ç†å³æ—¶æ•ˆæœ
                        if (item.effect.serve) this.player.skills.serve = Math.min(100, this.player.skills.serve + item.effect.serve);
                        if (item.effect.spike) this.player.skills.spike = Math.min(100, this.player.skills.spike + item.effect.spike);
                        if (item.effect.block) this.player.skills.block = Math.min(100, this.player.skills.block + item.effect.block);
                        if (item.effect.dig) this.player.skills.dig = Math.min(100, this.player.skills.dig + item.effect.dig);
                        if (item.effect.set) this.player.skills.set = Math.min(100, this.player.skills.set + item.effect.set);
                        if (item.effect.energy) this.player.energy = Math.max(0, Math.min(this.player.maxEnergy, this.player.energy + item.effect.energy));
                        if (item.effect.mood) this.player.mood = Math.max(0, Math.min(100, this.player.mood + item.effect.mood));
                        if (item.effect.stress) this.player.stress = Math.max(0, Math.min(100, this.player.stress + item.effect.stress));
                        if (item.effect.reputation) this.player.reputation += item.effect.reputation;
                        if (item.effect.relationship) this.player.relationships.teammates = Math.min(100, this.player.relationships.teammates + item.effect.relationship);
                    }
                    resultMessage += item.description;
                }
                
                // å¤„ç†æ°¸ä¹…ç‰©å“
                if (item.type === 'permanent') {
                    if (!this.player.ownedItems) {
                        this.player.ownedItems = { shoes: 'none', protection: false, jersey: false, trainingEquipment: [], electronics: [] };
                    }
                    
                    if (item.id === 'pro_shoes') this.player.ownedItems.shoes = 'pro';
                    if (item.id === 'protection') this.player.ownedItems.protection = true;
                    if (item.id === 'jersey') this.player.ownedItems.jersey = true;
                    if (item.id === 'training_ball') {
                        if (!this.player.ownedItems.trainingEquipment) this.player.ownedItems.trainingEquipment = [];
                        this.player.ownedItems.trainingEquipment.push('ball');
                    }
                    if (item.id === 'sports_watch') {
                        if (!this.player.ownedItems.electronics) this.player.ownedItems.electronics = [];
                        this.player.ownedItems.electronics.push('watch');
                    }
                    if (item.id === 'new_phone') {
                        if (!this.player.ownedItems.electronics) this.player.ownedItems.electronics = [];
                        this.player.ownedItems.electronics.push('phone');
                    }
                    if (item.id === 'game_console') {
                        if (!this.player.ownedItems.electronics) this.player.ownedItems.electronics = [];
                        this.player.ownedItems.electronics.push('console');
                    }
                }
                
                // å¤„ç†buffç±»ç‰©å“
                if (item.type === 'buff') {
                    if (!this.player.activeBuffs) this.player.activeBuffs = [];
                    this.player.activeBuffs.push({
                        id: item.id,
                        name: item.name,
                        effect: item.effect,
                        remainingWeeks: item.duration || 1
                    });
                    
                    // è¥å…»é¤è®¡åˆ’ï¼šç«‹å³å¢åŠ ä½“åŠ›ä¸Šé™
                    if (item.id === 'nutrition_plan' && item.effect.maxEnergyBonus) {
                        this.player.maxEnergy += item.effect.maxEnergyBonus;
                    }
                }
                
                alert(resultMessage);
                this.updateUI();
                // åˆ·æ–°å•†åº—ä¸»ç•Œé¢
                this.showScene('shopMain');
            }
            
            getSkillName(skill) {
                const names = { serve: 'å‘çƒ', spike: 'æ‰£çƒ', block: 'æ‹¦ç½‘', dig: 'å«çƒ', set: 'æ‰˜çƒ' };
                return names[skill] || skill;
            }
            
            // èŒä¸šç³»ç»Ÿæ–¹æ³•
            renderPositionSelection() {
                const storyText = document.getElementById('story-text');
                const choicesDiv = document.getElementById('choices');
                
                storyText.innerHTML = `<h2>ğŸ é€‰æ‹©ä½ çš„åœºä¸Šä½ç½®</h2>
                    <p>æ•™ç»ƒï¼š"ä½ å·²ç»æŒæ¡äº†åŸºæœ¬æŠ€èƒ½ï¼Œç°åœ¨éœ€è¦é€‰æ‹©ä¸€ä¸ªä¸“ç²¾çš„ä½ç½®ã€‚"</p>
                    <p>"æ¯ä¸ªä½ç½®éƒ½æœ‰ä¸åŒçš„èŒè´£å’Œè¦æ±‚ï¼Œé€‰æ‹©é€‚åˆä½ çš„ä½ç½®å§ï¼"</p>`;
                
                // è®¡ç®—æ‰€æœ‰èŒä¸šçš„åŒ¹é…åº¦å¹¶æ’åº
                const positionsWithMatch = Object.keys(this.positions).map(posKey => {
                    const pos = this.positions[posKey];
                    const matchScore = this.calculatePositionMatch(pos);
                    const meetsRequirement = this.checkPositionRequirement(pos);
                    return { key: posKey, pos, matchScore, meetsRequirement };
                }).sort((a, b) => b.matchScore - a.matchScore);
                
                let html = '<div class="position-cards">';
                
                for (let item of positionsWithMatch) {
                    const { key: posKey, pos, matchScore, meetsRequirement } = item;
                    const disabledClass = meetsRequirement ? '' : 'disabled';
                    const recommendedClass = matchScore >= 80 && meetsRequirement ? 'recommended' : '';
                    
                    // è·å–æ ¸å¿ƒæŠ€èƒ½è¦æ±‚
                    const reqText = Object.entries(pos.baseRequirements)
                        .map(([skill, value]) => {
                            const skillNames = { serve: 'å‘çƒ', spike: 'æ‰£çƒ', block: 'æ‹¦ç½‘', dig: 'å«çƒ', set: 'æ‰˜çƒ' };
                            const currentValue = this.player.skills[skill];
                            const met = currentValue >= value;
                            const gap = met ? 0 : value - currentValue;
                            return `${skillNames[skill]} ${currentValue}/${value} ${met ? 'âœ“' : `âœ—(è¿˜å·®${gap})`}`;
                        }).join(' ');
                    
                    html += `<div class="position-card ${disabledClass} ${recommendedClass}" onclick="game.selectPosition('${pos.id}', ${meetsRequirement})">
                        <div class="position-icon">${pos.icon}</div>
                        <div class="position-name">${pos.name}</div>
                        ${recommendedClass ? '<div class="position-recommended">â­ æ¨è</div>' : ''}
                        <div class="position-match">åŒ¹é…åº¦ï¼š${matchScore}%</div>
                        <div class="position-desc">${pos.description}</div>
                        <div class="position-skills">
                            <strong>æ ¸å¿ƒæŠ€èƒ½ï¼š</strong>${pos.coreSkills.map(s => {
                                const names = { serve: 'å‘çƒ', spike: 'æ‰£çƒ', block: 'æ‹¦ç½‘', dig: 'å«çƒ', set: 'æ‰˜çƒ' };
                                return names[s];
                            }).join('ã€')}
                        </div>
                        <div class="position-requirements">${reqText}</div>
                        ${pos.restrictions ? `<div class="position-restrictions">é™åˆ¶ï¼š${pos.restrictions.join('ã€')}</div>` : ''}
                        ${!meetsRequirement ? '<div class="position-locked">ğŸ”’ æ¡ä»¶ä¸è¶³</div>' : ''}
                    </div>`;
                }
                
                html += '</div>';
                
                // æ·»åŠ "æš‚ä¸é€‰æ‹©"é€‰é¡¹
                html += `<div class="choices">
                    <button class="choice-button" onclick="game.skipPositionSelection()">
                        â­ï¸ æš‚ä¸é€‰æ‹©ï¼Œç»§ç»­è®­ç»ƒ
                    </button>
                </div>`;
                
                choicesDiv.innerHTML = html;
            }
            
            calculatePositionMatch(position) {
                let score = 0;
                let maxScore = 0;
                
                for (let [skill, required] of Object.entries(position.baseRequirements)) {
                    maxScore += required;
                    score += Math.min(this.player.skills[skill], required);
                }
                
                return maxScore > 0 ? Math.round(score / maxScore * 100) : 0;
            }
            
            skipPositionSelection() {
                alert('ä½ å†³å®šæš‚æ—¶ä¸é€‰æ‹©ä½ç½®ï¼Œç»§ç»­æå‡æŠ€èƒ½ã€‚\n\nä½ å¯ä»¥éšæ—¶å›åˆ°è¿™é‡Œé€‰æ‹©ä½ç½®ï¼');
                this.currentScene = 'weeklyHub';
                this.showScene('weeklyHub');
                this.updateUI();
            }
            
            checkPositionRequirement(position) {
                const req = position.baseRequirements;
                for (let skill in req) {
                    if (this.player.skills[skill] < req[skill]) {
                        return false;
                    }
                }
                return true;
            }
            
            selectPosition(positionId, meetsRequirement) {
                if (!meetsRequirement) {
                    alert('ä½ çš„æŠ€èƒ½è¿˜ä¸æ»¡è¶³è¿™ä¸ªä½ç½®çš„è¦æ±‚ï¼');
                    return;
                }
                
                const position = this.positions[positionId];
                this.player.position = positionId;
                this.player.positionLevel = 1;
                
                alert(`ä½ é€‰æ‹©äº† ${position.icon} ${position.name}ï¼\n\n${position.description}\n\næ ¸å¿ƒæŠ€èƒ½è®­ç»ƒå°†è·å¾—é¢å¤–åŠ æˆï¼`);
                
                // ä¸ä¿®æ”¹ç›®æ ‡ï¼Œä¿æŒä¹‹å‰è®¾ç½®çš„ç›®æ ‡
                this.currentScene = 'weeklyHub';
                this.showScene('weeklyHub');
                this.updateUI();
            }
            
            getPositionInfo() {
                if (this.player.position === 'none') {
                    return null;
                }
                return this.positions[this.player.position];
            }
            
            getTrainingBonus(skill) {
                let totalBonus = 0;
                
                // èŒä¸šåŠ æˆ
                const posInfo = this.getPositionInfo();
                if (posInfo) {
                    // é€‚åº”æœŸæƒ©ç½š
                    if (this.player.adaptationWeeks > 0) {
                        totalBonus += -0.2;
                    } else {
                        if (posInfo.coreSkills.includes(skill)) {
                            totalBonus += posInfo.trainingBonus.core;
                        } else if (posInfo.secondarySkills.includes(skill)) {
                            totalBonus += posInfo.trainingBonus.secondary;
                        } else {
                            totalBonus += posInfo.trainingBonus.other;
                        }
                    }
                }
                
                // è£…å¤‡åŠ æˆ
                if (this.player.ownedItems) {
                    // ä¸“ä¸šçƒé‹ +10%
                    if (this.player.ownedItems.shoes === 'pro') {
                        totalBonus += 0.10;
                    }
                    // ä¸“ä¸šçƒè¡£ +5%
                    if (this.player.ownedItems.jersey) {
                        totalBonus += 0.05;
                    }
                    // ä¸“ä¸šè®­ç»ƒçƒ +15%
                    if (this.player.ownedItems.trainingEquipment && this.player.ownedItems.trainingEquipment.includes('ball')) {
                        totalBonus += 0.15;
                    }
                }
                
                // BuffåŠ æˆ
                if (this.player.activeBuffs) {
                    this.player.activeBuffs.forEach(buff => {
                        // æ•™ç»ƒç¤¼ç‰©ï¼šè®­ç»ƒè´¨é‡+10%
                        if (buff.id === 'coach_gift' && buff.effect.trainingQuality) {
                            totalBonus += buff.effect.trainingQuality / 100;
                        }
                    });
                }
                
                return totalBonus;
            }
            
            // è®¡ç®—å¹¶æ ¼å¼åŒ–æ•ˆæœé¢„è§ˆï¼ˆåŒ…å«è£…å¤‡åŠ æˆï¼‰
            getEffectPreview(effect) {
                if (!effect) return '';
                
                const parts = [];
                const skillIcons = {
                    serve: 'ğŸ¯',
                    spike: 'âš¡',
                    block: 'ğŸ›¡ï¸',
                    dig: 'ğŸ¤¸',
                    set: 'ğŸ™Œ'
                };
                
                // æŠ€èƒ½æ•ˆæœï¼ˆåŒ…å«èŒä¸šåŠ æˆï¼‰
                ['serve', 'spike', 'block', 'dig', 'set'].forEach(skill => {
                    if (effect[skill]) {
                        const bonus = this.getTrainingBonus(skill);
                        const baseValue = effect[skill];
                        const finalValue = Math.round(baseValue * (1 + bonus));
                        
                        if (bonus !== 0 && effect.trained) {
                            // æœ‰åŠ æˆæ—¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
                            const bonusText = bonus > 0 ? `+${Math.round(bonus * 100)}%` : `${Math.round(bonus * 100)}%`;
                            parts.push(`${skillIcons[skill]}${this.getSkillName(skill)}+${finalValue}(åŸºç¡€${baseValue}${bonusText})`);
                        } else {
                            parts.push(`${skillIcons[skill]}${this.getSkillName(skill)}${baseValue > 0 ? '+' : ''}${baseValue}`);
                        }
                    }
                });
                
                // å…¶ä»–æ•ˆæœï¼ˆè®­ç»ƒæ—¶ä¸æ˜¾ç¤ºä½“åŠ›æ¶ˆè€—ï¼Œå› ä¸ºå·²åœ¨åˆ†ç±»æ ‡é¢˜ä¸­æ˜¾ç¤ºï¼‰
                if (!effect.trained && effect.energy) parts.push(`ğŸ’ªä½“åŠ›${effect.energy > 0 ? '+' : ''}${effect.energy}`);
                if (effect.mood) parts.push(`ğŸ˜Šå¿ƒæƒ…${effect.mood > 0 ? '+' : ''}${effect.mood}`);
                if (effect.stress) parts.push(`ğŸ˜°å‹åŠ›${effect.stress > 0 ? '+' : ''}${effect.stress}`);
                if (effect.reputation) parts.push(`â­å£°æœ›${effect.reputation > 0 ? '+' : ''}${effect.reputation}`);
                if (effect.money) parts.push(`ğŸ’°${effect.money > 0 ? '+' : ''}${effect.money}å…ƒ`);
                
                return parts.length > 0 ? `ï¼ˆ${parts.join('ï¼Œ')}ï¼‰` : '';
            }
            
            getSkillName(skill) {
                const names = {
                    serve: 'å‘çƒ',
                    spike: 'æ‰£çƒ',
                    block: 'æ‹¦ç½‘',
                    dig: 'å«çƒ',
                    set: 'æ‰˜çƒ'
                };
                return names[skill] || skill;
            }
            
            getMatchWeight(skill) {
                const posInfo = this.getPositionInfo();
                if (!posInfo) {
                    // æ²¡æœ‰èŒä¸šæ—¶å¹³å‡æƒé‡
                    return 20;
                }
                return posInfo.matchWeights[skill] || 0;
            }
            
            getPositionDescription(skill, success) {
                const posInfo = this.getPositionInfo();
                if (!posInfo || !posInfo.specialDescriptions[skill]) {
                    return null;
                }
                
                const descriptions = posInfo.specialDescriptions[skill];
                return descriptions[Math.floor(Math.random() * descriptions.length)];
            }
            
            // æ–°å¢ï¼šè®¡ç®—ç©å®¶ç»¼åˆå®åŠ›ï¼ˆç”¨äºæ¯”èµ›èƒœç‡ï¼‰
            calculateMyStrength() {
                const skills = this.player.skills;
                const posInfo = this.getPositionInfo();
                
                // åŸºç¡€æŠ€èƒ½å€¼ï¼ˆåŠ æƒå¹³å‡ï¼‰
                let baseStrength = 0;
                const skillWeights = {
                    serve: 0.20,   // å‘çƒ 20%
                    spike: 0.25,   // æ‰£çƒ 25%
                    block: 0.20,   // æ‹¦ç½‘ 20%
                    dig: 0.20,     // å«çƒ 20%
                    set: 0.15      // æ‰˜çƒ 15%
                };
                
                for (let skill in skillWeights) {
                    baseStrength += skills[skill] * skillWeights[skill];
                }
                
                // èŒä¸šåŠ æˆï¼ˆæ ¸å¿ƒæŠ€èƒ½æƒé‡æå‡ï¼‰
                let positionBonus = 1.0;
                if (posInfo) {
                    let weightedSkills = 0;
                    let totalWeight = 0;
                    
                    for (let skill in skillWeights) {
                        let weight = skillWeights[skill];
                        
                        // æ ¸å¿ƒæŠ€èƒ½æƒé‡ Ã— 1.5
                        if (posInfo.coreSkills.includes(skill)) {
                            weight *= 1.5;
                        }
                        // æ¬¡è¦æŠ€èƒ½æƒé‡ Ã— 1.2
                        else if (posInfo.secondarySkills.includes(skill)) {
                            weight *= 1.2;
                        }
                        
                        weightedSkills += skills[skill] * weight;
                        totalWeight += weight;
                    }
                    
                    positionBonus = weightedSkills / totalWeight / baseStrength;
                }
                
                // çŠ¶æ€åŠ æˆ
                let stateBonus = 1.0;
                
                // å¿ƒæƒ…å½±å“ (-20% ~ +20%)
                const moodEffect = (this.player.mood - 50) / 250;
                stateBonus += moodEffect;
                
                // å‹åŠ›å½±å“ (-15% ~ 0%)
                const stressEffect = -this.player.stress / 667;
                stateBonus += stressEffect;
                
                // ä½“åŠ›å½±å“ (-10% ~ 0%)
                const energyEffect = Math.min(0, (this.player.energy - 50) / 500);
                stateBonus += energyEffect;
                
                // ç¡®ä¿çŠ¶æ€åŠ æˆåœ¨åˆç†èŒƒå›´
                stateBonus = Math.max(0.7, Math.min(1.3, stateBonus));
                
                return baseStrength * positionBonus * stateBonus;
            }
            
            // æ–°å¢ï¼šè®¡ç®—å¯¹æ‰‹å®åŠ›
            calculateOpponentStrength(matchType) {
                const myAvgSkill = (
                    this.player.skills.serve + 
                    this.player.skills.spike + 
                    this.player.skills.block + 
                    this.player.skills.dig + 
                    this.player.skills.set
                ) / 5;
                
                let baseOpponent = 0;
                let randomRange = 0;
                
                switch(matchType) {
                    case 'casual':
                        // é‡çƒï¼šå¯¹æ‰‹å®åŠ›æ¥è¿‘ç©å®¶
                        baseOpponent = myAvgSkill;
                        randomRange = myAvgSkill * 0.15;
                        break;
                        
                    case 'collegeMatch':
                        // é™¢é™…æ¯”èµ›ï¼šå¯¹æ‰‹ = ç©å®¶å¹³å‡ Ã— 0.85 Â± 10%
                        baseOpponent = myAvgSkill * 0.85;
                        randomRange = myAvgSkill * 0.1;
                        break;
                        
                    case 'tournament':
                        // é”¦æ ‡èµ›ï¼šä½¿ç”¨å½“å‰è½®æ¬¡çš„å›ºå®šå®åŠ›
                        if (this.tournament.active && this.tournament.currentRound) {
                            const roundInfo = this.TOURNAMENT_ROUNDS[this.tournament.currentRound];
                            baseOpponent = roundInfo.opponentStrength;
                            randomRange = 5;  // å°èŒƒå›´éšæœº
                        } else {
                            baseOpponent = myAvgSkill;
                            randomRange = myAvgSkill * 0.1;
                        }
                        break;
                        
                    case 'universityLeague':
                        // æ ¡é™…è”èµ›ï¼šå¯¹æ‰‹ = ç©å®¶å¹³å‡ Ã— 1.0 Â± 10%
                        baseOpponent = myAvgSkill * 1.0;
                        randomRange = myAvgSkill * 0.1;
                        break;
                        
                    case 'cityLeague':
                        // å¸‚çº§è”èµ›ï¼šå¯¹æ‰‹ = ç©å®¶å¹³å‡ Ã— 1.15 Â± 10%
                        baseOpponent = myAvgSkill * 1.15;
                        randomRange = myAvgSkill * 0.1;
                        break;
                        
                    default:
                        baseOpponent = myAvgSkill;
                        randomRange = myAvgSkill * 0.15;
                }
                
                // æ·»åŠ éšæœºæ³¢åŠ¨
                const opponent = baseOpponent + (Math.random() - 0.5) * 2 * randomRange;
                
                // ç¡®ä¿å¯¹æ‰‹å®åŠ›åœ¨åˆç†èŒƒå›´
                return Math.max(20, Math.min(90, opponent));
            }
            
            // æ–°å¢ï¼šè®¡ç®—å•åˆ†èƒœç‡
            calculatePointWinRate(myStrength, opponentStrength) {
                // åŸºç¡€èƒœç‡å…¬å¼
                let winRate = myStrength / (myStrength + opponentStrength);
                
                // æ·»åŠ ä¸»åœºä¼˜åŠ¿ï¼ˆæ­£å¼æ¯”èµ›ï¼‰
                if (this.currentMatch && this.currentMatch.type === 'formal') {
                    winRate += 0.05;  // +5% ä¸»åœºä¼˜åŠ¿
                }
                
                // ç¡®ä¿èƒœç‡åœ¨ 10% ~ 90% ä¹‹é—´ï¼ˆé¿å…æç«¯æƒ…å†µï¼‰
                winRate = Math.max(0.1, Math.min(0.9, winRate));
                
                return winRate;
            }
            
            // æ¯”èµ›ç³»ç»Ÿ
            startMatch(matchType) {
                // åˆå§‹åŒ–æ¯”èµ›æ•°æ®
                this.currentMatch = {
                    type: matchType, // 'casual' é‡çƒ, 'formal' æ­£å¼æ¯”èµ›
                    targetScore: matchType === 'casual' ? 25 : 25,
                    myScore: 0,
                    opponentScore: 0,
                    scoreLog: [],
                    mySkills: {
                        serve: this.player.skills.serve,
                        spike: this.player.skills.spike,
                        block: this.player.skills.block,
                        dig: this.player.skills.dig,
                        set: this.player.skills.set
                    }
                };
                
                // æ¨¡æ‹Ÿæ¯”èµ›è¿‡ç¨‹
                this.simulateMatch();
            }
            
            // æ–°å¢ï¼šæ­£å¼æ¯”èµ›ç³»ç»Ÿï¼ˆäº”å±€ä¸‰èƒœï¼‰
            startFormalMatch(matchType, matchName) {
                console.log('=== å¼€å§‹æ­£å¼æ¯”èµ› ===');
                console.log('æ¯”èµ›ç±»å‹:', matchType);
                console.log('æ¯”èµ›åç§°:', matchName);
                
                this.currentMatch = {
                    type: 'formal',
                    matchType: matchType,  // 'collegeMatch', 'universityLeague', 'cityLeague'
                    matchName: matchName,  // æ¯”èµ›åç§°
                    
                    // å¤§å±€åˆ†
                    mySets: 0,
                    opponentSets: 0,
                    targetSets: 3,  // äº”å±€ä¸‰èƒœ
                    
                    // å½“å‰å±€
                    currentSet: 1,
                    myScore: 0,
                    opponentScore: 0,
                    targetScore: 25,
                    
                    // æ¯å±€è¯¦æƒ…
                    setResults: [],
                    
                    // æ¯”èµ›æ—¥å¿—
                    scoreLog: [],
                    
                    // æŠ€èƒ½æ•°æ®
                    mySkills: {
                        serve: this.player.skills.serve,
                        spike: this.player.skills.spike,
                        block: this.player.skills.block,
                        dig: this.player.skills.dig,
                        set: this.player.skills.set
                    },
                    
                    // å¯¹æ‰‹å®åŠ›
                    opponentStrength: this.calculateOpponentStrength(matchType)
                };
                
                console.log('æ¯”èµ›æ•°æ®åˆå§‹åŒ–å®Œæˆï¼Œå¼€å§‹æ¨¡æ‹Ÿæ¯”èµ›...');
                
                // æ¨¡æ‹Ÿæ­£å¼æ¯”èµ›
                this.simulateFormalMatch();
                
                // æ˜¾ç¤ºæ¯”èµ›åŠ¨ç”»
                this.showFormalMatchAnimation();
            }
            
            // æ–°å¢ï¼šæ¨¡æ‹Ÿæ­£å¼æ¯”èµ›ï¼ˆäº”å±€ä¸‰èƒœï¼‰
            simulateFormalMatch() {
                const match = this.currentMatch;
                
                console.log('å¼€å§‹æ­£å¼æ¯”èµ›:', match.matchName);
                console.log('ç›®æ ‡å±€æ•°:', match.targetSets, '(éœ€è¦èµ¢', match.targetSets, 'å±€)');
                
                // æ¨¡æ‹Ÿæ¯ä¸€å±€
                while (match.mySets < match.targetSets && match.opponentSets < match.targetSets) {
                    console.log(`\nå¼€å§‹ç¬¬${match.currentSet}å±€ (å½“å‰å¤§å±€åˆ†: ${match.mySets}:${match.opponentSets})`);
                    
                    this.simulateSet();
                    
                    console.log(`ç¬¬${match.currentSet}å±€ç»“æŸ: ${match.myScore}-${match.opponentScore}`);
                    
                    // è®°å½•æœ¬å±€ç»“æœ
                    match.setResults.push({
                        setNumber: match.currentSet,
                        myScore: match.myScore,
                        opponentScore: match.opponentScore,
                        winner: match.myScore > match.opponentScore ? 'my' : 'opponent'
                    });
                    
                    // æ›´æ–°å¤§å±€åˆ†
                    if (match.myScore > match.opponentScore) {
                        match.mySets++;
                        console.log('æˆ‘æ–¹èµ¢å¾—æœ¬å±€ï¼å¤§å±€åˆ†:', match.mySets, ':', match.opponentSets);
                    } else {
                        match.opponentSets++;
                        console.log('å¯¹æ–¹èµ¢å¾—æœ¬å±€ï¼å¤§å±€åˆ†:', match.mySets, ':', match.opponentSets);
                    }
                    
                    // å‡†å¤‡ä¸‹ä¸€å±€
                    match.currentSet++;
                    match.myScore = 0;
                    match.opponentScore = 0;
                    
                    // å†³èƒœå±€æ”¹ä¸º15åˆ†åˆ¶
                    if (match.currentSet === 5) {
                        match.targetScore = 15;
                    } else {
                        match.targetScore = 25;
                    }
                }
                
                console.log('\næ¯”èµ›ç»“æŸï¼æœ€ç»ˆå¤§å±€åˆ†:', match.mySets, ':', match.opponentSets);
                console.log('å…±è¿›è¡Œäº†', match.setResults.length, 'å±€');
                
                // ä¸å†ç«‹å³æ˜¾ç¤ºç»“æœï¼Œç­‰å¾…åŠ¨ç”»å®Œæˆ
            }
            
            // æ–°å¢ï¼šæ¨¡æ‹Ÿå•å±€æ¯”èµ›
            simulateSet() {
                const match = this.currentMatch;
                
                // æ¨¡æ‹Ÿæœ¬å±€æ¯ä¸€åˆ†
                while (match.myScore < match.targetScore && match.opponentScore < match.targetScore) {
                    // å¦‚æœæ¯”åˆ†æ¥è¿‘ï¼Œéœ€è¦é¢†å…ˆ2åˆ†æ‰èƒ½è·èƒœ
                    if (match.myScore >= match.targetScore - 1 && match.opponentScore >= match.targetScore - 1) {
                        if (Math.abs(match.myScore - match.opponentScore) >= 2) {
                            break;
                        }
                    }
                    
                    const point = this.simulatePoint(match.mySkills, match.opponentStrength);
                    
                    if (point.scorer === 'my') {
                        match.myScore++;
                    } else {
                        match.opponentScore++;
                    }
                    
                    match.scoreLog.push({
                        set: match.currentSet,
                        myScore: match.myScore,
                        opponentScore: match.opponentScore,
                        description: point.description,
                        scorer: point.scorer
                    });
                }
            }
            
            simulateMatch() {
                const match = this.currentMatch;
                const mySkills = match.mySkills;
                
                // ä½¿ç”¨æ–°çš„å¯¹æ‰‹å®åŠ›è®¡ç®—æ–¹æ³•
                const opponentSkill = this.calculateOpponentStrength(match.type);
                
                // æ¨¡æ‹Ÿæ¯ä¸€åˆ†
                while (match.myScore < match.targetScore && match.opponentScore < match.targetScore) {
                    const point = this.simulatePoint(mySkills, opponentSkill);
                    
                    if (point.scorer === 'my') {
                        match.myScore++;
                    } else {
                        match.opponentScore++;
                    }
                    
                    match.scoreLog.push({
                        myScore: match.myScore,
                        opponentScore: match.opponentScore,
                        description: point.description,
                        scorer: point.scorer
                    });
                }
                
                // æ˜¾ç¤ºæ¯”èµ›ç»“æœ
                this.showMatchResult();
            }
            
            simulatePoint(mySkills, opponentSkill) {
                // éšæœºå†³å®šå“ªæ–¹å‘çƒ
                const myServe = Math.random() > 0.5;
                
                // å¾—åˆ†æ–¹å¼æƒé‡ï¼ˆåŸºäºèŒä¸šå’ŒæŠ€èƒ½ï¼‰
                const scoreTypes = [
                    { type: 'serve', weight: this.getMatchWeight('serve') * (mySkills.serve / 100), name: 'å‘çƒ' },
                    { type: 'spike', weight: this.getMatchWeight('spike') * (mySkills.spike / 100), name: 'æ‰£çƒ' },
                    { type: 'block', weight: this.getMatchWeight('block') * (mySkills.block / 100), name: 'æ‹¦ç½‘' },
                    { type: 'dig', weight: this.getMatchWeight('dig') * (mySkills.dig / 100), name: 'å«çƒ' },
                    { type: 'set', weight: this.getMatchWeight('set') * (mySkills.set / 100), name: 'æ‰˜çƒ' }
                ];
                
                // é€‰æ‹©å¾—åˆ†æ–¹å¼
                const totalWeight = scoreTypes.reduce((sum, st) => sum + st.weight, 0);
                let random = Math.random() * totalWeight;
                let selectedType = scoreTypes[0];
                
                for (let st of scoreTypes) {
                    random -= st.weight;
                    if (random <= 0) {
                        selectedType = st;
                        break;
                    }
                }
                
                // ä½¿ç”¨æ–°çš„èƒœç‡è®¡ç®—æ–¹æ³•
                const myStrength = this.calculateMyStrength();
                const winRate = this.calculatePointWinRate(myStrength, opponentSkill);
                const iWin = Math.random() < winRate;
                
                // ç”Ÿæˆå¾—åˆ†æè¿°ï¼ˆä¼˜å…ˆä½¿ç”¨èŒä¸šä¸“å±æè¿°ï¼‰
                let description = '';
                if (iWin) {
                    const posDesc = this.getPositionDescription(selectedType.type, true);
                    if (posDesc) {
                        description = posDesc;
                    } else {
                        const descriptions = {
                            serve: [
                                'ä½ å‘å‡ºä¸€è®°å¼ºåŠ›è·³å‘çƒï¼Œå¯¹æ–¹æ¥å‘å¤±è¯¯ï¼',
                                'ç²¾å‡†çš„å‘çƒç›´æ¥å¾—åˆ†ï¼Œå¯¹æ–¹æªæ‰‹ä¸åŠï¼',
                                'ä½ çš„å‘çƒè½åœ¨å¯¹æ–¹ç©ºæ¡£ï¼Œç›´æ¥å¾—åˆ†ï¼'
                            ],
                            spike: [
                                'ä½ é«˜é«˜è·ƒèµ·ï¼Œå¤§åŠ›æ‰£çƒå¾—åˆ†ï¼',
                                'æ¼‚äº®çš„æ‰£çƒï¼Œå¯¹æ–¹é˜²å®ˆå¤±è¯¯ï¼',
                                'ä½ æŠ“ä½æœºä¼šï¼Œä¸€è®°é‡æ‰£æ‹¿ä¸‹è¿™åˆ†ï¼',
                                'å®Œç¾çš„æ‰£çƒè§’åº¦ï¼Œå¯¹æ–¹æ— æ³•é˜²å®ˆï¼'
                            ],
                            block: [
                                'ä½ æˆåŠŸæ‹¦ç½‘ï¼Œç›´æ¥å¾—åˆ†ï¼',
                                'ç²¾å‡†çš„æ‹¦ç½‘åˆ¤æ–­ï¼Œçƒç›´æ¥å¼¹å›å¯¹æ–¹åœºåœ°ï¼',
                                'ä½ çš„æ‹¦ç½‘è®©å¯¹æ–¹çš„æ‰£çƒæ— åŠŸè€Œè¿”ï¼'
                            ],
                            dig: [
                                'ä½ æˆåŠŸå«èµ·å¯¹æ–¹çš„æ‰£çƒï¼Œé˜Ÿå‹åå‡»å¾—åˆ†ï¼',
                                'ç²¾å½©çš„å«çƒï¼ŒåŒ–è§£å¯¹æ–¹æ”»åŠ¿å¹¶åå‡»æˆåŠŸï¼',
                                'ä½ çš„å«çƒåˆ°ä½ï¼Œé˜Ÿå‹å®Œæˆåå‡»ï¼'
                            ],
                            set: [
                                'ä½ çš„äºŒä¼ ç²¾å‡†åˆ°ä½ï¼Œé˜Ÿå‹æ‰£çƒå¾—åˆ†ï¼',
                                'å®Œç¾çš„æ‰˜çƒï¼ŒåŠ©æ”»é˜Ÿå‹å¾—åˆ†ï¼',
                                'ä½ çš„ä¼ çƒç»„ç»‡è¿›æ”»ï¼Œé˜Ÿå‹å®Œæˆå¾—åˆ†ï¼'
                            ]
                        };
                        description = descriptions[selectedType.type][Math.floor(Math.random() * descriptions[selectedType.type].length)];
                    }
                } else {
                    const descriptions = {
                        serve: [
                            'ä½ çš„å‘çƒå‡ºç•Œäº†ï¼Œå¯¹æ–¹å¾—åˆ†ã€‚',
                            'å‘çƒå¤±è¯¯ï¼Œå¯¹æ–¹æ‹¿ä¸‹è¿™åˆ†ã€‚',
                            'å‘çƒä¸‹ç½‘ï¼Œå¯¹æ–¹å¾—åˆ†ã€‚'
                        ],
                        spike: [
                            'æ‰£çƒè¢«å¯¹æ–¹æ‹¦ç½‘ï¼Œå¯¹æ–¹å¾—åˆ†ã€‚',
                            'ä½ çš„æ‰£çƒå‡ºç•Œäº†ï¼Œå¯¹æ–¹å¾—åˆ†ã€‚',
                            'å¯¹æ–¹é˜²å®ˆæˆåŠŸå¹¶åå‡»å¾—åˆ†ã€‚'
                        ],
                        block: [
                            'æ‹¦ç½‘åˆ¤æ–­å¤±è¯¯ï¼Œå¯¹æ–¹æ‰£çƒå¾—åˆ†ã€‚',
                            'å¯¹æ–¹çš„æ‰£çƒçªç ´äº†ä½ çš„æ‹¦ç½‘ã€‚',
                            'æ‹¦ç½‘æ²¡æœ‰æˆåŠŸï¼Œå¯¹æ–¹å¾—åˆ†ã€‚'
                        ],
                        dig: [
                            'å«çƒå¤±è¯¯ï¼Œå¯¹æ–¹æ‰£çƒå¾—åˆ†ã€‚',
                            'ä½ æ²¡èƒ½å«èµ·å¯¹æ–¹çš„è¿›æ”»ã€‚',
                            'å«çƒä¸åˆ°ä½ï¼Œå¯¹æ–¹å¾—åˆ†ã€‚'
                        ],
                        set: [
                            'æ‰˜çƒå¤±è¯¯ï¼Œå¯¹æ–¹åå‡»å¾—åˆ†ã€‚',
                            'äºŒä¼ ä¸åˆ°ä½ï¼Œè¿›æ”»å¤±è´¥ã€‚',
                            'ä¼ çƒè¢«å¯¹æ–¹æ‹¦æˆªï¼Œå¯¹æ–¹å¾—åˆ†ã€‚'
                        ]
                    };
                    description = descriptions[selectedType.type][Math.floor(Math.random() * descriptions[selectedType.type].length)];
                }
                
                return {
                    scorer: iWin ? 'my' : 'opponent',
                    description: description,
                    type: selectedType.type
                };
            }
            
            showMatchResult() {
                const match = this.currentMatch;
                
                // æ˜¾ç¤ºæ¯”èµ›å¼¹çª—
                const modal = document.getElementById('match-modal');
                const title = document.getElementById('match-modal-title');
                const myScoreEl = document.getElementById('my-score');
                const opponentScoreEl = document.getElementById('opponent-score');
                const matchLog = document.getElementById('match-log');
                const choicesDiv = document.getElementById('match-modal-choices');
                const skipBtn = document.getElementById('skip-match-btn');
                
                title.textContent = 'ğŸ æ¯”èµ›è¿›è¡Œä¸­';
                myScoreEl.textContent = '0';
                opponentScoreEl.textContent = '0';
                matchLog.innerHTML = '';
                choicesDiv.innerHTML = '';
                skipBtn.style.display = 'block';
                skipBtn.disabled = false;
                
                modal.classList.add('show');
                
                // é€è¡Œæ˜¾ç¤ºå¾—åˆ†è®°å½•
                let currentIndex = 0;
                this.matchDisplayInterval = setInterval(() => {
                    if (currentIndex >= match.scoreLog.length) {
                        clearInterval(this.matchDisplayInterval);
                        this.matchDisplayInterval = null;
                        // æ‰€æœ‰å¾—åˆ†æ˜¾ç¤ºå®Œæ¯•ï¼Œæ˜¾ç¤ºæœ€ç»ˆç»“æœ
                        this.showFinalMatchResult();
                        return;
                    }
                    
                    const log = match.scoreLog[currentIndex];
                    
                    // æ›´æ–°æ¯”åˆ†æ˜¾ç¤º
                    myScoreEl.textContent = log.myScore;
                    opponentScoreEl.textContent = log.opponentScore;
                    
                    // æ·»åŠ å¾—åˆ†è®°å½•
                    const logItem = document.createElement('div');
                    logItem.className = `match-log-item ${log.scorer === 'my' ? 'my-point' : 'opponent-point'}`;
                    
                    const scoreColor = log.scorer === 'my' ? '#2ecc71' : '#e74c3c';
                    logItem.innerHTML = `
                        <div class="match-log-score" style="color: ${scoreColor};">
                            ${log.myScore} : ${log.opponentScore}
                        </div>
                        <div class="match-log-description">${log.description}</div>
                    `;
                    
                    matchLog.appendChild(logItem);
                    
                    // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
                    matchLog.scrollTop = matchLog.scrollHeight;
                    
                    currentIndex++;
                }, 500); // æ¯0.5ç§’æ˜¾ç¤ºä¸€æ¡
            }
            
            skipMatch() {
                // æ¸…é™¤åŠ¨ç”»å®šæ—¶å™¨
                if (this.matchDisplayInterval) {
                    clearInterval(this.matchDisplayInterval);
                    this.matchDisplayInterval = null;
                }
                
                const match = this.currentMatch;
                const modal = document.getElementById('match-modal');
                const matchLog = document.getElementById('match-log');
                const skipBtn = document.getElementById('skip-match-btn');
                
                // éšè—è·³è¿‡æŒ‰é’®
                skipBtn.style.display = 'none';
                
                // æ¸…ç©ºå¹¶æ˜¾ç¤ºç®€åŒ–çš„æ¯”èµ›è®°å½•
                matchLog.innerHTML = '<div style="text-align: center; padding: 20px; color: #ddd;">å·²è·³è¿‡æ¯”èµ›è¿‡ç¨‹</div>';
                
                // æ ¹æ®æ¯”èµ›ç±»å‹æ˜¾ç¤ºä¸åŒçš„ç»“æœ
                if (match.type === 'formal') {
                    // æ­£å¼æ¯”èµ›ï¼šæ˜¾ç¤ºæ‰€æœ‰å±€çš„ç»“æœ
                    match.setResults.forEach((set, i) => {
                        const setItem = document.createElement('div');
                        setItem.style.cssText = 'padding: 10px; margin: 5px 0; background: rgba(255,255,255,0.1); border-radius: 5px;';
                        const color = set.winner === 'my' ? '#2ecc71' : '#e74c3c';
                        setItem.innerHTML = `<div style="color: ${color}; font-weight: bold;">ç¬¬${i+1}å±€: ${set.myScore}-${set.opponentScore}</div>`;
                        matchLog.appendChild(setItem);
                    });
                    
                    // 1ç§’åå…³é—­å¼¹çª—å¹¶æ˜¾ç¤ºç»“æœ
                    setTimeout(() => {
                        modal.classList.remove('show');
                        // æ¢å¤é‡çƒçš„èƒŒæ™¯è‰²
                        const modalContent = document.getElementById('match-modal-content');
                        modalContent.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                        this.showFormalMatchResult();
                    }, 1000);
                } else {
                    // é‡çƒï¼šç›´æ¥æ˜¾ç¤ºæœ€ç»ˆç»“æœ
                    const myScoreEl = document.getElementById('my-score');
                    const opponentScoreEl = document.getElementById('opponent-score');
                    const finalLog = match.scoreLog[match.scoreLog.length - 1];
                    myScoreEl.textContent = finalLog.myScore;
                    opponentScoreEl.textContent = finalLog.opponentScore;
                    this.showFinalMatchResult();
                }
            }
            
            // æ–°å¢ï¼šæ˜¾ç¤ºæ­£å¼æ¯”èµ›åŠ¨ç”»
            showFormalMatchAnimation() {
                const match = this.currentMatch;
                
                // æ˜¾ç¤ºæ¯”èµ›å¼¹çª—
                const modal = document.getElementById('match-modal');
                const modalContent = document.getElementById('match-modal-content');
                const title = document.getElementById('match-modal-title');
                const myScoreEl = document.getElementById('my-score');
                const opponentScoreEl = document.getElementById('opponent-score');
                const matchLog = document.getElementById('match-log');
                const choicesDiv = document.getElementById('match-modal-choices');
                const skipBtn = document.getElementById('skip-match-btn');
                
                // æ­£å¼æ¯”èµ›ä½¿ç”¨é‡‘è‰²æ¸å˜èƒŒæ™¯
                modalContent.style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 50%, #ffd700 100%)';
                
                // åˆå§‹åŒ–æ˜¾ç¤ºï¼ˆå¤§å±€åˆ†ä»0:0å¼€å§‹ï¼‰
                let displayedMySets = 0;
                let displayedOpponentSets = 0;
                
                title.innerHTML = `ğŸ ${match.matchName}<br><span style="font-size: 18px; color: #ffd700;">å¤§å±€: ${displayedMySets} : ${displayedOpponentSets}</span>`;
                myScoreEl.textContent = '0';
                opponentScoreEl.textContent = '0';
                matchLog.innerHTML = '';
                choicesDiv.innerHTML = '';
                skipBtn.style.display = 'block';
                skipBtn.disabled = false;
                
                modal.classList.add('show');
                
                // æ˜¾ç¤º"ç¬¬1å±€å¼€å§‹"æç¤º
                this.showSetStartMessage(1, matchLog);
                
                // é€è¡Œæ˜¾ç¤ºå¾—åˆ†è®°å½•
                let currentIndex = 0;
                let currentSetNumber = 1;
                let isPaused = true;  // åˆå§‹æš‚åœï¼Œè®©"ç¬¬1å±€å¼€å§‹"æç¤ºæ˜¾ç¤º1ç§’
                
                // 1ç§’åå¼€å§‹åŠ¨ç”»
                setTimeout(() => {
                    isPaused = false;
                }, 1000);
                
                this.matchDisplayInterval = setInterval(() => {
                    // å¦‚æœæ­£åœ¨æš‚åœï¼Œè·³è¿‡è¿™æ¬¡æ›´æ–°
                    if (isPaused) {
                        return;
                    }
                    
                    if (currentIndex >= match.scoreLog.length) {
                        clearInterval(this.matchDisplayInterval);
                        this.matchDisplayInterval = null;
                        
                        // æ˜¾ç¤ºæœ€åä¸€å±€çš„ç»“æœ
                        const lastSetResult = match.setResults[match.setResults.length - 1];
                        const isLastSetWin = lastSetResult.winner === 'my';
                        
                        if (isLastSetWin) {
                            displayedMySets++;
                        } else {
                            displayedOpponentSets++;
                        }
                        
                        // æ˜¾ç¤ºæœ€åä¸€å±€ç»“æŸæç¤º
                        const lastSetEndItem = document.createElement('div');
                        lastSetEndItem.className = 'match-log-item';
                        const bgColor = isLastSetWin ? 'rgba(46,204,113,0.5)' : 'rgba(231,76,60,0.5)';
                        const borderColor = isLastSetWin ? '#2ecc71' : '#e74c3c';
                        const resultText = isLastSetWin ? 'âœ… èƒœåˆ©' : 'âŒ å¤±è´¥';
                        const resultColor = isLastSetWin ? '#2ecc71' : '#e74c3c';
                        
                        // å¼ºåˆ¶æ˜¾ç¤ºï¼Œä¸ä¾èµ–åŠ¨ç”»
                        lastSetEndItem.style.cssText = `background: ${bgColor}; border: 3px solid ${borderColor}; font-weight: bold; text-align: center; padding: 15px; margin: 10px 0; box-shadow: 0 4px 15px ${bgColor}; opacity: 1 !important; display: block !important;`;
                        lastSetEndItem.innerHTML = `
                            <div style="color: #ffd700; font-size: 22px; margin-bottom: 8px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
                                â­ ç¬¬${match.setResults.length}å±€ç»“æŸ â­
                            </div>
                            <div style="color: #fff; font-size: 20px; margin: 8px 0; text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                                ${lastSetResult.myScore} - ${lastSetResult.opponentScore}
                            </div>
                            <div style="color: ${resultColor}; font-size: 18px; margin: 8px 0; text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                                ${resultText}
                            </div>
                            <div style="color: #ffd700; font-size: 18px; margin-top: 8px; text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                                å¤§å±€æ¯”åˆ†: ${displayedMySets} : ${displayedOpponentSets}
                            </div>
                        `;
                        matchLog.appendChild(lastSetEndItem);
                        matchLog.scrollTop = matchLog.scrollHeight;
                        
                        // æ›´æ–°æ ‡é¢˜ä¸­çš„å¤§å±€åˆ†
                        title.innerHTML = `ğŸ ${match.matchName}<br><span style="font-size: 18px; color: #ffd700;">å¤§å±€: ${displayedMySets} : ${displayedOpponentSets}</span>`;
                        
                        // 2ç§’åæ˜¾ç¤ºæœ€ç»ˆç»“æœ
                        setTimeout(() => {
                            const finalWin = displayedMySets > displayedOpponentSets;
                            const finalResultItem = document.createElement('div');
                            finalResultItem.className = 'match-log-item';
                            const finalBgColor = finalWin ? 'rgba(46,204,113,0.6)' : 'rgba(231,76,60,0.6)';
                            const finalBorderColor = finalWin ? '#2ecc71' : '#e74c3c';
                            const finalIcon = finalWin ? 'ğŸ‰' : 'ğŸ˜”';
                            const finalText = finalWin ? 'ä½ å–å¾—äº†æ¯”èµ›çš„èƒœåˆ©ï¼' : 'å¾ˆé—æ†¾ï¼Œæ¯”èµ›å¤±è´¥äº†...';
                            const finalTextColor = finalWin ? '#2ecc71' : '#e74c3c';
                            
                            // å¼ºåˆ¶æ˜¾ç¤ºï¼Œä¸ä¾èµ–åŠ¨ç”»
                            finalResultItem.style.cssText = `background: ${finalBgColor}; border: 4px solid ${finalBorderColor}; font-weight: bold; text-align: center; padding: 20px; margin: 15px 0; box-shadow: 0 6px 20px ${finalBgColor}; opacity: 1 !important; display: block !important;`;
                            finalResultItem.innerHTML = `
                                <div style="color: #ffd700; font-size: 28px; margin-bottom: 12px; text-shadow: 2px 2px 6px rgba(0,0,0,0.8);">
                                    ${finalIcon} æ¯”èµ›ç»“æŸ ${finalIcon}
                                </div>
                                <div style="color: #fff; font-size: 24px; margin: 10px 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
                                    æœ€ç»ˆå¤§å±€æ¯”åˆ†
                                </div>
                                <div style="color: #ffd700; font-size: 32px; margin: 10px 0; font-weight: bold; text-shadow: 2px 2px 6px rgba(0,0,0,0.8);">
                                    ${displayedMySets} : ${displayedOpponentSets}
                                </div>
                                <div style="color: ${finalTextColor}; font-size: 20px; margin-top: 12px; text-shadow: 1px 1px 4px rgba(0,0,0,0.8);">
                                    ${finalText}
                                </div>
                            `;
                            matchLog.appendChild(finalResultItem);
                            matchLog.scrollTop = matchLog.scrollHeight;
                            
                            // å†ç­‰3ç§’åå…³é—­å¼¹çª—
                            setTimeout(() => {
                                modal.classList.remove('show');
                                // æ¢å¤é‡çƒçš„èƒŒæ™¯è‰²
                                modalContent.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                                this.showFormalMatchResult();
                            }, 3000);
                        }, 2000);
                        
                        return;
                    }
                    
                    const log = match.scoreLog[currentIndex];
                    
                    // æ£€æŸ¥æ˜¯å¦è¿›å…¥æ–°çš„ä¸€å±€
                    if (log.set !== currentSetNumber) {
                        // æš‚åœåŠ¨ç”»
                        isPaused = true;
                        
                        // æ˜¾ç¤ºå±€åˆ†æç¤º
                        const setResult = match.setResults[currentSetNumber - 1];
                        const isWin = setResult.winner === 'my';
                        
                        if (isWin) {
                            displayedMySets++;
                        } else {
                            displayedOpponentSets++;
                        }
                        
                        // æ˜¾ç¤ºå±€ç»“æŸæç¤º
                        const setEndItem = document.createElement('div');
                        setEndItem.className = 'match-log-item';
                        const bgColor = isWin ? 'rgba(46,204,113,0.5)' : 'rgba(231,76,60,0.5)';
                        const borderColor = isWin ? '#2ecc71' : '#e74c3c';
                        const resultText = isWin ? 'âœ… èƒœåˆ©' : 'âŒ å¤±è´¥';
                        const resultColor = isWin ? '#2ecc71' : '#e74c3c';
                        
                        // å¼ºåˆ¶æ˜¾ç¤ºï¼Œä¸ä¾èµ–åŠ¨ç”»
                        setEndItem.style.cssText = `background: ${bgColor}; border: 3px solid ${borderColor}; font-weight: bold; text-align: center; padding: 15px; margin: 10px 0; box-shadow: 0 4px 15px ${bgColor}; opacity: 1 !important; display: block !important;`;
                        setEndItem.innerHTML = `
                            <div style="color: #ffd700; font-size: 22px; margin-bottom: 8px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
                                â­ ç¬¬${currentSetNumber}å±€ç»“æŸ â­
                            </div>
                            <div style="color: #fff; font-size: 20px; margin: 8px 0; text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                                ${setResult.myScore} - ${setResult.opponentScore}
                            </div>
                            <div style="color: ${resultColor}; font-size: 18px; margin: 8px 0; text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                                ${resultText}
                            </div>
                            <div style="color: #ffd700; font-size: 18px; margin-top: 8px; text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                                å¤§å±€æ¯”åˆ†: ${displayedMySets} : ${displayedOpponentSets}
                            </div>
                        `;
                        matchLog.appendChild(setEndItem);
                        matchLog.scrollTop = matchLog.scrollHeight;
                        
                        currentSetNumber = log.set;
                        
                        // æ›´æ–°æ ‡é¢˜ä¸­çš„å¤§å±€åˆ†
                        title.innerHTML = `ğŸ ${match.matchName}<br><span style="font-size: 18px; color: #ffd700;">å¤§å±€: ${displayedMySets} : ${displayedOpponentSets}</span>`;
                        
                        // é‡ç½®å°å±€æ¯”åˆ†æ˜¾ç¤º
                        myScoreEl.textContent = '0';
                        opponentScoreEl.textContent = '0';
                        
                        // 2ç§’åæ˜¾ç¤º"ç¬¬Xå±€å¼€å§‹"å¹¶ç»§ç»­
                        setTimeout(() => {
                            this.showSetStartMessage(currentSetNumber, matchLog);
                            // å†ç­‰1ç§’åæ¢å¤åŠ¨ç”»
                            setTimeout(() => {
                                isPaused = false;
                            }, 1000);
                        }, 2000);
                        
                        return;
                    }
                    
                    // æ›´æ–°æ¯”åˆ†æ˜¾ç¤º
                    myScoreEl.textContent = log.myScore;
                    opponentScoreEl.textContent = log.opponentScore;
                    
                    // æ·»åŠ å¾—åˆ†è®°å½•
                    const logItem = document.createElement('div');
                    logItem.className = `match-log-item ${log.scorer === 'my' ? 'my-point' : 'opponent-point'}`;
                    
                    const scoreColor = log.scorer === 'my' ? '#2ecc71' : '#e74c3c';
                    logItem.innerHTML = `
                        <div class="match-log-score" style="color: ${scoreColor};">
                            ${log.myScore} : ${log.opponentScore}
                        </div>
                        <div class="match-log-description">${log.description}</div>
                    `;
                    
                    matchLog.appendChild(logItem);
                    matchLog.scrollTop = matchLog.scrollHeight;
                    
                    currentIndex++;
                }, 500); // æ”¹ä¸ºæ¯0.5ç§’æ˜¾ç¤ºä¸€åˆ†ï¼Œæ›´ä»å®¹
            }
            
            // æ–°å¢ï¼šæ˜¾ç¤ºå±€å¼€å§‹æç¤º
            showSetStartMessage(setNumber, matchLog) {
                const setStartItem = document.createElement('div');
                setStartItem.className = 'match-log-item';
                
                let setName = `ç¬¬${setNumber}å±€`;
                let emoji = 'ğŸ';
                let specialStyle = '';
                
                if (setNumber === 5) {
                    setName = 'å†³èƒœå±€';
                    emoji = 'ğŸ”¥';
                    specialStyle = 'background: linear-gradient(135deg, #ff6b6b 0%, #ffd700 100%); border: 3px solid #ff6b6b; box-shadow: 0 4px 15px rgba(255,107,107,0.5);';
                } else {
                    specialStyle = 'background: rgba(0,0,0,0.5); border: 2px solid #ffd700; box-shadow: 0 2px 10px rgba(255,215,0,0.3);';
                }
                
                // å¼ºåˆ¶æ˜¾ç¤ºï¼Œä¸ä¾èµ–åŠ¨ç”»
                setStartItem.style.cssText = `${specialStyle} font-weight: bold; text-align: center; padding: 15px; margin: 10px 0; opacity: 1 !important; display: block !important;`;
                
                setStartItem.innerHTML = `
                    <div style="color: #ffd700; font-size: 24px; padding: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
                        ${emoji} ${setName}å¼€å§‹ï¼${emoji}
                    </div>
                `;
                matchLog.appendChild(setStartItem);
                matchLog.scrollTop = matchLog.scrollHeight;
            }
            
            // æ–°å¢ï¼šæ˜¾ç¤ºæ­£å¼æ¯”èµ›ç»“æœ
            showFormalMatchResult() {
                const match = this.currentMatch;
                const won = match.mySets > match.opponentSets;
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯é”¦æ ‡èµ›æ¨¡å¼
                if (match.matchType === 'tournament' && this.tournament.active) {
                    // é”¦æ ‡èµ›æ¨¡å¼ï¼šè°ƒç”¨é”¦æ ‡èµ›ç»“æœå¤„ç†
                    this.onTournamentRoundComplete(won);
                    return;
                }
                
                // éé”¦æ ‡èµ›æ¨¡å¼ï¼šåŸæœ‰é€»è¾‘
                // è®¡ç®—è¡¨ç°è¯„çº§
                const performance = this.evaluateMatchPerformance();
                
                // æ ¹æ®è¡¨ç°ç­‰çº§æ˜¾ç¤ºä¸åŒç»“æœ
                this.showMatchResultByPerformance(performance, won);
            }
            
            // æ–°å¢ï¼šè¯„ä¼°æ¯”èµ›è¡¨ç°
            evaluateMatchPerformance() {
                const match = this.currentMatch;
                
                // åŸºäºæ¯”èµ›ç»“æœè®¡ç®—è¡¨ç°è¯„åˆ†
                const mySets = match.mySets;
                const opponentSets = match.opponentSets;
                const totalSets = mySets + opponentSets;
                
                // è®¡ç®—å±€åˆ†ä¼˜åŠ¿
                const setAdvantage = mySets - opponentSets;
                
                // è®¡ç®—æ¯å±€çš„å°åˆ†å·®è·
                let totalPointDiff = 0;
                let dominantSets = 0;  // å¤§æ¯”åˆ†è·èƒœçš„å±€æ•°ï¼ˆå·®è·>=5åˆ†ï¼‰
                
                match.setResults.forEach(set => {
                    const pointDiff = set.myScore - set.opponentScore;
                    totalPointDiff += pointDiff;
                    
                    // å¦‚æœèµ¢äº†è¿™å±€ä¸”åˆ†å·®>=5ï¼Œç®—ä½œä¸»å¯¼å±€
                    if (set.winner === 'my' && pointDiff >= 5) {
                        dominantSets++;
                    }
                });
                
                const avgPointDiff = totalPointDiff / totalSets;
                
                // ç»¼åˆè¯„åˆ†é€»è¾‘ï¼š
                // 1. 3:0æˆ–3:1æ¨ªæ‰« â†’ excellent
                // 2. 3:2é™©èƒœä½†æœ‰å¤šä¸ªä¸»å¯¼å±€ â†’ good
                // 3. 3:2é™©èƒœ â†’ average
                // 4. è¾“äº† â†’ æ ¹æ®å±€åˆ†å’Œå°åˆ†åˆ¤æ–­
                
                if (mySets >= 3) {
                    // èµ¢äº†æ¯”èµ›
                    if (opponentSets === 0) {
                        // 3:0æ¨ªæ‰«
                        return 'excellent';
                    } else if (opponentSets === 1) {
                        // 3:1å¤§èƒœ
                        return dominantSets >= 2 ? 'excellent' : 'good';
                    } else {
                        // 3:2é™©èƒœ
                        return dominantSets >= 2 ? 'good' : 'average';
                    }
                } else {
                    // è¾“äº†æ¯”èµ›
                    if (mySets === 2) {
                        // 2:3æƒœè´¥
                        return avgPointDiff >= -2 ? 'average' : 'poor';
                    } else if (mySets === 1) {
                        // 1:3å¤±åˆ©
                        return 'poor';
                    } else {
                        // 0:3æƒ¨è´¥
                        return 'poor';
                    }
                }
            }
            
            // æ–°å¢ï¼šæ ¹æ®è¡¨ç°æ˜¾ç¤ºæ¯”èµ›ç»“æœ
            showMatchResultByPerformance(performance, won) {
                const match = this.currentMatch;
                
                // æ„å»ºå±€åˆ†æ˜¾ç¤º
                let setsDisplay = `<div class="sets-result" style="margin: 20px 0;">`;
                setsDisplay += `<div class="final-sets" style="font-size: 28px; font-weight: bold; margin-bottom: 15px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">`;
                setsDisplay += `å¤§å±€æ¯”åˆ†ï¼š<span style="color: #2ecc71;">${match.mySets}</span> : <span style="color: #e74c3c;">${match.opponentSets}</span>`;
                setsDisplay += `</div>`;
                setsDisplay += `<div class="set-details" style="font-size: 16px;">`;
                match.setResults.forEach((set, i) => {
                    const setClass = set.winner === 'my' ? 'won' : 'lost';
                    const color = set.winner === 'my' ? '#2ecc71' : '#e74c3c';
                    setsDisplay += `<div class="set-result ${setClass}" style="padding: 8px; margin: 5px 0; background: rgba(255,255,255,0.05); border-radius: 5px;">`;
                    setsDisplay += `ç¬¬${i+1}å±€: <span style="color: ${color}; font-weight: bold;">${set.myScore}-${set.opponentScore}</span>`;
                    setsDisplay += `</div>`;
                });
                setsDisplay += `</div></div>`;
                
                // æ ¹æ®è¡¨ç°ç­‰çº§ç¡®å®šå¥–åŠ±
                let rewards = this.getMatchRewards(match.matchType, performance, won);
                
                // æ˜¾ç¤ºç»“æœåœºæ™¯
                const resultText = this.getMatchResultText(match.matchType, performance, won, setsDisplay);
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯æ ¡é™…è”èµ›ï¼ˆè§¦å‘ç»“å±€ï¼‰
                if (match.matchType === 'universityLeague' && rewards.ending) {
                    // æ ¡é™…è”èµ›ç»“æŸï¼Œè§¦å‘ç»“å±€
                    SCENES.matchResult = {
                        text: resultText,
                        choices: [{
                            text: 'æŸ¥çœ‹ç»“å±€',
                            next: rewards.ending,  // è·³è½¬åˆ°ç»“å±€åœºæ™¯
                            effect: rewards
                        }]
                    };
                } else {
                    // å…¶ä»–æ¯”èµ›ï¼Œè¿”å›å‘¨é€‰æ‹©ï¼Œå¹¶æ›´æ–°ç›®æ ‡
                    // é™¢é™…æ¯”èµ›ååˆ‡æ¢åˆ°åŠ å…¥æ ¡é˜Ÿç›®æ ‡
                    if (match.matchType === 'collegeMatch') {
                        rewards.goalUpdate = 'universityTryout';
                    }
                    
                    SCENES.matchResult = {
                        text: resultText,
                        choices: [{
                            text: 'ç»§ç»­',
                            next: 'weeklyHub',
                            effect: rewards
                        }]
                    };
                }
                
                console.log('æ˜¾ç¤ºæ¯”èµ›ç»“æœåœºæ™¯');
                this.showScene('matchResult');
            }
            
            // æ–°å¢ï¼šè·å–æ¯”èµ›å¥–åŠ±
            getMatchRewards(matchType, performance, won) {
                const rewards = {
                    reputation: 0,
                    serve: 0,
                    spike: 0,
                    block: 0,
                    dig: 0,
                    set: 0,
                    mood: 0,
                    stress: 0,
                    nextGoal: null
                };
                
                // æ ¹æ®æ¯”èµ›ç±»å‹å’Œè¡¨ç°ç­‰çº§è®¾ç½®å¥–åŠ±
                if (matchType === 'collegeMatch') {
                    rewards.nextGoal = 'universityTryout';
                    if (performance === 'excellent') {
                        rewards.reputation = 40;
                        rewards.serve = rewards.spike = rewards.block = rewards.dig = rewards.set = 8;
                        rewards.mood = 25;
                        rewards.stress = -15;
                    } else if (performance === 'good') {
                        rewards.reputation = 30;
                        rewards.serve = rewards.spike = rewards.block = rewards.dig = rewards.set = 5;
                        rewards.mood = 20;
                        rewards.stress = -10;
                    } else if (performance === 'average') {
                        rewards.reputation = 15;
                        rewards.serve = rewards.spike = rewards.block = 3;
                        rewards.mood = 5;
                        rewards.stress = 5;
                    } else {
                        rewards.reputation = 5;
                        rewards.mood = -20;
                        rewards.stress = 15;
                    }
                } else if (matchType === 'universityLeague') {
                    // æ ¡é™…è”èµ›ï¼šæ ¹æ®è¡¨ç°è§¦å‘ä¸åŒç»“å±€
                    if (performance === 'excellent') {
                        rewards.reputation = 70;
                        rewards.serve = rewards.spike = rewards.block = rewards.dig = rewards.set = 12;
                        rewards.mood = 30;
                        rewards.stress = -20;
                        rewards.ending = 'champion';  // å† å†›ç»“å±€
                    } else if (performance === 'good') {
                        rewards.reputation = 50;
                        rewards.serve = rewards.spike = rewards.block = rewards.dig = rewards.set = 8;
                        rewards.mood = 25;
                        rewards.stress = -15;
                        rewards.ending = 'runner_up';  // äºšå†›ç»“å±€
                    } else if (performance === 'average') {
                        rewards.reputation = 25;
                        rewards.serve = rewards.spike = rewards.block = rewards.dig = rewards.set = 5;
                        rewards.mood = 10;
                        rewards.stress = 5;
                        rewards.ending = 'participant';  // å‚ä¸ç»“å±€
                    } else {
                        rewards.reputation = 10;
                        rewards.mood = -25;
                        rewards.stress = 20;
                        rewards.ending = 'early_exit';  // æ—©é€€ç»“å±€
                    }
                }
                
                return rewards;
            }
            
            // æ–°å¢ï¼šè·å–æ¯”èµ›ç»“æœæ–‡æœ¬
            getMatchResultText(matchType, performance, won, setsDisplay) {
                let matchName = '';
                if (matchType === 'collegeMatch') matchName = 'é™¢é™…æ¯”èµ›';
                else if (matchType === 'universityLeague') matchName = 'æ ¡é™…è”èµ›';
                
                let text = `<h2>ğŸ ${matchName}</h2>`;
                
                // æ˜¾ç¤ºå¤§å±€åˆ†ï¼ˆåŠ å¤§å­—ä½“ï¼‰
                text += `<div style="font-size: 32px; font-weight: bold; margin: 20px 0; color: ${won ? '#2ecc71' : '#e74c3c'};">`;
                text += won ? 'ğŸ‰ èƒœåˆ©ï¼' : 'ğŸ˜” å¤±è´¥';
                text += `</div>`;
                
                text += setsDisplay;
                
                // æ ¹æ®èƒœè´Ÿå’Œè¡¨ç°æ˜¾ç¤ºä¸åŒæ–‡æœ¬
                if (won) {
                    if (performance === 'excellent') {
                        text += `<p><strong>ğŸŒŸ MVPè¡¨ç°ï¼</strong></p>`;
                        text += `<p>ä½ åœ¨æ¯”èµ›ä¸­è¡¨ç°å‡ºè‰²ï¼Œå®Œå…¨ä¸»å¯¼äº†æ¯”èµ›ï¼</p>`;
                        text += `<p>è§‚ä¼—ä»¬ä¸ºä½ æ¬¢å‘¼ï¼Œæ•™ç»ƒå¯¹ä½ èµä¸ç»å£ï¼</p>`;
                    } else if (performance === 'good') {
                        text += `<p><strong>âœ¨ å‡ºè‰²è¡¨ç°ï¼</strong></p>`;
                        text += `<p>ä½ åœ¨æ¯”èµ›ä¸­å‘æŒ¥ç¨³å®šï¼Œå¸®åŠ©çƒé˜Ÿè·å¾—èƒœåˆ©ï¼</p>`;
                        text += `<p>é˜Ÿå‹ä»¬å¯¹ä½ ç«–èµ·å¤§æ‹‡æŒ‡ï¼</p>`;
                    } else if (performance === 'average') {
                        text += `<p><strong>ğŸ“Š é™©èƒœ</strong></p>`;
                        text += `<p>æ¯”èµ›å¾ˆæ¿€çƒˆï¼Œä½ çš„è¡¨ç°ä¸­è§„ä¸­çŸ©ï¼Œä½†æœ€ç»ˆèµ¢å¾—äº†æ¯”èµ›ã€‚</p>`;
                        text += `<p>è¿˜æœ‰æå‡çš„ç©ºé—´ï¼Œç»§ç»­åŠªåŠ›ï¼</p>`;
                    } else {
                        text += `<p><strong>ğŸ€ å¹¸è¿è·èƒœ</strong></p>`;
                        text += `<p>è™½ç„¶ä½ çš„å‘æŒ¥ä¸å¤ªç†æƒ³ï¼Œä½†é˜Ÿå‹ä»¬å¸®åŠ©ä½ èµ¢å¾—äº†æ¯”èµ›ã€‚</p>`;
                        text += `<p>éœ€è¦æ›´å¤šçš„è®­ç»ƒæ¥æå‡å®åŠ›ã€‚</p>`;
                    }
                } else {
                    if (performance === 'excellent') {
                        text += `<p><strong>ğŸ’ª è™½è´¥çŠ¹è£</strong></p>`;
                        text += `<p>ä½ è¡¨ç°å‡ºè‰²ï¼Œä½†å¯¹æ‰‹æ›´å¼ºã€‚è¿™æ˜¯ä¸€åœºç²¾å½©çš„æ¯”èµ›ï¼</p>`;
                        text += `<p>ç»§ç»­ä¿æŒï¼Œä½ ä¼šå˜å¾—æ›´å¼ºï¼</p>`;
                    } else if (performance === 'good') {
                        text += `<p><strong>ğŸ˜” æƒœè´¥</strong></p>`;
                        text += `<p>ä½ å‘æŒ¥ä¸é”™ï¼Œä½†å¯¹æ‰‹ç•¥èƒœä¸€ç­¹ã€‚</p>`;
                        text += `<p>ç»§ç»­åŠªåŠ›ï¼Œä¸‹æ¬¡ä¸€å®šèƒ½èµ¢ï¼</p>`;
                    } else if (performance === 'average') {
                        text += `<p><strong>ğŸ“‰ è¡¨ç°ä¸€èˆ¬</strong></p>`;
                        text += `<p>æ¯”èµ›å¾ˆæ¿€çƒˆï¼Œä½†ä½ çš„è¡¨ç°ä¸å¤Ÿå‡ºè‰²ã€‚</p>`;
                        text += `<p>éœ€è¦æ›´å¤šè®­ç»ƒæ¥æå‡å®åŠ›ã€‚</p>`;
                    } else {
                        text += `<p><strong>ğŸ˜ è¡¨ç°ä¸ä½³</strong></p>`;
                        text += `<p>è¿™åœºæ¯”èµ›ä½ çš„å‘æŒ¥ä¸å¤ªç†æƒ³ï¼Œè¾“æ‰äº†æ¯”èµ›ã€‚</p>`;
                        text += `<p>ä¸è¦æ°”é¦ï¼ŒåŠ å¼ºè®­ç»ƒï¼Œä¸‹æ¬¡ä¼šæ›´å¥½ï¼</p>`;
                    }
                }
                
                return text;
            }
            
            showFinalMatchResult() {
                const match = this.currentMatch;
                const won = match.myScore >= match.targetScore;
                
                const title = document.getElementById('match-modal-title');
                const choicesDiv = document.getElementById('match-modal-choices');
                const skipBtn = document.getElementById('skip-match-btn');
                
                // éšè—è·³è¿‡æŒ‰é’®
                skipBtn.style.display = 'none';
                
                // æ›´æ–°æ ‡é¢˜
                title.textContent = won ? 'ğŸ‰ èƒœåˆ©ï¼' : 'ğŸ˜” å¤±è´¥';
                
                // æ›´æ–°æ¯”èµ›ç»Ÿè®¡
                this.player.matchesPlayed = (this.player.matchesPlayed || 0) + 1;
                if (won) {
                    this.player.matchesWon = (this.player.matchesWon || 0) + 1;
                }
                
                // è®¡ç®—æ¯”èµ›è¡¨ç°è¯„åˆ†ï¼ˆç®€åŒ–ç‰ˆï¼‰
                const performanceRating = this.calculateMatchPerformance(match, won);
                this.player.performanceHistory.push(performanceRating);
                
                // æ›´æ–°å¹³å‡è¡¨ç°
                if (this.player.performanceHistory.length > 0) {
                    this.player.averagePerformance = Math.round(
                        this.player.performanceHistory.reduce((a, b) => a + b, 0) / 
                        this.player.performanceHistory.length
                    );
                }
                
                // è®¡ç®—å¥–åŠ±
                const rewards = this.calculateMatchRewards(won, performanceRating);
                
                // æ˜¾ç¤ºç»“æœæŒ‰é’®
                choicesDiv.innerHTML = '';
                
                // æ·»åŠ ç»“æœè¯´æ˜
                const resultDiv = document.createElement('div');
                resultDiv.style.cssText = 'margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px; text-align: center;';
                resultDiv.innerHTML = `
                    <h3 style="margin-bottom: 10px;">${won ? 'æ­å–œè·èƒœï¼' : 'è™½è´¥çŠ¹è£ï¼'}</h3>
                    <p style="margin-bottom: 10px;">${rewards.message}</p>
                    <p style="font-size: 14px; color: #f39c12;">ğŸ“Š æœ¬åœºè¡¨ç°è¯„åˆ†ï¼š${performanceRating}/100</p>
                    <div style="text-align: left; font-size: 14px; margin-top: 15px;">
                        <strong>ğŸ’« æ¯”èµ›æ”¶è·ï¼š</strong><br>
                        ${rewards.serve ? `ğŸ¯ å‘çƒ +${rewards.serve}<br>` : ''}
                        ${rewards.spike ? `âš¡ æ‰£çƒ +${rewards.spike}<br>` : ''}
                        ${rewards.block ? `ğŸ›¡ï¸ æ‹¦ç½‘ +${rewards.block}<br>` : ''}
                        ${rewards.dig ? `ğŸ¤¸ å«çƒ +${rewards.dig}<br>` : ''}
                        ${rewards.set ? `ğŸ™Œ æ‰˜çƒ +${rewards.set}<br>` : ''}
                        ${rewards.trainingPoints ? `ğŸ¯ è®­ç»ƒç‚¹æ•° +${rewards.trainingPoints}<br>` : ''}
                        ${rewards.energy ? `ğŸ’ª ä½“åŠ› ${rewards.energy}<br>` : ''}
                        ${rewards.mood ? `ğŸ˜Š å¿ƒæƒ… ${rewards.mood > 0 ? '+' : ''}${rewards.mood}<br>` : ''}
                        ${rewards.stress ? `ğŸ˜° å‹åŠ› ${rewards.stress > 0 ? '+' : ''}${rewards.stress}<br>` : ''}
                        ${rewards.reputation ? `â­ å£°æœ› +${rewards.reputation}<br>` : ''}
                    </div>
                `;
                choicesDiv.appendChild(resultDiv);
                
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.textContent = 'ç¡®å®š';
                button.onclick = () => {
                    // åº”ç”¨å¥–åŠ±
                    this.applyEffect(rewards);
                    
                    // å…³é—­å¼¹çª—
                    const modal = document.getElementById('match-modal');
                    modal.classList.remove('show');
                    
                    // æ›´æ–°ç›®æ ‡æ˜¾ç¤º
                    this.updateGoalDisplay();
                    
                    // è¿”å›å‘¨é€‰æ‹©
                    this.currentScene = 'weeklyHub';
                    this.showScene('weeklyHub');
                };
                
                choicesDiv.appendChild(button);
            }
            
            // æ–°å¢ï¼šè®¡ç®—æ¯”èµ›è¡¨ç°è¯„åˆ†
            calculateMatchPerformance(match, won) {
                // åŸºç¡€åˆ†ï¼šæ ¹æ®æ¯”åˆ†å·®è·
                const scoreDiff = match.myScore - match.opponentScore;
                let baseScore = 50;
                
                if (won) {
                    baseScore = 60 + Math.min(scoreDiff * 2, 20); // 60-80åˆ†
                } else {
                    baseScore = 40 + Math.max(scoreDiff * 2, -20); // 20-40åˆ†
                }
                
                // æŠ€èƒ½åŠ æˆï¼šå¹³å‡æŠ€èƒ½è¶Šé«˜ï¼Œè¡¨ç°è¶Šå¥½
                const avgSkill = (
                    this.player.skills.serve +
                    this.player.skills.spike +
                    this.player.skills.block +
                    this.player.skills.dig +
                    this.player.skills.set
                ) / 5;
                
                const skillBonus = Math.min(avgSkill / 5, 20); // æœ€å¤š+20åˆ†
                
                const finalScore = Math.round(Math.min(baseScore + skillBonus, 100));
                return finalScore;
            }
            
            calculateMatchRewards(won, performanceRating) {
                const match = this.currentMatch;
                const isCasual = match.type === 'casual';
                
                // æ ¹æ®è¡¨ç°è¯„åˆ†è®¡ç®—è®­ç»ƒç‚¹æ•°å¥–åŠ±
                let trainingPoints = 0;
                if (performanceRating >= 85) {
                    trainingPoints = won ? 30 : 15;
                } else if (performanceRating >= 70) {
                    trainingPoints = won ? 15 : 8;
                } else if (performanceRating >= 55) {
                    trainingPoints = won ? 5 : 0;
                }
                
                if (won) {
                    return {
                        message: isCasual ? 
                            'é€šè¿‡å®æˆ˜ï¼Œä½ çš„æŠ€èƒ½å¾—åˆ°äº†æå‡ï¼' :
                            'èµ¢å¾—æ¯”èµ›è®©ä½ ä¿¡å¿ƒå¤§å¢ï¼ŒæŠ€èƒ½å’Œå£°æœ›éƒ½æœ‰æå‡ï¼',
                        serve: isCasual ? 2 : 4,
                        spike: isCasual ? 2 : 4,
                        block: isCasual ? 2 : 3,
                        dig: isCasual ? 2 : 4,
                        set: isCasual ? 2 : 3,
                        trainingPoints: trainingPoints,
                        energy: isCasual ? 0 : -15,  // é‡çƒä¸é¢å¤–æ¶ˆè€—ä½“åŠ›ï¼Œæ­£å¼æ¯”èµ›æ¶ˆè€—
                        mood: isCasual ? 12 : 20,
                        stress: isCasual ? -8 : -12,
                        reputation: isCasual ? 2 : 6
                    };
                } else {
                    return {
                        message: isCasual ?
                            'è™½ç„¶è¾“äº†ï¼Œä½†ä½ ä»æ¯”èµ›ä¸­å­¦åˆ°äº†å¾ˆå¤šã€‚' :
                            'å¤±è´¥æ˜¯æˆåŠŸä¹‹æ¯ï¼Œä½ ä»è¿™åœºæ¯”èµ›ä¸­å¸å–äº†ç»éªŒã€‚',
                        serve: isCasual ? 1 : 2,
                        spike: isCasual ? 1 : 2,
                        block: isCasual ? 1 : 1,
                        dig: isCasual ? 1 : 2,
                        set: isCasual ? 1 : 1,
                        trainingPoints: trainingPoints,
                        energy: isCasual ? 0 : -12,  // é‡çƒä¸é¢å¤–æ¶ˆè€—ä½“åŠ›ï¼Œæ­£å¼æ¯”èµ›æ¶ˆè€—
                        mood: isCasual ? -5 : -10,
                        stress: isCasual ? 5 : 8,
                        reputation: isCasual ? 0 : -2
                    };
                }
            }
            
            // ====================================================
            // é”¦æ ‡èµ›ç³»ç»Ÿ
            // ====================================================
            
            // å¼€å§‹é”¦æ ‡èµ›
            startTournament(type) {
                console.log('=== å¼€å§‹é”¦æ ‡èµ› ===');
                console.log('ç±»å‹:', type);
                
                this.tournament = {
                    active: true,
                    type: type,
                    currentRound: 'round16',
                    roundsCompleted: [],
                    matchesWon: 0,
                    matchesLost: 0,
                    eliminated: false,
                    finalRank: null
                };
                
                // æ˜¾ç¤ºé”¦æ ‡èµ›å¼€å¹•åœºæ™¯
                this.showScene('tournamentStart');
            }
            
            // å¼€å§‹æŸä¸€è½®æ¯”èµ›
            startTournamentRound(roundId) {
                console.log('=== å¼€å§‹é”¦æ ‡èµ›è½®æ¬¡ ===');
                console.log('è½®æ¬¡:', roundId);
                
                this.tournament.currentRound = roundId;
                const roundInfo = this.TOURNAMENT_ROUNDS[roundId];
                
                // æ˜¾ç¤ºè½®æ¬¡å¼€å§‹åœºæ™¯
                SCENES[`roundStart_${roundId}`] = {
                    text: this.getRoundStartText(roundInfo),
                    choices: [
                        {
                            text: 'å¼€å§‹æ¯”èµ›',
                            next: null,  // ä¸è·³è½¬åœºæ™¯
                            effect: () => {
                                // ç›´æ¥å¼€å§‹äº”å±€ä¸‰èƒœæ¯”èµ›
                                this.startFormalMatch('tournament', roundInfo.name);
                            }
                        }
                    ]
                };
                
                this.showScene(`roundStart_${roundId}`);
            }
            
            // è·å–è½®æ¬¡å¼€å§‹æ–‡æœ¬
            getRoundStartText(roundInfo) {
                const progress = this.renderTournamentProgress();
                const opponentStars = 'â˜…'.repeat(Math.floor(roundInfo.opponentStrength / 20)) + 
                                     'â˜†'.repeat(5 - Math.floor(roundInfo.opponentStrength / 20));
                
                let coachTip = '';
                if (roundInfo.id === 'round16') {
                    coachTip = '"è¿™æ˜¯å•è´¥æ·˜æ±°ï¼Œè¾“äº†å°±å›å®¶ã€‚å…¨åŠ›ä»¥èµ´ï¼Œä¸ç•™é—æ†¾ï¼"';
                } else if (roundInfo.id === 'round8') {
                    coachTip = '"ä½ å·²ç»è¯æ˜äº†è‡ªå·±çš„å®åŠ›ã€‚ç»§ç»­ä¿æŒï¼Œç¨³æ‰ç¨³æ‰“ï¼"';
                } else if (roundInfo.id === 'round4') {
                    coachTip = '"åŠå†³èµ›äº†ï¼è·ç¦»å† å†›åªæœ‰ä¸¤æ­¥ä¹‹é¥ï¼ŒåŠ æ²¹ï¼"';
                } else if (roundInfo.id === 'final') {
                    coachTip = '"ä½ å·²ç»è¯æ˜äº†è‡ªå·±ã€‚ç°åœ¨ï¼Œå»æ‹¿ä¸‹é‚£åº§å† å†›å¥–æ¯å§ï¼"';
                }
                
                let text = `<h2>${roundInfo.emoji} ${roundInfo.name}</h2>`;
                text += `<div style="margin: 20px 0;">`;
                text += `<h3>ğŸ† é”¦æ ‡èµ›è¿›åº¦</h3>`;
                text += `<p>âœ… å·²æ™‹çº§ï¼š${this.tournament.roundsCompleted.length}è½®</p>`;
                text += `<p>ğŸ“ å½“å‰è½®æ¬¡ï¼š${roundInfo.shortName}</p>`;
                if (roundInfo.nextRound) {
                    const nextRoundInfo = this.TOURNAMENT_ROUNDS[roundInfo.nextRound];
                    text += `<p>ğŸ¯ ä¸‹ä¸€è½®ï¼š${nextRoundInfo.shortName}</p>`;
                }
                text += `</div>`;
                
                text += progress;
                
                text += `<div style="margin: 20px 0;">`;
                text += `<p><strong>ğŸ’ª å¯¹æ‰‹å®åŠ›ï¼š${opponentStars}</strong></p>`;
                
                if (roundInfo.id === 'round16') {
                    text += `<p>è¿™æ˜¯ä½ çš„ç¬¬ä¸€åœºæ·˜æ±°èµ›ï¼Œå¯¹æ‰‹å®åŠ›ä¸­ç­‰åä¸Šã€‚ä¿æŒå†·é™ï¼Œå‘æŒ¥å®åŠ›ï¼</p>`;
                } else if (roundInfo.id === 'round8') {
                    text += `<p>è¿›å…¥8å¼ºï¼Œå¯¹æ‰‹å®åŠ›æ˜æ˜¾æå‡ã€‚éœ€è¦æ›´åŠ ä¸“æ³¨å’ŒåŠªåŠ›ï¼</p>`;
                } else if (roundInfo.id === 'round4') {
                    text += `<p>åŠå†³èµ›çš„å¯¹æ‰‹éå¸¸å¼ºå¤§ï¼Œè¿™å°†æ˜¯ä¸€åœºç¡¬ä»—ï¼</p>`;
                } else if (roundInfo.id === 'final') {
                    text += `<p>å†³èµ›å¯¹æ‰‹æ˜¯æœ¬å±Šè”èµ›æœ€å¼ºçš„é˜Ÿä¼ï¼è¿™å°†æ˜¯ä¸€åœºå²è¯—çº§çš„å¯¹å†³ï¼</p>`;
                    text += `<p style="margin-top: 10px;">ğŸ¯ <strong>èƒœåˆ© â†’ ğŸ† å† å†›</strong></p>`;
                    text += `<p>ğŸ˜” <strong>å¤±è´¥ â†’ ğŸ¥ˆ äºšå†›</strong></p>`;
                }
                text += `</div>`;
                
                text += `<div style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">`;
                text += `<p><strong>ğŸ’¡ æ•™ç»ƒæé†’ï¼š</strong></p>`;
                text += `<p>${coachTip}</p>`;
                text += `</div>`;
                
                return text;
            }
            
            // æ¸²æŸ“é”¦æ ‡èµ›è¿›åº¦æ¡
            renderTournamentProgress() {
                const rounds = ['round16', 'round8', 'round4', 'final'];
                const currentIndex = rounds.indexOf(this.tournament.currentRound);
                
                let html = `<div style="margin: 20px 0; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px;">`;
                html += `<div style="display: flex; justify-content: space-between; align-items: center; font-size: 14px;">`;
                
                rounds.forEach((roundId, index) => {
                    const roundInfo = this.TOURNAMENT_ROUNDS[roundId];
                    let status = '';
                    let color = '#666';
                    
                    if (this.tournament.roundsCompleted.includes(roundId)) {
                        status = 'âœ…';
                        color = '#2ecc71';
                    } else if (roundId === this.tournament.currentRound) {
                        status = 'ğŸ“';
                        color = '#f39c12';
                    } else {
                        status = 'â­•';
                        color = '#666';
                    }
                    
                    html += `<div style="text-align: center; flex: 1;">`;
                    html += `<div style="font-size: 20px;">${status}</div>`;
                    html += `<div style="color: ${color}; margin-top: 5px;">${roundInfo.shortName}</div>`;
                    html += `</div>`;
                    
                    if (index < rounds.length - 1) {
                        html += `<div style="color: #666;">â†’</div>`;
                    }
                });
                
                html += `<div style="text-align: center; flex: 1;">`;
                html += `<div style="font-size: 20px;">ğŸ†</div>`;
                html += `<div style="color: #ffd700; margin-top: 5px;">å† å†›</div>`;
                html += `</div>`;
                
                html += `</div></div>`;
                
                return html;
            }
            
            // è½®æ¬¡æ¯”èµ›ç»“æŸ
            onTournamentRoundComplete(won) {
                console.log('=== è½®æ¬¡æ¯”èµ›ç»“æŸ ===');
                console.log('èƒœåˆ©:', won);
                
                const roundInfo = this.TOURNAMENT_ROUNDS[this.tournament.currentRound];
                
                if (won) {
                    // æ™‹çº§
                    this.tournament.matchesWon++;
                    this.tournament.roundsCompleted.push(this.tournament.currentRound);
                    
                    // æ˜¾ç¤ºæ™‹çº§ç•Œé¢
                    this.showTournamentRoundResult(true, roundInfo);
                } else {
                    // æ·˜æ±°
                    this.tournament.matchesLost++;
                    this.tournament.eliminated = true;
                    this.tournament.finalRank = roundInfo.eliminationRank;
                    
                    // æ˜¾ç¤ºæ·˜æ±°ç•Œé¢
                    this.showTournamentRoundResult(false, roundInfo);
                }
            }
            
            // æ˜¾ç¤ºè½®æ¬¡ç»“æœ
            showTournamentRoundResult(won, roundInfo) {
                const match = this.currentMatch;
                
                // æ„å»ºå±€åˆ†æ˜¾ç¤º
                let setsDisplay = `<div class="sets-result" style="margin: 20px 0;">`;
                setsDisplay += `<div class="final-sets" style="font-size: 24px; font-weight: bold; margin-bottom: 15px;">`;
                setsDisplay += `å¤§å±€æ¯”åˆ†ï¼š<span style="color: #2ecc71;">${match.mySets}</span> : <span style="color: #e74c3c;">${match.opponentSets}</span>`;
                setsDisplay += `</div>`;
                setsDisplay += `<div class="set-details" style="font-size: 14px;">`;
                match.setResults.forEach((set, i) => {
                    const color = set.winner === 'my' ? '#2ecc71' : '#e74c3c';
                    setsDisplay += `<div style="padding: 5px; margin: 3px 0;">`;
                    setsDisplay += `ç¬¬${i+1}å±€: <span style="color: ${color}; font-weight: bold;">${set.myScore}-${set.opponentScore}</span>`;
                    if (set.winner === 'my') setsDisplay += ` âœ…`;
                    else setsDisplay += ` âŒ`;
                    setsDisplay += `</div>`;
                });
                setsDisplay += `</div></div>`;
                
                // è®¡ç®—å¥–åŠ±
                const rewards = this.getTournamentRoundRewards(won, roundInfo);
                
                let text = '';
                if (won) {
                    text = `<h2>ğŸ‰ æ™‹çº§æˆåŠŸï¼</h2>`;
                    text += `<h3>${roundInfo.emoji} ${roundInfo.name}</h3>`;
                    text += setsDisplay;
                    text += `<p><strong>â­ å‡ºè‰²è¡¨ç°ï¼</strong></p>`;
                    text += `<p>ä½ åœ¨æ¯”èµ›ä¸­å‘æŒ¥ç¨³å®šï¼ŒæˆåŠŸæˆ˜èƒœå¯¹æ‰‹ï¼Œæ™‹çº§ä¸‹ä¸€è½®ï¼</p>`;
                } else {
                    text = `<h2>ğŸ˜” é—æ†¾å‡ºå±€</h2>`;
                    text += `<h3>${roundInfo.emoji} ${roundInfo.name}</h3>`;
                    text += setsDisplay;
                    text += `<p>è™½ç„¶ä½ åŠªåŠ›æ‹¼æï¼Œä½†å¯¹æ‰‹æ›´èƒœä¸€ç­¹ã€‚ä½ çš„æ ¡é™…è”èµ›ä¹‹æ—…æ­¢æ­¥äºæ­¤ã€‚</p>`;
                }
                
                // æ˜¾ç¤ºå¥–åŠ±
                text += `<div style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">`;
                text += `<p><strong>ğŸ’« æ¯”èµ›æ”¶è·ï¼š</strong></p>`;
                text += `<div style="text-align: left; font-size: 14px;">`;
                
                // åªæ˜¾ç¤ºéé›¶çš„å¥–åŠ±
                if (rewards.serve > 0) text += `ğŸ¯ å‘çƒ +${rewards.serve}<br>`;
                if (rewards.spike > 0) text += `âš¡ æ‰£çƒ +${rewards.spike}<br>`;
                if (rewards.block > 0) text += `ğŸ›¡ï¸ æ‹¦ç½‘ +${rewards.block}<br>`;
                if (rewards.dig > 0) text += `ğŸ¤¸ å«çƒ +${rewards.dig}<br>`;
                if (rewards.set > 0) text += `ğŸ™Œ æ‰˜çƒ +${rewards.set}<br>`;
                
                // å£°æœ›ã€å¿ƒæƒ…ã€å‹åŠ›å§‹ç»ˆæ˜¾ç¤ºï¼ˆå¯èƒ½ä¸ºè´Ÿï¼‰
                if (rewards.reputation !== 0) text += `â­ å£°æœ› ${rewards.reputation > 0 ? '+' : ''}${rewards.reputation}<br>`;
                if (rewards.mood !== 0) text += `ğŸ˜Š å¿ƒæƒ… ${rewards.mood > 0 ? '+' : ''}${rewards.mood}<br>`;
                if (rewards.stress !== 0) text += `ğŸ˜° å‹åŠ› ${rewards.stress > 0 ? '+' : ''}${rewards.stress}<br>`;
                
                // å¦‚æœæ˜¯å†³èµ›ï¼Œæ·»åŠ è¯´æ˜
                if (roundInfo.id === 'final') {
                    text += `<br><p style="color: #fbbf24; font-size: 12px;">ğŸ’¡ å†³èµ›é˜¶æ®µä¸å†æå‡æŠ€èƒ½ï¼Œä¸“æ³¨äºè£èª‰ï¼</p>`;
                }
                
                text += `</div></div>`;
                
                if (won) {
                    // æ£€æŸ¥æ˜¯å¦æ˜¯å†³èµ›
                    if (!roundInfo.nextRound) {
                        // å†³èµ›èƒœåˆ©ï¼šæ˜¾ç¤ºå† å†›ç¥è´º
                        text += `<div style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); border-radius: 10px; border: 3px solid #ffd700;">`;
                        text += `<h3 style="color: #000; font-size: 24px; margin-bottom: 10px;">ğŸ† æ­å–œå¤ºå† ï¼ğŸ†</h3>`;
                        text += `<p style="color: #333; font-size: 16px;">ä½ æˆ˜èƒœäº†æ‰€æœ‰å¯¹æ‰‹ï¼Œç«™ä¸Šäº†æœ€é«˜é¢†å¥–å°ï¼</p>`;
                        text += `<p style="color: #333; font-size: 16px;">ä»16å¼ºåˆ°å† å†›ï¼Œä½ ç”¨å®åŠ›è¯æ˜äº†è‡ªå·±ï¼</p>`;
                        text += `</div>`;
                    } else {
                        // éå†³èµ›ï¼šæ˜¾ç¤ºè¿›åº¦æ›´æ–°
                        text += `<div style="margin: 20px 0;">`;
                        text += `<h3>ğŸ† é”¦æ ‡èµ›è¿›åº¦æ›´æ–°</h3>`;
                        text += `<p>âœ… å·²æ™‹çº§ï¼š${this.tournament.roundsCompleted.length}è½®`;
                        
                        const nextRoundInfo = this.TOURNAMENT_ROUNDS[roundInfo.nextRound];
                        text += ` ï¼ˆè¿›å…¥${nextRoundInfo.shortName}ï¼‰</p>`;
                        text += `<p>ğŸ“ ä¸‹ä¸€è½®ï¼š${nextRoundInfo.name}</p>`;
                        text += `</div>`;
                        
                        text += this.renderTournamentProgress();
                    }
                } else {
                    // æ·˜æ±°ï¼šæ˜¾ç¤ºæœ€ç»ˆæˆç»©
                    let rankText = '';
                    if (roundInfo.eliminationRank === 'top16') rankText = '16å¼º';
                    else if (roundInfo.eliminationRank === 'top8') rankText = '8å¼º';
                    else if (roundInfo.eliminationRank === 'top4') rankText = '4å¼º';
                    else if (roundInfo.eliminationRank === 'runner_up') rankText = 'äºšå†›';
                    
                    text += `<div style="margin: 20px 0; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px;">`;
                    text += `<p><strong>ğŸ† æœ€ç»ˆæˆç»©ï¼š${rankText}</strong></p>`;
                    text += `<p>"è™½ç„¶ç»“æœä¸å°½å¦‚äººæ„ï¼Œä½†ä½ å·²ç»èµ°åˆ°äº†è¿™é‡Œã€‚è¿™æ˜¯ä¸€ä¸ªæ–°çš„èµ·ç‚¹ã€‚"</p>`;
                    text += `</div>`;
                }
                
                // åˆ›å»ºç»“æœåœºæ™¯
                const nextRoundId = roundInfo.nextRound;
                const self = this;
                
                SCENES.tournamentRoundResult = {
                    text: text,
                    choices: won ? [
                        {
                            text: nextRoundId ? 'ç»§ç»­ä¸‹ä¸€è½®' : 'æŸ¥çœ‹ç»“å±€',
                            next: nextRoundId ? null : this.getTournamentEnding(),
                            effect: nextRoundId ? Object.assign({}, rewards, {
                                callback: () => {
                                    self.startTournamentRound(nextRoundId);
                                }
                            }) : rewards
                        }
                    ] : [
                        {
                            text: 'æŸ¥çœ‹ç»“å±€',
                            next: this.getTournamentEnding(),
                            effect: rewards
                        }
                    ]
                };
                
                this.showScene('tournamentRoundResult');
            }
            
            // è·å–é”¦æ ‡èµ›è½®æ¬¡å¥–åŠ±
            getTournamentRoundRewards(won, roundInfo) {
                const rewards = {
                    serve: 0,
                    spike: 0,
                    block: 0,
                    dig: 0,
                    set: 0,
                    reputation: 0,
                    mood: 0,
                    stress: 0
                };
                
                // å†³èµ›é˜¶æ®µï¼ˆç¬¬12å‘¨ï¼‰ä¸å†ç»™æŠ€èƒ½å¥–åŠ±ï¼Œå› ä¸ºæ¸¸æˆå³å°†ç»“æŸ
                // åªç»™å¿ƒæƒ…å’Œå£°æœ›å¥–åŠ±ä½œä¸ºè£èª‰
                const isFinalStage = roundInfo.id === 'final';
                
                if (won) {
                    if (!isFinalStage) {
                        // éå†³èµ›ï¼šæ ¹æ®è½®æ¬¡é€’å¢æŠ€èƒ½å¥–åŠ±
                        const baseReward = roundInfo.id === 'round16' ? 5 :
                                          roundInfo.id === 'round8' ? 7 :
                                          roundInfo.id === 'round4' ? 10 : 0;
                        
                        rewards.serve = rewards.spike = rewards.block = rewards.dig = rewards.set = baseReward;
                    }
                    
                    // æ‰€æœ‰è½®æ¬¡éƒ½ç»™å£°æœ›å’Œå¿ƒæƒ…å¥–åŠ±
                    const reputationBonus = isFinalStage ? 100 : // å†³èµ›å† å†›ï¼šå·¨é¢å£°æœ›
                                           roundInfo.id === 'round4' ? 50 :
                                           roundInfo.id === 'round8' ? 35 : 25;
                    
                    rewards.reputation = reputationBonus;
                    rewards.mood = isFinalStage ? 30 : 20; // å†³èµ›èƒœåˆ©å¿ƒæƒ…æ›´é«˜
                    rewards.stress = isFinalStage ? 5 : 10; // å†³èµ›åå‹åŠ›è¾ƒå°ï¼ˆå°˜åŸƒè½å®šï¼‰
                } else {
                    // å¤±è´¥ï¼šä¸ç»™æŠ€èƒ½å¥–åŠ±ï¼ˆå·²ç»æ˜¯æœ€åé˜¶æ®µï¼‰
                    rewards.reputation = isFinalStage ? 50 : 10; // å†³èµ›äºšå†›ä¹Ÿæœ‰ä¸é”™çš„å£°æœ›
                    rewards.mood = isFinalStage ? -10 : -15; // å†³èµ›å¤±è´¥æ²¡é‚£ä¹ˆæ²®ä¸§ï¼ˆå·²ç»å¾ˆæ£’äº†ï¼‰
                    rewards.stress = 15;
                }
                
                return rewards;
            }
            
            // è·å–é”¦æ ‡èµ›ç»“å±€
            getTournamentEnding() {
                const rank = this.tournament.finalRank;
                
                if (rank === 'top16') return 'early_exit';
                else if (rank === 'top8' || rank === 'top4') return 'participant';
                else if (rank === 'runner_up') return 'runner_up';
                else return 'champion';  // èµ¢å¾—å†³èµ›
            }
            
            // ====================================================
            // ç»“æŸé”¦æ ‡èµ›ç³»ç»Ÿ
            // ====================================================
            
            // ====================================================
            // ç»“å±€æ–‡æœ¬ç”Ÿæˆç³»ç»Ÿ
            // ====================================================
            
            // ç”ŸæˆåŠ¨æ€ç»“å±€æ–‡æœ¬
            generateEndingText(endingType) {
                const stats = this.playerStats;
                const player = this.player;
                
                // è®¡ç®—æŠ€èƒ½ç›¸å…³æ•°æ®
                const skills = player.skills;
                const skillValues = [skills.serve, skills.spike, skills.block, skills.dig, skills.set];
                const avgSkill = Math.round(skillValues.reduce((a, b) => a + b, 0) / 5);
                const maxSkill = Math.max(...skillValues);
                const minSkill = Math.min(...skillValues);
                const maxSkillName = ['å‘çƒ', 'æ‰£çƒ', 'æ‹¦ç½‘', 'å«çƒ', 'æ‰˜çƒ'][skillValues.indexOf(maxSkill)];
                
                // è®¡ç®—åˆå§‹å¹³å‡æŠ€èƒ½
                const initialSkillValues = Object.values(stats.initialSkills);
                const initialAvg = Math.round(initialSkillValues.reduce((a, b) => a + b, 0) / 5);
                const totalGrowth = avgSkill - initialAvg;
                
                // ç”Ÿæˆä¸»æ ‡é¢˜å’Œå‰¯æ ‡é¢˜
                let mainTitle = '';
                let subTitle = '';
                
                switch(endingType) {
                    case 'champion':
                        mainTitle = 'ğŸ† å† å†›ä¹‹è·¯';
                        break;
                    case 'runner_up':
                        mainTitle = 'ğŸ¥ˆ äºšå†›è£è€€';
                        break;
                    case 'participant':
                        mainTitle = 'ğŸ å‚ä¸è€…';
                        break;
                    case 'early_exit':
                        mainTitle = 'ğŸ“– æ–°çš„å¼€å§‹';
                        break;
                }
                
                // ç”Ÿæˆä¸ªæ€§åŒ–ç§°å·
                const titles = [];
                if (stats.totalTrainings >= 30) titles.push('è®­ç»ƒç‹‚äºº');
                else if (stats.totalTrainings >= 25) titles.push('åˆ»è‹¦ä¹‹æ˜Ÿ');
                else if (stats.totalTrainings < 10) titles.push('ä½›ç³»ç©å®¶');
                
                if (stats.totalMoneySpent >= 5000) titles.push('åœŸè±ªç©å®¶');
                else if (stats.equipmentPurchased >= 5) titles.push('è£…å¤‡å…š');
                else if (player.money >= 3000) titles.push('ç†è´¢é«˜æ‰‹');
                
                if (stats.casualMatchesPlayed >= 10 && stats.casualMatchesWon / stats.casualMatchesPlayed >= 0.7) {
                    titles.push('é‡çƒç‹è€…');
                }
                
                subTitle = titles.slice(0, 2).join(' Â· ') || 'æ’çƒæ–°æ˜Ÿ';
                
                // ç”Ÿæˆæ–‡æœ¬
                let text = `<h2>${mainTitle}</h2>`;
                text += `<p style="color: #ffd700; font-size: 18px; margin-bottom: 20px;">${subTitle}</p>`;
                
                // æ¯”èµ›å›é¡¾
                text += `<div style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">`;
                text += `<h3>ğŸ æ¯”èµ›å›é¡¾</h3>`;
                if (endingType === 'champion') {
                    text += `<p>æ ¡é™…è”èµ›å†³èµ›ï¼Œä½ ä»¬æˆ˜èƒœå¯¹æ‰‹ï¼Œå¤ºå¾—å† å†›ï¼</p>`;
                    text += `<p>ä»16å¼ºåˆ°å† å†›ï¼Œä½ è¿ç»­èµ¢å¾—4åœºæ¯”èµ›ï¼Œå±•ç°äº†å¼ºå¤§çš„å®åŠ›ã€‚</p>`;
                } else if (endingType === 'runner_up') {
                    text += `<p>æ ¡é™…è”èµ›å†³èµ›ï¼Œä½ ä»¬æ‹¼å°½å…¨åŠ›ï¼Œæœ€ç»ˆè·å¾—äºšå†›ã€‚</p>`;
                    text += `<p>è™½ç„¶æœ‰äº›é—æ†¾ï¼Œä½†ä½ ä»¬å·²ç»åˆ›é€ äº†å­¦æ ¡çš„æœ€å¥½æˆç»©ã€‚</p>`;
                } else if (endingType === 'participant') {
                    text += `<p>æ ¡é™…è”èµ›ä¸­ï¼Œä½ ä»¬æ­¢æ­¥äºå››å¼ºã€‚</p>`;
                    text += `<p>è™½ç„¶æ²¡èƒ½èµ°åˆ°æœ€åï¼Œä½†è¿™å·²ç»æ˜¯å¾ˆå¥½çš„æˆç»©äº†ã€‚</p>`;
                } else {
                    text += `<p>æ ¡é™…è”èµ›é¦–è½®ï¼Œä½ ä»¬é—æ†¾å‡ºå±€ã€‚</p>`;
                    text += `<p>è™½ç„¶ç»“æœä¸å°½å¦‚äººæ„ï¼Œä½†è¿™12å‘¨çš„ç»å†è®©ä½ æ”¶è·è‰¯å¤šã€‚</p>`;
                }
                text += `</div>`;
                
                // 12å‘¨çš„æ’çƒç”Ÿæ´»
                text += `<div style="margin: 20px 0;">`;
                text += `<h3 style="color: #ffd700;">ã€12å‘¨çš„æ’çƒç”Ÿæ´»ã€‘</h3>`;
                
                // è®­ç»ƒå†ç¨‹
                text += `<div style="margin: 15px 0; padding: 12px; background: rgba(255,255,255,0.03); border-left: 3px solid #3b82f6; border-radius: 5px;">`;
                text += `<p><strong>ğŸ“Š è®­ç»ƒå†ç¨‹</strong></p>`;
                text += `<p>â€¢ å…±è¿›è¡Œäº† ${stats.totalTrainings} æ¬¡è®­ç»ƒ</p>`;
                
                // æ‰¾å‡ºè®­ç»ƒæœ€å¤šçš„æŠ€èƒ½
                const trainingTypes = stats.trainingByType;
                const maxTrainingType = Object.keys(trainingTypes).reduce((a, b) => 
                    trainingTypes[a] > trainingTypes[b] ? a : b
                );
                const typeNames = {serve: 'å‘çƒ', spike: 'æ‰£çƒ', block: 'æ‹¦ç½‘', dig: 'å«çƒ', set: 'æ‰˜çƒ', composite: 'ç»„åˆ'};
                if (trainingTypes[maxTrainingType] > 0) {
                    text += `<p>â€¢ æœ€ä¸“æ³¨äº ${typeNames[maxTrainingType]} è®­ç»ƒï¼ˆ${trainingTypes[maxTrainingType]}æ¬¡ï¼‰</p>`;
                }
                
                if (player.position !== 'none') {
                    const posName = this.positions[player.position]?.name || 'æœªçŸ¥';
                    text += `<p>â€¢ é€‰æ‹©äº† ${posName} ä½œä¸ºä¸»è¦ä½ç½®</p>`;
                }
                
                // ç‰¹æ®Šè¯„ä»·
                if (stats.totalTrainings >= 30) {
                    text += `<p style="color: #fbbf24;">ä½ æ˜¯ä¸ªè®­ç»ƒç‹‚ï¼Œå‡ ä¹æ¯å‘¨éƒ½åœ¨çƒåœºä¸ŠæŒ¥æ±—å¦‚é›¨</p>`;
                } else if (stats.totalTrainings < 10) {
                    text += `<p style="color: #fbbf24;">ä½ ä¸æ˜¯ä¸ªè®­ç»ƒç‹‚ï¼Œæ›´æ³¨é‡äº«å—è¿‡ç¨‹</p>`;
                }
                text += `</div>`;
                
                // æ¯”èµ›ç»å†
                if (stats.casualMatchesPlayed > 0 || stats.formalMatchesPlayed > 0) {
                    text += `<div style="margin: 15px 0; padding: 12px; background: rgba(255,255,255,0.03); border-left: 3px solid #10b981; border-radius: 5px;">`;
                    text += `<p><strong>ğŸ æ¯”èµ›ç»å†</strong></p>`;
                    if (stats.casualMatchesPlayed > 0) {
                        const winRate = Math.round((stats.casualMatchesWon / stats.casualMatchesPlayed) * 100);
                        text += `<p>â€¢ å‚åŠ äº† ${stats.casualMatchesPlayed} åœºé‡çƒï¼Œèƒœç‡ ${winRate}%</p>`;
                        if (stats.casualMatchesPlayed >= 10 && winRate >= 70) {
                            text += `<p style="color: #fbbf24;">ä½ æ˜¯é‡çƒåœºçš„å¸¸å®¢ï¼Œåœ¨å®æˆ˜ä¸­å¿«é€Ÿæˆé•¿</p>`;
                        } else if (stats.casualMatchesPlayed < 3) {
                            text += `<p style="color: #fbbf24;">ä½ æ›´å–œæ¬¢æ­£å¼æ¯”èµ›çš„æ°›å›´ï¼Œå¾ˆå°‘æ‰“é‡çƒ</p>`;
                        }
                    }
                    if (stats.formalMatchesPlayed > 0) {
                        text += `<p>â€¢ æ­£å¼æ¯”èµ› ${stats.formalMatchesPlayed} åœºï¼Œ${stats.formalMatchesWon} èƒœ</p>`;
                    }
                    text += `</div>`;
                }
                
                // æ¶ˆè´¹è®°å½•
                if (stats.totalMoneySpent > 0) {
                    text += `<div style="margin: 15px 0; padding: 12px; background: rgba(255,255,255,0.03); border-left: 3px solid #f59e0b; border-radius: 5px;">`;
                    text += `<p><strong>ğŸ’° æ¶ˆè´¹è®°å½•</strong></p>`;
                    text += `<p>â€¢ æ€»æ¶ˆè´¹ï¼š${stats.totalMoneySpent} å…ƒ</p>`;
                    if (stats.equipmentPurchased > 0) text += `<p>â€¢ è´­ä¹°è£…å¤‡ï¼š${stats.equipmentPurchased} ä»¶</p>`;
                    if (stats.coachingPurchased > 0) text += `<p>â€¢ ç§æ•™è¯¾ç¨‹ï¼š${stats.coachingPurchased} æ¬¡</p>`;
                    if (stats.entertainmentSpent > 0) text += `<p>â€¢ å¨±ä¹æ¶ˆè´¹ï¼š${stats.entertainmentSpent} å…ƒ</p>`;
                    
                    if (stats.totalMoneySpent >= 5000) {
                        text += `<p style="color: #fbbf24;">ä½ èˆå¾—ä¸ºè‡ªå·±æŠ•èµ„ï¼Œè£…å¤‡å’Œç§æ•™ä¸€æ ·ä¸è½</p>`;
                    } else if (player.money >= 3000) {
                        text += `<p style="color: #fbbf24;">ä½ ç²¾æ‰“ç»†ç®—ï¼Œç»“æŸæ—¶è¿˜æœ‰ä¸å°‘ç§¯è“„ï¼ˆå‰©ä½™${player.money}å…ƒï¼‰</p>`;
                    }
                    text += `</div>`;
                }
                
                // è¯¾ä½™ç”Ÿæ´»
                const hasLifeActivities = stats.gamesPlayed > 0 || stats.moviesWatched > 0 || 
                                         stats.socialEvents > 0 || stats.restTaken > 0;
                if (hasLifeActivities) {
                    text += `<div style="margin: 15px 0; padding: 12px; background: rgba(255,255,255,0.03); border-left: 3px solid #ec4899; border-radius: 5px;">`;
                    text += `<p><strong>ğŸŒˆ è¯¾ä½™ç”Ÿæ´»</strong></p>`;
                    if (stats.gamesPlayed > 0) text += `<p>â€¢ ç©æ¸¸æˆ ${stats.gamesPlayed} æ¬¡</p>`;
                    if (stats.moviesWatched > 0) text += `<p>â€¢ çœ‹ç”µå½± ${stats.moviesWatched} æ¬¡</p>`;
                    if (stats.socialEvents > 0) text += `<p>â€¢ ç¤¾äº¤æ´»åŠ¨ ${stats.socialEvents} æ¬¡</p>`;
                    if (stats.restTaken > 0) text += `<p>â€¢ ä¼‘æ¯æ”¾æ¾ ${stats.restTaken} æ¬¡</p>`;
                    
                    // ç”Ÿæ´»æ–¹å¼è¯„ä»·
                    if (stats.gamesPlayed >= 8) {
                        text += `<p style="color: #fbbf24;">ä½ æ˜¯ä¸ªæ¸¸æˆçˆ±å¥½è€…ï¼Œç»å¸¸åœ¨æ¸¸æˆä¸­æ”¾æ¾</p>`;
                    } else if (stats.moviesWatched >= 6) {
                        text += `<p style="color: #fbbf24;">ä½ å–œæ¬¢æ–‡è‰ºæ´»åŠ¨ï¼Œç”µå½±é™¢æ˜¯å¸¸å»çš„åœ°æ–¹</p>`;
                    } else if (stats.socialEvents >= 8) {
                        text += `<p style="color: #fbbf24;">ä½ å¾ˆæ³¨é‡äººé™…å…³ç³»ï¼Œç»å¸¸å‚åŠ ç¤¾äº¤æ´»åŠ¨</p>`;
                    } else if (stats.restTaken >= 10) {
                        text += `<p style="color: #fbbf24;">ä½ æ‡‚å¾—ä¼‘æ¯çš„é‡è¦æ€§ï¼Œä»ä¸è®©è‡ªå·±è¿‡åº¦ç–²åŠ³</p>`;
                    } else if (stats.restTaken === 0 && stats.totalTrainings >= 25) {
                        text += `<p style="color: #fbbf24;">ä½ æ˜¯ä¸ªå·¥ä½œç‹‚ï¼Œå‡ ä¹æ²¡æœ‰ä¼‘æ¯æ—¶é—´</p>`;
                    } else if (hasLifeActivities) {
                        text += `<p style="color: #fbbf24;">ä½ æ‡‚å¾—åŠ³é€¸ç»“åˆï¼Œäº«å—å¤§å­¦ç”Ÿæ´»</p>`;
                    }
                    text += `</div>`;
                }
                
                // æŠ€èƒ½æˆé•¿
                text += `<div style="margin: 15px 0; padding: 12px; background: rgba(255,255,255,0.03); border-left: 3px solid #8b5cf6; border-radius: 5px;">`;
                text += `<p><strong>ğŸ“ˆ æŠ€èƒ½æˆé•¿</strong></p>`;
                text += `<p>â€¢ æœ€å¼ºæŠ€èƒ½ï¼š${maxSkillName}(${maxSkill})</p>`;
                text += `<p>â€¢ ä»å¹³å‡ ${initialAvg} æˆé•¿åˆ° ${avgSkill}</p>`;
                if (totalGrowth >= 60) {
                    text += `<p style="color: #fbbf24;">ä½ çš„æˆé•¿é€Ÿåº¦æƒŠäººï¼Œè¿›æ­¥é£å¿«ï¼</p>`;
                } else if (maxSkill - minSkill < 15) {
                    text += `<p style="color: #fbbf24;">ä½ è¿½æ±‚å…¨é¢å‘å±•ï¼Œå„é¡¹æŠ€èƒ½éƒ½å¾ˆå‡è¡¡</p>`;
                } else if (maxSkill >= 85) {
                    text += `<p style="color: #fbbf24;">ä½ çš„${maxSkillName}æŠ€æœ¯å‡ºç±»æ‹”èƒï¼Œæˆä¸ºäº†ä½ çš„æ‹›ç‰Œ</p>`;
                }
                text += `</div>`;
                
                text += `</div>`;
                
                // ç»“è¯­
                text += `<div style="margin: 20px 0; padding: 15px; background: rgba(255,215,0,0.1); border-radius: 10px;">`;
                if (endingType === 'champion') {
                    text += `<p><strong>ğŸ‰ å®Œç¾ç»“å±€ï¼šå† å†›ä¹‹æ˜Ÿ ğŸ‰</strong></p>`;
                    text += `<p>ä½ ç”¨æ±—æ°´å’ŒåŠªåŠ›é“¸å°±äº†å† å†›ä¹‹è·¯ã€‚çœé˜Ÿæ•™ç»ƒå·²ç»å‘ä½ å‘å‡ºé‚€è¯·ï¼Œæ›´å¤§çš„èˆå°åœ¨ç­‰ç€ä½ ...</p>`;
                } else if (endingType === 'runner_up') {
                    text += `<p><strong>ğŸŠ ä¼˜ç§€ç»“å±€ï¼šä¸å±ˆä¹‹å¿ƒ ğŸŠ</strong></p>`;
                    text += `<p>è™½ç„¶æ²¡èƒ½å¤ºå† ï¼Œä½†ä½ è¯æ˜äº†è‡ªå·±çš„å®åŠ›ã€‚å¤±è´¥è®©ä½ æ›´åŠ åšå¼ºï¼</p>`;
                } else if (endingType === 'participant') {
                    text += `<p><strong>ğŸˆ è‰¯å¥½ç»“å±€ï¼šæˆé•¿ä¹‹è·¯ ğŸˆ</strong></p>`;
                    text += `<p>è™½ç„¶æ²¡èƒ½èµ°åˆ°æœ€åï¼Œä½†ä½ æ”¶è·äº†æŠ€æœ¯ã€å‹è°Šå’Œæˆé•¿ã€‚æ’çƒä¹‹è·¯è¿˜å¾ˆé•¿ï¼</p>`;
                } else {
                    text += `<p><strong>ğŸŒ± æ™®é€šç»“å±€ï¼šåˆå¿ƒä¸æ”¹ ğŸŒ±</strong></p>`;
                    text += `<p>è™½ç„¶è¿™æ¬¡æ²¡èƒ½èµ°å¾—æ›´è¿œï¼Œä½†ä½ å·²ç»è¿ˆå‡ºäº†ç¬¬ä¸€æ­¥ã€‚ç»§ç»­åŠªåŠ›ï¼Œæ€»æœ‰ä¸€å¤©ä½ ä¼šç«™ä¸Šé¢†å¥–å°ï¼</p>`;
                }
                text += `<p><strong>æ„Ÿè°¢æ¸¸ç©ï¼</strong></p>`;
                text += `</div>`;
                
                return text;
            }
            
            // ====================================================
            // ç»“æŸç»“å±€æ–‡æœ¬ç”Ÿæˆç³»ç»Ÿ
            // ====================================================
            
            randomName() {
                const randomName = generateRandomName();
                const nameInput = document.getElementById('player-name-input');
                if (nameInput) {
                    nameInput.value = randomName;
                    // æ·»åŠ ä¸€ä¸ªå°åŠ¨ç”»æ•ˆæœ
                    nameInput.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        nameInput.style.transform = 'scale(1)';
                    }, 200);
                }
            }
            
            rerollAttributes() {
                if (this.rerollsRemaining <= 0) {
                    return;
                }
                
                this.rerollsRemaining--;
                this.rollAttributes();
                this.updateInitialSkillsDisplay();
                
                // æ›´æ–°å‘¨å¼€å§‹æ•°æ®å¿«ç…§ï¼ˆå› ä¸ºé‡æ–°éšæœºäº†åˆå§‹å€¼ï¼‰
                this.player.weekStartStats = {
                    serve: this.player.skills.serve,
                    spike: this.player.skills.spike,
                    block: this.player.skills.block,
                    dig: this.player.skills.dig,
                    set: this.player.skills.set,
                    maxEnergy: this.player.maxEnergy
                };
                
                // æ›´æ–°å‰©ä½™æ¬¡æ•°æ˜¾ç¤º
                const rerollCount = document.getElementById('reroll-count');
                const rerollBtn = document.getElementById('reroll-btn');
                if (rerollCount) {
                    rerollCount.textContent = `å‰©ä½™æ¬¡æ•°ï¼š${this.rerollsRemaining}/5`;
                }
                if (rerollBtn && this.rerollsRemaining <= 0) {
                    rerollBtn.disabled = true;
                    rerollBtn.textContent = 'å·²ç”¨å®Œ';
                }
            }
            
            updateInitialSkillsDisplay() {
                document.getElementById('init-serve').textContent = this.player.skills.serve;
                document.getElementById('init-spike').textContent = this.player.skills.spike;
                document.getElementById('init-block').textContent = this.player.skills.block;
                document.getElementById('init-dig').textContent = this.player.skills.dig;
                document.getElementById('init-set').textContent = this.player.skills.set;
                document.getElementById('init-energy').textContent = this.player.maxEnergy;
                document.getElementById('init-money').textContent = this.player.money;
            }
            
            submitName() {
                const nameInput = document.getElementById('player-name-input');
                const name = nameInput.value.trim();
                
                if (name === '') {
                    alert('è¯·è¾“å…¥ä½ çš„åå­—ï¼');
                    return;
                }
                
                this.player.name = name;
                this.rollAttributes();
                
                // æµ‹è¯•æ¨¡å¼ä¸‹éšè—é‡æ–°éšæœºæŒ‰é’®
                if (TEST_MODE) {
                    const rerollContainer = document.getElementById('reroll-container');
                    if (rerollContainer) {
                        rerollContainer.style.display = 'none';
                    }
                    console.log('æµ‹è¯•æ¨¡å¼å·²å¯ç”¨ï¼Œåˆå§‹æŠ€èƒ½:', this.player.skills);
                }
                
                // åˆå§‹åŒ–å‘¨å¼€å§‹æ•°æ®å¿«ç…§
                this.player.weekStartStats = {
                    serve: this.player.skills.serve,
                    spike: this.player.skills.spike,
                    block: this.player.skills.block,
                    dig: this.player.skills.dig,
                    set: this.player.skills.set,
                    maxEnergy: this.player.maxEnergy
                };
                
                // æ˜¾ç¤ºèƒ½åŠ›é¢æ¿å’Œæ¸¸æˆå¤´éƒ¨
                document.getElementById('character-panel').classList.add('show');
                document.getElementById('game-header').classList.add('show');
                
                // ç›´æ¥è¿›å…¥æ¸¸æˆå¼€å§‹åœºæ™¯
                this.currentScene = 'start';
                this.showScene('start');
            }
            
            rollAttributes() {
                // æµ‹è¯•æ¨¡å¼ä¸‹è·³è¿‡éšæœºç”Ÿæˆ
                if (TEST_MODE) {
                    console.log('æµ‹è¯•æ¨¡å¼ï¼šè·³è¿‡éšæœºå±æ€§ç”Ÿæˆ');
                    this.updateUI();
                    this.updateInitialSkillsDisplay();
                    return;
                }
                
                // ä½¿ç”¨æ›´å¹³è¡¡çš„éšæœºç®—æ³•
                // æ€»ç‚¹æ•°å›ºå®šåœ¨20-25ä¹‹é—´ï¼Œç„¶ååˆ†é…åˆ°5ä¸ªæŠ€èƒ½
                const totalPoints = Math.floor(Math.random() * 6) + 20; // 20-25ç‚¹
                let remainingPoints = totalPoints;
                const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                
                // å…ˆç»™æ¯ä¸ªæŠ€èƒ½åˆ†é…æœ€å°‘1ç‚¹
                skills.forEach(skill => {
                    this.player.skills[skill] = 1;
                    remainingPoints -= 1;
                });
                
                // éšæœºåˆ†é…å‰©ä½™ç‚¹æ•°
                while (remainingPoints > 0) {
                    const randomSkill = skills[Math.floor(Math.random() * skills.length)];
                    if (this.player.skills[randomSkill] < 8) { // å•é¡¹æœ€é«˜8
                        this.player.skills[randomSkill]++;
                        remainingPoints--;
                    }
                }
                
                // éšæœºç”Ÿæˆä½“åŠ›ä¸Šé™ï¼ŒèŒƒå›´åœ¨85-105ä¹‹é—´ï¼ˆæ›´é›†ä¸­ï¼‰
                this.player.maxEnergy = Math.floor(Math.random() * 21) + 85;
                this.player.energy = this.player.maxEnergy;
                
                // éšæœºç”Ÿæˆåˆå§‹é‡‘é’±ï¼ŒèŒƒå›´åœ¨400-600ä¹‹é—´
                this.player.money = Math.floor(Math.random() * 201) + 400;
                
                this.updateUI();
                this.updateInitialSkillsDisplay();
            }
            
            updateWeeklyHub() {
                const canTrain = this.player.trainingCount < this.player.maxTrainingPerWeek;
                const trainingText = canTrain ? 
                    `æœ¬å‘¨è¿˜å¯ä»¥è®­ç»ƒ ${this.player.maxTrainingPerWeek - this.player.trainingCount} æ¬¡` :
                    `æœ¬å‘¨è®­ç»ƒæ¬¡æ•°å·²ç”¨å®Œ`;
                
                let statusText = '';
                if (this.player.energy < 30) statusText += '<p style="color: #e74c3c;">âš ï¸ ä½“åŠ›ä¸è¶³ï¼Œéœ€è¦ä¼‘æ¯ï¼</p>';
                if (this.player.mood < 40) statusText += '<p style="color: #e67e22;">âš ï¸ å¿ƒæƒ…ä½è½ï¼Œå»ºè®®æ”¾æ¾ä¸€ä¸‹</p>';
                if (this.player.stress > 70) statusText += '<p style="color: #e74c3c;">âš ï¸ å‹åŠ›è¿‡å¤§ï¼Œå°å¿ƒå½±å“è¡¨ç°ï¼</p>';
                
                // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾ç›®æ ‡å‘¨
                const goalInfo = this.getGoalInfo();
                let goalNotice = '';
                
                if (goalInfo.deadline && this.player.week >= goalInfo.deadline) {
                    goalNotice = '<p style="color: #2ecc71; font-weight: bold;">âœ¨ é€‰æ‹”/æ¯”èµ›æ—¶é—´å·²åˆ°ï¼</p>';
                }
                
                SCENES.weeklyHub.text = `<h2>ğŸ“… ç¬¬ ${this.player.week} å‘¨</h2>
                <p>${trainingText}</p>
                ${statusText}
                ${goalNotice}
                <p style="margin-top: 15px;">ä½ æƒ³åšä»€ä¹ˆï¼Ÿ</p>`;
                
                // æ ¹æ®é˜Ÿä¼çŠ¶æ€å†³å®šè®­ç»ƒåœºæ™¯
                let trainingScene = 'trainingChoice'; // é»˜è®¤åŸºç¡€è®­ç»ƒ
                if (this.player.team === 'university') {
                    trainingScene = 'universityTeam';
                } else if (this.player.team === 'college') {
                    trainingScene = 'collegeTeam';
                }
                
                SCENES.weeklyHub.choices = [
                    {
                        text: 'ğŸ‹ï¸ è¿›è¡Œè®­ç»ƒ',
                        next: trainingScene,
                        requirement: { trainingCount: this.player.maxTrainingPerWeek - 1, maxCheck: true }
                    },
                    {
                        text: 'ğŸ›’ å•†åº—',
                        next: 'shopMain'
                    },
                    {
                        text: 'â­ï¸ ç»“æŸæœ¬å‘¨',
                        next: 'weekEnd'
                    }
                ];
                
                // å¦‚æœå·²åŠ å…¥é˜Ÿä¼ä½†è¿˜æ²¡é€‰æ‹©ä½ç½®ï¼Œæ·»åŠ ä½ç½®é€‰æ‹©å…¥å£
                if ((this.player.team === 'college' || this.player.team === 'university') && this.player.position === 'none') {
                    SCENES.weeklyHub.choices.splice(SCENES.weeklyHub.choices.length - 1, 0, {
                        text: 'ğŸ¯ é€‰æ‹©åœºä¸Šä½ç½®',
                        next: 'positionSelection'
                    });
                }
                
                // å¦‚æœæœ‰è¶³å¤Ÿçš„æŠ€èƒ½ï¼Œæ·»åŠ é€‰æ‹”é€‰é¡¹ï¼ˆåªä¿ç•™é€‰æ‹”ï¼Œä¸åŒ…æ‹¬æ¯”èµ›ï¼‰
                // æ ¹æ®å½“å‰ç›®æ ‡å’Œå‘¨æ•°æ·»åŠ é€‰æ‹”é€‰é¡¹
                if (this.currentGoal === 'collegeTryout' && this.player.week >= 2 && this.player.team === 'none') {
                    // ä½¿ç”¨æ–°çš„è¯„ä¼°ç³»ç»Ÿæ£€æŸ¥æ˜¯å¦æ»¡è¶³æ¡ä»¶
                    const goalInfo = this.getGoalInfo();
                    const evaluation = this.evaluateGoal(goalInfo);
                    const canTryout = evaluation.score >= 0.7; // 70%å³å¯å‚åŠ 
                    
                    SCENES.weeklyHub.choices.splice(SCENES.weeklyHub.choices.length - 1, 0, {
                        text: 'ğŸ† å‚åŠ é™¢é˜Ÿé€‰æ‹”',
                        next: 'collegeTryout',
                        requirement: canTryout ? {} : { serve: 999 } // å¦‚æœæ»¡è¶³æ¡ä»¶åˆ™æ— è¦æ±‚ï¼Œå¦åˆ™è®¾ç½®ä¸å¯èƒ½è¾¾åˆ°çš„è¦æ±‚
                    });
                } else if (this.currentGoal === 'universityTryout' && this.player.week >= 8 && this.player.team === 'college') {
                    const goalInfo = this.getGoalInfo();
                    const evaluation = this.evaluateGoal(goalInfo);
                    const canTryout = evaluation.score >= 0.7;
                    
                    SCENES.weeklyHub.choices.splice(SCENES.weeklyHub.choices.length - 1, 0, {
                        text: 'â­ ç”³è¯·æ ¡é˜Ÿé€‰æ‹”',
                        next: 'universityTryout',
                        requirement: canTryout ? {} : { serve: 999 }
                    });
                }
                
                // æ¯”èµ›ä¼šåœ¨å›ºå®šå‘¨æ•°è‡ªåŠ¨è§¦å‘ï¼Œä¸éœ€è¦æŒ‰é’®
            }
            
            triggerRandomEvent(eventType) {
                // 30% æ¦‚ç‡è§¦å‘äº‹ä»¶
                if (Math.random() > 0.3) {
                    return null;
                }
                
                // ç­›é€‰ç¬¦åˆç±»å‹çš„äº‹ä»¶
                let availableEvents = RANDOM_EVENTS.filter(e => e.type === eventType);
                if (availableEvents.length === 0) return null;
                
                // æ ¹æ®æ¡ä»¶å’Œæƒé‡è®¡ç®—æ¯ä¸ªäº‹ä»¶çš„è§¦å‘æ¦‚ç‡
                const weightedEvents = [];
                availableEvents.forEach(event => {
                    let weight = 1; // é»˜è®¤æƒé‡
                    
                    // æ£€æŸ¥æ˜¯å¦æ»¡è¶³æ¡ä»¶
                    if (event.condition) {
                        const { operator } = event.condition;
                        let conditionMet = false;
                        
                        // æ”¯æŒå¤šå±æ€§æ¡ä»¶æ£€æŸ¥
                        if (operator === '<') {
                            // å°äºæ¡ä»¶ï¼ˆå¦‚ä½“åŠ›<30ï¼‰
                            for (let key in event.condition) {
                                if (key !== 'operator' && this.player[key] !== undefined) {
                                    if (this.player[key] < event.condition[key]) {
                                        conditionMet = true;
                                        break;
                                    }
                                }
                            }
                        } else if (operator === '>') {
                            // å¤§äºæ¡ä»¶ï¼ˆå¦‚å£°æœ›>50ï¼‰
                            let allMet = true;
                            for (let key in event.condition) {
                                if (key !== 'operator' && this.player[key] !== undefined) {
                                    if (this.player[key] <= event.condition[key]) {
                                        allMet = false;
                                        break;
                                    }
                                }
                                // æ£€æŸ¥æŠ€èƒ½
                                if (key !== 'operator' && this.player.skills && this.player.skills[key] !== undefined) {
                                    if (this.player.skills[key] <= event.condition[key]) {
                                        allMet = false;
                                        break;
                                    }
                                }
                            }
                            conditionMet = allMet;
                        }
                        
                        // å¦‚æœæ¡ä»¶æ»¡è¶³ï¼Œåº”ç”¨æƒé‡åŠ æˆ
                        if (conditionMet && event.weight) {
                            weight = event.weight;
                        } else if (!conditionMet && event.weight) {
                            // æ¡ä»¶ä¸æ»¡è¶³ä½†æœ‰æ¡ä»¶é™åˆ¶çš„äº‹ä»¶ï¼Œé™ä½æƒé‡
                            weight = 0.3;
                        }
                    }
                    
                    // å°†äº‹ä»¶æŒ‰æƒé‡æ·»åŠ åˆ°åˆ—è¡¨ä¸­
                    for (let i = 0; i < weight; i++) {
                        weightedEvents.push(event);
                    }
                });
                
                if (weightedEvents.length === 0) return null;
                
                // ä»åŠ æƒåˆ—è¡¨ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªäº‹ä»¶
                const event = weightedEvents[Math.floor(Math.random() * weightedEvents.length)];
                return event;
            }
            
            showRandomEvent(event) {
                this.currentEvent = event;
                this.currentEventType = event.type; // è®°å½•äº‹ä»¶ç±»å‹
                
                // ä½¿ç”¨å¼¹çª—æ˜¾ç¤ºäº‹ä»¶
                const modal = document.getElementById('event-modal');
                const title = document.getElementById('event-modal-title');
                const text = document.getElementById('event-modal-text');
                const choicesDiv = document.getElementById('event-modal-choices');
                
                title.textContent = event.title;
                text.textContent = event.text;
                choicesDiv.innerHTML = '';
                
                event.choices.forEach(choice => {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    button.textContent = choice.text;
                    
                    if (choice.requirement) {
                        const meetsRequirement = this.checkRequirement(choice.requirement);
                        if (!meetsRequirement) {
                            button.disabled = true;
                            button.textContent += ' (æ¡ä»¶ä¸è¶³)';
                        }
                    }
                    
                    button.onclick = () => {
                        // åº”ç”¨æ•ˆæœ
                        if (choice.effect) {
                            this.applyEffect(choice.effect);
                        }
                        
                        // åœ¨å¼¹çª—ä¸­æ˜¾ç¤ºç»“æœ
                        title.textContent = 'âœ¨ ç»“æœ';
                        text.innerHTML = this.formatEventResult(choice.result, choice.effect);
                        choicesDiv.innerHTML = '';
                        
                        const continueBtn = document.createElement('button');
                        continueBtn.className = 'choice-btn';
                        continueBtn.textContent = 'ç»§ç»­';
                        continueBtn.onclick = () => {
                            modal.classList.remove('show');
                            
                            // æ ¹æ®äº‹ä»¶ç±»å‹å†³å®šä¸‹ä¸€æ­¥
                            if (this.currentEventType === 'training') {
                                // è®­ç»ƒäº‹ä»¶åè¿›å…¥è¯¾ä½™ç”Ÿæ´»
                                this.currentScene = 'lifeChoice';
                                this.showScene('lifeChoice');
                            } else {
                                // ç”Ÿæ´»äº‹ä»¶åè¿”å›å‘¨é€‰æ‹©
                                this.currentScene = 'weeklyHub';
                                this.showScene('weeklyHub');
                            }
                        };
                        choicesDiv.appendChild(continueBtn);
                    };
                    
                    choicesDiv.appendChild(button);
                });
                
                // æ˜¾ç¤ºå¼¹çª—
                modal.classList.add('show');
            }
            
            formatEventResult(result, effect) {
                let html = `<p>${result}</p>`;
                
                // æ„å»ºå±æ€§å˜åŒ–æ˜¾ç¤º
                let changesText = '<br><strong>å±æ€§å˜åŒ–ï¼š</strong><br>';
                let hasChanges = false;
                
                if (effect.serve) {
                    changesText += `ğŸ¯ å‘çƒ ${effect.serve > 0 ? '+' : ''}${effect.serve}<br>`;
                    hasChanges = true;
                }
                if (effect.spike) {
                    changesText += `âš¡ æ‰£çƒ ${effect.spike > 0 ? '+' : ''}${effect.spike}<br>`;
                    hasChanges = true;
                }
                if (effect.block) {
                    changesText += `ğŸ›¡ï¸ æ‹¦ç½‘ ${effect.block > 0 ? '+' : ''}${effect.block}<br>`;
                    hasChanges = true;
                }
                if (effect.dig) {
                    changesText += `ğŸ¤¸ å«çƒ ${effect.dig > 0 ? '+' : ''}${effect.dig}<br>`;
                    hasChanges = true;
                }
                if (effect.set) {
                    changesText += `ğŸ™Œ æ‰˜çƒ ${effect.set > 0 ? '+' : ''}${effect.set}<br>`;
                    hasChanges = true;
                }
                if (effect.energy) {
                    changesText += `ğŸ’ª ä½“åŠ› ${effect.energy > 0 ? '+' : ''}${effect.energy}<br>`;
                    hasChanges = true;
                }
                if (effect.mood) {
                    changesText += `ğŸ˜Š å¿ƒæƒ… ${effect.mood > 0 ? '+' : ''}${effect.mood}<br>`;
                    hasChanges = true;
                }
                if (effect.stress) {
                    changesText += `ğŸ˜° å‹åŠ› ${effect.stress > 0 ? '+' : ''}${effect.stress}<br>`;
                    hasChanges = true;
                }
                if (effect.reputation) {
                    changesText += `â­ å£°æœ› ${effect.reputation > 0 ? '+' : ''}${effect.reputation}<br>`;
                    hasChanges = true;
                }
                if (effect.money) {
                    changesText += `ğŸ’° é‡‘é’± ${effect.money > 0 ? '+' : ''}${effect.money}<br>`;
                    hasChanges = true;
                }
                if (effect.relationship) {
                    changesText += `ğŸ‘¥ é˜Ÿå‹å…³ç³» ${effect.relationship > 0 ? '+' : ''}${effect.relationship}<br>`;
                    hasChanges = true;
                }
                
                if (hasChanges) {
                    html += changesText;
                }
                
                return html;
            }
            
            nextWeek() {
                // ä¿å­˜æœ¬å‘¨å¼€å§‹æ—¶çš„æ•°æ®å¿«ç…§
                this.player.weekStartStats = {
                    serve: this.player.skills.serve,
                    spike: this.player.skills.spike,
                    block: this.player.skills.block,
                    dig: this.player.skills.dig,
                    set: this.player.skills.set,
                    maxEnergy: this.player.maxEnergy
                };
                
                this.player.week++;
                this.player.trainingCount = 0;
                this.player.money += 500; // æ¯å‘¨é›¶èŠ±é’±ï¼ˆä»350æ”¹ä¸º500ï¼‰
                
                // è‡ªç„¶æ¢å¤
                this.player.energy = Math.min(this.player.maxEnergy, this.player.energy + 30);
                this.player.mood = Math.min(100, this.player.mood + 10);
                this.player.stress = Math.max(0, this.player.stress - 10);
                
                // æ°¸ä¹…ç‰©å“çš„æŒç»­æ•ˆæœ
                if (this.player.ownedItems) {
                    // è¿åŠ¨æ‰‹ç¯ï¼šæ¯å‘¨è‡ªåŠ¨æ¢å¤å‹åŠ›-5
                    if (this.player.ownedItems.electronics && this.player.ownedItems.electronics.includes('watch')) {
                        this.player.stress = Math.max(0, this.player.stress - 5);
                    }
                    // æ–°æ‰‹æœºï¼šæ¯å‘¨å¿ƒæƒ…+3
                    if (this.player.ownedItems.electronics && this.player.ownedItems.electronics.includes('phone')) {
                        this.player.mood = Math.min(100, this.player.mood + 3);
                    }
                }
                
                // å¤„ç†buffï¼ˆå‡å°‘æŒç»­å‘¨æ•°ï¼‰
                if (this.player.activeBuffs) {
                    this.player.activeBuffs = this.player.activeBuffs.filter(buff => {
                        buff.remainingWeeks--;
                        // è¥å…»é¤è®¡åˆ’ï¼šä½“åŠ›ä¸Šé™åŠ æˆ
                        if (buff.id === 'nutrition_plan' && buff.effect.maxEnergyBonus) {
                            if (buff.remainingWeeks === 0) {
                                // buffç»“æŸï¼Œç§»é™¤ä½“åŠ›ä¸Šé™åŠ æˆ
                                this.player.maxEnergy -= buff.effect.maxEnergyBonus;
                            }
                        }
                        return buff.remainingWeeks > 0;
                    });
                }
                
                // æ¯å‘¨å¥–åŠ±å°‘é‡è®­ç»ƒç‚¹æ•°ï¼ˆä¿æŒè‰¯å¥½çŠ¶æ€ï¼‰
                if (this.player.energy >= 50 && this.player.mood >= 60) {
                    this.player.trainingPoints += 5;
                }
                
                this.updateUI();
                
                console.log(`ç¬¬${this.player.week}å‘¨å¼€å§‹ï¼Œå½“å‰é˜Ÿä¼: ${this.player.team}`);
                
                // æ–°å¢ï¼šæ£€æŸ¥æ˜¯å¦æœ‰å›ºå®šæ¯”èµ›
                const matchEvent = this.checkScheduledMatch();
                console.log('æ¯”èµ›æ£€æŸ¥ç»“æœ:', matchEvent);
                
                if (matchEvent) {
                    // æ˜¾ç¤ºæ¯”èµ›é¢„å‘Šåœºæ™¯æˆ–å¯åŠ¨é”¦æ ‡èµ›
                    if (matchEvent.type === 'match') {
                        console.log('è§¦å‘æ¯”èµ›é¢„å‘Š:', matchEvent.matchName);
                        this.showMatchPreview(matchEvent.matchType, matchEvent.matchName);
                    } else if (matchEvent.type === 'tournament') {
                        console.log('è§¦å‘é”¦æ ‡èµ›:', matchEvent.tournamentType);
                        this.startTournament(matchEvent.tournamentType);
                    } else if (matchEvent.type === 'spectator') {
                        this.showScene(matchEvent.sceneId);
                    } else if (matchEvent.type === 'missed') {
                        this.showScene(matchEvent.sceneId);
                    }
                    return;
                }
                
                // æ£€æŸ¥å½“å‰ç›®æ ‡æ˜¯å¦åˆ°è¾¾æˆªæ­¢æ—¥æœŸï¼ˆé€‰æ‹”ç±»ï¼‰
                const currentGoalInfo = this.getGoalInfo();
                if (currentGoalInfo && currentGoalInfo.deadline && this.player.week >= currentGoalInfo.deadline) {
                    // é€‰æ‹”ç±»ç›®æ ‡ï¼ˆTryoutï¼‰ä¸è‡ªåŠ¨æ£€æŸ¥ï¼Œéœ€è¦ç©å®¶ä¸»åŠ¨è§¦å‘
                    // åªæœ‰æ¯”èµ›ç±»ç›®æ ‡æ‰è‡ªåŠ¨æ£€æŸ¥ï¼ˆä½†ç°åœ¨æ¯”èµ›ä¸æ˜¯ç›®æ ‡äº†ï¼Œæ‰€ä»¥è¿™æ®µä»£ç å®é™…ä¸Šä¸ä¼šæ‰§è¡Œï¼‰
                    if (currentGoalInfo.id && !currentGoalInfo.id.includes('Tryout')) {
                        // åˆ°è¾¾æˆªæ­¢æ—¥æœŸï¼Œæ£€æŸ¥ç›®æ ‡å®Œæˆæƒ…å†µ
                        this.checkGoalCompletion();
                        return;
                    }
                }
                
                // å¦‚æœæ²¡æœ‰è§¦å‘ä»»ä½•ç‰¹æ®Šäº‹ä»¶ï¼Œæ˜¾ç¤ºå‘¨ä¸»ç•Œé¢
                this.showScene('weeklyHub');
            }
            
            // æ–°å¢ï¼šæ£€æŸ¥å›ºå®šæ¯”èµ›
            checkScheduledMatch() {
                console.log(`æ£€æŸ¥ç¬¬${this.player.week}å‘¨æ˜¯å¦æœ‰æ¯”èµ›...`);
                
                // é™¢é™…æ¯”èµ›ï¼šç¬¬5å‘¨
                if (this.player.week === 5) {
                    console.log('ç¬¬5å‘¨æ£€æŸ¥: é˜Ÿä¼çŠ¶æ€ =', this.player.team);
                    if (this.player.team === 'college') {
                        console.log('âœ“ å·²åŠ å…¥é™¢é˜Ÿï¼Œè§¦å‘é™¢é™…æ¯”èµ›');
                        return { 
                            type: 'match', 
                            matchType: 'collegeMatch',
                            matchName: 'é™¢é™…æ¯”èµ›'
                        };
                    } else {
                        console.log('âœ— æœªåŠ å…¥é™¢é˜Ÿï¼Œè·³è¿‡æ¯”èµ›');
                        // æœªåŠ å…¥é™¢é˜Ÿï¼Œè·³è¿‡æ¯”èµ›ï¼ˆé˜¶æ®µ4å°†æ·»åŠ è§‚æˆ˜åœºæ™¯ï¼‰
                        return null;
                    }
                }
                
                // æ ¡é™…è”èµ›ï¼šç¬¬12å‘¨ï¼ˆæ¸¸æˆç»“æŸï¼‰
                if (this.player.week === 12) {
                    console.log('ç¬¬12å‘¨æ£€æŸ¥: é˜Ÿä¼çŠ¶æ€ =', this.player.team);
                    if (this.player.team === 'university') {
                        console.log('âœ“ å·²åŠ å…¥æ ¡é˜Ÿï¼Œè§¦å‘æ ¡é™…è”èµ›é”¦æ ‡èµ›');
                        return { 
                            type: 'tournament',  // æ”¹ä¸ºé”¦æ ‡èµ›ç±»å‹
                            tournamentType: 'universityLeague'
                        };
                    } else {
                        console.log('âœ— æœªåŠ å…¥æ ¡é˜Ÿï¼Œè·³è¿‡æ¯”èµ›');
                        // æœªåŠ å…¥æ ¡é˜Ÿï¼Œè·³è¿‡æ¯”èµ›ï¼ˆé˜¶æ®µ4å°†æ·»åŠ è§‚æˆ˜åœºæ™¯ï¼‰
                        return null;
                    }
                }
                
                return null;
            }
            
            // æ–°å¢ï¼šæ˜¾ç¤ºæ¯”èµ›é¢„å‘Š
            showMatchPreview(matchType, matchName) {
                let previewText = '';
                let matchInfo = '';
                
                if (matchType === 'collegeMatch') {
                    matchInfo = `
                        <h2>ğŸ ${matchName}</h2>
                        <p>æœ¬å‘¨æœ«å°†ä¸¾è¡Œé™¢é™…æ’çƒæ¯”èµ›ï¼</p>
                        <p>ä½œä¸ºé™¢é˜Ÿçš„ä¸€å‘˜ï¼Œä½ å°†ä»£è¡¨å­¦é™¢å‡ºæˆ˜ã€‚</p>
                        <p><strong>æ¯”èµ›è§„åˆ™ï¼š</strong>ä¸‰å±€ä¸¤èƒœåˆ¶ï¼Œæ¯å±€25åˆ†ï¼ˆå†³èƒœå±€15åˆ†ï¼‰</p>
                        <p><strong>å¯¹æ‰‹å®åŠ›ï¼š</strong>ä¸ä½ ä»¬æ°´å¹³ç›¸å½“çš„å…¶ä»–å­¦é™¢é˜Ÿä¼</p>
                        <p>è¿™æ˜¯ä½ è¯æ˜è‡ªå·±çš„å¥½æœºä¼šï¼ŒåŠ æ²¹ï¼</p>
                    `;
                } else if (matchType === 'universityLeague') {
                    matchInfo = `
                        <h2>ğŸ ${matchName}</h2>
                        <p>æœ¬å‘¨æœ«å°†ä¸¾è¡Œæ ¡é™…æ’çƒè”èµ›ï¼</p>
                        <p>ä½œä¸ºæ ¡é˜Ÿçš„ä¸»åŠ›ï¼Œä½ å°†ä»£è¡¨å­¦æ ¡ä¸å…¶ä»–é«˜æ ¡å¯¹å†³ã€‚</p>
                        <p><strong>æ¯”èµ›è§„åˆ™ï¼š</strong>ä¸‰å±€ä¸¤èƒœåˆ¶ï¼Œæ¯å±€25åˆ†ï¼ˆå†³èƒœå±€15åˆ†ï¼‰</p>
                        <p><strong>å¯¹æ‰‹å®åŠ›ï¼š</strong>å…¶ä»–é«˜æ ¡çš„ç²¾è‹±é€‰æ‰‹</p>
                        <p>è¿™æ˜¯å±•ç°ä½ å®åŠ›çš„èˆå°ï¼Œå…¨åŠ›ä»¥èµ´ï¼</p>
                    `;
                } else if (matchType === 'cityLeague') {
                    matchInfo = `
                        <h2>ğŸ ${matchName}</h2>
                        <p>æœ¬å‘¨æœ«å°†ä¸¾è¡Œå¸‚çº§æ’çƒè”èµ›ï¼</p>
                        <p>è¿™æ˜¯æœ¬èµ›å­£æœ€é‡è¦çš„æ¯”èµ›ï¼Œä½ å°†é¢å¯¹å…¨å¸‚æœ€å¼ºçš„é˜Ÿä¼ã€‚</p>
                        <p><strong>æ¯”èµ›è§„åˆ™ï¼š</strong>ä¸‰å±€ä¸¤èƒœåˆ¶ï¼Œæ¯å±€25åˆ†ï¼ˆå†³èƒœå±€15åˆ†ï¼‰</p>
                        <p><strong>å¯¹æ‰‹å®åŠ›ï¼š</strong>å¸‚çº§é¡¶å°–é€‰æ‰‹</p>
                        <p>è¿™æ˜¯ä½ çš„å·…å³°ä¹‹æˆ˜ï¼Œè¯æ˜ä½ çš„ä»·å€¼ï¼</p>
                    `;
                }
                
                // åˆ›å»ºé¢„å‘Šåœºæ™¯
                SCENES.matchPreview = {
                    text: matchInfo,
                    choices: [{
                        text: 'å¼€å§‹æ¯”èµ›',
                        effect: { 
                            startFormalMatch: { 
                                matchType: matchType, 
                                matchName: matchName 
                            } 
                        }
                    }]
                };
                
                this.showScene('matchPreview');
            }
            
            generateWeeklySummary() {
                const scene = SCENES.weekEnd;
                
                // è®¡ç®—æŠ€èƒ½å˜åŒ–
                const changes = {
                    serve: this.player.skills.serve - this.player.weekStartStats.serve,
                    spike: this.player.skills.spike - this.player.weekStartStats.spike,
                    block: this.player.skills.block - this.player.weekStartStats.block,
                    dig: this.player.skills.dig - this.player.weekStartStats.dig,
                    set: this.player.skills.set - this.player.weekStartStats.set,
                    maxEnergy: this.player.maxEnergy - this.player.weekStartStats.maxEnergy
                };
                
                // è·å–å½“å‰é˜¶æ®µ
                const teamNames = {
                    'none': 'åŸºç¡€è®­ç»ƒ',
                    'college': 'é™¢é˜Ÿ',
                    'university': 'æ ¡é˜Ÿ'
                };
                const currentStage = teamNames[this.player.team];
                
                // ç”ŸæˆæŠ€èƒ½å˜åŒ–HTMLï¼ˆç´§å‡‘ç‰ˆï¼‰
                let skillChangesHTML = '<div style="background: #f8fafc; padding: 8px; border-radius: 6px; margin: 8px 0; font-size: 14px;">';
                skillChangesHTML += '<strong>æœ¬å‘¨æˆé•¿</strong><br>';
                
                const skillIcons = {
                    serve: 'ğŸ¯',
                    spike: 'âš¡',
                    block: 'ğŸ›¡ï¸',
                    dig: 'ğŸ',
                    set: 'ğŸ¤²'
                };
                
                const skillNames = {
                    serve: 'å‘çƒ',
                    spike: 'æ‰£çƒ',
                    block: 'æ‹¦ç½‘',
                    dig: 'å«çƒ',
                    set: 'æ‰˜çƒ'
                };
                
                for (let skill in skillIcons) {
                    const change = changes[skill];
                    const icon = skillIcons[skill];
                    const name = skillNames[skill];
                    const newVal = this.player.skills[skill];
                    
                    if (change > 0) {
                        skillChangesHTML += `<span style="color: #22c55e;">${icon}${name} ${newVal}(+${change})</span> `;
                    } else if (change === 0) {
                        skillChangesHTML += `<span style="color: #9ca3af;">${icon}${name} ${newVal}</span> `;
                    } else {
                        skillChangesHTML += `<span style="color: #ef4444;">${icon}${name} ${newVal}(${change})</span> `;
                    }
                }
                
                if (changes.maxEnergy > 0) {
                    skillChangesHTML += `<br><span style="color: #22c55e;">ğŸ’ªä½“åŠ›ä¸Šé™+${changes.maxEnergy}</span>`;
                }
                
                skillChangesHTML += '</div>';
                
                // ç”Ÿæˆç›®æ ‡è¿›åº¦HTMLï¼ˆç´§å‡‘ç‰ˆï¼‰
                const goalProgressHTML = this.generateGoalProgress();
                
                // ç”Ÿæˆæ™ºèƒ½å»ºè®®HTMLï¼ˆç´§å‡‘ç‰ˆï¼‰
                const suggestionsHTML = this.generateWeeklySuggestions(changes);
                
                // ç»„åˆå®Œæ•´çš„æ€»ç»“æ–‡æœ¬ï¼ˆç´§å‡‘ç‰ˆï¼‰
                scene.text = `<h2>ğŸ“Š ç¬¬${this.player.week}å‘¨Â·${currentStage}</h2>
                
                ${skillChangesHTML}
                
                ${goalProgressHTML}
                
                ${suggestionsHTML}`;
            }
            
            generateGoalProgress() {
                const goalInfo = this.getGoalInfo();
                
                // å¦‚æœç›®æ ‡å·²å®Œæˆï¼Œä¸æ˜¾ç¤ºç›®æ ‡è¿›åº¦
                if (!goalInfo || goalInfo.completed) {
                    return '';
                }
                
                let progressHTML = '<div style="background: #f0fdf4; padding: 8px; border-radius: 6px; margin: 8px 0; font-size: 14px;">';
                progressHTML += `<strong>${goalInfo.icon} ${goalInfo.title}</strong>`;
                
                if (goalInfo.type === 'tryout') {
                    // é€‰æ‹”ç±»ç›®æ ‡ï¼šæ˜¾ç¤ºè¦æ±‚å’Œè¾¾æ ‡æƒ…å†µ
                    progressHTML += ` <span style="color: #6b7280; font-size: 12px;">(${goalInfo.timeWindow})</span><br>`;
                    
                    const req = goalInfo.requirements;
                    const skillIcons = {
                        serve: 'ğŸ¯', spike: 'âš¡', block: 'ğŸ›¡ï¸', dig: 'ğŸ', set: 'ğŸ¤²', reputation: 'â­'
                    };
                    const skillNames = { 
                        serve: 'å‘çƒ', spike: 'æ‰£çƒ', block: 'æ‹¦ç½‘', dig: 'å«çƒ', set: 'æ‰˜çƒ', reputation: 'å£°æœ›' 
                    };
                    
                    let metCount = 0;
                    let totalCount = 0;
                    let unmetItems = [];
                    
                    // å¤„ç†æŠ€èƒ½è¦æ±‚
                    if (req.anyTwo !== undefined) {
                        const threshold = req.anyTwo;
                        const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                        const qualifiedSkills = skills.filter(s => this.player.skills[s] >= threshold);
                        
                        totalCount = 1;
                        if (qualifiedSkills.length >= 2) {
                            metCount = 1;
                        } else {
                            const sortedSkills = skills
                                .map(s => ({ skill: s, value: this.player.skills[s], diff: threshold - this.player.skills[s] }))
                                .filter(s => s.diff > 0)
                                .sort((a, b) => a.diff - b.diff)
                                .slice(0, 2);
                            sortedSkills.forEach(item => {
                                unmetItems.push({ key: item.skill, required: threshold, current: item.value, diff: item.diff });
                            });
                        }
                    } else if (req.anyThree !== undefined) {
                        const threshold = req.anyThree;
                        const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                        const qualifiedSkills = skills.filter(s => this.player.skills[s] >= threshold);
                        
                        totalCount = 1;
                        if (qualifiedSkills.length >= 3) {
                            metCount = 1;
                        } else {
                            const sortedSkills = skills
                                .map(s => ({ skill: s, value: this.player.skills[s], diff: threshold - this.player.skills[s] }))
                                .filter(s => s.diff > 0)
                                .sort((a, b) => a.diff - b.diff)
                                .slice(0, 3);
                            sortedSkills.forEach(item => {
                                unmetItems.push({ key: item.skill, required: threshold, current: item.value, diff: item.diff });
                            });
                        }
                    }
                    
                    // å¤„ç†å£°æœ›è¦æ±‚
                    if (req.reputation !== undefined) {
                        totalCount++;
                        if (this.player.reputation >= req.reputation) {
                            metCount++;
                        } else {
                            unmetItems.push({
                                key: 'reputation',
                                required: req.reputation,
                                current: this.player.reputation,
                                diff: req.reputation - this.player.reputation
                            });
                        }
                    }
                    
                    // æ˜¾ç¤ºè¿›åº¦
                    if (metCount === totalCount) {
                        progressHTML += `<span style="color: #22c55e;">âœ… å…¨éƒ¨è¾¾æ ‡ï¼å¯ä»¥æŒ‘æˆ˜ç›®æ ‡äº†</span><br>`;
                    } else {
                        progressHTML += `<span style="color: #f59e0b;">è¿›åº¦ï¼š${metCount}/${totalCount}</span><br>`;
                        progressHTML += `<span style="color: #6b7280; font-size: 12px;">çŸ­æ¿ï¼š`;
                        unmetItems.slice(0, 2).forEach((item, idx) => {
                            if (idx > 0) progressHTML += 'ï¼Œ';
                            progressHTML += `${skillNames[item.key]}${item.current}(å·®${item.diff})`;
                        });
                        progressHTML += `</span>`;
                    }
                    
                } else if (goalInfo.type === 'match') {
                    // æ¯”èµ›ç±»ç›®æ ‡ï¼šæ˜¾ç¤ºæ¯”èµ›æ—¶é—´å’Œæç¤º
                    const weeksUntil = goalInfo.triggerWeek - this.player.week;
                    
                    if (weeksUntil > 0) {
                        progressHTML += `<br><span style="color: #f59e0b;">ğŸ“… ç¬¬${goalInfo.triggerWeek}å‘¨è‡ªåŠ¨å¼€å§‹ï¼ˆè¿˜æœ‰${weeksUntil}å‘¨ï¼‰</span><br>`;
                        progressHTML += `<span style="color: #6b7280; font-size: 12px;">ğŸ’¡ ${goalInfo.description}</span>`;
                    } else if (weeksUntil === 0) {
                        progressHTML += `<br><span style="color: #ef4444;">ğŸ“… æœ¬å‘¨å°†è¿›è¡Œæ¯”èµ›ï¼</span><br>`;
                        progressHTML += `<span style="color: #6b7280; font-size: 12px;">ğŸ’ª ä¿æŒæœ€ä½³çŠ¶æ€å‚èµ›</span>`;
                    } else {
                        progressHTML += `<br><span style="color: #22c55e;">âœ… æ¯”èµ›å·²å®Œæˆ</span>`;
                    }
                }
                
                progressHTML += '</div>';
                return progressHTML;
            }
            
            generateWeeklySuggestions(changes) {
                const suggestions = [];
                const goalInfo = this.getGoalInfo();
                
                // 1. æ£€æŸ¥ç´§æ€¥çŠ¶æ€
                if (this.player.energy < 20) {
                    suggestions.push({ priority: 1, text: 'âš ï¸ ä½“åŠ›ä¸¥é‡ä¸è¶³ï¼Œå»ºè®®ä¼˜å…ˆä¼‘æ¯æ¢å¤' });
                }
                if (this.player.stress > 80) {
                    suggestions.push({ priority: 1, text: 'âš ï¸ å‹åŠ›è¿‡å¤§ï¼Œå¿…é¡»è¿›è¡Œæ”¾æ¾æ´»åŠ¨' });
                }
                if (this.player.money < 100) {
                    suggestions.push({ priority: 1, text: 'ğŸ’° é‡‘é’±ä¸è¶³ï¼Œè€ƒè™‘å…¼èŒèµšé’±' });
                }
                if (this.player.mood < 30) {
                    suggestions.push({ priority: 1, text: 'ğŸ˜” å¿ƒæƒ…ä½è½ï¼Œå»ºè®®ä¼‘é—²å¨±ä¹æå‡å¿ƒæƒ…' });
                }
                
                // 2. æ ¹æ®ç›®æ ‡ç±»å‹ç»™å‡ºå»ºè®®
                if (goalInfo.type === 'tryout') {
                    // é€‰æ‹”ç±»ç›®æ ‡ï¼šæ£€æŸ¥è¿›åº¦
                    const req = goalInfo.requirements;
                    let metCount = 0;
                    let totalCount = 0;
                    let shortfalls = [];
                    
                    const skillNames = { serve: 'å‘çƒ', spike: 'æ‰£çƒ', block: 'æ‹¦ç½‘', dig: 'å«çƒ', set: 'æ‰˜çƒ', reputation: 'å£°æœ›' };
                    
                    // å¤„ç†æŠ€èƒ½è¦æ±‚
                    if (req.anyTwo !== undefined) {
                        const threshold = req.anyTwo;
                        const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                        const qualifiedSkills = skills.filter(s => this.player.skills[s] >= threshold);
                        
                        totalCount = 1;
                        if (qualifiedSkills.length >= 2) {
                            metCount = 1;
                        } else {
                            const sortedSkills = skills
                                .map(s => ({ skill: s, value: this.player.skills[s], diff: threshold - this.player.skills[s] }))
                                .filter(s => s.diff > 0)
                                .sort((a, b) => a.diff - b.diff)
                                .slice(0, 2);
                            sortedSkills.forEach(item => {
                                shortfalls.push({ skill: skillNames[item.skill], diff: item.diff, key: item.skill });
                            });
                        }
                    } else if (req.anyThree !== undefined) {
                        const threshold = req.anyThree;
                        const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                        const qualifiedSkills = skills.filter(s => this.player.skills[s] >= threshold);
                        
                        totalCount++;
                        if (qualifiedSkills.length >= 3) {
                            metCount++;
                        } else {
                            const sortedSkills = skills
                                .map(s => ({ skill: s, value: this.player.skills[s], diff: threshold - this.player.skills[s] }))
                                .filter(s => s.diff > 0)
                                .sort((a, b) => a.diff - b.diff)
                                .slice(0, 3);
                            sortedSkills.forEach(item => {
                                shortfalls.push({ skill: skillNames[item.skill], diff: item.diff, key: item.skill });
                            });
                        }
                    }
                    
                    // æ£€æŸ¥å£°æœ›
                    if (req.reputation !== undefined) {
                        totalCount++;
                        if (this.player.reputation >= req.reputation) {
                            metCount++;
                        } else {
                            shortfalls.push({ 
                                skill: 'å£°æœ›', 
                                diff: req.reputation - this.player.reputation, 
                                key: 'reputation' 
                            });
                        }
                    }
                    
                    const progressPercent = totalCount > 0 ? (metCount / totalCount) * 100 : 0;
                    
                    if (progressPercent >= 100) {
                        suggestions.push({ priority: 2, text: `ğŸ‰ å·²è¾¾æ ‡ï¼å¯ä»¥æŒ‘æˆ˜ç›®æ ‡äº†` });
                    } else if (progressPercent >= 80) {
                        const topShortfall = shortfalls.sort((a, b) => b.diff - a.diff)[0];
                        if (topShortfall) {
                            suggestions.push({ priority: 2, text: `ğŸ’¡ æ¥è¿‘ç›®æ ‡ï¼é‡ç‚¹æå‡${topShortfall.skill}(å·®${topShortfall.diff})` });
                        }
                    } else if (progressPercent >= 50) {
                        const top2Shortfalls = shortfalls.sort((a, b) => b.diff - a.diff).slice(0, 2);
                        if (top2Shortfalls.length > 0) {
                            suggestions.push({ priority: 2, text: `ğŸ’ª ç¨³æ­¥å‰è¿›ï¼çŸ­æ¿ï¼š${top2Shortfalls.map(s => `${s.skill}(${s.diff})`).join('ã€')}` });
                        }
                    } else {
                        suggestions.push({ priority: 2, text: `âš¡ åŠ å¿«èŠ‚å¥ï¼å»ºè®®æ¯å‘¨è®­ç»ƒæ»¡3æ¬¡` });
                    }
                    
                } else if (goalInfo.type === 'match') {
                    // æ¯”èµ›ç±»ç›®æ ‡ï¼šç»™å‡ºå‡†å¤‡å»ºè®®
                    const weeksUntil = goalInfo.triggerWeek - this.player.week;
                    
                    if (weeksUntil > 0) {
                        suggestions.push({ priority: 2, text: `ğŸ“… è·ç¦»${goalInfo.title}è¿˜æœ‰${weeksUntil}å‘¨ï¼ŒæŠ“ç´§å‡†å¤‡` });
                        
                        // æ ¹æ®å¹³å‡æŠ€èƒ½ç»™å‡ºå»ºè®®
                        const avgSkill = (this.player.skills.serve + this.player.skills.spike + 
                                         this.player.skills.block + this.player.skills.dig + 
                                         this.player.skills.set) / 5;
                        
                        if (avgSkill < 30) {
                            suggestions.push({ priority: 3, text: `ğŸ’ª æŠ€èƒ½åä½ï¼Œå»ºè®®åŠ å¼ºè®­ç»ƒ` });
                        } else if (avgSkill < 50) {
                            suggestions.push({ priority: 3, text: `ğŸ“ˆ ç»§ç»­æå‡ï¼Œäº‰å–æ›´å¥½è¡¨ç°` });
                        } else {
                            suggestions.push({ priority: 3, text: `ğŸŒŸ å®åŠ›ä¸é”™ï¼Œä¿æŒçŠ¶æ€å³å¯` });
                        }
                    } else if (weeksUntil === 0) {
                        suggestions.push({ priority: 2, text: `ğŸ æœ¬å‘¨æ¯”èµ›ï¼ä¿æŒæœ€ä½³çŠ¶æ€` });
                    }
                }
                
                // 3. èŒä¸šç›¸å…³å»ºè®®ï¼ˆç®€åŒ–ï¼‰
                if (this.player.position !== 'none') {
                    const posInfo = this.getPositionInfo();
                    const skillNames = { serve: 'å‘çƒ', spike: 'æ‰£çƒ', block: 'æ‹¦ç½‘', dig: 'å«çƒ', set: 'æ‰˜çƒ' };
                    const coreSkillsMet = posInfo.coreSkills.every(skill => {
                        const baseReq = posInfo.baseRequirements[skill] || 0;
                        return this.player.skills[skill] >= baseReq;
                    });
                    
                    if (!coreSkillsMet) {
                        const coreNames = posInfo.coreSkills.map(s => skillNames[s]).join('ã€');
                        suggestions.push({ priority: 3, text: `${posInfo.icon} ${posInfo.name}æ ¸å¿ƒæŠ€èƒ½ï¼š${coreNames}(+50%åŠ æˆ)` });
                    }
                }
                
                // 4. è®­ç»ƒæ•ˆç‡å»ºè®®ï¼ˆç®€åŒ–ï¼‰
                if (this.player.trainingCount < 2) {
                    suggestions.push({ priority: 4, text: `ğŸ“ˆ æœ¬å‘¨è®­ç»ƒè¾ƒå°‘(${this.player.trainingCount}/3)ï¼Œå»ºè®®å¢åŠ è®­ç»ƒ` });
                }
                
                // è®¡ç®—æ€»æå‡
                const totalGrowth = Math.abs(changes.serve) + Math.abs(changes.spike) + Math.abs(changes.block) + Math.abs(changes.dig) + Math.abs(changes.set);
                
                if (totalGrowth === 0 && this.player.trainingCount > 0) {
                    suggestions.push({ priority: 4, text: `ğŸ¤” è®­ç»ƒäº†ä½†æ— æå‡ï¼Œæ³¨æ„ä¿æŒè‰¯å¥½çŠ¶æ€` });
                } else if (totalGrowth >= 20) {
                    suggestions.push({ priority: 5, text: `ğŸŒŸ æœ¬å‘¨è¡¨ç°å‡ºè‰²ï¼æå‡${totalGrowth}ç‚¹` });
                }
                
                // æŒ‰ä¼˜å…ˆçº§æ’åºï¼Œå–å‰2æ¡ï¼ˆæ‰‹æœºç‰ˆåªæ˜¾ç¤º2æ¡ï¼‰
                const topSuggestions = suggestions.sort((a, b) => a.priority - b.priority).slice(0, 2);
                
                let html = '<div style="background: #dbeafe; padding: 8px; border-radius: 6px; margin: 8px 0; font-size: 14px;">';
                html += '<strong>ğŸ’¡ å»ºè®®</strong><br>';
                topSuggestions.forEach(s => {
                    html += `<div style="margin: 4px 0; color: #1e40af;">â€¢ ${s.text}</div>`;
                });
                html += '</div>';
                
                return html;
            }
            
            updateUI() {
                document.getElementById('week').textContent = this.player.week;
                document.getElementById('training-count').textContent = `${this.player.trainingCount}/${this.player.maxTrainingPerWeek}`;
                document.getElementById('energy').textContent = this.player.energy;
                document.getElementById('mood').textContent = this.player.mood;
                document.getElementById('stress').textContent = this.player.stress;
                document.getElementById('reputation').textContent = this.player.reputation;
                document.getElementById('money').textContent = this.player.money;
                document.getElementById('training-points').textContent = this.player.trainingPoints || 0;
                
                const teamNames = {
                    'none': 'æ— ',
                    'college': 'é™¢é˜Ÿ',
                    'university': 'æ ¡é˜Ÿ'
                };
                document.getElementById('team').textContent = teamNames[this.player.team];
                
                // æ˜¾ç¤ºèŒä¸šä¿¡æ¯
                const positionStat = document.getElementById('position-stat');
                const positionElement = document.getElementById('position');
                if (this.player.position !== 'none') {
                    const posInfo = this.getPositionInfo();
                    positionStat.style.display = 'block';
                    positionElement.textContent = `${posInfo.icon} ${posInfo.name}`;
                } else {
                    positionStat.style.display = 'none';
                }
                
                for (let skill in this.player.skills) {
                    const value = this.player.skills[skill];
                    document.getElementById(`${skill}-value`).textContent = value;
                    const bar = document.getElementById(`${skill}-bar`);
                    bar.style.width = `${value}%`;
                    bar.textContent = value;
                }
                
                this.drawRadarChart();
                this.updateGoalDisplay();
            }
            
            drawRadarChart() {
                const canvas = document.getElementById('skills-radar');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = 75;
                
                // æ¸…ç©ºç”»å¸ƒ
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // æŠ€èƒ½æ•°æ®ï¼ˆäº”è¾¹å½¢ï¼Œä»æ­£ä¸Šæ–¹å¼€å§‹ï¼Œé¡ºæ—¶é’ˆï¼‰
                const skills = [
                    { name: 'å‘çƒ', value: this.player.skills.serve, angle: -Math.PI / 2 },
                    { name: 'æ‰£çƒ', value: this.player.skills.spike, angle: -Math.PI / 2 + Math.PI * 2 / 5 },
                    { name: 'æ‹¦ç½‘', value: this.player.skills.block, angle: -Math.PI / 2 + Math.PI * 4 / 5 },
                    { name: 'å«çƒ', value: this.player.skills.dig, angle: -Math.PI / 2 + Math.PI * 6 / 5 },
                    { name: 'æ‰˜çƒ', value: this.player.skills.set, angle: -Math.PI / 2 + Math.PI * 8 / 5 }
                ];
                
                // ç»˜åˆ¶èƒŒæ™¯ç½‘æ ¼
                ctx.strokeStyle = '#ddd';
                ctx.lineWidth = 1;
                for (let i = 1; i <= 5; i++) {
                    ctx.beginPath();
                    const r = (radius / 5) * i;
                    skills.forEach((skill, index) => {
                        const x = centerX + r * Math.cos(skill.angle);
                        const y = centerY + r * Math.sin(skill.angle);
                        if (index === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    });
                    ctx.closePath();
                    ctx.stroke();
                }
                
                // ç»˜åˆ¶è½´çº¿
                ctx.strokeStyle = '#ccc';
                ctx.lineWidth = 1;
                skills.forEach(skill => {
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    const x = centerX + radius * Math.cos(skill.angle);
                    const y = centerY + radius * Math.sin(skill.angle);
                    ctx.lineTo(x, y);
                    ctx.stroke();
                });
                
                // ç»˜åˆ¶æ•°æ®åŒºåŸŸ
                ctx.fillStyle = 'rgba(102, 126, 234, 0.3)';
                ctx.strokeStyle = 'rgba(102, 126, 234, 0.8)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                skills.forEach((skill, index) => {
                    const value = Math.min(skill.value, 100);
                    const r = (radius / 100) * value;
                    const x = centerX + r * Math.cos(skill.angle);
                    const y = centerY + r * Math.sin(skill.angle);
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                ctx.closePath();
                ctx.fill();
                ctx.stroke();
                
                // ç»˜åˆ¶æ•°æ®ç‚¹
                ctx.fillStyle = '#667eea';
                skills.forEach(skill => {
                    const value = Math.min(skill.value, 100);
                    const r = (radius / 100) * value;
                    const x = centerX + r * Math.cos(skill.angle);
                    const y = centerY + r * Math.sin(skill.angle);
                    ctx.beginPath();
                    ctx.arc(x, y, 4, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                // ç»˜åˆ¶æ ‡ç­¾
                ctx.fillStyle = '#333';
                ctx.font = 'bold 13px "Microsoft YaHei", Arial, sans-serif';
                
                skills.forEach((skill, index) => {
                    const labelRadius = radius + 30;
                    const x = centerX + labelRadius * Math.cos(skill.angle);
                    const y = centerY + labelRadius * Math.sin(skill.angle);
                    
                    // æ ¹æ®ç´¢å¼•ç²¾ç¡®è®¾ç½®æ¯ä¸ªæ ‡ç­¾çš„å¯¹é½æ–¹å¼
                    switch(index) {
                        case 0: // å‘çƒ - æ­£ä¸Šæ–¹
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'bottom';
                            break;
                        case 1: // æ‰£çƒ - å³ä¸Š
                            ctx.textAlign = 'left';
                            ctx.textBaseline = 'middle';
                            break;
                        case 2: // æ‹¦ç½‘ - å³ä¸‹
                            ctx.textAlign = 'left';
                            ctx.textBaseline = 'middle';
                            break;
                        case 3: // å«çƒ - å·¦ä¸‹
                            ctx.textAlign = 'right';
                            ctx.textBaseline = 'middle';
                            break;
                        case 4: // æ‰˜çƒ - å·¦ä¸Š
                            ctx.textAlign = 'right';
                            ctx.textBaseline = 'middle';
                            break;
                    }
                    
                    ctx.fillText(skill.name, x, y);
                });
            }

            
            applyEffect(effect) {
                if (effect.reset) {
                    this.player = {
                        name: 'æ–°ç”Ÿ',
                        week: TEST_MODE ? TEST_CONFIG.skipToWeek : 1,
                        trainingCount: 0,
                        maxTrainingPerWeek: TEST_MODE ? TEST_CONFIG.maxTrainingPerWeek : 3,
                        energy: TEST_MODE ? TEST_CONFIG.initialEnergy : 100,
                        maxEnergy: TEST_MODE ? TEST_CONFIG.initialEnergy : 100,
                        mood: TEST_MODE ? TEST_CONFIG.initialMood : 80,
                        stress: TEST_MODE ? TEST_CONFIG.initialStress : 20,
                        reputation: TEST_MODE ? TEST_CONFIG.initialReputation : 10,
                        money: TEST_MODE ? TEST_CONFIG.initialMoney : 100,
                        team: 'none',
                        position: 'none',
                        positionLevel: 0,
                        adaptationWeeks: 0,
                        skills: {
                            serve: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                            spike: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                            block: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                            dig: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                            set: TEST_MODE ? TEST_CONFIG.initialSkills : 0
                        },
                        attributes: {
                            strength: 0,
                            agility: 0,
                            stamina: 0,
                            coordination: 0
                        },
                        relationships: {
                            coach: 50,
                            teammates: 50
                        },
                        achievements: []
                    };
                    this.rerollsRemaining = 5;
                    this.currentScene = 'nameInput';
                    document.getElementById('character-panel').classList.remove('show');
                    document.getElementById('game-header').classList.remove('show');
                    this.updateUI();
                    return;
                }
                
                // æ–°å¢ï¼šå¤„ç†æ­£å¼æ¯”èµ›å¯åŠ¨
                if (effect.startFormalMatch) {
                    this.startFormalMatch(
                        effect.startFormalMatch.matchType, 
                        effect.startFormalMatch.matchName
                    );
                    return;
                }
                
                if (effect.nextWeek) {
                    this.nextWeek();
                    return;
                }
                
                if (effect.eventResult) {
                    // æ„å»ºå±æ€§å˜åŒ–æ˜¾ç¤º
                    let changesText = '<br><br><strong>å±æ€§å˜åŒ–ï¼š</strong><br>';
                    let hasChanges = false;
                    
                    if (effect.serve) {
                        changesText += `ğŸ¯ å‘çƒ ${effect.serve > 0 ? '+' : ''}${effect.serve}<br>`;
                        hasChanges = true;
                    }
                    if (effect.spike) {
                        changesText += `âš¡ æ‰£çƒ ${effect.spike > 0 ? '+' : ''}${effect.spike}<br>`;
                        hasChanges = true;
                    }
                    if (effect.block) {
                        changesText += `ğŸ›¡ï¸ æ‹¦ç½‘ ${effect.block > 0 ? '+' : ''}${effect.block}<br>`;
                        hasChanges = true;
                    }
                    if (effect.dig) {
                        changesText += `ğŸ å«çƒ ${effect.dig > 0 ? '+' : ''}${effect.dig}<br>`;
                        hasChanges = true;
                    }
                    if (effect.set) {
                        changesText += `ğŸ¤² æ‰˜çƒ ${effect.set > 0 ? '+' : ''}${effect.set}<br>`;
                        hasChanges = true;
                    }
                    if (effect.energy) {
                        changesText += `ğŸ’ª ä½“åŠ› ${effect.energy > 0 ? '+' : ''}${effect.energy}<br>`;
                        hasChanges = true;
                    }
                    if (effect.mood) {
                        changesText += `ğŸ˜Š å¿ƒæƒ… ${effect.mood > 0 ? '+' : ''}${effect.mood}<br>`;
                        hasChanges = true;
                    }
                    if (effect.stress) {
                        changesText += `ğŸ˜° å‹åŠ› ${effect.stress > 0 ? '+' : ''}${effect.stress}<br>`;
                        hasChanges = true;
                    }
                    if (effect.reputation) {
                        changesText += `â­ å£°æœ› ${effect.reputation > 0 ? '+' : ''}${effect.reputation}<br>`;
                        hasChanges = true;
                    }
                    if (effect.money) {
                        changesText += `ğŸ’° é‡‘é’± ${effect.money > 0 ? '+' : ''}${effect.money}<br>`;
                        hasChanges = true;
                    }
                    if (effect.relationship) {
                        changesText += `ğŸ‘¥ é˜Ÿå‹å…³ç³» ${effect.relationship > 0 ? '+' : ''}${effect.relationship}<br>`;
                        hasChanges = true;
                    }
                    
                    SCENES.eventResult.text = `<h2>âœ¨ ç»“æœ</h2>
                    <p>${effect.eventResult}</p>
                    ${hasChanges ? changesText : ''}`;
                }
                
                if (effect.goalUpdate) {
                    this.currentGoal = effect.goalUpdate;
                }
                
                if (effect.eventType) {
                    this.lastEventType = effect.eventType;
                    
                    // è¿½è¸ªç”Ÿæ´»æ´»åŠ¨ç»Ÿè®¡
                    if (effect.lifeActivity) {
                        switch(effect.lifeActivity) {
                            case 'game':
                                this.playerStats.gamesPlayed++;
                                break;
                            case 'movie':
                                this.playerStats.moviesWatched++;
                                break;
                            case 'social':
                                this.playerStats.socialEvents++;
                                break;
                            case 'rest':
                                this.playerStats.restTaken++;
                                break;
                        }
                    }
                }
                
                if (effect.trained) {
                    this.player.trainingCount++;
                    
                    // ç»Ÿè®¡è®­ç»ƒæ¬¡æ•°
                    this.playerStats.totalTrainings++;
                    
                    // ç»Ÿè®¡å„æŠ€èƒ½è®­ç»ƒæ¬¡æ•°ï¼ˆç®€åŒ–ï¼šæ ¹æ®effectä¸­çš„æŠ€èƒ½åˆ¤æ–­ï¼‰
                    if (effect.serve) this.playerStats.trainingByType.serve++;
                    if (effect.spike) this.playerStats.trainingByType.spike++;
                    if (effect.block) this.playerStats.trainingByType.block++;
                    if (effect.dig) this.playerStats.trainingByType.dig++;
                    if (effect.set) this.playerStats.trainingByType.set++;
                    
                    // å¦‚æœå¤šä¸ªæŠ€èƒ½éƒ½æœ‰æå‡ï¼Œç®—ä½œç»„åˆè®­ç»ƒ
                    const skillCount = [effect.serve, effect.spike, effect.block, effect.dig, effect.set].filter(v => v).length;
                    if (skillCount >= 3) {
                        this.playerStats.trainingByType.composite++;
                    }
                }
                
                // åº”ç”¨èŒä¸šè®­ç»ƒåŠ æˆ
                const skillEffects = ['serve', 'spike', 'block', 'dig', 'set'];
                skillEffects.forEach(skill => {
                    if (effect[skill]) {
                        const bonus = this.getTrainingBonus(skill);
                        const finalValue = Math.round(effect[skill] * (1 + bonus));
                        this.player.skills[skill] = Math.min(100, this.player.skills[skill] + finalValue);
                        
                        // å¦‚æœæœ‰åŠ æˆï¼Œæ˜¾ç¤ºæç¤º
                        if (bonus > 0 && effect.trained) {
                            console.log(`${skill} è®­ç»ƒè·å¾—èŒä¸šåŠ æˆ: ${bonus * 100}%`);
                        }
                    }
                });
                if (effect.energy) this.player.energy = Math.max(0, Math.min(this.player.maxEnergy, this.player.energy + effect.energy));
                if (effect.maxEnergyBonus) this.player.maxEnergy = Math.min(150, this.player.maxEnergy + effect.maxEnergyBonus);
                if (effect.mood) this.player.mood = Math.max(0, Math.min(100, this.player.mood + effect.mood));
                if (effect.stress) this.player.stress = Math.max(0, Math.min(100, this.player.stress + effect.stress));
                if (effect.reputation) this.player.reputation += effect.reputation;
                if (effect.money) this.player.money += effect.money;
                if (effect.team) this.player.team = effect.team;
                if (effect.trainingPoints) this.player.trainingPoints += effect.trainingPoints;  // æ–°å¢ï¼šè®­ç»ƒç‚¹æ•°
                if (effect.relationship) {
                    this.player.relationships.teammates = Math.min(100, this.player.relationships.teammates + effect.relationship);
                }
                
                this.updateUI();
                
                // æ–°å¢ï¼šæ”¯æŒå›è°ƒå‡½æ•°
                if (effect.callback && typeof effect.callback === 'function') {
                    effect.callback();
                }
            }
            
            checkRequirement(req) {
                if (req.energy && this.player.energy < req.energy) return false;
                if (req.mood && this.player.mood < req.mood) return false;
                if (req.money && this.player.money < req.money) return false;
                if (req.team && this.player.team !== req.team) return false;
                if (req.reputation && this.player.reputation < req.reputation) return false;
                if (req.serve && this.player.skills.serve < req.serve) return false;
                if (req.spike && this.player.skills.spike < req.spike) return false;
                if (req.block && this.player.skills.block < req.block) return false;
                if (req.dig && this.player.skills.dig < req.dig) return false;
                if (req.set && this.player.skills.set < req.set) return false;
                if (req.maxCheck && req.trainingCount !== undefined) {
                    if (this.player.trainingCount > req.trainingCount) return false;
                }
                return true;
            }

            
            showScene(sceneId) {
                console.log('showScene called with:', sceneId);
                console.trace('è°ƒç”¨å †æ ˆ:');  // æ·»åŠ å †æ ˆè·Ÿè¸ª
                
                // å…ˆå¤„ç†ç‰¹æ®Šåœºæ™¯ï¼ˆä¸éœ€è¦åœ¨SCENESä¸­å®šä¹‰ï¼‰
                // è¯¾ä½™ç”Ÿæ´»åœºæ™¯ç‰¹æ®Šæ¸²æŸ“
                if (sceneId === 'lifeChoice') {
                    this.renderLifeChoice();
                    return;
                }
                
                // å•†åº—åœºæ™¯ç‰¹æ®Šæ¸²æŸ“
                if (sceneId === 'shopMain') {
                    this.renderShopMain();
                    return;
                }
                
                if (sceneId.startsWith('shopCategory_')) {
                    const category = sceneId.replace('shopCategory_', '');
                    this.renderShopCategory(category);
                    return;
                }
                
                // èŒä¸šé€‰æ‹©åœºæ™¯ç‰¹æ®Šæ¸²æŸ“
                if (sceneId === 'positionSelection') {
                    this.renderPositionSelection();
                    return;
                }
                
                // æ¯”èµ›åœºæ™¯
                if (sceneId === 'casualMatch') {
                    this.startMatch('casual');
                    return;
                }
                
                // matchResult åœºæ™¯ç°åœ¨ä½œä¸ºæ™®é€šåœºæ™¯å¤„ç†ï¼ˆç”± showMatchResultByPerformance åˆ›å»ºï¼‰
                // ä¸å†ç‰¹æ®Šå¤„ç†
                
                // æ£€æŸ¥SCENESä¸­çš„å¸¸è§„åœºæ™¯
                const scene = SCENES[sceneId];
                if (!scene) {
                    console.error('Scene not found:', sceneId);
                    alert('åœºæ™¯æœªæ‰¾åˆ°: ' + sceneId);
                    return;
                }
                
                // åŠ¨æ€æ›´æ–°ç‰¹å®šåœºæ™¯
                if (sceneId === 'start' && this.player.name !== 'æ–°ç”Ÿ') {
                    scene.text = `<h2>ğŸ“ å¤§å­¦æ–°ç”Ÿæ´»</h2>
                    <p><strong>${this.player.name}</strong>ï¼Œä½ æ˜¯ä¸€ååˆšå…¥å­¦çš„å¤§ä¸€æ–°ç”Ÿï¼Œä»æœªæ¥è§¦è¿‡æ’çƒã€‚</p>
                    <p>å¼€å­¦ç¬¬ä¸€å‘¨ï¼Œä½ è·¯è¿‡ä½“è‚²é¦†ï¼Œçœ‹åˆ°æ’çƒç¤¾å›¢æ­£åœ¨æ‹›æ–°ã€‚é˜³å…‰é€è¿‡çª—æˆ·æ´’åœ¨çƒåœºä¸Šï¼Œå­¦é•¿å­¦å§ä»¬çŸ«å¥çš„èº«å½±è®©ä½ å¿ƒç”Ÿå‘å¾€ã€‚</p>
                    <p>"æƒ³è¯•è¯•å—ï¼Ÿ"ä¸€ä½å­¦å§ç¬‘ç€å‘ä½ æ‹›æ‰‹ã€‚</p>`;
                }
                
                if (sceneId === 'weeklyHub') {
                    this.updateWeeklyHub();
                }
                
                if (sceneId === 'weekEnd') {
                    this.generateWeeklySummary();
                }
                
                // æ£€æŸ¥æ˜¯å¦è§¦å‘éšæœºäº‹ä»¶
                if (sceneId === 'checkRandomEvent' && this.lastEventType) {
                    const event = this.triggerRandomEvent(this.lastEventType);
                    this.lastEventType = null;
                    
                    if (event) {
                        this.showRandomEvent(event);
                        return;
                    } else {
                        // æ²¡æœ‰è§¦å‘äº‹ä»¶ï¼Œæ ¹æ®ä¹‹å‰çš„ç±»å‹å†³å®šä¸‹ä¸€æ­¥
                        this.currentScene = 'weeklyHub';
                        this.showScene('weeklyHub');
                        return;
                    }
                }
                
                const storyText = document.getElementById('story-text');
                const choicesDiv = document.getElementById('choices');
                
                // å¤„ç†æ–‡æœ¬ï¼šå¦‚æœæ˜¯å‡½æ•°åˆ™è°ƒç”¨ï¼Œå¦åˆ™ç›´æ¥ä½¿ç”¨
                const textContent = typeof scene.text === 'function' ? scene.text() : scene.text;
                storyText.innerHTML = textContent;
                choicesDiv.innerHTML = '';
                
                scene.choices.forEach(choice => {
                    // å¦‚æœæœ‰åˆ†éš”ç¬¦ï¼Œå…ˆæ·»åŠ åˆ†éš”ç¬¦
                    if (choice.separator && choice.separatorText) {
                        const separator = document.createElement('div');
                        separator.innerHTML = choice.separatorText;
                        separator.style.marginTop = '10px';
                        choicesDiv.appendChild(separator);
                    }
                    
                    // å¦‚æœåªæ˜¯åˆ†éš”ç¬¦ï¼ˆæ²¡æœ‰textï¼‰ï¼Œä¸åˆ›å»ºæŒ‰é’®
                    if (!choice.text || choice.text.trim() === '') {
                        return;
                    }
                    
                    const button = document.createElement('button');
                    
                    // åˆ¤æ–­æ˜¯å¦æ˜¯é‡è¦æŒ‰é’®ï¼ˆé€‰æ‹”ã€æ¯”èµ›ç­‰å…³é”®æµç¨‹ï¼‰
                    const importantKeywords = ['é€‰æ‹”', 'å¼€å§‹æ¯”èµ›', 'åŠ å…¥', 'æŒ‘æˆ˜', 'å‚åŠ æ¯”èµ›'];
                    const isImportant = importantKeywords.some(keyword => choice.text.includes(keyword));
                    
                    button.className = isImportant ? 'choice-btn-important' : 'choice-btn';
                    
                    // å¦‚æœæœ‰effectä¸”æ˜¯è®­ç»ƒç±»å‹ï¼ŒåŠ¨æ€ç”Ÿæˆå¸¦åŠ æˆçš„æ–‡æœ¬
                    if (choice.effect && choice.effect.trained) {
                        // æå–åŸå§‹æ–‡æœ¬çš„å›¾æ ‡å’Œåç§°éƒ¨åˆ†
                        const match = choice.text.match(/^([ğŸ¯âš¡ğŸ›¡ï¸ğŸ¤¸ğŸ™ŒğŸ”¥]+\s*[\u4e00-\u9fa5]+)/);
                        const baseName = match ? match[1] : choice.text.split('ï¼ˆ')[0];
                        const effectPreview = this.getEffectPreview(choice.effect);
                        button.textContent = baseName + effectPreview;
                    } else {
                        button.textContent = choice.text;
                    }
                    
                    if (choice.requirement) {
                        const meetsRequirement = this.checkRequirement(choice.requirement);
                        if (!meetsRequirement) {
                            button.disabled = true;
                            button.textContent += ' (æ¡ä»¶ä¸è¶³)';
                        }
                    }
                    
                    button.onclick = () => {
                        let shouldContinue = true;
                        
                        if (choice.effect) {
                            // å¦‚æœ effect æ˜¯å‡½æ•°ï¼Œç›´æ¥æ‰§è¡Œå®ƒ
                            if (typeof choice.effect === 'function') {
                                choice.effect();
                                // å‡½æ•°å¯èƒ½ä¼šå¤„ç†åœºæ™¯è·³è½¬ï¼Œæ‰€ä»¥æ£€æŸ¥æ˜¯å¦æœ‰ next
                                if (!choice.next) {
                                    return;  // æ²¡æœ‰ nextï¼Œå‡½æ•°è‡ªå·±å¤„ç†è·³è½¬
                                }
                            } else {
                                // effect æ˜¯å¯¹è±¡ï¼Œä½¿ç”¨ applyEffect å¤„ç†
                                // æ£€æŸ¥æ˜¯å¦æœ‰ä¼šæ”¹å˜åœºæ™¯çš„ç‰¹æ®Šæ•ˆæœ
                                if (choice.effect.nextWeek || choice.effect.startFormalMatch) {
                                    // è¿™äº›æ•ˆæœä¼šè‡ªå·±å¤„ç†åœºæ™¯è·³è½¬ï¼Œä¸éœ€è¦ç»§ç»­
                                    this.applyEffect(choice.effect);
                                    return;  // ç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œåé¢çš„ showScene
                                }
                                
                                this.applyEffect(choice.effect);
                                
                                // æ£€æŸ¥æ˜¯å¦éœ€è¦è§¦å‘éšæœºäº‹ä»¶
                                if (choice.effect.eventType) {
                                    const event = this.triggerRandomEvent(choice.effect.eventType);
                                    if (event) {
                                        // è§¦å‘äº‹ä»¶ï¼Œæš‚ä¸è·³è½¬åœºæ™¯
                                        this.showRandomEvent(event);
                                        return;
                                    }
                                }
                            }
                        }
                        
                        if (choice.next) {
                            this.currentScene = choice.next;
                            this.showScene(choice.next);
                        }
                    };
                    
                    choicesDiv.appendChild(button);
                });
            }
        }
        
        // å¯åŠ¨æ¸¸æˆ
        let game;
        
        // åˆ†äº«åŠŸèƒ½
        function shareGame() {
            const shareData = {
                title: 'æ’çƒä¹‹æ˜Ÿ - ä»èœé¸Ÿåˆ°å† å†›',
                text: 'æˆ‘åœ¨ç©æ’çƒä¹‹æ˜Ÿï¼Œä»èœé¸Ÿåˆ°å† å†›çš„æˆé•¿ä¹‹è·¯ï¼å¿«æ¥ä¸€èµ·ç©å§ï¼',
                url: window.location.href
            };
            
            // æ£€æŸ¥æ˜¯å¦æ”¯æŒåŸç”Ÿåˆ†äº«APIï¼ˆç§»åŠ¨ç«¯ï¼‰
            if (navigator.share) {
                navigator.share(shareData)
                    .then(() => {
                        console.log('åˆ†äº«æˆåŠŸ');
                    })
                    .catch((error) => {
                        if (error.name !== 'AbortError') {
                            console.log('åˆ†äº«å¤±è´¥', error);
                            fallbackShare();
                        }
                    });
            } else {
                // æ¡Œé¢ç«¯æˆ–ä¸æ”¯æŒçš„æµè§ˆå™¨ï¼Œå¤åˆ¶é“¾æ¥
                fallbackShare();
            }
        }
        
        function fallbackShare() {
            const url = window.location.href;
            
            // å°è¯•ä½¿ç”¨å‰ªè´´æ¿API
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(url)
                    .then(() => {
                        showShareMessage('âœ… é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\nå¿«å»åˆ†äº«ç»™æœ‹å‹å§ï¼');
                    })
                    .catch(() => {
                        showShareMessage('ğŸ“‹ è¯·å¤åˆ¶é“¾æ¥ï¼š\n' + url);
                    });
            } else {
                // é™çº§æ–¹æ¡ˆï¼šæ˜¾ç¤ºé“¾æ¥è®©ç”¨æˆ·æ‰‹åŠ¨å¤åˆ¶
                showShareMessage('ğŸ“‹ è¯·å¤åˆ¶é“¾æ¥ï¼š\n' + url);
            }
        }
        
        function showShareMessage(message) {
            // åˆ›å»ºä¸´æ—¶æç¤ºæ¡†
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.85);
                color: white;
                padding: 20px 30px;
                border-radius: 12px;
                font-size: 14px;
                z-index: 10000;
                text-align: center;
                white-space: pre-line;
                max-width: 80%;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }
        
        window.addEventListener('DOMContentLoaded', () => {
            console.log('DOMContentLoaded fired');
            try {
                console.log('Creating game instance...');
                game = new VolleyballGame();
                console.log('Game instance created:', game);
            } catch (e) {
                console.error('Error creating game:', e);
                alert('æ¸¸æˆåˆå§‹åŒ–å¤±è´¥: ' + e.message);
            }
        });
    </script>
</body>
</html>

