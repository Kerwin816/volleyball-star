<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÊéíÁêÉ‰πãÊòü - ‰ªéËèúÈ∏üÂà∞ÂÜ†ÂÜõ</title>
    <!-- Version: 2.2.0 - Skill Growth Rebalance -->
    
    <!-- SEO‰ºòÂåñ -->
    <meta name="description" content="‰ΩìÈ™å‰ªéÂ§ß‰∏ÄÊñ∞ÁîüÂà∞Â∏ÇÁ∫ßÂÜ†ÂÜõÁöÑÊéíÁêÉ‰πãÊóÖÔºÅËÆ≠ÁªÉ„ÄÅÊØîËµõ„ÄÅÊàêÈïøÔºå‰π¶ÂÜô‰Ω†ÁöÑÊéíÁêÉ‰º†Â•áÔºÅ">
    <meta name="keywords" content="ÊéíÁêÉÊ∏∏Êàè,ÊñáÂ≠óÂÜíÈô©,‰ΩìËÇ≤Ê∏∏Êàè,ÊàêÈïøÊ∏∏Êàè,ÊéíÁêÉ‰πãÊòü">
    <meta name="author" content="Â∞èÊ∞¥">
    
    <!-- ÂæÆ‰ø°ÂàÜ‰∫´‰ºòÂåñ -->
    <meta property="og:title" content="ÊéíÁêÉ‰πãÊòü - ‰ªéËèúÈ∏üÂà∞ÂÜ†ÂÜõÁöÑÊàêÈïø‰πãË∑Ø" />
    <meta property="og:description" content="‰ΩìÈ™å‰ªéÂ§ß‰∏ÄÊñ∞ÁîüÂà∞Â∏ÇÁ∫ßÂÜ†ÂÜõÁöÑÊéíÁêÉ‰πãÊóÖÔºÅËÆ≠ÁªÉ„ÄÅÊØîËµõ„ÄÅÊàêÈïøÔºå‰π¶ÂÜô‰Ω†ÁöÑÊéíÁêÉ‰º†Â•áÔºÅ" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://via.placeholder.com/1200x630/667eea/ffffff?text=ÊéíÁêÉ‰πãÊòü" />
    
    <!-- ÁßªÂä®Á´Ø‰ºòÂåñ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ÊéíÁêÉ‰πãÊòü">
    <meta name="theme-color" content="#667eea">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                align-items: flex-start;
            }
        }
        
        #game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 900px;
            width: 100%;
            overflow: hidden;
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            #game-container {
                border-radius: 10px;
                max-width: 100%;
                margin: 0;
            }
        }
        
        #game-header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            text-align: center;
            display: none;
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            #game-header {
                padding: 15px 10px;
            }
        }
        
        #game-header.show {
            display: block;
        }
        
        #game-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            #game-header h1 {
                font-size: 22px;
                margin-bottom: 8px;
            }
        }
        
        #current-goal {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        #current-goal h3 {
            margin: 0 0 5px 0;
            font-size: 16px;
        }
        
        #current-goal p {
            margin: 3px 0;
        }
        
        .goal-requirement {
            color: #fff;
            font-weight: bold;
        }
        
        .goal-met {
            color: #2ecc71;
        }
        
        .goal-not-met {
            color: #ffeb3b;
        }
        
        #event-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        #event-modal.show {
            display: flex;
        }
        
        #event-modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            #event-modal-content {
                padding: 20px;
                width: 95%;
                max-height: 85vh;
                border-radius: 10px;
            }
        }
        
        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        #event-modal-content h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        #event-modal-content p {
            line-height: 1.8;
            margin-bottom: 20px;
        }
        
        #event-modal-choices {
            display: grid;
            gap: 10px;
        }
        
        /* ÊØîËµõÂºπÁ™óÊ†∑Âºè */
        #match-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        #match-modal.show {
            display: flex;
        }
        
        #match-modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            color: white;
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            #match-modal-content {
                padding: 20px 15px;
                width: 95%;
                max-height: 85vh;
                border-radius: 10px;
            }
        }
        
        #match-modal-content h2 {
            color: white;
            margin-bottom: 20px;
            text-align: center;
        }
        
        #match-score-display {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        #match-log {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }
        
        .match-log-item {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            animation: slideIn 0.3s ease-out;
            opacity: 0;
            animation-fill-mode: forwards;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .match-log-item.my-point {
            border-left: 4px solid #2ecc71;
            background: rgba(46, 204, 113, 0.2);
        }
        
        .match-log-item.opponent-point {
            border-left: 4px solid #e74c3c;
            background: rgba(231, 76, 60, 0.2);
        }
        
        .match-log-score {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .match-log-description {
            color: #ddd;
            font-size: 14px;
        }
        
        #match-modal-choices {
            display: grid;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* ÁõÆÊ†áÈù¢ÊùøÊ†∑Âºè */
        #goals-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
        }
        
        #goals-panel.show {
            display: flex;
        }
        
        #goals-panel-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            color: white;
        }
        
        #goals-panel-content h2 {
            color: white;
            margin-bottom: 20px;
        }
        
        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }
        
        .goal-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid;
        }
        
        .goal-card.current {
            border-left-color: #ffd700;
            background: rgba(255, 215, 0, 0.2);
        }
        
        .goal-card.next {
            border-left-color: #4CAF50;
            background: rgba(76, 175, 80, 0.15);
        }
        
        .goal-card.future {
            border-left-color: #9E9E9E;
            background: rgba(158, 158, 158, 0.1);
        }
        
        .goal-card.completed {
            border-left-color: #2196F3;
            background: rgba(33, 150, 243, 0.15);
            opacity: 0.7;
        }
        
        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .goal-title {
            font-size: 20px;
            font-weight: bold;
        }
        
        .goal-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .goal-badge.current {
            background: #ffd700;
            color: #333;
        }
        
        .goal-badge.next {
            background: #4CAF50;
            color: white;
        }
        
        .goal-badge.completed {
            background: #2196F3;
            color: white;
        }
        
        .goal-description {
            margin: 10px 0;
            font-size: 14px;
            color: #ddd;
        }
        
        .goal-requirements {
            margin: 15px 0;
        }
        
        .goal-requirements h4 {
            font-size: 14px;
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .requirement-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 13px;
        }
        
        .requirement-met {
            color: #4CAF50;
        }
        
        .requirement-not-met {
            color: #ff6b6b;
        }
        
        .goal-tips {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            font-size: 12px;
            color: #ddd;
        }
        
        .tab-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        #stats-bar {
            display: flex;
            justify-content: space-around;
            font-size: 14px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            #stats-bar {
                font-size: 12px;
                gap: 8px;
            }
        }
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
        }

        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
        }
        
        #game-content {
            padding: 30px;
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            #game-content {
                padding: 15px;
            }
        }
        
        #story-text {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            min-height: 150px;
            line-height: 1.8;
            font-size: 16px;
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            #story-text {
                padding: 15px;
                font-size: 15px;
                line-height: 1.6;
                min-height: 100px;
            }
        }
        
        #choices {
            display: grid;
            gap: 10px;
        }
        
        /* ËØæ‰ΩôÁîüÊ¥ªÂàÜÁ±ªÂ∏ÉÂ±Ä - Á¥ßÂáëÂûã */
        .life-categories {
            display: grid;
            gap: 15px;
        }
        
        .life-category {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 12px;
            border-left: 4px solid;
        }
        
        .life-category.sports {
            border-left-color: #ff6b6b;
        }
        
        .life-category.rest {
            border-left-color: #4ecdc4;
        }
        
        .life-category.social {
            border-left-color: #95e1d3;
        }
        
        .life-category.food {
            border-left-color: #ffd93d;
        }
        
        .life-category.work {
            border-left-color: #6c5ce7;
        }
        
        .category-title {
            font-size: 15px;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .category-choices {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .life-choice-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 13px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .life-choice-card:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .life-choice-card:disabled {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .life-choice-icon {
            font-size: 28px;
            margin-bottom: 4px;
        }
        
        .life-choice-title {
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 13px;
        }
        
        .life-choice-effects {
            font-size: 10px;
            opacity: 0.9;
            line-height: 1.3;
        }
        
        @media (max-width: 768px) {
            .category-choices {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .life-choice-icon {
                font-size: 24px;
            }
            
            .life-choice-title {
                font-size: 12px;
            }
            
            .life-choice-effects {
                font-size: 9px;
            }
        }
        
        @media (min-width: 769px) {
            .category-choices {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* ÂïÜÂ∫óÁ≥ªÁªüÊ†∑Âºè - Á¥ßÂáëÂûã‰∏ÄÁ∫ßÂÖ•Âè£ */
        .shop-category-section {
            margin-bottom: 25px;
        }
        
        .shop-category-header {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }
        
        .shop-items-compact {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
        }
        
        .shop-item-compact {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .shop-item-compact:hover:not(.disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        }
        
        .shop-item-compact.disabled {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .item-compact-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 6px;
            line-height: 1.3;
        }
        
        .item-compact-desc {
            font-size: 11px;
            opacity: 0.9;
            margin-bottom: 6px;
            line-height: 1.3;
            min-height: 32px;
        }
        
        .item-compact-price {
            font-size: 13px;
            font-weight: bold;
            padding: 4px 8px;
            background: rgba(255,255,255,0.25);
            border-radius: 6px;
            display: inline-block;
        }
        
        .item-compact-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 16px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .item-compact-badge.owned {
            background: rgba(46, 204, 113, 0.9);
        }
        
        .item-compact-badge.locked {
            background: rgba(231, 76, 60, 0.9);
        }
        
        @media (max-width: 768px) {
            .shop-items-compact {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .item-compact-name {
                font-size: 13px;
            }
            
            .item-compact-price {
                font-size: 12px;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .shop-items-compact {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (min-width: 1025px) {
            .shop-items-compact {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* ÊóßÁöÑÂïÜÂ∫óÊ†∑ÂºèÔºà‰øùÁïô‰ª•Èò≤ÈúÄË¶ÅÔºâ */
        .shop-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .shop-category-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .shop-category-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .shop-cat-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .shop-cat-name {
            font-size: 16px;
            font-weight: bold;
        }
        
        .shop-items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .shop-item-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
            transition: all 0.3s;
        }
        
        .shop-item-card:hover:not(.disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .shop-item-card.disabled {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            opacity: 0.7;
        }
        
        .item-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .item-description {
            font-size: 13px;
            margin-bottom: 10px;
            opacity: 0.9;
            line-height: 1.4;
        }
        
        .item-price {
            font-size: 16px;
            font-weight: bold;
            margin: 10px 0;
            padding: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            text-align: center;
        }
        
        .item-owned {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(46, 204, 113, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .item-locked {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .shop-item-card button {
            width: 100%;
            background: rgba(255,255,255,0.3);
            color: white;
            border: 2px solid white;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .shop-item-card button:hover:not(:disabled) {
            background: white;
            color: #667eea;
        }
        
        .shop-item-card button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        @media (max-width: 768px) {
            .shop-categories {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .shop-items-grid {
                grid-template-columns: 1fr;
            }
            
            .shop-cat-icon {
                font-size: 36px;
            }
        }
        
        .choice-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            text-align: left;
        }
        
        /* ÈáçË¶ÅÊåâÈíÆÊ†∑ÂºèÔºàÈáëÈªÑËâ≤Ôºâ */
        .choice-btn-important {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 50%, #ffd700 100%);
            color: white;
            border: 2px solid #ffd700;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            text-align: left;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            .choice-btn {
                padding: 12px 15px;
                font-size: 15px;
                border-radius: 8px;
            }
            
            .choice-btn-important {
                padding: 12px 15px;
                font-size: 15px;
                border-radius: 8px;
            }
        }
        
        .choice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .choice-btn-important:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5);
        }
        
        .choice-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        /* ËÅå‰∏öÈÄâÊã©Âç°ÁâáÊ†∑Âºè */
        .position-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .position-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            position: relative;
        }
        
        .position-card:hover:not(.disabled) {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        
        .position-card.disabled {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .position-card.recommended {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 0 20px rgba(245, 87, 108, 0.5);
        }
        
        .position-recommended {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 215, 0, 0.9);
            color: #333;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .position-match {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            padding: 5px;
            background: rgba(255,255,255,0.25);
            border-radius: 8px;
        }
        
        .position-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .position-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .position-desc {
            font-size: 13px;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        
        .position-skills {
            font-size: 12px;
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
        }
        
        .position-requirements {
            font-size: 11px;
            margin-top: 10px;
            padding: 8px;
            background: rgba(255,255,255,0.15);
            border-radius: 8px;
            line-height: 1.6;
        }
        
        .position-restrictions {
            font-size: 10px;
            margin-top: 8px;
            padding: 5px;
            background: rgba(255,100,100,0.3);
            border-radius: 5px;
            color: #ffeb3b;
        }
        
        .position-locked {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.5);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        
        @media (max-width: 768px) {
            .position-cards {
                grid-template-columns: 1fr;
            }
        }

        
        #character-panel {
            background: #e9ecef;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            #character-panel {
                padding: 12px;
                margin-bottom: 15px;
            }
        }
        
        #character-panel.show {
            display: block;
        }
        
        .skills-container {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-top: 15px;
        }
        
        .skills-left {
            flex: 1;
            min-width: 0;
        }
        
        .skills-right {
            flex-shrink: 0;
            display: none; /* ÈöêËóèÈõ∑ËææÂõæ - ‰øùÁïô‰ª£Á†Å‰ª•‰æøÂêéÁª≠ÊøÄÊ¥ª */
            /* display: flex; */ /* ÂèñÊ∂àÊ≥®ÈáäÊ≠§Ë°åÂèØÈáçÊñ∞ÊòæÁ§∫Èõ∑ËææÂõæ */
            justify-content: center;
            align-items: center;
        }
        
        @media (max-width: 768px) {
            .skills-container {
                flex-direction: column;
            }
            
            .skills-left {
                width: 100%;
            }
        }
        
        #name-input-panel {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            #name-input-panel {
                padding: 20px 15px;
                border-radius: 10px;
            }
        }
        
        #name-input-panel h2 {
            color: #667eea;
            margin-bottom: 20px;
        }
        
        #name-input-panel input {
            width: calc(100% - 60px);
            padding: 15px;
            font-size: 18px;
            border: 2px solid #667eea;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.2s;
            display: inline-block;
        }
        
        #name-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
        }
        
        #random-name-btn {
            background: #f093fb;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        #random-name-btn:hover {
            background: #e082ea;
            transform: rotate(360deg) scale(1.1);
        }
        
        #initial-attributes {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        
        #initial-attributes h3 {
            text-align: center;
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .init-attr-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .init-attr-item:last-child {
            border-bottom: none;
        }
        
        .init-attr-value {
            font-weight: bold;
            color: #667eea;
        }
        
        .init-attr-rating {
            text-align: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #667eea;
            font-weight: bold;
            color: #f5576c;
        }
        
        #reroll-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        #reroll-btn {
            background: #f093fb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #reroll-btn:hover:not(:disabled) {
            background: #e082ea;
            transform: scale(1.05);
        }
        
        #reroll-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        #reroll-count {
            color: #666;
            font-size: 14px;
        }
        
        #name-input-panel button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #name-input-panel button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .hidden {
            display: none;
        }
        
        .attribute-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        
        .attribute-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .attribute-item:last-child {
            border-bottom: none;
        }
        
        .attribute-value {
            font-weight: bold;
            color: #667eea;
        }
        
        .skill-bar {
            margin: 10px 0;
        }
        
        .skill-name {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .progress-bar {
            background: #dee2e6;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
            height: 100%;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* ÂºÄÂèëËÄÖÁΩ≤Âêç */
        .developer-credit {
            text-align: center;
            padding: 15px;
            font-size: 11px;
            color: #999;
            opacity: 0.6;
            margin-top: 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }
        
        .version-number {
            color: #667eea;
            font-weight: 500;
            opacity: 0.8;
        }
        
        /* ÂàÜ‰∫´ÊåâÈíÆ */
        .share-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
        }
        
        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        .share-btn:active {
            transform: translateY(0);
        }
        
        @media (max-width: 768px) {
            .share-btn {
                bottom: 15px;
                right: 15px;
                padding: 10px 16px;
                font-size: 13px;
            }
        }
        
        /* Ë∑≥ËøáÊåâÈíÆ */
        .skip-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .skip-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .skip-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
        }
        
        /* ÂàÆÂàÆ‰πêÊ†∑Âºè */
        .scratch-card-result {
            text-align: center;
            padding: 40px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            min-width: 350px;
            animation: scratchCardFadeIn 0.3s ease-out;
        }
        
        .scratch-card-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: iconBounce 0.6s ease-out;
        }
        
        .scratch-card-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 25px;
        }
        
        .scratch-card-rewards {
            font-size: 20px;
            line-height: 1.8;
            margin-bottom: 25px;
        }
        
        .scratch-card-close {
            padding: 12px 40px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: #4CAF50;
            color: white;
            transition: all 0.3s;
        }
        
        .scratch-card-close:hover {
            background: #45a049;
            transform: scale(1.05);
        }
        
        /* ÁâπÁ≠âÂ•ñ - ÈáëËâ≤Èó™ËÄÄ */
        .scratch-grand-prize {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #8B0000;
            animation: prizeShine 1.5s infinite;
        }
        
        .scratch-grand-prize .scratch-card-title {
            color: #8B0000;
        }
        
        .scratch-grand-prize .scratch-card-rewards {
            color: #8B0000;
        }
        
        /* ‰∏ÄÁ≠âÂ•ñ - Ê©ôËâ≤ */
        .scratch-first-prize {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            color: white;
        }
        
        .scratch-first-prize .scratch-card-title {
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .scratch-first-prize .scratch-card-rewards {
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        /* ‰∫åÁ≠âÂ•ñ - Èì∂Ëâ≤ */
        .scratch-second-prize {
            background: linear-gradient(135deg, #C0C0C0 0%, #A9A9A9 100%);
            color: #333;
        }
        
        .scratch-second-prize .scratch-card-title {
            color: #1a1a1a;
        }
        
        .scratch-second-prize .scratch-card-rewards {
            color: #1a1a1a;
        }
        
        /* ‰∏âÁ≠âÂ•ñ - ÈìúËâ≤ */
        .scratch-third-prize {
            background: linear-gradient(135deg, #CD7F32 0%, #B87333 100%);
            color: white;
        }
        
        .scratch-third-prize .scratch-card-title {
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .scratch-third-prize .scratch-card-rewards {
            color: #FFF8DC;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
            font-weight: bold;
        }
        
        /* ÂÆâÊÖ∞Â•ñ - ÊµÖËìù */
        .scratch-consolation-prize {
            background: #87CEEB;
            color: #1E3A8A;
        }
        
        .scratch-consolation-prize .scratch-card-title {
            color: #1E3A8A;
        }
        
        .scratch-consolation-prize .scratch-card-rewards {
            color: #1E3A8A;
        }
        
        /* Ë∞¢Ë∞¢ÊÉ†È°æ - ÁÅ∞Ëâ≤ */
        .scratch-nothing-prize {
            background: #F0F0F0;
            color: #666;
        }
        
        .scratch-nothing-prize .scratch-card-title {
            color: #666;
        }
        
        .scratch-nothing-prize .scratch-card-rewards {
            color: #666;
        }
        
        /* ÂõæÊ†áÂºπË∑≥Âä®Áîª */
        @keyframes iconBounce {
            0% { transform: scale(0) rotate(-180deg); }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        
        /* ÁâπÁ≠âÂ•ñÈó™ËÄÄÂä®Áîª */
        @keyframes prizeShine {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 1); }
        }
        
        /* ÂºπÁ™óÊ∑°ÂÖ•Âä®Áîª */
        @keyframes scratchCardFadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="game-header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h1>üèê ÊéíÁêÉ‰πãÊòü</h1>
                <button id="goals-tab-btn" class="tab-btn" onclick="game.toggleGoalsPanel()">üéØ ÁõÆÊ†á</button>
            </div>
            <div id="current-goal">
                <h3>üìç ÂΩìÂâçÁõÆÊ†á</h3>
                <p id="goal-text">Âä†ËΩΩ‰∏≠...</p>
            </div>
            <div id="stats-bar">
                <div class="stat">
                    <span class="stat-label">Âë®Ê¨°</span>
                    <span class="stat-value" id="week">1</span>
                </div>
                <div class="stat">
                    <span class="stat-label">ËÆ≠ÁªÉ</span>
                    <span class="stat-value" id="training-count">0/3</span>
                </div>

                <div class="stat">
                    <span class="stat-label">‰ΩìÂäõ</span>
                    <span class="stat-value" id="energy">100</span>
                </div>
                <div class="stat">
                    <span class="stat-label">ÂøÉÊÉÖ</span>
                    <span class="stat-value" id="mood">80</span>
                </div>
                <div class="stat">
                    <span class="stat-label">ÂéãÂäõ</span>
                    <span class="stat-value" id="stress">20</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Â£∞Êúõ</span>
                    <span class="stat-value" id="reputation">10</span>
                </div>
                <div class="stat">
                    <span class="stat-label">ÈáëÈí±</span>
                    <span class="stat-value" id="money">100</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Èòü‰ºç</span>
                    <span class="stat-value" id="team">Êó†</span>
                </div>
                <div class="stat" id="position-stat" style="display: none;">
                    <span class="stat-label">ËÅå‰∏ö</span>
                    <span class="stat-value" id="position">Êú™ÈÄâÊã©</span>
                </div>
            </div>
        </div>
        
        <div id="game-content">
            <div id="character-panel">
                <h3>üìä ËÉΩÂäõÂÄº</h3>
                <div class="skills-container">
                    <div class="skills-left">
                        <div class="skill-bar">
                            <div class="skill-name">
                                <span>ÂèëÁêÉ</span>
                                <span id="serve-value">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="serve-bar" style="width: 0%">0</div>
                            </div>
                        </div>
                        <div class="skill-bar">
                            <div class="skill-name">
                                <span>Êâ£ÁêÉ</span>
                                <span id="spike-value">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="spike-bar" style="width: 0%">0</div>
                            </div>
                        </div>
                        <div class="skill-bar">
                            <div class="skill-name">
                                <span>Êã¶ÁΩë</span>
                                <span id="block-value">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="block-bar" style="width: 0%">0</div>
                            </div>
                        </div>
                        <div class="skill-bar">
                            <div class="skill-name">
                                <span>Âû´ÁêÉ</span>
                                <span id="dig-value">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="dig-bar" style="width: 0%">0</div>
                            </div>
                        </div>
                        <div class="skill-bar">
                            <div class="skill-name">
                                <span>ÊâòÁêÉ</span>
                                <span id="set-value">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="set-bar" style="width: 0%">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="skills-right">
                        <canvas id="skills-radar" width="260" height="260"></canvas>
                    </div>
                </div>
            </div>
            
            <div id="story-text"></div>
            <div id="choices"></div>
        </div>
        
        <!-- ÂºÄÂèëËÄÖÁΩ≤ÂêçÂíåÁâàÊú¨Âè∑ -->
        <div class="developer-credit">
            <span>ÂºÄÂèëËÄÖÔºöÂ∞èÊ∞¥</span>
            <span class="version-number">v2.2.0</span>
        </div>
    </div>
    
    <!-- ÂàÜ‰∫´ÊåâÈíÆ -->
    <button class="share-btn" onclick="shareGame()">
        <span>üì§</span>
        <span>ÂàÜ‰∫´Ê∏∏Êàè</span>
    </button>
    
    <!-- ‰∫ã‰ª∂ÂºπÁ™ó -->
    <div id="event-modal">
        <div id="event-modal-content">
            <h2 id="event-modal-title">‰∫ã‰ª∂</h2>
            <p id="event-modal-text"></p>
            <div id="event-modal-choices"></div>
        </div>
    </div>
    
    <!-- ÊØîËµõÂºπÁ™ó -->
    <div id="match-modal">
        <div id="match-modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 id="match-modal-title" style="margin: 0;">üèê ÊØîËµõËøõË°å‰∏≠</h2>
                <button id="skip-match-btn" class="skip-btn" onclick="game.skipMatch()">‚è≠Ô∏è Ë∑≥Ëøá</button>
            </div>
            <div id="match-score-display">
                <span id="my-score">0</span>
                <span style="margin: 0 20px;">:</span>
                <span id="opponent-score">0</span>
            </div>
            <div id="match-log"></div>
            <div id="match-modal-choices"></div>
        </div>
    </div>
    
    <!-- ÁõÆÊ†áÈù¢Êùø -->
    <div id="goals-panel">
        <div id="goals-panel-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>üéØ ÊàêÈïøÁõÆÊ†á</h2>
                <button class="close-btn" onclick="game.toggleGoalsPanel()">‚úï</button>
            </div>
            <div id="goals-list"></div>
        </div>
    </div>

    <script>
        // ÂßìÊ∞èÂ∫ì
        const SURNAMES = [
            // Â∏∏ËßÅÂçïÂßì
            'Âº†', 'Áéã', 'Êùé', 'Âàò', 'Èôà', 'Êù®', 'ÈªÑ', 'Ëµµ', 'Âê¥', 'Âë®',
            'Âæê', 'Â≠ô', 'È©¨', 'Êú±', 'ËÉ°', 'ÈÉ≠', '‰Ωï', 'Êûó', 'È´ò', 'ÁΩó',
            'ÈÉë', 'Ê¢Å', 'Ë∞¢', 'ÂÆã', 'Âîê', 'ËÆ∏', 'Èü©', 'ÂÜØ', 'ÈÇì', 'Êõπ',
            'ÂΩ≠', 'Êõæ', 'ËÇñ', 'Áî∞', 'Ëë£', 'Ë¢Å', 'ÊΩò', '‰∫é', 'Ëíã', 'Ëî°',
            // Â§çÂßì
            'Ê¨ßÈò≥', 'Âè∏È©¨', '‰∏äÂÆò', 'ËØ∏Ëëõ', '‰∏úÊñπ', 'Áã¨Â≠§', 'ÂçóÂÆ´', 'Ë•øÈó®',
            'ÊÖïÂÆπ', 'ËΩ©Ëæï', '‰ª§Áãê', 'ÁöáÁî´', 'ÂÖ¨Â≠ô', 'ÊæπÂè∞'
        ];
        
        // ÂêçÂ≠óÂ∫ìÔºàÊéíÁêÉ/ËøêÂä®Áõ∏ÂÖ≥Ôºâ
        const GIVEN_NAMES = [
            // ÊéíÁêÉÊäÄÊúØÁõ∏ÂÖ≥
            'ÂèëÁêÉ', 'Êâ£ÊùÄ', 'Êã¶ÁΩë', 'Èò≤ÂÆà', '‰º†ÁêÉ', 'Âû´ÁêÉ', 'È£òÁêÉ', 'Ë∑≥Âèë',
            'Êö¥Êâ£', 'ËΩªÂêä', 'Âø´Êîª', 'Âº∫Êîª', 'ÂêéÊîª', 'Ë∑≥È£ò', 'ÊïëÁêÉ', '‰∏Ä‰º†',
            
            // ËøêÂä®ÁâπË¥®Áõ∏ÂÖ≥
            'Â¶ÇÈ£é', '‰ººÁîµ', 'Á†¥Á©∫', 'Âáå‰∫ë', 'ÂÜ≤Â§©', 'ÊÉäÈõ∑', 'Èó™Áîµ', 'ÁñæÈ£é',
            'Áø±Áøî', 'ËÖæË∑É', 'È£ûÊâ¨', 'Â•îÈõ∑', 'ËøΩÈ£é', 'ÈÄêÊó•', 'Á†¥Êµ™', 'ÂáåÁ©∫',
            
            // Âä±ÂøóÁõ∏ÂÖ≥
            'ÂøÖËÉú', '‰∫âÂÖà', 'Ë∂ÖË∂ä', 'ÊãºÊêè', 'Â•ãËøõ', 'ÂêëÂâç', 'ÂÜ≤Èîã', 'Á™ÅÁ†¥',
            'ÁôªÂ≥∞', 'Â§∫ÂÜ†', 'Áß∞Èú∏', 'Êó†Êïå', 'Âà∂Èú∏', 'ÁéãËÄÖ', 'Èú∏‰∏ª', 'Ëá≥Â∞ä',
            
            // ÂìÅË¥®Áõ∏ÂÖ≥
            'ÂùöÈüß', 'ÂàöÊØÖ', 'ÂãáÁåõ', 'ÊûúÊï¢', 'Êó†Áïè', 'Ëã±Âãá', 'Â®ÅÊ≠¶', 'Á•ûÂãá',
            'ÁÅµÂä®', 'ÊïèÊç∑', 'ËøÖÊç∑', 'Áü´ÂÅ•', 'Âº∫ÂÅ•', 'ÈõÑÂ£Æ', 'Â®ÅÁåõ', 'ÂàöÂº∫',
            
            // Ë∞êÈü≥Ê¢óÔºàÊõ¥ÂÉèÂêçÂ≠óÔºâ
            'ÁêÉËÉú', 'ÁΩëÁΩó', 'Êéí‰∫ë', 'Ë∑ÉËøõ', 'È´òÈ£û', 'ËøúÂøó', 'ÂáåÂ≥∞', 'ÈúáÂ§©',
            'ÊÉäÈ∏ø', 'ÁªùÂ∞ò', 'Êó†Âèå', 'Áã¨ÁßÄ', 'Âá∫‰ºó', 'Ë∂ÖÁæ§', 'ÂçìË∂ä', 'ÈùûÂá°',
            
            // ÂçïÂ≠óÂêç
            'Ë∑É', 'È£û', 'Áøî', 'ËÖæ', 'ÂÜ≤', 'ÈóØ', 'Êãº', 'Êêè',
            'Âº∫', 'Âàö', 'Âãá', 'Â®Å', 'Áåõ', 'Èîê', 'Â≥∞', 'Êù∞',
            'ÁÅµ', 'Êïè', 'Êç∑', 'Âø´', 'ËøÖ', 'Áñæ', 'ÈÄü', 'È£é'
        ];
        
        // ÁîüÊàêÈöèÊú∫ÂêçÂ≠ó
        function generateRandomName() {
            const surname = SURNAMES[Math.floor(Math.random() * SURNAMES.length)];
            const givenName = GIVEN_NAMES[Math.floor(Math.random() * GIVEN_NAMES.length)];
            return surname + givenName;
        }
        
        // ÈöèÊú∫‰∫ã‰ª∂Â∫ìÔºàÊâ©Â±ïÁâàÔºâ
        const RANDOM_EVENTS = [
            // ËÆ≠ÁªÉÁõ∏ÂÖ≥‰∫ã‰ª∂
            {
                id: 'senior_guidance',
                type: 'training',
                title: 'üéì Â≠¶ÈïøÊåáÂØº',
                text: 'ËÆ≠ÁªÉÊó∂Ôºå‰∏Ä‰ΩçÂ≠¶ÈïøÊ≥®ÊÑèÂà∞‰∫Ü‰Ω†Ôºå‰∏ªÂä®ËøáÊù•ÊåáÂØº‰Ω†ÁöÑÂä®‰Ωú„ÄÇ',
                choices: [
                    {
                        text: 'ËôöÂøÉËØ∑ÊïôÔºåËÆ§ÁúüÂ≠¶‰π†',
                        effect: { serve: 2, spike: 2, mood: 5, reputation: 2 },
                        result: 'Â≠¶ÈïøÂæàÈ´òÂÖ¥ÔºåÊïô‰∫Ü‰Ω†‰∏Ä‰∫õÊäÄÂ∑ßÔºå‰Ω†ÁöÑÊäÄËÉΩÊúâÊâÄÊèêÂçáÔºÅ'
                    },
                    {
                        text: 'Á§ºË≤åÊÑüË∞¢ÔºåËá™Â∑±Áê¢Á£®',
                        effect: { mood: 2, stress: -2 },
                        result: '‰Ω†‰øùÊåÅ‰∫ÜËá™Â∑±ÁöÑËÆ≠ÁªÉËäÇÂ•è„ÄÇ'
                    }
                ]
            },
            {
                id: 'injury_risk',
                type: 'training',
                title: '‚ö†Ô∏è ËÆ≠ÁªÉÊÑèÂ§ñ',
                text: 'ËÆ≠ÁªÉÂº∫Â∫¶ÊúâÁÇπÂ§ßÔºå‰Ω†ÊÑüËßâË∫´‰ΩìÊúâ‰∫õ‰∏çÈÄÇ...',
                condition: { energy: 30, operator: '<' },
                weight: 3,
                choices: [
                    {
                        text: 'ÂùöÊåÅÂÆåÊàêËÆ≠ÁªÉ',
                        effect: { serve: 2, spike: 2, energy: -10, stress: 5 },
                        result: '‰Ω†Âí¨ÁâôÂùöÊåÅ‰∫Ü‰∏ãÊù•ÔºåÊäÄËÉΩÊúâÊâÄÊèêÂçáÔºå‰ΩÜÂæàÁñ≤ÊÉ´„ÄÇ'
                    },
                    {
                        text: 'ÈÄÇÂΩì‰ºëÊÅØÔºå‰øùÊä§Ë∫´‰Ωì',
                        effect: { energy: 5, mood: 3, stress: -3 },
                        result: '‰Ω†ÊòéÊô∫Âú∞ÈÄâÊã©‰∫Ü‰ºëÊÅØÔºåË∫´‰ΩìÊÅ¢Â§ç‰∫Ü‰∏Ä‰∫õ„ÄÇ'
                    }
                ]
            },
            {
                id: 'coach_praise',
                type: 'training',
                title: 'üëç ÊïôÁªÉË°®Êâ¨',
                text: 'ÊïôÁªÉÊ≥®ÊÑèÂà∞‰Ω†ÊúÄËøëÁöÑËøõÊ≠•ÔºåÂΩì‰ºóË°®Êâ¨‰∫Ü‰Ω†ÔºÅ',
                choices: [
                    {
                        text: 'Ë∞¶ËôöÂõûÂ∫îÔºåÁªßÁª≠Âä™Âäõ',
                        effect: { mood: 8, reputation: 3, stress: -3 },
                        result: '‰Ω†ÁöÑË∞¶ËôöËµ¢Âæó‰∫ÜÂ§ßÂÆ∂ÁöÑÂ•ΩÊÑü„ÄÇ'
                    },
                    {
                        text: '‰ø°ÂøÉÂ§ßÂ¢ûÔºåÂä†ÁªÉ‰∏Ä‰ºö',
                        effect: { serve: 2, spike: 2, energy: -8, mood: 10 },
                        result: '‰Ω†Ë∂ÅÁÉ≠ÊâìÈìÅÔºåÂèàÁªÉ‰∫Ü‰∏Ä‰ºöÂÑøÔºåÊî∂Ëé∑Êª°Êª°ÔºÅ'
                    }
                ]
            },
            {
                id: 'teammate_competition',
                type: 'training',
                title: 'üî• ÈòüÂèãÂàáÁ£ã',
                text: '‰∏Ä‰ΩçÈòüÂèãÂêë‰Ω†ÂèëËµ∑ÂèãÂ•ΩÁöÑÊäÄÊúØÂàáÁ£ã„ÄÇ',
                choices: [
                    {
                        text: 'ÂÖ®ÂäõÂ∫îÊàò',
                        effect: { spike: 2, dig: 1, set: 1, energy: -10, mood: 8, relationship: 3 },
                        result: 'ÊøÄÁÉàÁöÑÂØπÊäóËÆ©‰Ω†‰ª¨ÈÉΩÊúâÊâÄÊî∂Ëé∑ÔºåÂèãË∞ä‰πüÂä†Ê∑±‰∫ÜÔºÅ'
                    },
                    {
                        text: 'Â©âÊãíÔºå‰øùÂ≠ò‰ΩìÂäõ',
                        effect: { energy: 5, stress: -2 },
                        result: '‰Ω†ÈÄâÊã©‰∫Ü‰ºëÊÅØÔºå‰øùÂ≠ò‰ΩìÂäõ„ÄÇ'
                    }
                ]
            },
            
            // ÁîüÊ¥ªÁõ∏ÂÖ≥‰∫ã‰ª∂
            {
                id: 'meet_friend',
                type: 'life',
                title: 'üëã ÂÅ∂ÈÅáÊúãÂèã',
                text: 'Âú®È£üÂ†ÇÈÅáÂà∞‰∫ÜËÄÅÊúãÂèãÔºå‰ªñÈÇÄËØ∑‰Ω†‰∏ÄËµ∑ÂêÉÈ•≠ËÅäÂ§©„ÄÇ',
                choices: [
                    {
                        text: 'ÊÑâÂø´ËÅäÂ§©ÔºåÂàÜ‰∫´ËøëÂÜµ',
                        effect: { mood: 10, stress: -5, money: -15 },
                        result: '‰Ω†‰ª¨ËÅäÂæóÂæàÂºÄÂøÉÔºåÂøÉÊÉÖËàíÁïÖ‰∫ÜËÆ∏Â§öÔºÅ'
                    },
                    {
                        text: 'ÁÆÄÂçïÂØíÊöÑÔºåÂêÑËá™Á¶ªÂºÄ',
                        effect: { mood: 2 },
                        result: '‰Ω†‰ª¨ÁÆÄÂçïËÅä‰∫ÜÂá†Âè•Â∞±ÂàÜÂºÄ‰∫Ü„ÄÇ'
                    }
                ]
            },
            {
                id: 'study_pressure',
                type: 'life',
                title: 'üìù ËØæ‰∏öÂéãÂäõ',
                text: 'Á™ÅÁÑ∂ÊÉ≥Ëµ∑ÊòéÂ§©Êúâ‰∏™‰Ωú‰∏öË¶Å‰∫§ÔºåËøòÊ≤°ÂºÄÂßãÂÅö...',
                choices: [
                    {
                        text: 'ÁÜ¨Â§úËµ∂‰Ωú‰∏ö',
                        effect: { energy: -15, mood: -5, stress: 8, reputation: 2 },
                        result: '‰Ω†ÁÜ¨Â§úÂÆåÊàê‰∫Ü‰Ωú‰∏öÔºå‰ΩÜÂæàÁñ≤ÊÉ´„ÄÇ'
                    },
                    {
                        text: 'ÂÖà‰ºëÊÅØÔºåÊòéÊó©Êó©Ëµ∑ÂÅö',
                        effect: { energy: 10, stress: 3 },
                        result: '‰Ω†ÈÄâÊã©‰∫ÜÂÖà‰ºëÊÅØÔºåÊòéÂ§©ÂÜçËØ¥„ÄÇ'
                    },
                    {
                        text: 'ÊâæÂêåÂ≠¶ÂÄüÈâ¥‰∏Ä‰∏ã',
                        effect: { mood: 5, stress: -5, relationship: -2 },
                        result: 'ÂêåÂ≠¶Â∏Æ‰∫Ü‰Ω†Ôºå‰ΩÜ‰Ω†ÊúâÁÇπ‰∏çÂ•ΩÊÑèÊÄù„ÄÇ'
                    }
                ]
            },
            {
                id: 'lucky_money',
                type: 'life',
                title: 'üí∞ ÊÑèÂ§ñ‰πãË¥¢',
                text: 'Âú®Ë∑Ø‰∏äÊç°Âà∞‰∫Ü‰∏Ä‰∫õÈí±ÔºÅ',
                choices: [
                    {
                        text: '‰∫§ÁªôÂ§±Áâ©ÊãõÈ¢ÜÂ§Ñ',
                        effect: { mood: 5, reputation: 5 },
                        result: '‰Ω†ÂÅö‰∫ÜÊ≠£Á°ÆÁöÑ‰∫ãÔºåÂøÉÈáåÂæàË∏èÂÆû„ÄÇ'
                    },
                    {
                        text: 'Ëá™Â∑±ÁïôÁùÄÁî®',
                        effect: { money: 30, mood: 8, stress: 2 },
                        result: '‰Ω†ÊääÈí±Áïô‰∏ã‰∫ÜÔºå‰ΩÜÂøÉÈáåÊúâÁÇπ‰∏çÂÆâ„ÄÇ'
                    }
                ]
            },
            {
                id: 'club_activity',
                type: 'life',
                title: 'üéâ Á§æÂõ¢Ê¥ªÂä®',
                text: 'ÊéíÁêÉÁ§æÂõ¢ÁªÑÁªáËÅöÈ§êÊ¥ªÂä®ÔºåÈÇÄËØ∑‰Ω†ÂèÇÂä†„ÄÇ',
                choices: [
                    {
                        text: 'ÁßØÊûÅÂèÇÂä†',
                        effect: { mood: 15, stress: -8, money: -30, relationship: 8 },
                        result: 'ËÅöÈ§êÂæàÊÑâÂø´Ôºå‰Ω†ÂíåÈòüÂèã‰ª¨ÁöÑÂÖ≥Á≥ªÊõ¥Ëøë‰∫ÜÔºÅ'
                    },
                    {
                        text: 'Â©âÊãíÈÇÄËØ∑',
                        effect: { energy: 10, money: 10 },
                        result: '‰Ω†ÈÄâÊã©‰∫Ü‰ºëÊÅØÔºåÁúÅ‰∏ã‰∫Ü‰∏ÄÁ¨îÂºÄÈîÄ„ÄÇ'
                    }
                ]
            },
            {
                id: 'equipment_sale',
                type: 'life',
                title: 'üõçÔ∏è Ë£ÖÂ§á‰øÉÈîÄ',
                text: '‰ΩìËÇ≤Áî®ÂìÅÂ∫óÂú®ÊâìÊäòÔºåÊúâ‰∏ÄÂèåÂæà‰∏çÈîôÁöÑÊéíÁêÉÈûã„ÄÇ',
                choices: [
                    {
                        text: '‰π∞‰∏ãÊù•ÔºàËä±Ë¥π80ÂÖÉÔºâ',
                        effect: { money: -80, mood: 12, serve: 2, spike: 2 },
                        requirement: { money: 80 },
                        result: 'Êñ∞ÈûãÂæàËàíÈÄÇÔºåËÆ≠ÁªÉÊïàÊûúÊõ¥Â•Ω‰∫ÜÔºÅ'
                    },
                    {
                        text: '‰∏ç‰π∞ÔºåÁúÅÈí±',
                        effect: { mood: -3 },
                        result: '‰Ω†Âøç‰Ωè‰∫ÜË¥≠‰π∞ÁöÑÂÜ≤Âä®„ÄÇ'
                    }
                ]
            },
            {
                id: 'weather_good',
                type: 'life',
                title: '‚òÄÔ∏è Â•ΩÂ§©Ê∞î',
                text: '‰ªäÂ§©Â§©Ê∞îÁâπÂà´Â•ΩÔºåÈò≥ÂÖâÊòéÂ™öÔºåÂøÉÊÉÖËàíÁïÖ„ÄÇ',
                choices: [
                    {
                        text: 'Âá∫ÂéªÊï£Êï£Ê≠•',
                        effect: { mood: 10, stress: -5, energy: 5 },
                        result: '‰Ω†‰∫´Âèó‰∫ÜÁæéÂ•ΩÁöÑÂ§©Ê∞îÔºåÁ•ûÊ∏ÖÊ∞îÁàΩÔºÅ'
                    },
                    {
                        text: 'Âú®ÂÆøËàç‰ºëÊÅØ',
                        effect: { energy: 8, mood: 3 },
                        result: '‰Ω†Âú®ÂÆøËàçÂ•ΩÂ•Ω‰ºëÊÅØ‰∫Ü‰∏Ä‰∏ã„ÄÇ'
                    }
                ]
            },
            
            // Êñ∞Â¢û‰∫ã‰ª∂ - Âü∫‰∫éÂ±ûÊÄßËß¶Âèë
            {
                id: 'serious_injury',
                type: 'training',
                title: 'üöë ËøêÂä®Êçü‰º§',
                text: 'Á≥üÁ≥ïÔºÅËÆ≠ÁªÉÊó∂‰Ω†‰∏çÂ∞èÂøÉÊâ≠‰º§‰∫ÜËÑöË∏ùÔºåÁñºÁóõÈöæÂøç...',
                condition: { energy: 20, operator: '<' },
                weight: 5,
                choices: [
                    {
                        text: 'Á´ãÂç≥ÂéªÂåªÂä°ÂÆ§ÔºàËä±Ë¥π50ÂÖÉÔºâ',
                        effect: { energy: -5, mood: -10, stress: 5, money: -50 },
                        requirement: { money: 50 },
                        result: 'ÂåªÁîüÁªô‰Ω†ÂÅö‰∫ÜÂ§ÑÁêÜÔºåÈúÄË¶Å‰ºëÊÅØÂá†Â§©„ÄÇ'
                    },
                    {
                        text: 'Âøç‰∏ÄÂøçÔºåËá™Â∑±Â§ÑÁêÜ',
                        effect: { energy: -15, mood: -15, stress: 10, serve: -2, spike: -2 },
                        result: '‰º§ÂäøÂä†Èáç‰∫ÜÔºåÂΩ±Âìç‰∫Ü‰Ω†ÁöÑÁä∂ÊÄÅÂíåÊäÄËÉΩ...'
                    }
                ]
            },
            {
                id: 'perfect_state',
                type: 'training',
                title: '‚ú® ÂÆåÁæéÁä∂ÊÄÅ',
                text: '‰ªäÂ§©Áä∂ÊÄÅÁâπÂà´Â•ΩÔºåÊÑüËßâÊµëË∫´ÂÖÖÊª°ÂäõÈáèÔºÅ',
                condition: { energy: 80, mood: 70, operator: '>' },
                weight: 4,
                choices: [
                    {
                        text: 'Êäì‰ΩèÊú∫‰ºöÔºåÂº∫ÂåñËÆ≠ÁªÉ',
                        effect: { serve: 3, spike: 3, block: 3, energy: -20, mood: 10 },
                        result: '‰Ω†ÂÖÖÂàÜÂà©Áî®‰∫ÜËøô‰∏™Áä∂ÊÄÅÔºåÊäÄËÉΩÂ§ßÂπÖÊèêÂçáÔºÅ'
                    },
                    {
                        text: 'Ê≠£Â∏∏ËÆ≠ÁªÉÂç≥ÂèØ',
                        effect: { serve: 3, spike: 3, energy: -10, mood: 5 },
                        result: '‰Ω†ÂÆåÊàê‰∫ÜÊ≠£Â∏∏ÁöÑËÆ≠ÁªÉ„ÄÇ'
                    }
                ]
            },
            {
                id: 'technique_breakthrough',
                type: 'training',
                title: 'üí° ÊäÄÊúØÁ™ÅÁ†¥',
                text: 'ËÆ≠ÁªÉ‰∏≠‰Ω†Á™ÅÁÑ∂È¢ÜÊÇü‰∫Ü‰∏Ä‰∏™Êñ∞ÊäÄÂ∑ßÔºÅ',
                choices: [
                    {
                        text: 'ÂèçÂ§çÁªÉ‰π†ÔºåÂ∑©Âõ∫ÊäÄÂ∑ß',
                        effect: { serve: 3, spike: 3, energy: -15, mood: 12 },
                        result: '‰Ω†ÊääÊñ∞ÊäÄÂ∑ßÁªÉÂæóÂæàÁÜüÁªÉ‰∫ÜÔºÅ'
                    },
                    {
                        text: 'ËÆ∞Âú®ÂøÉÈáåÔºå‰∏ãÊ¨°ÂÜçÁªÉ',
                        effect: { serve: 2, spike: 2, mood: 5 },
                        result: '‰Ω†ËÆ∞‰Ωè‰∫ÜËøô‰∏™ÊäÄÂ∑ß„ÄÇ'
                    }
                ]
            },
            {
                id: 'equipment_broken',
                type: 'training',
                title: 'üíî Ë£ÖÂ§áÊçüÂùè',
                text: 'ËÆ≠ÁªÉÊó∂‰Ω†ÁöÑÁêÉÈûãÂºÄËÉ∂‰∫ÜÔºåÂΩ±Âìç‰∫ÜËÆ≠ÁªÉÊïàÊûú„ÄÇ',
                choices: [
                    {
                        text: 'È©¨‰∏äÂéª‰π∞Êñ∞ÁöÑÔºàËä±Ë¥π100ÂÖÉÔºâ',
                        effect: { money: -100, mood: -5, serve: 2, spike: 2 },
                        requirement: { money: 100 },
                        result: 'Êñ∞ÈûãÂæàÂêàËÑöÔºåËÆ≠ÁªÉÊïàÊûúÊõ¥Â•Ω‰∫ÜÔºÅ'
                    },
                    {
                        text: 'ÂáëÂêàÁùÄÁî®',
                        effect: { mood: -8, serve: -2, spike: -2 },
                        result: 'Á†¥ÈûãÂΩ±Âìç‰∫Ü‰Ω†ÁöÑÂèëÊå•...'
                    }
                ]
            },
            {
                id: 'depression',
                type: 'life',
                title: 'üòî ÊÉÖÁª™‰ΩéËêΩ',
                text: 'ÊúÄËøëÂøÉÊÉÖ‰∏ÄÁõ¥‰∏çÂ§™Â•ΩÔºåÊÑüËßâÊúâ‰∫õÊäëÈÉÅ...',
                condition: { mood: 30, operator: '<' },
                weight: 4,
                choices: [
                    {
                        text: 'ÊâæÊúãÂèãÂÄæËØâ',
                        effect: { mood: 15, stress: -10, relationship: 5 },
                        result: 'ÊúãÂèãÁöÑÂÆâÊÖ∞ËÆ©‰Ω†ÊÑüËßâÂ•ΩÂ§ö‰∫Ü„ÄÇ'
                    },
                    {
                        text: 'Ëá™Â∑±Ë∞ÉËäÇÔºåÂá∫ÂéªËµ∞Ëµ∞',
                        effect: { mood: 8, stress: -5, energy: -5 },
                        result: 'Êï£Ê≠•ËÆ©‰Ω†ÁöÑÂøÉÊÉÖÁ®çÂæÆÂ•Ω‰∫Ü‰∏Ä‰∫õ„ÄÇ'
                    },
                    {
                        text: '‰∏Ä‰∏™‰∫∫ÂæÖÁùÄ',
                        effect: { mood: -5, stress: 5 },
                        result: '‰Ω†Áã¨Ëá™ÂæÖ‰∫Ü‰∏Ä‰ºöÂÑøÔºå‰ΩÜÂøÉÊÉÖÊ≤°ÊúâÂ•ΩËΩ¨„ÄÇ'
                    }
                ]
            },
            {
                id: 'stress_overload',
                type: 'life',
                title: 'üò∞ ÂéãÂäõÁàÜË°®',
                text: 'ÂéãÂäõÂ§™Â§ß‰∫ÜÔºå‰Ω†ÊÑüËßâÂø´Ë¶ÅÂ¥©Ê∫É‰∫Ü...',
                condition: { stress: 80, operator: '>' },
                weight: 5,
                choices: [
                    {
                        text: 'Êîæ‰∏ã‰∏ÄÂàáÔºåÂ•ΩÂ•Ω‰ºëÊÅØ',
                        effect: { stress: -20, mood: 10, energy: 15 },
                        result: '‰Ω†ÁªôËá™Â∑±Êîæ‰∫Ü‰∏™ÂÅáÔºåÊÑüËßâËΩªÊùæÂ§ö‰∫Ü„ÄÇ'
                    },
                    {
                        text: 'ÊâæÂøÉÁêÜÂí®ËØ¢ÔºàËä±Ë¥π50ÂÖÉÔºâ',
                        effect: { stress: -25, mood: 8, money: -50 },
                        requirement: { money: 50 },
                        result: '‰∏ì‰∏öÁöÑÂ∏ÆÂä©ËÆ©‰Ω†ÈáäÊîæ‰∫ÜÂéãÂäõ„ÄÇ'
                    },
                    {
                        text: 'ÁªßÁª≠Á°¨Êíë',
                        effect: { stress: 5, mood: -10, energy: -10 },
                        result: '‰Ω†ÁöÑÁä∂ÊÄÅË∂äÊù•Ë∂äÂ∑Æ...'
                    }
                ]
            },
            {
                id: 'broke',
                type: 'life',
                title: 'üí∏ ÊâãÂ§¥Á¥ßÂº†',
                text: 'Èí±Âø´Ëä±ÂÖâ‰∫ÜÔºåËøôÂë®ÁöÑÁîüÊ¥ªË¥π‰∏çÂ§üÁî®‰∫Ü...',
                condition: { money: 50, operator: '<' },
                weight: 4,
                choices: [
                    {
                        text: 'ÊâæÂÖºËÅåÊâìÂ∑•',
                        effect: { money: 100, energy: -20, stress: 5, mood: -5 },
                        result: '‰Ω†ËæõËã¶ÊâìÂ∑•Ëµö‰∫Ü‰∫õÈí±„ÄÇ'
                    },
                    {
                        text: 'ÂêëÂÆ∂ÈáåË¶ÅÈí±',
                        effect: { money: 200, mood: -5, stress: 3 },
                        result: 'ÂÆ∂ÈáåÁªô‰Ω†Êâì‰∫ÜÈí±Ôºå‰ΩÜ‰Ω†Êúâ‰∫õÊÑßÁñö„ÄÇ'
                    },
                    {
                        text: 'ËäÇË°£Áº©È£ü',
                        effect: { mood: -8, energy: -5 },
                        result: '‰Ω†ÂºÄÂßãÁúÅÂêÉ‰ø≠Áî®„ÄÇ'
                    }
                ]
            },
            {
                id: 'scholarship',
                type: 'life',
                title: 'üéì Â•ñÂ≠¶ÈáëÈÄöÁü•',
                text: '‰Ω†Ëé∑Âæó‰∫ÜÂ≠¶Ê†°ÁöÑÂ•ñÂ≠¶ÈáëÔºÅ',
                condition: { reputation: 50, operator: '>' },
                weight: 2,
                choices: [
                    {
                        text: 'ÂºÄÂøÉÊé•Âèó',
                        effect: { money: 300, mood: 20, reputation: 5 },
                        result: 'ËøôÊòØÂØπ‰Ω†Âä™ÂäõÁöÑËÆ§ÂèØÔºÅ'
                    }
                ]
            },
            {
                id: 'love_confession',
                type: 'life',
                title: 'üíï Êúâ‰∫∫Ë°®ÁôΩ',
                text: '‰∏Ä‰ΩçÂêåÂ≠¶Âêë‰Ω†Ë°®ÁôΩ‰∫ÜÔºÅ',
                condition: { reputation: 60, operator: '>' },
                weight: 1,
                choices: [
                    {
                        text: 'Êé•ÂèóÔºåÂºÄÂßãÊÅãÁà±',
                        effect: { mood: 25, stress: -15, energy: -5, money: -50 },
                        result: '‰Ω†‰ª¨Âú®‰∏ÄËµ∑‰∫ÜÔºåÊÑüËßâÂæàÂπ∏Á¶èÔºÅ'
                    },
                    {
                        text: 'Â©âÊãíÔºå‰∏ìÊ≥®ÊéíÁêÉ',
                        effect: { mood: -5, stress: 5, serve: 3, spike: 3 },
                        result: '‰Ω†ÈÄâÊã©‰∫Ü‰∏ìÊ≥®‰∫éÊéíÁêÉ‰∫ã‰∏ö„ÄÇ'
                    }
                ]
            },
            {
                id: 'family_call',
                type: 'life',
                title: 'üìû ÂÆ∂‰∫∫Êù•Áîµ',
                text: 'ÂÆ∂ÈáåÊâìÊù•ÁîµËØùÔºåÂÖ≥ÂøÉ‰Ω†ÁöÑËøëÂÜµ„ÄÇ',
                choices: [
                    {
                        text: 'ËÅäËÅäËøëÂÜµ',
                        effect: { mood: 12, stress: -8 },
                        result: 'ÂíåÂÆ∂‰∫∫ËÅäÂ§©ËÆ©‰Ω†ÊÑüÂà∞Ê∏©Êöñ„ÄÇ'
                    },
                    {
                        text: 'ÁÆÄÂçïÊä•Âπ≥ÂÆâ',
                        effect: { mood: 3 },
                        result: '‰Ω†ÁÆÄÂçïËØ¥‰∫ÜÂá†Âè•Â∞±ÊåÇ‰∫ÜÁîµËØù„ÄÇ'
                    }
                ]
            },
            {
                id: 'roommate_conflict',
                type: 'life',
                title: 'üò§ ÂÆ§ÂèãÁüõÁõæ',
                text: 'ÂíåÂÆ§ÂèãÂõ†‰∏∫‰∏Ä‰∫õÂ∞è‰∫ãÂèëÁîü‰∫Ü‰∫âÊâß„ÄÇ',
                choices: [
                    {
                        text: '‰∏ªÂä®ÈÅìÊ≠âÂíåËß£',
                        effect: { mood: 5, stress: -5, relationship: 3 },
                        result: '‰Ω†‰ª¨ÂíåÂ•Ω‰∫ÜÔºåÂÖ≥Á≥ªÂèçËÄåÊõ¥Ëøë‰∫Ü„ÄÇ'
                    },
                    {
                        text: 'ÂÜ∑ÊàòÂ§ÑÁêÜ',
                        effect: { mood: -10, stress: 8 },
                        result: 'ÂÆøËàçÊ∞îÊ∞õÂèòÂæóÂæàÂ∞¥Â∞¨...'
                    }
                ]
            },
            {
                id: 'game_addiction',
                type: 'life',
                title: 'üéÆ Ê∏∏ÊàèËØ±ÊÉë',
                text: 'Êñ∞Ê∏∏Êàè‰∏äÁ∫ø‰∫ÜÔºåÊúãÂèã‰ª¨ÈÉΩÂú®Áé©Ôºå‰Ω†‰πüÂæàÊÉ≥ËØïËØï...',
                choices: [
                    {
                        text: 'Áé©‰∏ÄÊï¥Â§©',
                        effect: { mood: 20, stress: -15, energy: -15, serve: -2, spike: -2 },
                        result: 'Ê∏∏ÊàèÂæàÂ•ΩÁé©Ôºå‰ΩÜËçíÂ∫ü‰∫ÜËÆ≠ÁªÉ...'
                    },
                    {
                        text: 'Áé©‰∏Ä‰ºöÂ∞±ÂÅú',
                        effect: { mood: 10, stress: -5, energy: -5 },
                        result: '‰Ω†ÈÄÇÂ∫¶Â®±‰πêÔºå‰øùÊåÅ‰∫ÜÂπ≥Ë°°„ÄÇ'
                    },
                    {
                        text: 'ÊãíÁªùËØ±ÊÉë',
                        effect: { mood: -3, serve: 3, spike: 3 },
                        result: '‰Ω†ÂùöÊåÅËÆ≠ÁªÉÔºåÊäÄËÉΩÊúâÊâÄÊèêÂçá„ÄÇ'
                    }
                ]
            },
            {
                id: 'food_poisoning',
                type: 'life',
                title: 'ü§¢ È£üÁâ©‰∏≠ÊØí',
                text: 'ÂêÉ‰∫Ü‰∏çÂπ≤ÂáÄÁöÑ‰∏úË•øÔºåËÇöÂ≠êÂæà‰∏çËàíÊúç...',
                choices: [
                    {
                        text: 'ÂéªÂåªÈô¢ÁúãÁóÖÔºàËä±Ë¥π80ÂÖÉÔºâ',
                        effect: { energy: -10, mood: -5, money: -80 },
                        requirement: { money: 80 },
                        result: 'ÂåªÁîüÁªô‰Ω†ÂºÄ‰∫ÜËçØÔºå‰ºëÊÅØÂá†Â§©Â∞±Â•Ω‰∫Ü„ÄÇ'
                    },
                    {
                        text: 'Ëá™Â∑±‰π∞ËçØÂêÉÔºàËä±Ë¥π20ÂÖÉÔºâ',
                        effect: { energy: -15, mood: -8, money: -20 },
                        requirement: { money: 20 },
                        result: 'ÂêÉ‰∫ÜËçØÔºå‰ΩÜËøòÊòØÂæàÈöæÂèó„ÄÇ'
                    }
                ]
            },
            {
                id: 'volunteer_activity',
                type: 'life',
                title: 'ü§ù ÂøóÊÑøËÄÖÊ¥ªÂä®',
                text: 'Â≠¶Ê†°ÁªÑÁªáÂøóÊÑøËÄÖÊ¥ªÂä®ÔºåÈÇÄËØ∑‰Ω†ÂèÇÂä†„ÄÇ',
                choices: [
                    {
                        text: 'ÁßØÊûÅÂèÇ‰∏é',
                        effect: { mood: 15, stress: -5, energy: -10, reputation: 8 },
                        result: 'Â∏ÆÂä©‰ªñ‰∫∫ËÆ©‰Ω†ÊÑüÂà∞ÂæàÂÖÖÂÆûÔºÅ'
                    },
                    {
                        text: 'Â©âÊãíÈÇÄËØ∑',
                        effect: { energy: 5 },
                        result: '‰Ω†ÈÄâÊã©‰∫Ü‰ºëÊÅØ„ÄÇ'
                    }
                ]
            },
            {
                id: 'talent_show',
                type: 'life',
                title: 'üé§ ÊâçËâ∫Ë°®Êºî',
                text: 'Â≠¶Ê†°‰∏æÂäûÊâçËâ∫Ë°®ÊºîÔºåÊúâ‰∫∫Âª∫ËÆÆ‰Ω†Â±ïÁ§∫ÊéíÁêÉÊäÄÂ∑ß„ÄÇ',
                condition: { serve: 40, spike: 40, operator: '>' },
                weight: 2,
                choices: [
                    {
                        text: '‰∏äÂè∞Ë°®Êºî',
                        effect: { mood: 18, stress: 5, reputation: 10, relationship: 8 },
                        result: '‰Ω†ÁöÑË°®ÊºîËµ¢Âæó‰∫ÜÁÉ≠ÁÉàÊéåÂ£∞ÔºÅ'
                    },
                    {
                        text: 'ÂÆ≥ÁæûÊãíÁªù',
                        effect: { mood: -3, stress: -2 },
                        result: '‰Ω†‰∏çÂ•ΩÊÑèÊÄù‰∏äÂè∞„ÄÇ'
                    }
                ]
            },
            {
                id: 'exam_week',
                type: 'life',
                title: 'üìö ËÄÉËØïÂë®',
                text: 'ÊúüÊú´ËÄÉËØïÂë®Âà∞‰∫ÜÔºåÈúÄË¶ÅÂπ≥Ë°°Â≠¶‰π†ÂíåËÆ≠ÁªÉ„ÄÇ',
                choices: [
                    {
                        text: '‰∏ìÂøÉÂ§ç‰π†ÔºåÊöÇÂÅúËÆ≠ÁªÉ',
                        effect: { stress: 10, energy: -10, serve: -3, spike: -3, reputation: 5 },
                        result: '‰Ω†ÈÄöËøá‰∫ÜËÄÉËØïÔºå‰ΩÜÊäÄËÉΩÊúâÊâÄÈÄÄÊ≠•„ÄÇ'
                    },
                    {
                        text: '‰∏§ËÄÖÂÖºÈ°æ',
                        effect: { stress: 15, energy: -20, mood: -10 },
                        result: '‰Ω†ÂæàÁ¥ØÔºå‰ΩÜÈÉΩÂùöÊåÅ‰∫Ü‰∏ãÊù•„ÄÇ'
                    },
                    {
                        text: '‰ºòÂÖàËÆ≠ÁªÉ',
                        effect: { serve: 5, spike: 5, stress: 8, reputation: -5 },
                        result: 'ËÆ≠ÁªÉÊïàÊûú‰∏çÈîôÔºå‰ΩÜÊàêÁª©‰∏çÂ§™ÁêÜÊÉ≥„ÄÇ'
                    }
                ]
            },
            {
                id: 'birthday',
                type: 'life',
                title: 'üéÇ ÁîüÊó•Âø´‰πê',
                text: '‰ªäÂ§©ÊòØ‰Ω†ÁöÑÁîüÊó•ÔºåÈòüÂèã‰ª¨Áªô‰Ω†ÂáÜÂ§á‰∫ÜÊÉäÂñúÔºÅ',
                choices: [
                    {
                        text: 'ÂºÄÂøÉÂ∫ÜÁ•ù',
                        effect: { mood: 25, stress: -15, relationship: 10, money: -30 },
                        result: 'ËøôÊòØÈöæÂøòÁöÑ‰∏ÄÂ§©ÔºÅ'
                    }
                ]
            },
            {
                id: 'rainy_day',
                type: 'life',
                title: 'üåßÔ∏è Èò¥Èõ®Â§©',
                text: 'ËøûÁª≠‰∏ã‰∫ÜÂ•ΩÂá†Â§©Èõ®ÔºåÂøÉÊÉÖÊúâ‰∫õ‰ΩéËêΩ„ÄÇ',
                choices: [
                    {
                        text: 'ÂÆ§ÂÜÖËÆ≠ÁªÉ',
                        effect: { serve: 3, spike: 3, energy: -10, mood: -3 },
                        result: 'ËôΩÁÑ∂Â§©Ê∞î‰∏çÂ•ΩÔºå‰ΩÜ‰Ω†ÂùöÊåÅ‰∫ÜËÆ≠ÁªÉ„ÄÇ'
                    },
                    {
                        text: '‰ºëÊÅØÊîæÊùæ',
                        effect: { energy: 10, mood: 5, stress: -5 },
                        result: '‰Ω†Â•ΩÂ•Ω‰ºëÊÅØ‰∫Ü‰∏Ä‰∏ã„ÄÇ'
                    }
                ]
            },
            {
                id: 'inspiration',
                type: 'life',
                title: 'üí´ ËßÇËµõÂêØÂèë',
                text: 'Áúã‰∫Ü‰∏ÄÂú∫Á≤æÂΩ©ÁöÑÊéíÁêÉÊØîËµõÔºåÊ∑±ÂèóÂêØÂèëÔºÅ',
                choices: [
                    {
                        text: 'È©¨‰∏äÂéªËÆ≠ÁªÉ',
                        effect: { serve: 2, spike: 2, block: 2, energy: -15, mood: 15 },
                        result: '‰Ω†ÂÖÖÊª°Âä®ÂäõÔºåËÆ≠ÁªÉÊïàÊûúÂæàÂ•ΩÔºÅ'
                    },
                    {
                        text: 'ËÆ∞Âú®ÂøÉÈáå',
                        effect: { mood: 8, serve: 2, spike: 2 },
                        result: '‰Ω†Â≠¶Âà∞‰∫Ü‰∏Ä‰∫õÊñ∞‰∏úË•ø„ÄÇ'
                    }
                ]
            },
            {
                id: 'senior_retire',
                type: 'life',
                title: 'üëã Â≠¶ÈïøÊØï‰∏ö',
                text: '‰∏ÄÁõ¥ÊåáÂØº‰Ω†ÁöÑÂ≠¶ÈïøË¶ÅÊØï‰∏ö‰∫ÜÔºå‰ªñÈÄÅÁªô‰Ω†‰∏Ä‰∫õËÆ≠ÁªÉÂøÉÂæó„ÄÇ',
                condition: { reputation: 40, operator: '>' },
                weight: 2,
                choices: [
                    {
                        text: 'ËÆ§ÁúüÂ≠¶‰π†ÂøÉÂæó',
                        effect: { serve: 2, spike: 2, block: 2, mood: 10, reputation: 5 },
                        result: 'Â≠¶ÈïøÁöÑÁªèÈ™åËÆ©‰Ω†ÂèóÁõäÂå™ÊµÖÔºÅ'
                    },
                    {
                        text: 'ÊÑüË∞¢Âπ∂ÈÅìÂà´',
                        effect: { mood: 5, reputation: 2 },
                        result: '‰Ω†‰ª¨‰∫íÁõ∏Á•ùÁ¶è„ÄÇ'
                    }
                ]
            },
            {
                id: 'media_interview',
                type: 'life',
                title: 'üì∞ Â™í‰ΩìÈááËÆø',
                text: 'Ê†°Êä•ËÆ∞ËÄÖÊÉ≥ÈááËÆø‰Ω†Ëøô‰ΩçÊéíÁêÉÊñ∞Êòü„ÄÇ',
                condition: { reputation: 80, operator: '>' },
                weight: 2,
                choices: [
                    {
                        text: 'Êé•ÂèóÈááËÆø',
                        effect: { mood: 12, stress: 5, reputation: 10 },
                        result: '‰Ω†ÁöÑÊïÖ‰∫ãÁôª‰∏ä‰∫ÜÊ†°Êä•ÔºÅ'
                    },
                    {
                        text: '‰ΩéË∞ÉÊãíÁªù',
                        effect: { mood: 3, stress: -3 },
                        result: '‰Ω†ÈÄâÊã©‰øùÊåÅ‰ΩéË∞É„ÄÇ'
                    }
                ]
            },
            {
                id: 'lucky_day',
                type: 'life',
                title: 'üçÄ Âπ∏ËøêÊó•',
                text: '‰ªäÂ§©ËøêÊ∞îÁâπÂà´Â•ΩÔºåÂ•Ω‰∫ãËøûËøûÔºÅ',
                choices: [
                    {
                        text: '‰∫´ÂèóËøô‰∏ÄÂ§©',
                        effect: { mood: 15, stress: -10, money: 50, reputation: 3 },
                        result: 'ÁúüÊòØÁæéÂ•ΩÁöÑ‰∏ÄÂ§©ÔºÅ'
                    }
                ]
            },
            {
                id: 'part_time_offer',
                type: 'life',
                title: 'üíº ÂÖºËÅåÊú∫‰ºö',
                text: '‰ΩìËÇ≤Áî®ÂìÅÂ∫óËÄÅÊùøÁúã‰∏≠‰∫Ü‰Ω†ÔºåÈÇÄËØ∑‰Ω†Êù•Â∫óÈáåÂÅöÂÖºËÅå„ÄÇ',
                choices: [
                    {
                        text: 'Êé•ÂèóÂÖºËÅåÔºàÈáëÈí±+200Ôºå‰ΩìÂäõ-15ÔºåÂéãÂäõ+5Ôºâ',
                        effect: { money: 200, energy: -15, stress: 5, mood: 5 },
                        result: '‰Ω†Âú®Â∫óÈáåÂ∑•‰Ωú‰∫Ü‰∏ÄÊÆµÊó∂Èó¥ÔºåËµö‰∫Ü‰∏çÂ∞ëÈí±„ÄÇ'
                    },
                    {
                        text: 'Â©âÊãíÔºå‰∏ìÊ≥®ËÆ≠ÁªÉ',
                        effect: { serve: 3, spike: 3, mood: 3 },
                        result: '‰Ω†ÈÄâÊã©ÊääÊó∂Èó¥Áî®Âú®ËÆ≠ÁªÉ‰∏ä„ÄÇ'
                    }
                ]
            },
            {
                id: 'shopping_temptation',
                type: 'life',
                title: 'üõçÔ∏è Ë¥≠Áâ©ËØ±ÊÉë',
                text: 'Ë∑ØËøáÂïÜÂú∫ÔºåÁúãÂà∞ÂæàÂ§öÊÉ≥‰π∞ÁöÑ‰∏úË•ø...',
                condition: { money: 200, operator: '>' },
                weight: 2,
                choices: [
                    {
                        text: 'ÁñØÁãÇË¥≠Áâ©ÔºàÂøÉÊÉÖ+30ÔºåËä±Ë¥π300ÂÖÉÔºâ',
                        effect: { mood: 30, stress: -15, money: -300 },
                        requirement: { money: 300 },
                        result: '‰π∞‰π∞‰π∞ÔºÅÂøÉÊÉÖÂ§ßÂ•ΩÔºÅ'
                    },
                    {
                        text: 'ÁêÜÊÄßÊ∂àË¥πÔºàÂøÉÊÉÖ+10ÔºåËä±Ë¥π50ÂÖÉÔºâ',
                        effect: { mood: 10, money: -50 },
                        requirement: { money: 50 },
                        result: '‰Ω†Âè™‰π∞‰∫ÜÂøÖÈúÄÂìÅ„ÄÇ'
                    },
                    {
                        text: 'Âøç‰Ωè‰∏ç‰π∞',
                        effect: { mood: -5, stress: 3 },
                        result: '‰Ω†Âøç‰Ωè‰∫ÜË¥≠Áâ©ÁöÑÂÜ≤Âä®Ôºå‰ΩÜÊúâÁÇπ‰∏çÂºÄÂøÉ„ÄÇ'
                    }
                ]
            },
            {
                id: 'sponsor_offer',
                type: 'life',
                title: 'ü§ù ËµûÂä©ÈÇÄÁ∫¶',
                text: '‰∏ÄÂÆ∂ËøêÂä®ÂìÅÁâåÁúã‰∏≠‰∫Ü‰Ω†ÁöÑÊΩúÂäõÔºåÊÑøÊÑèÊèê‰æõËµûÂä©ÔºÅ',
                condition: { reputation: 70, operator: '>' },
                weight: 2,
                choices: [
                    {
                        text: 'Êé•ÂèóËµûÂä©',
                        effect: { money: 500, mood: 20, reputation: 10, serve: 3, spike: 3 },
                        result: '‰Ω†Ëé∑Âæó‰∫ÜÂìÅÁâåËµûÂä©ÔºåËøòÂæóÂà∞‰∫Ü‰∏ì‰∏öË£ÖÂ§áÔºÅ'
                    },
                    {
                        text: 'ÊöÇÊó∂ÊãíÁªù',
                        effect: { mood: 5 },
                        result: '‰Ω†ËßâÂæóÊó∂Êú∫Ëøò‰∏çÊàêÁÜü„ÄÇ'
                    }
                ]
            },
            {
                id: 'lottery_win',
                type: 'life',
                title: 'üé∞ ‰∏≠Â•ñ‰∫Ü',
                text: '‰Ω†‰π∞ÁöÑÂΩ©Á•®‰∏≠‰∫ÜÂ∞èÂ•ñÔºÅ',
                choices: [
                    {
                        text: 'ÂºÄÂøÉÊî∂Èí±',
                        effect: { money: 100, mood: 15 },
                        result: 'ÊÑèÂ§ñ‰πãË¥¢ÔºåÁúüÂºÄÂøÉÔºÅ'
                    }
                ]
            },
            {
                id: 'friend_borrow',
                type: 'life',
                title: 'üí∏ ÊúãÂèãÂÄüÈí±',
                text: '‰∏Ä‰ΩçÊúãÂèãÈÅáÂà∞Âõ∞ÈöæÔºåÂêë‰Ω†ÂÄü200ÂÖÉ„ÄÇ',
                condition: { money: 200, operator: '>' },
                weight: 2,
                choices: [
                    {
                        text: 'ÂÄüÁªô‰ªñ',
                        effect: { money: -200, mood: 5, relationship: 10, reputation: 5 },
                        result: 'ÊúãÂèãÂæàÊÑüÊøÄ‰Ω†ÁöÑÂ∏ÆÂä©„ÄÇ'
                    },
                    {
                        text: 'Â©âÊãí',
                        effect: { mood: -5, relationship: -5 },
                        result: '‰Ω†ÊãíÁªù‰∫ÜÔºå‰ΩÜÂøÉÈáåÊúâ‰∫õ‰∏çÂÆâ„ÄÇ'
                    }
                ]
            },
            {
                id: 'expensive_equipment',
                type: 'life',
                title: '‚≠ê È°∂Á∫ßË£ÖÂ§á',
                text: 'ÂèëÁé∞‰∏ÄÂ•óÈ°∂Á∫ßÊéíÁêÉË£ÖÂ§áÔºå‰ΩÜ‰ª∑Ê†ºÊòÇË¥µÔºà500ÂÖÉÔºâ„ÄÇ',
                condition: { money: 500, operator: '>' },
                weight: 2,
                choices: [
                    {
                        text: '‰π∞‰∏ãÊù•',
                        effect: { money: -500, mood: 25, serve: 5, spike: 5, block: 5, dig: 3, set: 3 },
                        requirement: { money: 500 },
                        result: 'È°∂Á∫ßË£ÖÂ§áËÆ©‰Ω†ÁöÑËÆ≠ÁªÉÊïàÊûúÂ§ßÂπÖÊèêÂçáÔºÅ'
                    },
                    {
                        text: 'Â§™Ë¥µ‰∫ÜÔºå‰∏ç‰π∞',
                        effect: { mood: -8 },
                        result: '‰Ω†ÂøçÁóõÊîæÂºÉ‰∫Ü„ÄÇ'
                    }
                ]
            },
            {
                id: 'treat_teammates',
                type: 'life',
                title: 'üçï ËØ∑ÂÆ¢ÂêÉÈ•≠',
                text: 'ÈòüÂèã‰ª¨ÊèêËÆÆËÅöÈ§êÔºåÂ§ßÂÆ∂ÈÉΩÁúãÁùÄ‰Ω†...',
                choices: [
                    {
                        text: 'ÊàëËØ∑ÂÆ¢ÔºÅÔºàËä±Ë¥π150ÂÖÉÔºâ',
                        effect: { money: -150, mood: 15, relationship: 20, reputation: 8 },
                        requirement: { money: 150 },
                        result: '‰Ω†ÁöÑÊÖ∑ÊÖ®Ëµ¢Âæó‰∫ÜÂ§ßÂÆ∂ÁöÑÂ•ΩÊÑüÔºÅ'
                    },
                    {
                        text: 'AAÂà∂ÂêßÔºàËä±Ë¥π30ÂÖÉÔºâ',
                        effect: { money: -30, mood: 8, relationship: 5 },
                        requirement: { money: 30 },
                        result: 'Â§ßÂÆ∂AAÂà∂ÔºåÊ∞îÊ∞õ‰πü‰∏çÈîô„ÄÇ'
                    },
                    {
                        text: 'ÊàëÊ≤°Èí±Ôºå‰∏çÂéª‰∫Ü',
                        effect: { mood: -10, relationship: -5 },
                        result: '‰Ω†ÈîôËøá‰∫ÜËøôÊ¨°ËÅöÈ§ê„ÄÇ'
                    }
                ]
            },
            {
                id: 'coach_conflict',
                type: 'training',
                title: 'üò† ‰∏éÊïôÁªÉ‰∫âÊâß',
                text: 'ËÆ≠ÁªÉ‰∏≠‰Ω†ÂíåÊïôÁªÉÂõ†‰∏∫ÊäÄÊúØÂä®‰Ωú‰∫ßÁîü‰∫ÜÂàÜÊ≠ßÔºå‰∫âÊâßËµ∑Êù•...',
                condition: { stress: 60, operator: '>' },
                weight: 3,
                choices: [
                    {
                        text: 'ÂùöÊåÅÂ∑±ËßÅÔºåÊãíÁªùÊîπÊ≠£',
                        effect: { spike: -3, block: -2, mood: -10, stress: 5, reputation: -8 },
                        result: 'ÊïôÁªÉÂæàÁîüÊ∞îÔºå‰Ω†ÁöÑÊäÄÊúØ‰πüÂõ†‰∏∫ÈîôËØØÂä®‰ΩúËÄåÈÄÄÊ≠•‰∫Ü...'
                    },
                    {
                        text: 'ÂÜ∑Èùô‰∏ãÊù•ÔºåËôöÂøÉÊé•Âèó',
                        effect: { mood: -5, stress: -5, reputation: 3, spike: 2 },
                        result: '‰Ω†ÊÑèËØÜÂà∞‰∫ÜËá™Â∑±ÁöÑÈîôËØØÔºåÊïôÁªÉÁöÑÊåáÂØºËÆ©‰Ω†ËøõÊ≠•‰∫Ü„ÄÇ'
                    },
                    {
                        text: 'ÊöÇÊó∂Á¶ªÂºÄÔºåÂÜ∑Èùô‰∏Ä‰∏ã',
                        effect: { mood: -3, stress: -3, energy: 5 },
                        result: '‰Ω†‰ª¨ÈÉΩÈúÄË¶ÅÊó∂Èó¥ÂÜ∑Èùô„ÄÇ'
                    }
                ]
            },
            {
                id: 'training_burnout',
                type: 'training',
                title: 'üò´ ËÆ≠ÁªÉÂÄ¶ÊÄ†',
                text: 'ËøûÁª≠È´òÂº∫Â∫¶ËÆ≠ÁªÉËÆ©‰Ω†ÊÑüÂà∞Áñ≤ÊÉ´ÂíåÂéåÂÄ¶ÔºåÂä®‰ΩúÂºÄÂßãÂèòÂΩ¢...',
                condition: { energy: 25, stress: 70, operator: '<' },
                weight: 4,
                choices: [
                    {
                        text: 'Âº∫Ëø´Ëá™Â∑±ÁªßÁª≠',
                        effect: { serve: -2, spike: -2, energy: -15, mood: -10, stress: 10 },
                        result: 'ËøáÂ∫¶ËÆ≠ÁªÉÂØºËá¥ÊäÄÊúØÈÄÄÊ≠•ÔºåË∫´ÂøÉ‰ø±Áñ≤...'
                    },
                    {
                        text: '‰ºëÊÅØ‰∏ÄÂë®',
                        effect: { energy: 30, mood: 15, stress: -20, serve: -1, spike: -1 },
                        result: 'ÂÖÖÂàÜ‰ºëÊÅØÂêéÁä∂ÊÄÅÊÅ¢Â§ç‰∫ÜÔºå‰ΩÜÊäÄËÉΩÊúâ‰∫õÁîüÁñè„ÄÇ'
                    },
                    {
                        text: 'Èôç‰ΩéËÆ≠ÁªÉÂº∫Â∫¶',
                        effect: { energy: 10, mood: 5, stress: -10 },
                        result: '‰Ω†Ë∞ÉÊï¥‰∫ÜËÆ≠ÁªÉËÆ°ÂàíÔºåÊâæÂõû‰∫ÜÂπ≥Ë°°„ÄÇ'
                    }
                ]
            },
            {
                id: 'wrong_technique',
                type: 'training',
                title: '‚ùå Âä®‰ΩúÈîôËØØ',
                text: '‰Ω†ÂèëÁé∞Ëá™Â∑±‰∏ÄÁõ¥Âú®Áî®ÈîôËØØÁöÑÂä®‰ΩúËÆ≠ÁªÉÔºåÂÖªÊàê‰∫ÜÂùè‰π†ÊÉØ...',
                weight: 3,
                choices: [
                    {
                        text: 'Á´ãÂç≥Á∫†Ê≠£ÔºàÈúÄË¶ÅÊó∂Èó¥Ôºâ',
                        effect: { serve: -3, spike: -3, energy: -15, mood: -8 },
                        result: 'Á∫†Ê≠£ÈîôËØØÂä®‰ΩúÂæàÁóõËã¶ÔºåÊäÄËÉΩÊöÇÊó∂‰∏ãÈôç‰∫Ü...'
                    },
                    {
                        text: 'ËØ∑ÁßÅÊïôÊåáÂØºÔºàËä±Ë¥π150ÂÖÉÔºâ',
                        effect: { serve: 2, spike: 2, money: -150, mood: 5 },
                        requirement: { money: 150 },
                        result: 'ÁßÅÊïôÂ∏Æ‰Ω†Á∫†Ê≠£‰∫ÜÂä®‰ΩúÔºåËøòÊúâÈ¢ùÂ§ñÊî∂Ëé∑ÔºÅ'
                    },
                    {
                        text: 'ÁªßÁª≠Áî®ÈîôËØØÂä®‰Ωú',
                        effect: { serve: -1, spike: -1, block: -1 },
                        result: 'ÈîôËØØÁöÑÂä®‰ΩúÈôêÂà∂‰∫Ü‰Ω†ÁöÑËøõÊ≠•...'
                    }
                ]
            },
            {
                id: 'team_competition_pressure',
                type: 'training',
                title: 'üò∞ Á´û‰∫âÂéãÂäõ',
                text: 'ÈòüÂÜÖÁ´û‰∫âÊøÄÁÉàÔºå‰Ω†ÊãÖÂøÉËá™Â∑±‰ºöË¢´ÊõøË°•ÔºåÂéãÂäõÂæàÂ§ß...',
                condition: { stress: 50, operator: '>' },
                weight: 3,
                choices: [
                    {
                        text: 'Âä†ÂÄçËÆ≠ÁªÉËØÅÊòéËá™Â∑±',
                        effect: { serve: 3, spike: 3, energy: -25, mood: -10, stress: 15 },
                        result: '‰Ω†ÊãºÂëΩËÆ≠ÁªÉÔºåÊäÄËÉΩÊèêÂçá‰∫Ü‰ΩÜË∫´ÂøÉ‰ø±Áñ≤„ÄÇ'
                    },
                    {
                        text: 'ÊâæÊïôÁªÉÊ≤üÈÄö',
                        effect: { mood: 5, stress: -10, reputation: 3 },
                        result: 'ÊïôÁªÉÁöÑÈºìÂä±ËÆ©‰Ω†Êîæ‰∏ã‰∫ÜÂåÖË¢±„ÄÇ'
                    },
                    {
                        text: 'Ëá™Êö¥Ëá™ÂºÉ',
                        effect: { serve: -2, spike: -2, mood: -15, stress: 5, reputation: -5 },
                        result: 'Ê∂àÊûÅÁöÑÊÄÅÂ∫¶ËÆ©‰Ω†ÁöÑÁä∂ÊÄÅË∂äÊù•Ë∂äÂ∑Æ...'
                    }
                ]
            },
            {
                id: 'match_mistake_shadow',
                type: 'life',
                title: 'üòî Â§±ËØØÈò¥ÂΩ±',
                text: '‰∏äÊ¨°ÊØîËµõÁöÑÂ§±ËØØ‰∏ÄÁõ¥Âõ∞Êâ∞ÁùÄ‰Ω†Ôºå‰Ω†ÂºÄÂßãÊÄÄÁñëËá™Â∑±ÁöÑËÉΩÂäõ...',
                condition: { mood: 40, operator: '<' },
                weight: 3,
                choices: [
                    {
                        text: 'ÈÄÉÈÅøËÆ≠ÁªÉ',
                        effect: { serve: -3, spike: -3, mood: -10, stress: 10 },
                        result: 'ÈÄÉÈÅøËÆ©ÈóÆÈ¢òÊõ¥‰∏•Èáç‰∫Ü...'
                    },
                    {
                        text: 'ÈíàÂØπÊÄßËÆ≠ÁªÉ',
                        effect: { serve: 3, spike: 3, energy: -20, mood: 10, stress: -10 },
                        result: '‰Ω†ÂÖãÊúç‰∫ÜÂøÉÁêÜÈöúÁ¢çÔºåÊäÄÊúØ‰πüÊèêÂçá‰∫ÜÔºÅ'
                    },
                    {
                        text: 'ÂØªÊ±ÇÂøÉÁêÜËæÖÂØºÔºàËä±Ë¥π80ÂÖÉÔºâ',
                        effect: { mood: 15, stress: -15, money: -80 },
                        requirement: { money: 80 },
                        result: '‰∏ì‰∏öÁöÑÂ∏ÆÂä©ËÆ©‰Ω†Ëµ∞Âá∫‰∫ÜÈò¥ÂΩ±„ÄÇ'
                    }
                ]
            },
            {
                id: 'injury_relapse',
                type: 'training',
                title: 'ü§ï Êóß‰º§Â§çÂèë',
                text: '‰πãÂâçÁöÑ‰º§ËøòÊ≤°ÂÆåÂÖ®Â•ΩÔºåËÆ≠ÁªÉÊó∂ÂèàÊÑüÂà∞ÁñºÁóõ...',
                weight: 2,
                choices: [
                    {
                        text: 'ÂøçÁóõÁªßÁª≠ËÆ≠ÁªÉ',
                        effect: { serve: -4, spike: -4, energy: -20, mood: -15 },
                        result: '‰º§ÂäøÂä†ÈáçÔºå‰∏•ÈáçÂΩ±Âìç‰∫Ü‰Ω†ÁöÑÁä∂ÊÄÅ...'
                    },
                    {
                        text: 'ÂÅúÊ≠¢ËÆ≠ÁªÉÔºåÂ•ΩÂ•Ω‰ºëÂÖª',
                        effect: { energy: 20, mood: -5, serve: -1, spike: -1 },
                        result: '‰ºëÊÅØËÆ©‰º§ÂäøÂ•ΩËΩ¨Ôºå‰ΩÜÊäÄËÉΩÊúâ‰∫õÁîüÁñè„ÄÇ'
                    },
                    {
                        text: 'ÂéªÂåªÈô¢Ê≤ªÁñóÔºàËä±Ë¥π200ÂÖÉÔºâ',
                        effect: { energy: 10, mood: 5, money: -200 },
                        requirement: { money: 200 },
                        result: '‰∏ì‰∏öÊ≤ªÁñóËÆ©‰Ω†ÊÅ¢Â§ç‰∫ÜÂÅ•Â∫∑„ÄÇ'
                    }
                ]
            },
            {
                id: 'teammate_conflict',
                type: 'life',
                title: 'üíî ÈòüÂèãÁüõÁõæ',
                text: '‰Ω†Âíå‰∏ªÂäõÈòüÂëòÂèëÁîü‰∫Ü‰∏•ÈáçÂÜ≤Á™ÅÔºåÈòüÂÜÖÊ∞îÊ∞õÂæàÁ¥ßÂº†...',
                condition: { relationship: 30, operator: '<' },
                weight: 3,
                choices: [
                    {
                        text: '‰∏ªÂä®ÈÅìÊ≠âÂíåËß£',
                        effect: { mood: 5, stress: -10, relationship: 15, reputation: 5 },
                        result: '‰Ω†ÁöÑÂ§ßÂ∫¶Ëµ¢Âæó‰∫ÜÂ∞äÈáçÔºåÂÖ≥Á≥ªÊîπÂñÑ‰∫Ü„ÄÇ'
                    },
                    {
                        text: 'ÁªßÁª≠ÂÜ∑Êàò',
                        effect: { mood: -15, stress: 15, relationship: -10, serve: -2, spike: -2 },
                        result: 'Á≥üÁ≥ïÁöÑÈòüÂÜÖÂÖ≥Á≥ªÂΩ±Âìç‰∫Ü‰Ω†ÁöÑËÆ≠ÁªÉÂíåÂèëÊå•...'
                    },
                    {
                        text: 'ËØ∑ÊïôÁªÉË∞ÉËß£',
                        effect: { mood: -5, stress: -5, relationship: 5, reputation: -3 },
                        result: 'ÊïôÁªÉÂ∏Æ‰Ω†‰ª¨Ë∞ÉËß£‰∫ÜÁüõÁõæ„ÄÇ'
                    }
                ]
            }
        ];
        
        const SCENES = {
            nameInput: {
                text: `<div id="name-input-panel">
                    <h2>üèê Ê¨¢ËøéÊù•Âà∞ÊéíÁêÉ‰πãÊòü</h2>
                    <p style="margin-bottom: 20px; color: #666;">‰Ω†Âç≥Â∞ÜÂºÄÂßã‰∏ÄÊÆµ‰ªéËèúÈ∏üÂà∞ÂÜ†ÂÜõÁöÑÊéíÁêÉ‰πãÊóÖ</p>
                    <div id="name-input-container">
                        <input type="text" id="player-name-input" placeholder="ËØ∑ËæìÂÖ•‰Ω†ÁöÑÂêçÂ≠ó" maxlength="10" />
                        <button id="random-name-btn" onclick="game.randomName()" title="ÈöèÊú∫ÂêçÂ≠ó">üé≤</button>
                    </div>
                    <div id="initial-attributes">
                        <h3>üé≤ ÂàùÂßãËÉΩÂäõ</h3>
                        <div class="init-attr-item">
                            <span>üéØ ÂèëÁêÉ</span>
                            <span class="init-attr-value" id="init-serve">0</span>
                        </div>
                        <div class="init-attr-item">
                            <span>‚ö° Êâ£ÁêÉ</span>
                            <span class="init-attr-value" id="init-spike">0</span>
                        </div>
                        <div class="init-attr-item">
                            <span>üõ°Ô∏è Êã¶ÁΩë</span>
                            <span class="init-attr-value" id="init-block">0</span>
                        </div>
                        <div class="init-attr-item">
                            <span>üèê Âû´ÁêÉ</span>
                            <span class="init-attr-value" id="init-dig">0</span>
                        </div>
                        <div class="init-attr-item">
                            <span>ü§≤ ÊâòÁêÉ</span>
                            <span class="init-attr-value" id="init-set">0</span>
                        </div>
                        <div class="init-attr-item">
                            <span>üí™ ‰ΩìÂäõ‰∏äÈôê</span>
                            <span class="init-attr-value" id="init-energy">100</span>
                        </div>
                        <div class="init-attr-item">
                            <span>üí∞ ÂàùÂßãÈáëÈí±</span>
                            <span class="init-attr-value" id="init-money">500</span>
                        </div>
                        <div id="reroll-container">
                            <button id="reroll-btn" onclick="game.rerollAttributes()">üé≤ ÈáçÊñ∞ÈöèÊú∫</button>
                            <span id="reroll-count">Ââ©‰ΩôÊ¨°Êï∞Ôºö5/5</span>
                        </div>
                    </div>
                    <button onclick="game.submitName()">ÂºÄÂßãÊ∏∏Êàè</button>
                </div>`,
                choices: []
            },
            
            start: {
                text: `<h2>üéì Â§ßÂ≠¶Êñ∞ÁîüÊ¥ª</h2>
                <p>‰Ω†ÊòØ‰∏ÄÂêçÂàöÂÖ•Â≠¶ÁöÑÂ§ß‰∏ÄÊñ∞ÁîüÔºå‰ªéÊú™Êé•Ëß¶ËøáÊéíÁêÉ„ÄÇ</p>
                <p>ÂºÄÂ≠¶Á¨¨‰∏ÄÂë®Ôºå‰Ω†Ë∑ØËøá‰ΩìËÇ≤È¶ÜÔºåÁúãÂà∞ÊéíÁêÉÁ§æÂõ¢Ê≠£Âú®ÊãõÊñ∞„ÄÇÈò≥ÂÖâÈÄèËøáÁ™óÊà∑Ê¥íÂú®ÁêÉÂú∫‰∏äÔºåÂ≠¶ÈïøÂ≠¶Âßê‰ª¨Áü´ÂÅ•ÁöÑË∫´ÂΩ±ËÆ©‰Ω†ÂøÉÁîüÂêëÂæÄ„ÄÇ</p>
                <p>"ÊÉ≥ËØïËØïÂêóÔºü"‰∏Ä‰ΩçÂ≠¶ÂßêÁ¨ëÁùÄÂêë‰Ω†ÊãõÊâã„ÄÇ</p>`,
                choices: [
                    {
                        text: 'üèê Âä†ÂÖ•ÊéíÁêÉÁ§æÂõ¢ÔºåÂºÄÂßãËÆ≠ÁªÉÔºÅ',
                        next: 'weeklyHub'
                    },
                    {
                        text: 'üìö ÂÖàËßÇÂØü‰∏Ä‰∏ãÔºå‰∫ÜËß£Êõ¥Â§ö‰ø°ÊÅØ',
                        next: 'observe'
                    }
                ]
            },

            
            observe: {
                text: `<h2>üëÄ ËßÇÂØüÂ≠¶‰π†</h2>
                <p>‰Ω†Âú®Âú∫ËæπËßÇÂØü‰∫Ü‰∏Ä‰ºöÂÑøÔºåÁúãÂà∞Â≠¶ÈïøÂ≠¶Âßê‰ª¨Âú®ÁªÉ‰π†ÂêÑÁßçÊäÄÊúØÔºö</p>
                <p>‚Ä¢ ÂèëÁêÉÔºöÂ∞ÜÁêÉÈ´òÈ´òÊäõËµ∑ÔºåÁî®ÂäõÂáªÊâìËøáÁΩë<br>
                ‚Ä¢ Êâ£ÁêÉÔºöË∑≥Ëµ∑Êù•Áî®ÂäõÂ∞ÜÁêÉÁ†∏ÂêëÂØπÊñπÂú∫Âú∞<br>
                ‚Ä¢ Êã¶ÁΩëÔºöÂú®ÁΩëÂâçË∑≥Ëµ∑ÈòªÊå°ÂØπÊñπÁöÑËøõÊîª<br>
                ‚Ä¢ Èò≤ÂÆàÔºöÂø´ÈÄüÁßªÂä®Êé•Ëµ∑ÂØπÊñπÁöÑÊîªÂáª</p>
                <p>ÁúãËµ∑Êù•ÂæàÊúâË∂£ÔºÅ‰Ω†ÂÜ≥ÂÆö...</p>`,
                choices: [
                    {
                        text: 'üí™ Áé∞Âú®Â∞±Âä†ÂÖ•ÔºåÂºÄÂßãËÆ≠ÁªÉÔºÅ',
                        next: 'weeklyHub'
                    }
                ]
            },
            
            weeklyHub: {
                text: '',
                choices: []
            },
            
            shopMain: {
                text: '',
                choices: []
            },
            
            lifeChoice: {
                text: '',
                choices: []
            },
            
            trainingChoice: {
                text: `<h2>üèãÔ∏è ÈÄâÊã©ËÆ≠ÁªÉÈ°πÁõÆ</h2>
                <p>‰ªäÂ§©‰Ω†ÊÉ≥ÈáçÁÇπËÆ≠ÁªÉÂì™‰∏™ÊäÄËÉΩÔºü</p>
                <p style="color: #999; font-size: 14px;">ËÆ≠ÁªÉ‰ºöÊ∂àËÄó‰ΩìÂäõÂíåÂøÉÊÉÖÔºå‰ΩÜËÉΩÊèêÂçáÊäÄËÉΩ</p>`,
                choices: [
                    {
                        text: 'üéØ ÂèëÁêÉËÆ≠ÁªÉÔºà‰ΩìÂäõ-15ÔºåÂøÉÊÉÖ-5Ôºâ',
                        next: 'lifeChoice',
                        requirement: { energy: 15 },
                        effect: { serve: 3, energy: -15, mood: -5, stress: 3, trained: true, eventType: 'training' }
                    },
                    {
                        text: '‚ö° Êâ£ÁêÉËÆ≠ÁªÉÔºà‰ΩìÂäõ-20ÔºåÂøÉÊÉÖ-8Ôºâ',
                        next: 'lifeChoice',
                        requirement: { energy: 20 },
                        effect: { spike: 3, energy: -20, mood: -8, stress: 5, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'üõ°Ô∏è Êã¶ÁΩëËÆ≠ÁªÉÔºà‰ΩìÂäõ-18ÔºåÂøÉÊÉÖ-6Ôºâ',
                        next: 'lifeChoice',
                        requirement: { energy: 18 },
                        effect: { block: 3, energy: -18, mood: -6, stress: 4, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'ü§∏ Âû´ÁêÉËÆ≠ÁªÉÔºà‰ΩìÂäõ-15ÔºåÂøÉÊÉÖ-5Ôºâ',
                        next: 'lifeChoice',
                        requirement: { energy: 15 },
                        effect: { dig: 3, energy: -15, mood: -5, stress: 3, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'üôå ÊâòÁêÉËÆ≠ÁªÉÔºà‰ΩìÂäõ-15ÔºåÂøÉÊÉÖ-5Ôºâ',
                        next: 'lifeChoice',
                        requirement: { energy: 15 },
                        effect: { set: 3, energy: -15, mood: -5, stress: 3, trained: true, eventType: 'training' }
                    },
                    {
                        text: '‚è≠Ô∏è Ë∑≥ËøáËÆ≠ÁªÉÔºåÁõ¥Êé•ËØæ‰ΩôÁîüÊ¥ª',
                        next: 'lifeChoice',
                        effect: { trained: true }
                    },
                    {
                        text: 'üîô ËøîÂõû',
                        next: 'weeklyHub'
                    }
                ]
            },
            
            lifeChoice: {
                text: `<h2>üåü ËØæ‰ΩôÁîüÊ¥ª</h2>
                <p>ËÆ≠ÁªÉÁªìÊùü‰∫ÜÔºå‰Ω†ÊÉ≥ÂÅö‰∫õ‰ªÄ‰πàÊù•ÊîæÊùæ‰∏Ä‰∏ãÔºü</p>`,
                choices: [
                    {
                        text: 'üçú ÂêÉÂ§úÂÆµÔºàÂøÉÊÉÖ+15Ôºå‰ΩìÂäõ-5ÔºåÂéãÂäõ-5ÔºåËä±Ë¥π20ÂÖÉÔºâ',
                        next: 'checkRandomEvent',
                        requirement: { money: 20 },
                        effect: { mood: 15, energy: -5, stress: -5, money: -20, eventType: 'life' }
                    },
                    {
                        text: 'üèê ÊâìÈáéÁêÉÔºà25ÂàÜÂà∂ÊØîËµõÔºå‰ΩìÂäõ-20Ôºâ',
                        next: 'casualMatch',
                        requirement: { energy: 20 },
                        effect: { matchType: 'casual', energy: -20 }
                    },
                    {
                        text: 'üéÆ ÊâìÊ∏∏ÊàèÔºàÂøÉÊÉÖ+10ÔºåÂéãÂäõ-8Ôºå‰ΩìÂäõ-3Ôºâ',
                        next: 'checkRandomEvent',
                        effect: { mood: 10, stress: -8, energy: -3, eventType: 'life' }
                    },
                    {
                        text: 'ÔøΩ ÂéªÂõæ‰π¶È¶ÜÔºàÂøÉÊÉÖ+5ÔºåÂéãÂäõ+3ÔºåÂ£∞Êúõ+2Ôºâ',
                        next: 'checkRandomEvent',
                        effect: { mood: 5, stress: 3, reputation: 2, eventType: 'life' }
                    },
                    {
                        text: 'ÔøΩ Êó©ÁÇπ‰ºëÊÅØÔºà‰ΩìÂäõ+20ÔºåÂøÉÊÉÖ+8ÔºåÂéãÂäõ-5Ôºâ',
                        next: 'checkRandomEvent',
                        effect: { energy: 20, mood: 8, stress: -5, eventType: 'life' }
                    },
                    {
                        text: 'üë• ÂíåÈòüÂèãËÅäÂ§©ÔºàÂøÉÊÉÖ+12ÔºåÂéãÂäõ-6ÔºåÂÖ≥Á≥ª+5Ôºâ',
                        next: 'checkRandomEvent',
                        effect: { mood: 12, stress: -6, relationship: 5, eventType: 'life' }
                    },
                    {
                        text: 'üçø ÁúãÁîµÂΩ±ÔºàÂøÉÊÉÖ+18ÔºåÂéãÂäõ-10ÔºåËä±Ë¥π50ÂÖÉÔºâ',
                        next: 'checkRandomEvent',
                        requirement: { money: 50 },
                        effect: { mood: 18, stress: -10, money: -50, eventType: 'life' }
                    },
                    {
                        text: 'üõí ‰π∞ËøêÂä®Ë£ÖÂ§áÔºàÊäÄËÉΩ+2ÔºåÂøÉÊÉÖ+10ÔºåËä±Ë¥π250ÂÖÉÔºâ',
                        next: 'checkRandomEvent',
                        requirement: { money: 250 },
                        effect: { serve: 2, spike: 2, block: 2, dig: 1, set: 1, mood: 10, money: -250, eventType: 'life' }
                    },
                    {
                        text: 'üíº ÂÖºËÅåÊâìÂ∑•ÔºàÈáëÈí±+150Ôºå‰ΩìÂäõ-20ÔºåÂéãÂäõ+8Ôºâ',
                        next: 'checkRandomEvent',
                        requirement: { energy: 20 },
                        effect: { money: 150, energy: -20, stress: 8, mood: -5, eventType: 'life' }
                    },
                    {
                        text: 'üçî ÂêÉÂ§ßÈ§êÔºàÂøÉÊÉÖ+25Ôºå‰ΩìÂäõ+10ÔºåËä±Ë¥π100ÂÖÉÔºâ',
                        next: 'checkRandomEvent',
                        requirement: { money: 100 },
                        effect: { mood: 25, energy: 10, stress: -8, money: -100, eventType: 'life' }
                    },
                    {
                        text: 'üéÅ ÁªôÈòüÂèã‰π∞Á§ºÁâ©ÔºàÂÖ≥Á≥ª+15ÔºåÂ£∞Êúõ+5ÔºåËä±Ë¥π80ÂÖÉÔºâ',
                        next: 'checkRandomEvent',
                        requirement: { money: 80 },
                        effect: { relationship: 15, reputation: 5, mood: 8, money: -80, eventType: 'life' }
                    },
                    {
                        text: 'üì± ‰π∞Êñ∞ÊâãÊú∫ÔºàÂøÉÊÉÖ+20ÔºåÂéãÂäõ-5ÔºåËä±Ë¥π800ÂÖÉÔºâ',
                        next: 'checkRandomEvent',
                        requirement: { money: 800 },
                        effect: { mood: 20, stress: -5, money: -800, eventType: 'life' }
                    }
                ]
            },
            
            casualMatch: {
                text: '',
                choices: []
            },
            
            matchResult: {
                text: '',
                choices: []
            },
            
            checkRandomEvent: {
                text: '',
                choices: []
            },
            
            randomEvent: {
                text: '',
                choices: []
            },

            
            basicTraining: {
                text: `<h2>üìà Âü∫Á°ÄËÆ≠ÁªÉÈò∂ÊÆµ</h2>
                <p>ÁªèËøáÂá†Âë®ÁöÑËÆ≠ÁªÉÔºå‰Ω†Â∑≤ÁªèÊéåÊè°‰∫ÜÂü∫Êú¨ÁöÑÊéíÁêÉÊäÄÊúØ„ÄÇÊïôÁªÉËØ¥‰Ω†ÂæàÊúâÂ§©Ëµã„ÄÇ</p>
                <p>Áé∞Âú®‰Ω†ÂèØ‰ª•ÈÄâÊã©ÈáçÁÇπËÆ≠ÁªÉÊüêÈ°πÊäÄËÉΩÔºåÊàñËÄÖÂèÇÂä†Èô¢ÈòüÁöÑÈÄâÊãî„ÄÇ</p>`,
                choices: [
                    {
                        text: 'ÁªßÁª≠ËÆ≠ÁªÉ',
                        next: 'weeklyHub'
                    }
                ]
            },
            
            weekEnd: {
                text: `<h2>üìä Êú¨Âë®ÊÄªÁªì</h2>
                <p>Á¨¨ ${this.player ? this.player.week : 1} Âë®ÁªìÊùü‰∫ÜÔºÅ</p>
                <p>Êú¨Âë®ËÆ≠ÁªÉ‰∫Ü ${this.player ? this.player.trainingCount : 0} Ê¨°</p>
                <p>Ëé∑ÂæóÈõ∂Ëä±Èí± +120ÂÖÉ</p>
                <p>‰ΩìÂäõ„ÄÅÂøÉÊÉÖËá™ÁÑ∂ÊÅ¢Â§çÔºåÂéãÂäõÂáèËΩª</p>`,
                choices: [
                    {
                        text: 'ÂºÄÂßãÊñ∞ÁöÑ‰∏ÄÂë®',
                        next: 'weeklyHub',
                        effect: { nextWeek: true }
                    }
                ]
            },
            
            eventResult: {
                text: '',
                choices: [
                    {
                        text: 'ÁªßÁª≠',
                        next: 'weeklyHub'
                    }
                ]
            },

            
            rest: {
                text: `<h2>üí§ ‰ºëÊÅØÊÅ¢Â§ç</h2>
                <p>‰Ω†Â•ΩÂ•Ω‰ºëÊÅØ‰∫Ü‰∏ÄÊÆµÊó∂Èó¥Ôºå‰ΩìÂäõÊÅ¢Â§ç‰∫Ü„ÄÇ</p>
                <p>ÊòéÂ§©ÁªßÁª≠Âä†Ê≤πÔºÅ</p>`,
                choices: [
                    { text: 'ÁªßÁª≠ËÆ≠ÁªÉ', next: 'basicTraining' }
                ]
            },
            
            collegeTryout: {
                text: `<h2>üéØ Èô¢ÈòüÈÄâÊãî</h2>
                <p>Èô¢ÈòüÁöÑÈÄâÊãîËµõÂºÄÂßã‰∫ÜÔºÅ‰Ω†ÈúÄË¶ÅÂú®ÊïôÁªÉÂíåÂ≠¶ÈïøÈù¢ÂâçÂ±ïÁ§∫‰Ω†ÁöÑÊäÄÊúØ„ÄÇ</p>
                <p>ÂèëÁêÉ„ÄÅÊé•ÁêÉ„ÄÅÊâ£ÁêÉ...‰Ω†ÂÖ®Âäõ‰ª•Ëµ¥Âú∞ÂÆåÊàê‰∫ÜÊØè‰∏Ä‰∏™Âä®‰Ωú„ÄÇ</p>
                <p>ÊïôÁªÉÊª°ÊÑèÂú∞ÁÇπ‰∫ÜÁÇπÂ§¥Ôºö"‰∏çÈîôÔºåÊ¨¢ËøéÂä†ÂÖ•Èô¢ÈòüÔºÅ"</p>
                <p><strong>ÊàêÂ∞±ËææÊàêÔºöÂä†ÂÖ•Èô¢ÈòüÔºÅ</strong></p>
                <p><strong>Â£∞Êúõ +20</strong></p>`,
                choices: [
                    {
                        text: 'üéâ Â§™Â•Ω‰∫ÜÔºÅÈÄâÊã©Âú∫‰∏ä‰ΩçÁΩÆ',
                        next: 'positionSelection',
                        effect: { reputation: 20, team: 'college', weeklyAllowance: 150, goalUpdate: 'collegeMatch' }
                    }
                ]
            },
            
            positionSelection: {
                text: `<h2>üèê ÈÄâÊã©‰Ω†ÁöÑÂú∫‰∏ä‰ΩçÁΩÆ</h2>
                <p>ÊïôÁªÉÔºö"‰Ω†Â∑≤ÁªèÊéåÊè°‰∫ÜÂü∫Êú¨ÊäÄËÉΩÔºåÁé∞Âú®ÈúÄË¶ÅÈÄâÊã©‰∏Ä‰∏™‰∏ìÁ≤æÁöÑ‰ΩçÁΩÆ„ÄÇ"</p>
                <p>"ÊØè‰∏™‰ΩçÁΩÆÈÉΩÊúâ‰∏çÂêåÁöÑËÅåË¥£ÂíåË¶ÅÊ±ÇÔºåÈÄâÊã©ÈÄÇÂêà‰Ω†ÁöÑ‰ΩçÁΩÆÂêßÔºÅ"</p>
                <div id="position-cards"></div>`,
                choices: [] // Âä®ÊÄÅÁîüÊàê
            },
            
            collegeTeam: {
                text: `<h2>üè´ Èô¢ÈòüËÆ≠ÁªÉ</h2>
                <p>‰Ωú‰∏∫Èô¢ÈòüÁöÑ‰∏ÄÂëòÔºåËÆ≠ÁªÉÂº∫Â∫¶ÊòéÊòæÊèêÂçá‰∫Ü„ÄÇ‰Ω†ÂíåÈòüÂèã‰ª¨‰∏ÄËµ∑ËÆ≠ÁªÉÔºåÊäÄÊúØËøõÊ≠•ÂæàÂø´„ÄÇ</p>`,
                choices: [
                    // Âü∫Á°ÄËÆ≠ÁªÉÂàÜÁ±ªÊ†áÈ¢ò
                    {
                        text: '',
                        separator: true,
                        separatorText: '<h3>üìã Âü∫Á°ÄËÆ≠ÁªÉÔºà‰ΩìÂäõ-30Ôºâ</h3>'
                    },
                    // Âü∫Á°ÄËÆ≠ÁªÉÔºàÈôç‰ΩéÔºö6‚Üí4Ôºâ
                    {
                        text: 'üéØ ÂèëÁêÉËÆ≠ÁªÉ',
                        next: 'lifeChoice',
                        requirement: { energy: 30 },
                        effect: { serve: 4, energy: -30, trained: true, eventType: 'training' }
                    },
                    {
                        text: '‚ö° Êâ£ÁêÉËÆ≠ÁªÉ',
                        next: 'lifeChoice',
                        requirement: { energy: 30 },
                        effect: { spike: 4, energy: -30, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'üõ°Ô∏è Êã¶ÁΩëËÆ≠ÁªÉ',
                        next: 'lifeChoice',
                        requirement: { energy: 30 },
                        effect: { block: 4, energy: -30, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'ü§∏ Âû´ÁêÉËÆ≠ÁªÉ',
                        next: 'lifeChoice',
                        requirement: { energy: 30 },
                        effect: { dig: 4, energy: -30, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'üôå ÊâòÁêÉËÆ≠ÁªÉ',
                        next: 'lifeChoice',
                        requirement: { energy: 30 },
                        effect: { set: 4, energy: -30, trained: true, eventType: 'training' }
                    },
                    // ÁªÑÂêàËÆ≠ÁªÉÂàÜÁ±ªÊ†áÈ¢ò
                    {
                        text: '',
                        separator: true,
                        separatorText: '<h3>üî• ÁªÑÂêàËÆ≠ÁªÉÔºà‰ΩìÂäõ-35Ôºâ</h3>'
                    },
                    // ÁªÑÂêàËÆ≠ÁªÉ
                    {
                        text: 'ÔøΩ ËøõÊîªÁªÑÂêà',
                        next: 'lifeChoice',
                        requirement: { energy: 35 },
                        effect: { spike: 4, serve: 3, energy: -35, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'üõ°Ô∏è Èò≤ÂÆàÁªÑÂêà',
                        next: 'lifeChoice',
                        requirement: { energy: 35 },
                        effect: { block: 4, dig: 3, energy: -35, trained: true, eventType: 'training' }
                    },
                    // ÂÖ∂‰ªñÈÄâÈ°πÂàÜÈöî
                    {
                        text: '',
                        separator: true,
                        separatorText: '<div style="margin-top: 15px;"></div>'
                    },
                    // ÂÖ∂‰ªñÈÄâÈ°π
                    {
                        text: '‚è≠Ô∏è Ë∑≥ËøáËÆ≠ÁªÉ',
                        next: 'lifeChoice',
                        effect: { trained: true }
                    },
                    {
                        text: 'üîô ËøîÂõû',
                        next: 'weeklyHub'
                    }
                ]
            },
            
            rest2: {
                text: `<h2>üí§ ‰ºëÊÅØÊÅ¢Â§ç</h2>
                <p>‰Ω†Â•ΩÂ•Ω‰ºëÊÅØ‰∫Ü‰∏ÄÊÆµÊó∂Èó¥Ôºå‰ΩìÂäõÊÅ¢Â§ç‰∫Ü„ÄÇ</p>
                <p>ÁªßÁª≠‰∏∫ÊØîËµõÂÅöÂáÜÂ§áÔºÅ</p>`,
                choices: [
                    { text: 'ÁªßÁª≠ËÆ≠ÁªÉ', next: 'collegeTeam' }
                ]
            },

            
            collegeMatch: {
                text: `<h2>üèê Èô¢ÈôÖÊØîËµõ</h2>
                <p>ÊØîËµõÊó•Âà∞‰∫ÜÔºÅ‰ΩìËÇ≤È¶ÜÈáåÊå§Êª°‰∫Ü‰∏∫ÂêÑËá™Â≠¶Èô¢Âä†Ê≤πÁöÑÂêåÂ≠¶„ÄÇ</p>
                <p>Á¨¨‰∏ÄÂ±ÄÔºå‰Ω†ÁöÑÂèëÁêÉÁõ¥Êé•ÂæóÂàÜÔºÅËßÇ‰ºóÂ∏≠‰º†Êù•Ê¨¢ÂëºÂ£∞„ÄÇ</p>
                <p>Á¨¨‰∫åÂ±ÄÔºå‰Ω†ÊàêÂäüÊã¶‰∏ã‰∫ÜÂØπÊñπÁöÑÊâ£ÁêÉÔºå‰∏∫Èòü‰ºçËµ¢Âæó‰∫ÜÂÖ≥ÈîÆÂàÜÊï∞„ÄÇ</p>
                <p>ÊúÄÁªàÔºå‰Ω†‰ª¨Â≠¶Èô¢‰ª•3:1Ëé∑ËÉúÔºÅ</p>
                <p><strong>Â£∞Êúõ +30ÔºåÂÖ®ÊäÄËÉΩ +5</strong></p>`,
                choices: [
                    {
                        text: 'üéâ Â§™Ê£í‰∫ÜÔºÅÁªßÁª≠Âä™Âäõ',
                        next: 'weeklyHub',
                        effect: { reputation: 30, serve: 5, spike: 5, block: 5, dig: 3, set: 3 }
                    }
                ]
            },
            
            universityTryout: {
                text: `<h2>‚≠ê Ê†°ÈòüÈÄâÊãî</h2>
                <p>Ê†°ÈòüÁöÑÈÄâÊãîÈùûÂ∏∏‰∏•Ê†ºÔºåÊù•Ëá™ÂêÑ‰∏™Â≠¶Èô¢ÁöÑÈ´òÊâãÈΩêËÅö‰∏ÄÂ†Ç„ÄÇ</p>
                <p>‰Ω†Â±ïÁ§∫‰∫ÜÁ≤æÂáÜÁöÑÂèëÁêÉ„ÄÅÂº∫ÂäõÁöÑÊâ£ÁêÉ„ÄÅÁ®≥Âõ∫ÁöÑÊã¶ÁΩëÂíåÁÅµÊ¥ªÁöÑÈò≤ÂÆà„ÄÇ</p>
                <p>‰∏ªÊïôÁªÉ‰ªîÁªÜËßÇÂØüÁùÄÊØè‰∏Ä‰∏™‰∫∫ÁöÑË°®Áé∞...</p>
                <p>"ÊÅ≠Âñú‰Ω†ÔºåÊ¨¢ËøéÂä†ÂÖ•Ê†°ÈòüÔºÅ"</p>
                <p><strong>ÊàêÂ∞±ËææÊàêÔºöÂä†ÂÖ•Ê†°ÈòüÔºÅ</strong></p>
                <p><strong>Â£∞Êúõ +50</strong></p>`,
                choices: [
                    {
                        text: 'üåü ÂºÄÂßãÊ†°ÈòüËÆ≠ÁªÉ',
                        next: 'weeklyHub',
                        effect: { reputation: 50, team: 'university', weeklyAllowance: 200, goalUpdate: 'universityLeague' }
                    }
                ]
            },
            
            universityLeague: {
                text: `<h2>üèÖ Ê†°ÈôÖËÅîËµõ</h2>
                <p>Ê†°ÈôÖËÅîËµõÊ±áËÅö‰∫ÜÂÖ®Â∏ÇÂêÑÂ§ßÈ´òÊ†°ÁöÑÁ≤æËã±Èòü‰ºç„ÄÇ</p>
                <p>ËøôÊòØ‰Ω†Â§ßÂ≠¶ÊéíÁêÉÁîüÊ∂ØÁöÑÊúÄÂêé‰∏ÄÊàòÔºÅ</p>
                <p>‰Ω†ÂáÜÂ§áÂ•Ω‰∫ÜÂêóÔºü</p>`,
                choices: [
                    {
                        text: 'üèê ÂºÄÂßãÊØîËµõ',
                        next: 'weeklyHub',
                        effect: { startFormalMatch: { matchType: 'universityLeague', matchName: 'Ê†°ÈôÖËÅîËµõ' } }
                    }
                ]
            },

            
            universityTeam: {
                text: `<h2>üåü Ê†°ÈòüËÆ≠ÁªÉ</h2>
                <p>Ê†°ÈòüÁöÑËÆ≠ÁªÉÊõ¥Âä†‰∏ì‰∏öÂíåÁ≥ªÁªü„ÄÇ‰Ω†ÂíåÂÖ®Ê†°ÊúÄ‰ºòÁßÄÁöÑÊéíÁêÉÈÄâÊâã‰∏ÄËµ∑ËÆ≠ÁªÉ„ÄÇ</p>`,
                choices: [
                    // Âü∫Á°ÄËÆ≠ÁªÉÂàÜÁ±ªÊ†áÈ¢ò
                    {
                        text: '',
                        separator: true,
                        separatorText: '<h3>üìã Âü∫Á°ÄËÆ≠ÁªÉÔºà‰ΩìÂäõ-35Ôºâ</h3>'
                    },
                    // Âü∫Á°ÄËÆ≠ÁªÉ - ‰øùÊåÅ5‰∏™Áã¨Á´ãÊäÄËÉΩÔºàÈôç‰ΩéÔºö8‚Üí5Ôºâ
                    {
                        text: 'üéØ ÂèëÁêÉËÆ≠ÁªÉ',
                        next: 'lifeChoice',
                        requirement: { energy: 35 },
                        effect: { serve: 5, energy: -35, trained: true, eventType: 'training' }
                    },
                    {
                        text: '‚ö° Êâ£ÁêÉËÆ≠ÁªÉ',
                        next: 'lifeChoice',
                        requirement: { energy: 35 },
                        effect: { spike: 5, energy: -35, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'üõ°Ô∏è Êã¶ÁΩëËÆ≠ÁªÉ',
                        next: 'lifeChoice',
                        requirement: { energy: 35 },
                        effect: { block: 5, energy: -35, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'ü§∏ Âû´ÁêÉËÆ≠ÁªÉ',
                        next: 'lifeChoice',
                        requirement: { energy: 35 },
                        effect: { dig: 5, energy: -35, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'üôå ÊâòÁêÉËÆ≠ÁªÉ',
                        next: 'lifeChoice',
                        requirement: { energy: 35 },
                        effect: { set: 5, energy: -35, trained: true, eventType: 'training' }
                    },
                    // ÁªÑÂêàËÆ≠ÁªÉÂàÜÁ±ªÊ†áÈ¢ò
                    {
                        text: '',
                        separator: true,
                        separatorText: '<h3>üî• ÁªÑÂêàËÆ≠ÁªÉÔºà‰ΩìÂäõ-40Ôºâ</h3>'
                    },
                    // ÁªÑÂêàËÆ≠ÁªÉ
                    {
                        text: 'ÔøΩ ËøõÊîªÁªÑÂêà',
                        next: 'lifeChoice',
                        requirement: { energy: 40 },
                        effect: { spike: 4, serve: 3, energy: -40, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'üõ°Ô∏è Èò≤ÂÆàÁªÑÂêà',
                        next: 'lifeChoice',
                        requirement: { energy: 40 },
                        effect: { block: 4, dig: 3, energy: -40, trained: true, eventType: 'training' }
                    },
                    // È´òÁ∫ßËÆ≠ÁªÉÂàÜÁ±ªÊ†áÈ¢ò
                    {
                        text: '',
                        separator: true,
                        separatorText: '<h3>‚≠ê È´òÁ∫ßËÆ≠ÁªÉÔºà‰ΩìÂäõ-45/-50Ôºâ</h3>'
                    },
                    // È´òÁ∫ßËÆ≠ÁªÉÔºà‰ªÖÊ†°ÈòüÔºâ
                    {
                        text: 'üéØ ÁªÑÁªáÁªÑÂêà',
                        next: 'lifeChoice',
                        requirement: { energy: 45 },
                        effect: { set: 4, dig: 3, energy: -45, trained: true, eventType: 'training' }
                    },
                    {
                        text: '‚≠ê ÂÖ®Èù¢ÂèëÂ±ï',
                        next: 'lifeChoice',
                        requirement: { energy: 50 },
                        effect: { serve: 2, spike: 2, block: 2, dig: 2, set: 2, energy: -50, trained: true, eventType: 'training' }
                    },
                    {
                        text: 'ÔøΩ ‰ΩìËÉΩÂº∫Âåñ',
                        next: 'lifeChoice',
                        requirement: { energy: 50 },
                        effect: { serve: 2, spike: 2, block: 2, dig: 2, set: 2, maxEnergyBonus: 2, energy: -50, trained: true, eventType: 'training' }
                    },
                    // ÂÖ∂‰ªñÈÄâÈ°πÂàÜÈöî
                    {
                        text: '',
                        separator: true,
                        separatorText: '<div style="margin-top: 15px;"></div>'
                    },
                    // ÂÖ∂‰ªñÈÄâÈ°π
                    {
                        text: '‚è≠Ô∏è Ë∑≥ËøáËÆ≠ÁªÉ',
                        next: 'lifeChoice',
                        effect: { trained: true }
                    },
                    {
                        text: 'üîô ËøîÂõû',
                        next: 'weeklyHub'
                    }
                ]
            },

            
            // ==================== ÁªìÂ±ÄÂú∫ÊôØ ====================
            // Ê†πÊçÆÊ†°ÈôÖËÅîËµõË°®Áé∞Ëß¶Âèë‰∏çÂêåÁªìÂ±Ä
            
            // Èî¶Ê†áËµõÂºÄÂπïÂú∫ÊôØ
            tournamentStart: {
                text: function() {
                    return `<h2>üèÜ Ê†°ÈôÖÊéíÁêÉËÅîËµõ - Ê∑òÊ±∞ËµõÂºÄÂßãÔºÅ</h2>
                    <div style="margin: 20px 0; padding: 20px; background: rgba(255,215,0,0.1); border: 2px solid #ffd700; border-radius: 10px;">
                        <p>ÁªèËøáÊº´ÈïøÁöÑÂáÜÂ§áÔºå‰Ω†Áªà‰∫éÁ´ôÂú®‰∫ÜÊ†°ÈôÖËÅîËµõÁöÑËµõÂú∫‰∏äÔºÅ</p>
                        <br>
                        <p><strong>üìã ËµõÂà∂ËØ¥ÊòéÔºö</strong></p>
                        <ul style="text-align: left; margin-left: 20px;">
                            <li>ÂçïË¥•Ê∑òÊ±∞Âà∂ÔºåËæì‰∏ÄÂú∫Âç≥Ê∑òÊ±∞</li>
                            <li>‰ªé16Âº∫ÂºÄÂßãÔºåÈÄêËΩÆÊôãÁ∫ß</li>
                            <li>ÊØèËΩÆÊØîËµõÈááÁî®‰∫îÂ±Ä‰∏âËÉúÂà∂</li>
                        </ul>
                        <br>
                        <p><strong>üéØ ‰Ω†ÁöÑÁõÆÊ†áÔºö</strong></p>
                        <p>Â∞ΩÂèØËÉΩËµ∞ÂæóÊõ¥ËøúÔºå‰∫âÂèñÂÜ†ÂÜõÔºÅ</p>
                    </div>
                    <div style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <p><strong>ÂΩìÂâçÁä∂ÊÄÅÔºö</strong></p>
                        <p>üéØ ÂèëÁêÉ: ${game.player.skills.serve}  ‚ö° Êâ£ÁêÉ: ${game.player.skills.spike}</p>
                        <p>üõ°Ô∏è Êã¶ÁΩë: ${game.player.skills.block}  ü§∏ Âû´ÁêÉ: ${game.player.skills.dig}</p>
                        <p>üôå ÊâòÁêÉ: ${game.player.skills.set}</p>
                    </div>`;
                },
                choices: [
                    {
                        text: 'ÂºÄÂßãÈ¶ñËΩÆÊØîËµõ',
                        next: null,  // ‰∏çË∑≥ËΩ¨Âú∫ÊôØ
                        effect: () => {
                            // Áõ¥Êé•ÂºÄÂßãÁ¨¨‰∏ÄËΩÆ
                            game.startTournamentRound('round16');
                        }
                    }
                ]
            },
            
            champion: {
                text: function() {
                    return game.generateEndingText('champion');
                },
                choices: [
                    {
                        text: 'üîÑ ÈáçÊñ∞ÂºÄÂßã',
                        next: 'nameInput',
                        effect: { reset: true }
                    }
                ]
            },
            
            runner_up: {
                text: function() {
                    return game.generateEndingText('runner_up');
                },
                choices: [
                    {
                        text: 'üîÑ ÈáçÊñ∞ÂºÄÂßã',
                        next: 'nameInput',
                        effect: { reset: true }
                    }
                ]
            },
            
            participant: {
                text: function() {
                    return game.generateEndingText('participant');
                },
                choices: [
                    {
                        text: 'üîÑ ÈáçÊñ∞ÂºÄÂßã',
                        next: 'nameInput',
                        effect: { reset: true }
                    }
                ]
            },
            
            early_exit: {
                text: function() {
                    return game.generateEndingText('early_exit');
                },
                choices: [
                    {
                        text: 'üîÑ ÈáçÊñ∞ÂºÄÂßã',
                        next: 'nameInput',
                        effect: { reset: true }
                    }
                ]
            },
            
            // ÈöêËóèÁªìÂ±Ä1ÔºöÊóÅËßÇËÄÖ
            bystander: {
                text: function() {
                    return game.generateBystanderEndingText();
                },
                choices: [
                    {
                        text: 'üîÑ ÈáçÊñ∞ÂºÄÂßã',
                        next: 'nameInput',
                        effect: { reset: true }
                    }
                ]
            },
            
            // ÈöêËóèÁªìÂ±Ä2ÔºöÁã¨Ë°åËÄÖ
            loner: {
                text: function() {
                    return game.generateLonerEndingText();
                },
                choices: [
                    {
                        text: 'üîÑ ÈáçÊñ∞ÂºÄÂßã',
                        next: 'nameInput',
                        effect: { reset: true }
                    }
                ]
            }
        };

        // ==================== ÊµãËØïÊ®°ÂºèÈÖçÁΩÆ ====================
        // ËÆæÁΩÆ TEST_MODE = true Êù•ÂêØÁî®ÊµãËØïÊ®°Âºè
        // ÊµãËØïÊ®°Âºè‰ºöÁªô‰∫àÈ´òÂàùÂßãÂ±ûÊÄßÔºåÊñπ‰æøÂø´ÈÄüÊµãËØïÊ∏∏ÊàèÂäüËÉΩ
        const TEST_MODE = false;  // Êîπ‰∏∫ true ÂêØÁî®ÊµãËØïÊ®°Âºè
        
        const TEST_CONFIG = {
            initialSkills: 80,      // ÂàùÂßãÊäÄËÉΩÂÄºÔºàÊ≠£Â∏∏ÊòØ0Ôºâ
            initialMoney: 10000,    // ÂàùÂßãÈáëÈí±ÔºàÊ≠£Â∏∏ÊòØ500Ôºâ
            initialEnergy: 100,     // ÂàùÂßã‰ΩìÂäõÔºàÊ≠£Â∏∏ÊòØ100Ôºâ
            initialMood: 100,       // ÂàùÂßãÂøÉÊÉÖÔºàÊ≠£Â∏∏ÊòØ80Ôºâ
            initialStress: 0,       // ÂàùÂßãÂéãÂäõÔºàÊ≠£Â∏∏ÊòØ20Ôºâ
            initialReputation: 100, // ÂàùÂßãÂ£∞ÊúõÔºàÊ≠£Â∏∏ÊòØ10Ôºâ
            maxTrainingPerWeek: 10, // ÊØèÂë®ÊúÄÂ§ßËÆ≠ÁªÉÊ¨°Êï∞ÔºàÊ≠£Â∏∏ÊòØ3Ôºâ
            skipToWeek: 1           // Ë∑≥ËΩ¨Âà∞ÊåáÂÆöÂë®Ôºà1=‰∏çË∑≥ËΩ¨Ôºâ
        };
        // ====================================================

        class VolleyballGame {
            constructor() {
                this.player = {
                    name: 'Êñ∞Áîü',
                    week: TEST_MODE ? TEST_CONFIG.skipToWeek : 1,
                    trainingCount: 0,
                    maxTrainingPerWeek: TEST_MODE ? TEST_CONFIG.maxTrainingPerWeek : 3,
                    energy: TEST_MODE ? TEST_CONFIG.initialEnergy : 100,
                    maxEnergy: TEST_MODE ? TEST_CONFIG.initialEnergy : 100,
                    mood: TEST_MODE ? TEST_CONFIG.initialMood : 80,
                    stress: TEST_MODE ? TEST_CONFIG.initialStress : 20,
                    reputation: TEST_MODE ? TEST_CONFIG.initialReputation : 10,
                    money: TEST_MODE ? TEST_CONFIG.initialMoney : 800,
                    weeklyAllowance: 120,  // ÊØèÂë®Èõ∂Ëä±Èí±
                    team: 'none',
                    position: 'none',  // ËÅå‰∏ö‰ΩçÁΩÆ
                    positionLevel: 0,  // ËÅå‰∏öÁ≠âÁ∫ß
                    adaptationWeeks: 0, // ËΩ¨ËÅåÈÄÇÂ∫îÊúüÂâ©‰ΩôÂë®Êï∞
                    skills: {
                        serve: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        spike: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        block: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        dig: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        set: TEST_MODE ? TEST_CONFIG.initialSkills : 0
                    },
                    weekStartStats: {  // ÊØèÂë®ÂºÄÂßãÊó∂ÁöÑÊï∞ÊçÆÂø´ÁÖß
                        serve: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        spike: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        block: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        dig: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        set: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        maxEnergy: TEST_MODE ? TEST_CONFIG.initialEnergy : 100
                    },
                    attributes: {
                        strength: 0,    // ÂäõÈáè
                        agility: 0,     // ÊïèÊç∑
                        stamina: 0,     // ËÄêÂäõ
                        coordination: 0 // ÂçèË∞ÉÊÄß
                    },
                    relationships: {
                        coach: 50,
                        teammates: 50
                    },
                    achievements: [],  // ÊàêÂ∞±ÂàóË°®
                    // Êñ∞Â¢ûÔºöËøõÂ∫¶ËøΩË∏™
                    performanceHistory: [],  // ÊØîËµõË°®Áé∞ÂéÜÂè≤
                    averagePerformance: 0,  // Âπ≥ÂùáË°®Áé∞
                    matchesPlayed: 0,  // ÊØîËµõÂú∫Ê¨°
                    matchesWon: 0,  // ËÉúÂú∫
                    completedStoryEvents: [],  // ÂÆåÊàêÁöÑÊïÖ‰∫ã‰∫ã‰ª∂
                    storyChoices: {},  // ÊïÖ‰∫ãÈÄâÊã©ËÆ∞ÂΩï
                    trainingHistory: [],  // ËÆ≠ÁªÉÂéÜÂè≤ÔºàÁî®‰∫éÈÄíÂáèÊî∂ÁõäÔºâ
                    goalProgress: {}  // ÁõÆÊ†áËøõÂ∫¶
                };
                
                // Êñ∞Â¢ûÔºöÁé©ÂÆ∂Ë°å‰∏∫ÁªüËÆ°ÔºàÁî®‰∫éÁªìÂ±ÄÁîüÊàêÔºâ
                this.playerStats = {
                    // ËÆ≠ÁªÉÁõ∏ÂÖ≥
                    totalTrainings: 0,
                    trainingByType: {
                        serve: 0,
                        spike: 0,
                        block: 0,
                        dig: 0,
                        set: 0,
                        composite: 0
                    },
                    
                    // ÊØîËµõÁõ∏ÂÖ≥
                    casualMatchesPlayed: 0,
                    casualMatchesWon: 0,
                    formalMatchesPlayed: 0,
                    formalMatchesWon: 0,
                    tournamentRoundsWon: 0,
                    
                    // Ê∂àË¥πÁõ∏ÂÖ≥
                    totalMoneySpent: 0,
                    equipmentPurchased: 0,
                    coachingPurchased: 0,
                    entertainmentSpent: 0,
                    
                    // ÁîüÊ¥ªÁõ∏ÂÖ≥
                    gamesPlayed: 0,
                    moviesWatched: 0,
                    socialEvents: 0,
                    restTaken: 0,
                    
                    // ËØæ‰ΩôÊ¥ªÂä®ËøΩË∏™ÔºàÁî®‰∫éÂ•áÈÅá‰∫ã‰ª∂Ôºâ
                    lifeActivities: {
                        scratchCard: 0,      // ‰π∞ÂàÆÂàÆ‰πêÊ¨°Êï∞
                        movie: 0,            // ÁúãÁîµÂΩ±Ê¨°Êï∞
                        game: 0,             // ÊâìÊ∏∏ÊàèÊ¨°Êï∞
                        social: 0,           // Á§æ‰∫§Ê¥ªÂä®Ê¨°Êï∞ÔºàËÅäÂ§©Ôºâ
                        gift: 0,             // ‰π∞Á§ºÁâ©Ê¨°Êï∞
                        rest: 0,             // ‰ºëÊÅØÊ¨°Êï∞ÔºàÊó©ÁÇπ‰ºëÊÅØ+ÊåâÊë©Ôºâ
                        massage: 0,          // ÊåâÊë©Ê¨°Êï∞
                        library: 0,          // ÂéªÂõæ‰π¶È¶ÜÊ¨°Êï∞
                        casualMatch: 0,      // ÊâìÈáéÁêÉÊ¨°Êï∞
                        work: 0,             // ÊâìÂ∑•Ê¨°Êï∞
                        food: 0              // ÂêÉÁæéÈ£üÊ¨°Êï∞ÔºàÂ§úÂÆµ+Â§ßÈ§êÔºâ
                    },
                    
                    // Â•áÈÅá‰∫ã‰ª∂ËøΩË∏™
                    triggeredEvents: [],     // Â∑≤Ëß¶ÂèëÁöÑ‰∏ÄÊ¨°ÊÄß‰∫ã‰ª∂ID
                    scratchCardJackpots: 0,  // ‰∏≠ÁâπÁ≠âÂ•ñÊ¨°Êï∞
                    hasLoveInterest: false,  // ÊòØÂê¶ÂºÄÂêØÊÅãÁà±Á∫ø
                    weeklyDateCount: 0,      // Êú¨Âë®Á∫¶‰ºöÊ¨°Êï∞
                    permanentBuffs: {        // Ê∞∏‰πÖbuff
                        scratchCardDiscount: false,  // ÂàÆÂàÆ‰πêÊâìÊäò
                        movieMembership: false,      // ÁîµÂΩ±‰ºöÂëò
                        foodDiscount: false,         // ÁæéÈ£üÊâìÊäò
                        workBonus: false,            // ÊâìÂ∑•Âä†Êàê
                        trainingBonus: 0,            // ËÆ≠ÁªÉÊïàÊûúÂä†Êàê%
                        stressReduction: 0,          // ÂéãÂäõ‰∏äÈôêÈôç‰Ωé
                        energyRecovery: 0,           // ÊØèÂë®‰ΩìÂäõÊÅ¢Â§çÂä†Êàê
                        moodRecovery: 0,             // ÊØèÂë®ÂøÉÊÉÖÊÅ¢Â§çÂä†Êàê
                        reputationGrowth: 0,         // ÊØèÂë®Â£∞ÊúõÂ¢ûÈïø
                        injuryReduction: 0           // Âèó‰º§Ê¶ÇÁéáÈôç‰Ωé%
                    },
                    titles: [],              // Ëé∑ÂæóÁöÑÁß∞Âè∑ÂàóË°®
                    
                    // ÁâπÊÆäË°å‰∏∫
                    positionChanges: 0,
                    perfectWeeks: 0,
                    burnoutWeeks: 0,
                    richestWeek: 0,
                    brokestWeek: Infinity,
                    
                    // ÊäÄËÉΩÂèëÂ±ï
                    initialSkills: {
                        serve: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        spike: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        block: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        dig: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                        set: TEST_MODE ? TEST_CONFIG.initialSkills : 0
                    }
                };
                
                // ËÅå‰∏öÈÖçÁΩÆ
                this.positions = {
                    outsideHitter: {
                        id: 'outsideHitter',
                        name: '‰∏ªÊîªÊâã',
                        icon: 'üî•',
                        description: 'ÂæóÂàÜ‰∏ªÂäõÔºåÊâøÊãÖÂ§ßÈáèËøõÊîªÂíåÈò≤ÂÆà‰ªªÂä°',
                        coreSkills: ['spike', 'dig'],
                        secondarySkills: ['serve'],
                        baseRequirements: { spike: 15, dig: 12 },  // ‰øÆÊîπÔºöspike 15, dig 12
                        trainingBonus: { core: 0.4, secondary: 0.2, other: -0.25 },
                        matchWeights: { spike: 40, dig: 25, serve: 15, block: 10, set: 10 },
                        specialDescriptions: {
                            spike: ['Âº∫ÂäõË∑≥ÂèëÁõ¥Êé•ÂæóÂàÜÔºÅ', 'ÂêéÊéíËøõÊîªÔºåÂ§ßÂäõÊâ£ÊùÄÂæóÂàÜÔºÅ', 'ÂÖ≥ÈîÆÁêÉÔºå‰∏ªÊîªÊâãÊå∫Ë∫´ËÄåÂá∫ÔºÅ'],
                            dig: ['‰∏ªÊîªÊâãÂêéÊéíÈò≤ÂÆàÊàêÂäüÔºÅ', 'ÂèäÊó∂Ë°•‰ΩçÔºåÊïëËµ∑ÂÖ≥ÈîÆÁêÉÔºÅ', 'Á≤æÂáÜÂû´ÁêÉÔºåÁªÑÁªáÂèçÂáªÔºÅ'],
                            serve: ['Ë∑≥ÂèëÁêÉÁõ¥Êé•ÂæóÂàÜÔºÅ', 'ÂèëÁêÉÁ†¥ÂùèÂØπÊñπ‰∏Ä‰º†ÔºÅ', 'ËøûÁª≠ÂèëÁêÉÊñΩÂéãÔºÅ']
                        }
                    },
                    middleBlocker: {
                        id: 'middleBlocker',
                        name: 'ÂâØÊîªÊâã',
                        icon: 'üõ°Ô∏è',
                        description: 'Êã¶ÁΩë‰∏ìÂÆ∂ÔºåÂø´ÊîªÊâã',
                        coreSkills: ['block', 'spike'],
                        secondarySkills: ['set'],
                        baseRequirements: { block: 15, spike: 12 },  // Èôç‰ΩéÔºöblock 25‚Üí15, spike 20‚Üí12
                        trainingBonus: { core: 0.4, secondary: 0.2, other: -0.25 },
                        matchWeights: { block: 40, spike: 30, set: 10, serve: 10, dig: 10 },
                        specialDescriptions: {
                            block: ['Âçï‰∫∫Êã¶ÁΩëÁõ¥Êé•ÂæóÂàÜÔºÅ', 'Âèå‰∫∫Êã¶ÁΩëÔºå‰∏•ÂØÜÈò≤ÂÆàÔºÅ', 'Êã¶ÁΩëÂà§Êñ≠Á≤æÂáÜÔºÅ'],
                            spike: ['Âø´ÈÄüÁü≠Âπ≥Âø´ÔºåÂØπÊñπÊù•‰∏çÂèäÂèçÂ∫îÔºÅ', 'Êó∂Èó¥Â∑ÆËøõÊîªÂæóÂàÜÔºÅ', 'ËÉåÂø´Á™ÅÁ†¥Èò≤Á∫øÔºÅ'],
                            set: ['ÂâØÊîªÊâãË∞ÉÊï¥‰º†ÁêÉÔºÅ', 'ÁΩëÂâçÂÅáÂä®‰ΩúÔºåÂä©ÊîªÂæóÂàÜÔºÅ']
                        }
                    },
                    setter: {
                        id: 'setter',
                        name: '‰∫å‰º†Êâã',
                        icon: 'üéØ',
                        description: 'ÁªÑÁªáÊ†∏ÂøÉÔºåÊàòÊúØÂ§ßËÑë',
                        coreSkills: ['set', 'serve'],
                        secondarySkills: ['dig'],
                        baseRequirements: { set: 18, serve: 12 },  // Èôç‰ΩéÔºöset 30‚Üí18, serve 20‚Üí12
                        trainingBonus: { core: 0.4, secondary: 0.2, other: -0.25 },
                        matchWeights: { set: 50, serve: 20, dig: 15, spike: 10, block: 5 },
                        specialDescriptions: {
                            set: ['Á≤æÂáÜ‰∫å‰º†ÔºåÂä©ÊîªÈòüÂèãÂæóÂàÜÔºÅ', 'ËÉå‰º†Âá∫ÂÖ∂‰∏çÊÑèÔºåÈòüÂèãËΩªÊùæÂæóÂàÜÔºÅ', 'Ë∑≥‰º†Ë∞ÉÊï¥ÔºåÂåñËß£Âõ∞Â¢ÉÔºÅ'],
                            serve: ['‰∫å‰º†ÊâãÂèëÁêÉÁõ¥Êé•ÂæóÂàÜÔºÅ', 'ÂèëÁêÉÁ†¥ÂùèÂØπÊñπËøõÊîªËäÇÂ•èÔºÅ'],
                            dig: ['‰∫å‰º†ÊâãÈò≤ÂÆàÂà∞‰ΩçÔºÅ', '‰∏Ä‰º†Á®≥ÂÆöÔºåÁªÑÁªáÂèçÂáªÔºÅ']
                        }
                    },
                    oppositeHitter: {
                        id: 'oppositeHitter',
                        name: 'Êé•Â∫î‰∫å‰º†',
                        icon: '‚ö°',
                        description: 'ÂÖ®ËÉΩÊàòÂ£´ÔºåÂêéÊéíËøõÊîªÊ†∏ÂøÉ',
                        coreSkills: ['spike', 'set'],
                        secondarySkills: ['serve'],
                        baseRequirements: { spike: 15, set: 15 },  // Èôç‰ΩéÔºöspike 22‚Üí15, set 22‚Üí15
                        trainingBonus: { core: 0.4, secondary: 0.2, other: -0.25 },
                        matchWeights: { spike: 35, set: 25, serve: 20, block: 10, dig: 10 },
                        specialDescriptions: {
                            spike: ['ÂêéÊéíÂº∫ÊîªÔºåÁ™ÅÁ†¥ÂØπÊñπÈò≤Á∫øÔºÅ', 'Ë∞ÉÊï¥ÁêÉ‰∫åÊ¨°ËøõÊîªÂæóÂàÜÔºÅ', 'ÂÖ≥ÈîÆÊó∂ÂàªÊé•Â∫îÁ´ôÂá∫Êù•ÔºÅ'],
                            set: ['Êé•Â∫î‰∫å‰º†ÁªÑÁªáËøõÊîªÔºÅ', 'ÊõøË°•‰∫å‰º†‰ΩçÁΩÆÔºå‰º†ÁêÉÂà∞‰ΩçÔºÅ'],
                            serve: ['Êé•Â∫îÂèëÁêÉÊñΩÂéãÔºÅ', 'Ë∑≥È£òÁêÉÁ†¥ÂùèÂØπÊñπÔºÅ']
                        }
                    },
                    libero: {
                        id: 'libero',
                        name: 'Ëá™Áî±‰∫∫',
                        icon: 'üèÉ',
                        description: 'Èò≤ÂÆà‰∏ìÂÆ∂Ôºå‰∏Ä‰º†‰øùÈöú',
                        coreSkills: ['dig', 'set'],
                        secondarySkills: [],
                        baseRequirements: { dig: 18, set: 15 },  // Èôç‰ΩéÔºödig 30‚Üí18, set 25‚Üí15
                        trainingBonus: { core: 0.4, secondary: 0.2, other: -0.25 },
                        matchWeights: { dig: 60, set: 30, spike: 0, block: 0, serve: 0 },
                        specialDescriptions: {
                            dig: ['È±ºË∑ÉÊïëÁêÉÔºåÁ≤æÂΩ©Èò≤ÂÆàÔºÅ', 'ÂÆåÁæé‰∏Ä‰º†ÔºåÁªÑÁªáÂèçÂáªÔºÅ', 'ËøûÁª≠Èò≤ÂÆàÔºåÂåñËß£ÂØπÊñπÊîªÂäøÔºÅ'],
                            set: ['Ëá™Áî±‰∫∫‰∫å‰º†Âà∞‰ΩçÔºÅ', 'ÂêéÊéí‰º†ÁêÉÁªÑÁªáÔºÅ', 'Èò≤ÂÆàÂèçÂáªÁöÑËµ∑ÁÇπÔºÅ']
                        },
                        restrictions: ['‰∏çËÉΩÊâ£ÁêÉ', '‰∏çËÉΩÊã¶ÁΩë', '‰∏çËÉΩÂèëÁêÉ']
                    }
                };
                
                this.rerollsRemaining = 5;
                this.currentScene = 'nameInput';
                this.justTrained = false;
                this.lastEventType = null;
                this.currentEvent = null;
                this.currentEventType = null;
                this.currentGoal = 'collegeTryout'; // ÂΩìÂâçÁõÆÊ†á
                
                // Èî¶Ê†áËµõÁ≥ªÁªü
                this.tournament = {
                    active: false,
                    type: null,
                    currentRound: null,
                    roundsCompleted: [],
                    matchesWon: 0,
                    matchesLost: 0,
                    eliminated: false,
                    finalRank: null
                };
                
                // Èî¶Ê†áËµõËΩÆÊ¨°ÂÆö‰πâ
                this.TOURNAMENT_ROUNDS = {
                    round16: {
                        id: 'round16',
                        name: '1/8ÂÜ≥ËµõÔºà16Âº∫Ôºâ',
                        shortName: '16Âº∫Ëµõ',
                        emoji: 'üèê',
                        nextRound: 'round8',
                        eliminationRank: 'top16',
                        opponentStrength: 70  // ÊèêÈ´òÈöæÂ∫¶Ôºö55‚Üí70
                    },
                    round8: {
                        id: 'round8',
                        name: '1/4ÂÜ≥ËµõÔºà8Âº∫Ôºâ',
                        shortName: '8Âº∫Ëµõ',
                        emoji: '‚ö°',
                        nextRound: 'round4',
                        eliminationRank: 'top8',
                        opponentStrength: 85  // ÊèêÈ´òÈöæÂ∫¶Ôºö65‚Üí85
                    },
                    round4: {
                        id: 'round4',
                        name: 'ÂçäÂÜ≥ËµõÔºà4Âº∫Ôºâ',
                        shortName: 'ÂçäÂÜ≥Ëµõ',
                        emoji: 'üî•',
                        nextRound: 'final',
                        eliminationRank: 'top4',
                        opponentStrength: 100  // ÊèêÈ´òÈöæÂ∫¶Ôºö75‚Üí100
                    },
                    final: {
                        id: 'final',
                        name: 'ÂÜ≥Ëµõ',
                        shortName: 'ÂÜ≥Ëµõ',
                        emoji: 'üèÜ',
                        nextRound: null,
                        eliminationRank: 'runner_up',
                        opponentStrength: 120  // ÊèêÈ´òÈöæÂ∫¶Ôºö85‚Üí120
                    }
                };
                
                // ÂïÜÂ∫óÁ≥ªÁªüÊï∞ÊçÆ
                this.shopItems = this.initShopItems();
                this.player.ownedItems = {
                    shoes: 'basic',  // ÈûãÂ≠êÁ≠âÁ∫ß
                    protection: false,  // Êä§ÂÖ∑
                    jersey: false,  // ÁêÉË°£
                    trainingEquipment: [],  // ËÆ≠ÁªÉÂô®Êùê
                    electronics: [],  // ÁîµÂ≠ê‰∫ßÂìÅ
                    books: []  // ‰π¶Á±ç
                };
                this.player.activeBuffs = [];  // ÊøÄÊ¥ªÁöÑbuff
                this.player.purchaseCount = {};  // Áâ©ÂìÅË¥≠‰π∞Ê¨°Êï∞ËøΩË∏™
                
                // Â•áÈÅá‰∫ã‰ª∂Á≥ªÁªüÊï∞ÊçÆ
                this.adventureEvents = this.initAdventureEvents();
                
                this.init();
            }
            
            init() {
                console.log('init() called');
                console.log('currentScene:', this.currentScene);
                this.updateUI();
                this.updateGoalDisplay();
                this.showScene(this.currentScene);
                // ÂàùÂßãÂåñÊó∂ËÆæÁΩÆ‰∏Ä‰∏™ÈöèÊú∫ÂêçÂ≠óÂíåÊäÄËÉΩ
                setTimeout(() => {
                    console.log('Setting random name and skills...');
                    this.randomName();
                    this.rollAttributes();
                    this.updateInitialSkillsDisplay();
                }, 100);
            }
            
            // ÂàùÂßãÂåñÂïÜÂ∫óÁâ©ÂìÅ
            initShopItems() {
                return {
                    training: {
                        name: 'ËÆ≠ÁªÉÊúçÂä°',
                        icon: 'üéì',
                        items: [
                            { id: 'coach_serve', name: 'ÂèëÁêÉÁßÅÊïô', price: 300, effect: { serve: 5 }, description: 'ÂèëÁêÉ+5', maxPurchases: 3 },
                            { id: 'coach_spike', name: 'Êâ£ÁêÉÁßÅÊïô', price: 300, effect: { spike: 5 }, description: 'Êâ£ÁêÉ+5', maxPurchases: 3 },
                            { id: 'coach_block', name: 'Êã¶ÁΩëÁßÅÊïô', price: 300, effect: { block: 5 }, description: 'Êã¶ÁΩë+5', maxPurchases: 3 },
                            { id: 'coach_dig', name: 'Âû´ÁêÉÁßÅÊïô', price: 300, effect: { dig: 5 }, description: 'Âû´ÁêÉ+5', maxPurchases: 3 },
                            { id: 'coach_set', name: 'ÊâòÁêÉÁßÅÊïô', price: 300, effect: { set: 5 }, description: 'ÊâòÁêÉ+5', maxPurchases: 3 },
                            { id: 'weekend_camp', name: 'Âë®Êú´ËÆ≠ÁªÉËê•', price: 600, effect: { serve: 3, spike: 3, block: 3, dig: 3, set: 3, energy: -20 }, description: 'ÂÖ®ÊäÄËÉΩ+3Ôºå‰ΩìÂäõ-20', maxPurchases: 3 }
                        ]
                    },
                    equipment: {
                        name: 'Ë£ÖÂ§áÂïÜÂ∫ó',
                        icon: 'üëü',
                        items: [
                            { id: 'pro_shoes', name: '‰∏ì‰∏öÁêÉÈûã', price: 500, type: 'permanent', effect: { trainingBonus: 20 }, description: 'ËÆ≠ÁªÉÊïàÊûú+20%ÔºàÊ∞∏‰πÖÔºâ' },
                            { id: 'protection', name: 'Êä§ËÜùÊä§ËÖïÂ•óË£Ö', price: 250, type: 'permanent', effect: { injuryResist: 70 }, description: 'ÂáèÂ∞ëÂèó‰º§Ê¶ÇÁéá70%ÔºàÊ∞∏‰πÖÔºâ' },
                            { id: 'jersey', name: '‰∏ì‰∏öÁêÉË°£', price: 350, type: 'permanent', effect: { mood: 15, reputation: 10, trainingBonus: 5 }, description: 'ÂøÉÊÉÖ+15ÔºåÂ£∞Êúõ+10ÔºåËÆ≠ÁªÉÊïàÊûú+5%ÔºàÊ∞∏‰πÖÔºâ' },
                            { id: 'training_ball', name: '‰∏ì‰∏öËÆ≠ÁªÉÁêÉ', price: 600, type: 'permanent', effect: { trainingBonus: 15 }, description: 'ÊäÄËÉΩËÆ≠ÁªÉ+15%ÔºàÊ∞∏‰πÖÔºâ' }
                        ]
                    },
                    recovery: {
                        name: 'ÊÅ¢Â§ç‰∏≠ÂøÉ',
                        icon: 'üíä',
                        items: [
                            { id: 'energy_drink', name: 'ËøêÂä®È•ÆÊñô', price: 50, effect: { energy: 10 }, description: '‰ΩìÂäõ+10' },
                            { id: 'massage', name: 'ËøêÂä®ÊåâÊë©', price: 150, effect: { energy: 40, mood: 15, stress: -10 }, description: '‰ΩìÂäõ+40ÔºåÂøÉÊÉÖ+15ÔºåÂéãÂäõ-10' },
                            { id: 'therapy', name: 'Ê∑±Â∫¶ÁêÜÁñó', price: 250, effect: { energy: 60, mood: 25, stress: -20 }, description: '‰ΩìÂäõ+60ÔºåÂøÉÊÉÖ+25ÔºåÂéãÂäõ-20' },
                            { id: 'nutrition_plan', name: 'Ëê•ÂÖªÈ§êËÆ°Âàí', price: 400, type: 'buff', effect: { maxEnergyBonus: 50 }, duration: 6, description: '‰ΩìÂäõ‰∏äÈôê+50ÔºàÊåÅÁª≠6Âë®Ôºâ' }
                        ]
                    },
                    gifts: {
                        name: 'Á§ºÂìÅÂ∫ó',
                        icon: 'üéÅ',
                        items: [
                            { id: 'small_gift', name: 'Â∞èÁ§ºÁâ©', price: 80, effect: { relationship: 10, mood: 8 }, description: 'ÈòüÂèãÂÖ≥Á≥ª+10ÔºåÂøÉÊÉÖ+8' },
                            { id: 'nice_gift', name: 'Á≤æÁæéÁ§ºÁâ©', price: 180, effect: { relationship: 20, reputation: 10, mood: 15 }, description: 'ÈòüÂèãÂÖ≥Á≥ª+20ÔºåÂ£∞Êúõ+10ÔºåÂøÉÊÉÖ+15' },
                            { id: 'coach_gift', name: 'ÊïôÁªÉÁ§ºÁâ©', price: 350, type: 'buff', effect: { trainingQuality: 10 }, duration: 3, description: 'ËÆ≠ÁªÉË¥®Èáè+10%ÔºàÊåÅÁª≠3Âë®Ôºâ' },
                            { id: 'team_dinner', name: 'ËØ∑ÈòüÂèãÂêÉÈ•≠', price: 250, effect: { relationship: 25, reputation: 15, mood: 20 }, description: 'ÈòüÂèãÂÖ≥Á≥ª+25ÔºåÂ£∞Êúõ+15ÔºåÂøÉÊÉÖ+20' }
                        ]
                    },
                    daily: {
                        name: 'ÁîüÊ¥ªÁî®ÂìÅ',
                        icon: 'üì±',
                        items: [
                            { id: 'sports_watch', name: 'ËøêÂä®ÊâãÁéØ', price: 400, type: 'permanent', effect: { mood: 15, weeklyStressReduction: 5 }, description: 'ÂøÉÊÉÖ+15ÔºåÊØèÂë®Ëá™Âä®ÊÅ¢Â§çÂéãÂäõ-5ÔºàÊ∞∏‰πÖÔºâ' },
                            { id: 'new_phone', name: 'Êñ∞ÊâãÊú∫', price: 1200, type: 'permanent', effect: { mood: 30, stress: -20, reputation: 15, weeklyMoodBonus: 3 }, description: 'ÂøÉÊÉÖ+30ÔºåÂéãÂäõ-20ÔºåÂ£∞Êúõ+15ÔºåÊØèÂë®ÂøÉÊÉÖ+3ÔºàÊ∞∏‰πÖÔºâ' },
                            { id: 'volleyball_book', name: 'ÊéíÁêÉÊïôÂ≠¶‰π¶', price: 200, effect: { randomSkill: 4 }, description: 'ÈöèÊú∫ÊäÄËÉΩ+4', maxPurchases: 5 },
                            { id: 'health_supplement', name: 'ÂÜ•ÊÉ≥ÊïôÊùê', price: 600, type: 'permanent', effect: { energy: 20, maxEnergy: 5, weeklyEnergyBonus: 10 }, description: '‰ΩìÂäõ+20Ôºå‰ΩìÂäõ‰∏äÈôê+5ÔºåÊØèÂë®‰ΩìÂäõÊÅ¢Â§ç+10ÔºàÊ∞∏‰πÖÔºâ', maxPurchases: 1 }
                        ]
                    }
                };
            }
            
            // ÂàùÂßãÂåñÂ•áÈÅá‰∫ã‰ª∂Á≥ªÁªü
            initAdventureEvents() {
                return [
                    // 1. ÂàÆÂàÆ‰πêÁõ∏ÂÖ≥‰∫ã‰ª∂
                    {
                        id: 'lucky_customer',
                        name: 'Âπ∏ËøêÂ∏∏ÂÆ¢',
                        condition: { activities: { scratchCard: 5 } },
                        probability: 0.4,
                        once: true,
                        content: {
                            title: 'üé´ Âπ∏ËøêÂ∏∏ÂÆ¢',
                            text: 'Â∫óËÄÅÊùøËÆ§Âá∫‰∫Ü‰Ω†Ôºö"Â∞è‰ºôÂ≠êÔºå‰Ω†ÊòØÊàë‰ª¨ÁöÑÂ∏∏ÂÆ¢ÂïäÔºÅËøôÊ†∑ÂêßÔºå‰ª•Âêé‰Ω†Êù•‰π∞ÂàÆÂàÆ‰πêÔºåÊàëÁªô‰Ω†Êâì9ÊäòÔºÅ"\n\n‰Ω†Ëé∑Âæó‰∫Ü"VIPÈ°æÂÆ¢"Ë∫´‰ªΩÔºÅ',
                            choices: [
                                { text: 'Â§™Â•Ω‰∫ÜÔºåË∞¢Ë∞¢ËÄÅÊùøÔºÅ', effect: { reputation: 5, buff: 'scratchCardDiscount' } },
                                { text: '‰∏çÁî®‰∫ÜÔºåÊàëÂè™ÊòØÂÅ∂Â∞îÁé©Áé©', effect: { mood: 10 } }
                            ]
                        }
                    },
                    {
                        id: 'mysterious_elder',
                        name: 'Á•ûÁßòËÄÅ‰∫∫',
                        condition: { activities: { scratchCard: 10 } },
                        probability: 0.3,
                        once: true,
                        content: {
                            title: 'üßô Á•ûÁßòËÄÅ‰∫∫',
                            text: '‰∏Ä‰ΩçÁôΩÂèëËÄÅ‰∫∫Âú®‰Ω†ÊóÅËæπ‰π∞ÂàÆÂàÆ‰πê„ÄÇ‰ªñÁúã‰∫Ü‰Ω†‰∏ÄÁúºÔºö"Âπ¥ËΩª‰∫∫ÔºåÊàëÁúã‰Ω†ËøêÊ∞î‰∏çÈîô„ÄÇËøôÂº†ÂàÆÂàÆ‰πêÔºåÊàëÈÄÅÁªô‰Ω†„ÄÇ"\n\n‰ªñÈÄíÁªô‰Ω†‰∏ÄÂº†ÂàÆÂàÆ‰πêÂ∞±Á¶ªÂºÄ‰∫Ü...',
                            choices: [
                                { text: 'Ë∞¢Ë∞¢ËÄÅ‰∫∫ÂÆ∂ÔºÅ', effect: { special: 'freeScratchCard' } }
                            ]
                        }
                    },
                    {
                        id: 'jackpot_celebrity',
                        name: '‰∏≠Â•ñÈî¶È≤§',
                        condition: { scratchCardJackpots: 1 },
                        probability: 1.0,
                        once: true,
                        content: {
                            title: 'üì∞ Ê†°Âõ≠Êñ∞Èóª',
                            text: '‰Ω†‰∏≠ÁâπÁ≠âÂ•ñÁöÑÊ∂àÊÅØÂú®Ê†°Âõ≠Èáå‰º†ÂºÄ‰∫ÜÔºÅÂêåÂ≠¶‰ª¨ÈÉΩÂè´‰Ω†"Èî¶È≤§"ÔºåÁ∫∑Á∫∑Êù•Êâæ‰Ω†Ê≤æÊ≤æÂñúÊ∞î„ÄÇ\n\n‰Ω†ÁöÑ‰∫∫Ê∞îÊö¥Ê∂®ÔºÅ',
                            choices: [
                                { text: 'ÂìàÂìàÔºåÂè™ÊòØËøêÊ∞îÂ•Ω', effect: { reputation: 20, relationship: 15, mood: 25, title: 'Âπ∏ËøêÈî¶È≤§' } }
                            ]
                        }
                    },
                    
                    // 2. ÁîµÂΩ±Áõ∏ÂÖ≥‰∫ã‰ª∂
                    {
                        id: 'movie_membership',
                        name: 'ÁîµÂΩ±Ëææ‰∫∫',
                        condition: { activities: { movie: 3 } },
                        probability: 0.4,
                        once: true,
                        content: {
                            title: 'üé¨ ÁîµÂΩ±Ëææ‰∫∫',
                            text: 'ÁîµÂΩ±Èô¢ÁªèÁêÜÊ≥®ÊÑèÂà∞‰Ω†ÊòØÂ∏∏ÂÆ¢„ÄÇ"ÂêåÂ≠¶ÔºåË¶Å‰∏çË¶ÅÂäûÂº†‰ºöÂëòÂç°Ôºü‰ª•ÂêéÁúãÁîµÂΩ±8ÊäòÔºåËøòÈÄÅÁàÜÁ±≥Ëä±ÔºÅ"',
                            choices: [
                                { text: 'ÂäûÁêÜ‰ºöÂëòÂç°Ôºà-200ÂÖÉÔºâ', effect: { money: -200, buff: 'movieMembership' }, requirement: { money: 200 } },
                                { text: '‰∏çÂäû‰∫ÜÔºåË∞¢Ë∞¢', effect: {} }
                            ]
                        }
                    },
                    {
                        id: 'romantic_encounter',
                        name: 'Êµ™Êº´ÈÇÇÈÄÖ',
                        condition: { activities: { movie: 5 }, mood: 60 },
                        probability: 0.35,
                        once: true,
                        content: {
                            title: 'üíï Êµ™Êº´ÈÇÇÈÄÖ',
                            text: 'Âú®ÁîµÂΩ±Èô¢Ôºå‰Ω†ÈÅáÂà∞‰∫Ü‰∏Ä‰∏™ÂæàÊúâÊ∞îË¥®ÁöÑ‰∫∫„ÄÇ‰Ω†‰ª¨ËÅäÂæóÂæàÊäïÊú∫ÔºåÂèëÁé∞ÊúâÂæàÂ§öÂÖ±ÂêåËØùÈ¢ò„ÄÇ\n\n"‰∏ãÊ¨°‰∏ÄËµ∑ÁúãÁîµÂΩ±ÂêßÔºü"ÂØπÊñπÂæÆÁ¨ëÁùÄËØ¥„ÄÇ',
                            choices: [
                                { text: 'Â•ΩÂïäÔºå‰∫§Êç¢ËÅîÁ≥ªÊñπÂºè', effect: { mood: 30, stress: -20, special: 'startLove' } },
                                { text: 'Êä±Ê≠âÔºåÊàëË¶Å‰∏ìÊ≥®ÊéíÁêÉ', effect: { randomSkill: 5 } }
                            ]
                        }
                    },
                    {
                        id: 'movie_inspiration',
                        name: 'ÁîµÂΩ±ÁÅµÊÑü',
                        condition: { activities: { movie: 6, library: 3 } },
                        probability: 0.3,
                        once: true,
                        content: {
                            title: 'üí° ÁîµÂΩ±ÁÅµÊÑü',
                            text: 'ÁúãÂÆåÁîµÂΩ±ÂêéÔºå‰Ω†Á™ÅÁÑ∂ÊÉ≥Âà∞‰∫Ü‰∏Ä‰∏™ËÆ≠ÁªÉÊñπÊ≥ï„ÄÇÁªìÂêàÁîµÂΩ±ÈáåÁöÑÂä®‰ΩúÂíåÂõæ‰π¶È¶ÜÁúãÂà∞ÁöÑÁêÜËÆ∫...\n\n‰Ω†È¢ÜÊÇü‰∫ÜÊñ∞ÁöÑÊäÄÂ∑ßÔºÅ',
                            choices: [
                                { text: 'Â§™Ê£í‰∫ÜÔºÅ', effect: { randomSkill: 10, mood: 15, title: 'Â≠¶Èú∏ËøêÂä®Âëò' } }
                            ]
                        }
                    },
                    
                    // 3. Á§æ‰∫§Áõ∏ÂÖ≥‰∫ã‰ª∂
                    {
                        id: 'teammates_trust',
                        name: 'ÈòüÂèãÁöÑ‰ø°‰ªª',
                        condition: { activities: { social: 3, gift: 2 } },
                        probability: 0.5,
                        once: true,
                        content: {
                            title: 'ü§ù ÈòüÂèãÁöÑ‰ø°‰ªª',
                            text: 'ÈòüÂèã‰ª¨Êää‰Ω†ÊãâÂà∞‰∏ÄËæπÔºö"ÂÖÑÂºüÔºåÊàë‰ª¨ÂïÜÈáè‰∫Ü‰∏Ä‰∏ãÔºåÊÉ≥Êé®Ëçê‰Ω†ÂΩìÂâØÈòüÈïøÔºÅ‰Ω†Âπ≥Êó∂ÂØπÂ§ßÂÆ∂Ëøô‰πàÂ•ΩÔºåÂ§ßÂÆ∂ÈÉΩÂæà‰ø°‰ªª‰Ω†„ÄÇ"',
                            choices: [
                                { text: 'Ë∞¢Ë∞¢Â§ßÂÆ∂ÁöÑ‰ø°‰ªªÔºÅ', effect: { reputation: 25, relationship: 20, title: 'ÂâØÈòüÈïø', buff: 'teamBonus' } },
                                { text: 'ÊàëËøòÈúÄË¶ÅÊèêÂçáËá™Â∑±', effect: { randomSkill: 5 } }
                            ]
                        }
                    },
                    {
                        id: 'birthday_surprise',
                        name: 'ÁîüÊó•ÊÉäÂñú',
                        condition: { activities: { social: 5, gift: 3 }, relationship: 70 },
                        probability: 0.4,
                        once: true,
                        content: {
                            title: 'üéÇ ÁîüÊó•ÊÉäÂñú',
                            text: 'ÈòüÂèã‰ª¨‰∏∫‰Ω†ÂáÜÂ§á‰∫Ü‰∏Ä‰∏™ÊÉäÂñúÁîüÊó•Ê¥æÂØπÔºÅ"ËôΩÁÑ∂‰∏çÊòØ‰Ω†ÁúüÊ≠£ÁöÑÁîüÊó•Ôºå‰ΩÜÊàë‰ª¨ÊÉ≥ÊÑüË∞¢‰Ω†‰∏ÄÁõ¥‰ª•Êù•ÂØπÂ§ßÂÆ∂ÁöÑÁÖßÈ°æÔºÅ"\n\nËõãÁ≥ï„ÄÅÁ§ºÁâ©„ÄÅÊ¨¢Á¨ë...Ëøô‰∏ÄÂàªÁúüÁæéÂ•Ω„ÄÇ',
                            choices: [
                                { text: 'Â§™ÊÑüÂä®‰∫ÜÔºÅ', effect: { mood: 40, stress: -25, relationship: 15, special: 'mysteryGift' } }
                            ]
                        }
                    },
                    {
                        id: 'captain_invitation',
                        name: 'ÈòüÈïøÁöÑÈÇÄËØ∑',
                        condition: { activities: { social: 6 }, relationship: 80, totalSkills: 200 },
                        probability: 0.35,
                        once: true,
                        content: {
                            title: '‚≠ê ÈòüÈïøÁöÑÈÇÄËØ∑',
                            text: 'ÈòüÈïøÊâæÂà∞‰Ω†Ôºö"ÊàëÁúã‰Ω†ÂÆûÂäõ‰∏çÈîôÔºå‰∫∫Áºò‰πüÂ•Ω„ÄÇ‰∏ãÂ≠¶ÊúüÊàëÂ∞±ÊØï‰∏ö‰∫ÜÔºåÊàëÊÉ≥Êé®Ëçê‰Ω†Êé•‰ªªÈòüÈïø„ÄÇ‰Ω†ÊÑøÊÑèÂêóÔºü"',
                            choices: [
                                { text: 'Êàë‰ºöÂä™ÂäõÁöÑÔºÅ', effect: { reputation: 50, title: 'Êú™Êù•ÈòüÈïø', buff: 'captainBonus', stress: 5 } }
                            ]
                        }
                    },
                    
                    // 4. Ê∏∏ÊàèÁõ∏ÂÖ≥‰∫ã‰ª∂
                    {
                        id: 'game_master',
                        name: 'Ê∏∏ÊàèÈ´òÊâã',
                        condition: { activities: { game: 8 } },
                        probability: 0.4,
                        once: true,
                        content: {
                            title: 'üéÆ Ê∏∏ÊàèÈ´òÊâã',
                            text: '‰Ω†Âú®Ê∏∏ÊàèÈáåÈÅáÂà∞‰∫Ü‰∏Ä‰∏™È´òÊâã„ÄÇÂØπÊñπÔºö"‰Ω†ÂèçÂ∫îÈÄüÂ∫¶‰∏çÈîôÂïäÔºåÊâìÊéíÁêÉÁöÑÔºüÊàëÊòØËÅå‰∏öÁîµÁ´ûÈÄâÊâãÔºåË¶Å‰∏çË¶ÅÂàáÁ£ã‰∏Ä‰∏ãÔºü"\n\n‰Ω†‰ª¨Êàê‰∏∫‰∫ÜÊ∏∏ÊàèÂ•ΩÂèã„ÄÇ',
                            choices: [
                                { text: 'Â•ΩÂïäÔºÅ', effect: { mood: 15, special: 'gameFriend' } }
                            ]
                        }
                    },
                    {
                        id: 'esports_tournament',
                        name: 'ÁîµÁ´ûÊØîËµõ',
                        condition: { activities: { game: 12 } },
                        probability: 0.25,
                        once: true,
                        content: {
                            title: 'üèÜ ÁîµÁ´ûÊØîËµõ',
                            text: 'Ê∏∏ÊàèÂ•ΩÂèãÈÇÄËØ∑‰Ω†ÂèÇÂä†Ê†°Âõ≠ÁîµÁ´ûÊØîËµõ„ÄÇ"Â•ñÈáë1000ÂÖÉÔºåËÄå‰∏î‰∏çËÄΩËØØÂ§öÂ∞ëÊó∂Èó¥„ÄÇ‰Ω†ÂèçÂ∫îËøô‰πàÂø´ÔºåËÇØÂÆöËÉΩÊãøÂêçÊ¨°ÔºÅ"',
                            choices: [
                                { text: 'ÂèÇÂä†ÊØîËµõ', effect: { special: 'esportsTournament' } },
                                { text: 'ÁÆó‰∫ÜÔºåÊàëË¶Å‰∏ìÊ≥®ÊéíÁêÉ', effect: {} }
                            ]
                        }
                    },
                    
                    // 5. Âõæ‰π¶È¶ÜÁõ∏ÂÖ≥‰∫ã‰ª∂
                    {
                        id: 'psychology_book',
                        name: 'Â≠¶Èú∏ÁöÑÁßòÁ±ç',
                        condition: { activities: { library: 5 } },
                        probability: 0.4,
                        once: true,
                        content: {
                            title: 'üìñ Â≠¶Èú∏ÁöÑÁßòÁ±ç',
                            text: 'Âú®Âõæ‰π¶È¶ÜÔºå‰Ω†ÂèëÁé∞‰∫Ü‰∏ÄÊú¨„ÄäËøêÂä®ÂøÉÁêÜÂ≠¶„Äã„ÄÇÈáåÈù¢ÊúâÂæàÂ§öÂÖ≥‰∫éÂ¶Ç‰Ωï‰øùÊåÅÊúÄ‰Ω≥Áä∂ÊÄÅÁöÑÊñπÊ≥ï„ÄÇ\n\n‰Ω†ËÆ§ÁúüÂ≠¶‰π†‰∫ÜËøôÊú¨‰π¶„ÄÇ',
                            choices: [
                                { text: 'ÂèóÁõäÂå™ÊµÖÔºÅ', effect: { mood: 15, buff: 'stressReduction', title: 'ÂøÉÁêÜÂ§ßÂ∏à' } }
                            ]
                        }
                    },
                    {
                        id: 'senior_guidance',
                        name: 'Â≠¶ÂßêÁöÑÊåáÂØº',
                        condition: { activities: { library: 8 }, reputation: 50 },
                        probability: 0.35,
                        once: true,
                        content: {
                            title: 'üë©‚Äçüéì Â≠¶ÂßêÁöÑÊåáÂØº',
                            text: '‰∏Ä‰Ωç‰ΩìËÇ≤Á≥ªÁöÑÂ≠¶ÂßêÊ≥®ÊÑèÂà∞‰Ω†Âú®ÁúãÊéíÁêÉ‰π¶Á±ç„ÄÇ"‰Ω†ÊòØÊéíÁêÉÁ§æÁöÑÂêßÔºüÊàë‰ª•Ââç‰πüÊâìÊéíÁêÉ„ÄÇËøô‰∫õËµÑÊñôÁªô‰Ω†ÔºåÂ∏åÊúõÂØπ‰Ω†ÊúâÂ∏ÆÂä©„ÄÇ"\n\nÂ•πÁªô‰∫Ü‰Ω†‰∏Ä‰∫õÁèçË¥µÁöÑËÆ≠ÁªÉËµÑÊñô„ÄÇ',
                            choices: [
                                { text: 'Â§™ÊÑüË∞¢‰∫ÜÔºÅ', effect: { serve: 3, spike: 3, block: 3, dig: 3, set: 3, relationship: 10, special: 'seniorNotes' } }
                            ]
                        }
                    },
                    
                    // 6. ÁæéÈ£üÁõ∏ÂÖ≥‰∫ã‰ª∂
                    {
                        id: 'food_regular',
                        name: 'ÁæéÈ£üÂÆ∂',
                        condition: { activities: { food: 6 } },
                        probability: 0.4,
                        once: true,
                        content: {
                            title: 'üçú ÁæéÈ£üÂÆ∂',
                            text: 'È§êÂéÖËÄÅÊùøËÆ§Âá∫‰∫Ü‰Ω†Ôºö"Â∞è‰ºôÂ≠êÔºå‰Ω†ÊòØÊàë‰ª¨ÁöÑÂ∏∏ÂÆ¢ÔºÅÁúã‰Ω†ÊòØÂ≠¶ÁîüÔºå‰ª•ÂêéÊù•ÂêÉÈ•≠Áªô‰Ω†Êâì9Êäò„ÄÇËÄå‰∏îÊàëÁúã‰Ω†ÊòØËøêÂä®ÂëòÔºåÁªô‰Ω†Âä†Èáè‰∏çÂä†‰ª∑ÔºÅ"',
                            choices: [
                                { text: 'Â§™Â•Ω‰∫ÜÔºåË∞¢Ë∞¢ËÄÅÊùøÔºÅ', effect: { mood: 15, buff: 'foodDiscount', title: 'ÁæéÈ£üÂÆ∂' } }
                            ]
                        }
                    },
                    {
                        id: 'nutritionist_advice',
                        name: 'Ëê•ÂÖªÂ∏àÁöÑÂª∫ËÆÆ',
                        condition: { activities: { food: 8 }, maxEnergy: 95 },
                        probability: 0.3,
                        once: true,
                        content: {
                            title: 'ü•ó Ëê•ÂÖªÂ∏àÁöÑÂª∫ËÆÆ',
                            text: '‰∏Ä‰ΩçËê•ÂÖªÂ∏àÊ≥®ÊÑèÂà∞‰Ω†ÁöÑÈ•ÆÈ£ü‰π†ÊÉØ„ÄÇ"ÂêåÂ≠¶Ôºå‰Ω†ÊòØËøêÂä®ÂëòÂêßÔºüÊàëÂèØ‰ª•Áªô‰Ω†Âà∂ÂÆö‰∏Ä‰ªΩ‰∏ì‰∏öÁöÑËê•ÂÖªËÆ°ÂàíÔºåÂÖçË¥πÁöÑÔºÅ"\n\n‰Ω†Ëé∑Âæó‰∫ÜÁßëÂ≠¶ÁöÑËê•ÂÖªÊåáÂØº„ÄÇ',
                            choices: [
                                { text: 'Â§™ÊÑüË∞¢‰∫ÜÔºÅ', effect: { maxEnergy: 10, buff: 'nutritionPlan', title: 'ÁßëÂ≠¶È•ÆÈ£ü' } }
                            ]
                        }
                    },
                    
                    // 7. ÊâìÂ∑•Áõ∏ÂÖ≥‰∫ã‰ª∂
                    {
                        id: 'boss_appreciation',
                        name: 'ËÄÅÊùøÁöÑËµèËØÜ',
                        condition: { activities: { work: 8 } },
                        probability: 0.4,
                        once: true,
                        content: {
                            title: 'üíº ËÄÅÊùøÁöÑËµèËØÜ',
                            text: 'ËÄÅÊùøÊää‰Ω†Âè´Âà∞‰∏ÄËæπÔºö"Â∞è‰ºôÂ≠êÔºå‰Ω†Â∑•‰ΩúÂæàËÆ§Áúü„ÄÇ‰ª•Âêé‰Ω†Êù•ÊâìÂ∑•ÔºåÂ∑•ËµÑÁªô‰Ω†Ê∂®20%ÔºÅËÄå‰∏îÂ¶ÇÊûú‰Ω†ÈúÄË¶ÅÔºåÈöèÊó∂ÂèØ‰ª•Êù•„ÄÇ"',
                            choices: [
                                { text: 'Ë∞¢Ë∞¢ËÄÅÊùøÔºÅ', effect: { mood: 15, buff: 'workBonus' } }
                            ]
                        }
                    },
                    {
                        id: 'sports_store_job',
                        name: 'Â∑•‰ΩúÊú∫‰ºö',
                        condition: { activities: { work: 12 }, reputation: 60 },
                        probability: 0.3,
                        once: true,
                        content: {
                            title: 'üí∞ Â∑•‰ΩúÊú∫‰ºö',
                            text: 'ËÄÅÊùø‰ªãÁªç‰Ω†Âéª‰∏ÄÂÆ∂‰ΩìËÇ≤Áî®ÂìÅÂ∫óÂÅöÂÖºËÅå„ÄÇ"‰ªñ‰ª¨ÈúÄË¶ÅÊáÇÊéíÁêÉÁöÑ‰∫∫ÔºåÂ∑•ËµÑÊõ¥È´òÔºåËÄå‰∏î‰Ω†ËøòËÉΩÂ≠¶Âà∞ÂæàÂ§ö‰∏ì‰∏öÁü•ËØÜ„ÄÇ"',
                            choices: [
                                { text: 'Â§™Â•Ω‰∫ÜÔºÅ', effect: { mood: 20, reputation: 10, special: 'sportsStoreJob' } }
                            ]
                        }
                    },
                    
                    // 8. ÊåâÊë©/‰ºëÊÅØÁõ∏ÂÖ≥‰∫ã‰ª∂
                    {
                        id: 'therapist_recognition',
                        name: 'ÁêÜÁñóÂ∏àÁöÑËÆ§ÂèØ',
                        condition: { activities: { massage: 6 } },
                        probability: 0.4,
                        once: true,
                        content: {
                            title: 'üíÜ ÁêÜÁñóÂ∏àÁöÑËÆ§ÂèØ',
                            text: 'ÁêÜÁñóÂ∏àÔºö"‰Ω†ÂæàÊ≥®ÈáçË∫´‰ΩìÊÅ¢Â§çÔºåËøôÂæàÂ•Ω„ÄÇÊàëÊïô‰Ω†‰∏Ä‰∫õËá™ÊàëÊåâÊë©ÁöÑÊñπÊ≥ïÔºå‰ª•Âêé‰Ω†Ëá™Â∑±‰πüËÉΩÂÅöÁÆÄÂçïÁöÑÊîæÊùæ„ÄÇ"',
                            choices: [
                                { text: 'Â§™ÊÑüË∞¢‰∫ÜÔºÅ', effect: { buff: 'selfTherapy', title: 'Ëá™ÊàëÁêÜÁñó' } }
                            ]
                        }
                    },
                    {
                        id: 'perfect_routine',
                        name: 'ÂÆåÁæé‰ΩúÊÅØ',
                        condition: { activities: { rest: 10 }, avgEnergy: 80 },
                        probability: 0.35,
                        once: true,
                        content: {
                            title: 'üò¥ ÂÆåÁæé‰ΩúÊÅØ',
                            text: '‰Ω†ÂÖªÊàê‰∫ÜËâØÂ•ΩÁöÑ‰ΩúÊÅØ‰π†ÊÉØ„ÄÇË∫´‰ΩìÁä∂ÊÄÅË∂äÊù•Ë∂äÂ•ΩÔºåËÆ≠ÁªÉÊïàÊûú‰πüÊèêÂçá‰∫Ü„ÄÇ\n\nÊïôÁªÉÈÉΩÂ§∏‰Ω†ÊòØ"Ëá™ÂæãÂÖ∏ËåÉ"ÔºÅ',
                            choices: [
                                { text: 'ÁªßÁª≠‰øùÊåÅÔºÅ', effect: { maxEnergy: 10, buff: 'perfectRoutine', title: 'Ëá™ÂæãÂÖ∏ËåÉ' } }
                            ]
                        }
                    },
                    
                    // 9. Â§çÂêà‰∫ã‰ª∂
                    {
                        id: 'well_rounded',
                        name: 'ÂÖ®Èù¢ÂèëÂ±ï',
                        condition: { diverseActivities: 5 },
                        probability: 0.3,
                        once: true,
                        content: {
                            title: 'üåü ÂÖ®Èù¢ÂèëÂ±ï',
                            text: 'ËæÖÂØºÂëòÊâæÂà∞‰Ω†Ôºö"ÊàëÊ≥®ÊÑèÂà∞‰Ω†‰∏ç‰ªÖËÆ≠ÁªÉÂàªËã¶ÔºåÁîüÊ¥ª‰πüÂæà‰∏∞ÂØå„ÄÇÂ≠¶‰π†„ÄÅÁ§æ‰∫§„ÄÅÂ®±‰πêÈÉΩÂæàÂπ≥Ë°°„ÄÇÂ≠¶Ê†°ÊÉ≥Êé®Ëçê‰Ω†ÂèÇÂä†\'‰ºòÁßÄÂ§ßÂ≠¶Áîü\'ËØÑÈÄâ„ÄÇ"',
                            choices: [
                                { text: 'Â§™Ëç£Âπ∏‰∫ÜÔºÅ', effect: { reputation: 30, money: 500, mood: 20, title: '‰ºòÁßÄÂ§ßÂ≠¶Áîü' } }
                            ]
                        }
                    },
                    {
                        id: 'campus_celebrity',
                        name: 'Ê†°Âõ≠Âêç‰∫∫',
                        condition: { reputation: 80, diverseActivities: 6 },
                        probability: 0.25,
                        once: true,
                        content: {
                            title: 'üì∏ Ê†°Âõ≠Âêç‰∫∫',
                            text: 'Ê†°Âõ≠ËÆ∞ËÄÖÊÉ≥ÈááËÆø‰Ω†Ôºö"‰Ω†Âú®ÊéíÁêÉÈòüË°®Áé∞Âá∫Ëâ≤ÔºåÁîüÊ¥ª‰πüÂæàÁ≤æÂΩ©ÔºåËÉΩÂàÜ‰∫´‰∏Ä‰∏ã‰Ω†ÁöÑÁªèÈ™åÂêóÔºü"\n\nÈááËÆøÂèëÂ∏ÉÂêéÔºå‰Ω†Êàê‰∫ÜÊ†°Âõ≠Âêç‰∫∫ÔºÅ',
                            choices: [
                                { text: 'ÂæàÈ´òÂÖ¥ÂàÜ‰∫´', effect: { reputation: 40, relationship: 20, title: 'Ê†°Âõ≠ÊòéÊòü', buff: 'campusStar' } }
                            ]
                        }
                    },
                    {
                        id: 'life_mentor',
                        name: 'ÁîüÊ¥ªÂØºÂ∏à',
                        condition: { activities: { gift: 4, social: 6 }, diverseActivities: 4 },
                        probability: 0.3,
                        once: true,
                        content: {
                            title: 'üéì ÁîüÊ¥ªÂØºÂ∏à',
                            text: 'Â≠¶ÂºüÂ≠¶Â¶π‰ª¨ÁªèÂ∏∏Êù•Êâæ‰Ω†ËØ∑Êïô„ÄÇ‰∏ç‰ªÖÊòØÊéíÁêÉÊäÄÊúØÔºåËøòÊúâÂ¶Ç‰ΩïÂπ≥Ë°°Â≠¶‰π†„ÄÅËÆ≠ÁªÉÂíåÁîüÊ¥ª„ÄÇ\n\n‰Ω†Êàê‰∫ÜÂ§ßÂÆ∂ÁöÑ"ÁîüÊ¥ªÂØºÂ∏à"ÔºÅ',
                            choices: [
                                { text: 'Âæà‰πêÊÑèÂ∏ÆÂä©Â§ßÂÆ∂', effect: { reputation: 25, relationship: 15, title: 'ÁîüÊ¥ªÂØºÂ∏à', buff: 'mentor' } }
                            ]
                        }
                    },
                    
                    // 10. ÁâπÊÆäËøûÈîÅ‰∫ã‰ª∂
                    {
                        id: 'lucky_day',
                        name: 'Âπ∏ËøêÊó•',
                        condition: { scratchCardJackpots: 1, mood: 80 },
                        probability: 0.2,
                        once: false,
                        content: {
                            title: 'üçÄ Âπ∏ËøêÊó•',
                            text: '‰ªäÂ§©‰ºº‰πéÁâπÂà´Âπ∏ËøêÔºÅËµ∞Âú®Ë∑Ø‰∏äÊç°Âà∞‰∫ÜÈí±ÔºåÈ£üÂ†ÇÈòøÂß®Â§öÊâì‰∫ÜËèúÔºåËÆ≠ÁªÉÊó∂Áä∂ÊÄÅÁâπÂà´Â•Ω...\n\nËøôÊòØ‰Ω†ÁöÑÂπ∏ËøêÊó•ÔºÅ',
                            choices: [
                                { text: 'Â§™Ê£í‰∫ÜÔºÅ', effect: { money: 100, mood: 15, special: 'luckyWeek' } }
                            ]
                        }
                    },
                    {
                        id: 'burnout_warning',
                        name: 'Áñ≤ÊÉ´Êúü',
                        condition: { activities: { work: 10 }, maxRest: 2 },
                        probability: 0.4,
                        once: false,
                        content: {
                            title: 'üò∞ Áñ≤ÊÉ´Êúü',
                            text: '‰Ω†ÊúÄËøëÂ§™Á¥Ø‰∫Ü...ÈòüÂèãÊãÖÂøÉÂú∞ËØ¥Ôºö"‰Ω†ÊòØ‰∏çÊòØÊâìÂ∑•Â§™Â§ö‰∫ÜÔºüË∫´‰ΩìË¶ÅÁ¥ßÂïäÔºåÂà´ÊääËá™Â∑±Á¥ØÂùè‰∫Ü„ÄÇ"',
                            choices: [
                                { text: '‰Ω†ËØ¥ÂæóÂØπÔºåÊàëË¶ÅÂ§ö‰ºëÊÅØ', effect: { energy: -20, mood: -15, stress: 15, special: 'restBuff' } },
                                { text: 'Ê≤°‰∫ãÔºåÊàëËÉΩÂùöÊåÅ', effect: { energy: -20, mood: -15, stress: 15, special: 'burnoutPenalty' } }
                            ]
                        }
                    },
                    {
                        id: 'love_trouble',
                        name: 'ÊÅãÁà±ÁöÑÁÉ¶ÊÅº',
                        condition: { hasLoveInterest: true, weeklyTraining: 3, weeklyDate: 0 },
                        probability: 0.3,
                        once: false,
                        content: {
                            title: 'üíî ÊÅãÁà±ÁöÑÁÉ¶ÊÅº',
                            text: 'ÂØπË±°ÂèëÊù•Ê∂àÊÅØÔºö"‰Ω†ÊúÄËøëÈÉΩÂú®ËÆ≠ÁªÉÔºåÈÉΩÊ≤°Êó∂Èó¥Èô™Êàë...‰Ω†ÊòØ‰∏çÊòØ‰∏çÂú®‰πéÊàë‰∫ÜÔºü"\n\n‰Ω†ÈúÄË¶ÅÂπ≥Ë°°ÊÅãÁà±ÂíåËÆ≠ÁªÉ„ÄÇ',
                            choices: [
                                { text: 'Êä±Ê≠âÔºåËøôÂë®Êú´Èô™‰Ω†', effect: { mood: -10, stress: 10, special: 'planDate' } },
                                { text: 'ÂØπ‰∏çËµ∑ÔºåÊØîËµõÂø´Âà∞‰∫Ü', effect: { relationship: -10, buff: 'focusBonus' } },
                                { text: 'Êàë‰ª¨ËøòÊòØÂàÜÊâãÂêß', effect: { mood: -20, special: 'breakup', buff: 'dedicationBonus' } }
                            ]
                        }
                    }
                ];
            }
            
            getGoalInfo() {
                const goals = {
                    collegeTryout: {
                        id: 'collegeTryout',
                        type: 'tryout',  // ÈÄâÊãîÁ±ª
                        title: 'üéØ Âä†ÂÖ•Èô¢Èòü',
                        icon: 'üéØ',
                        timeWindow: 'Á¨¨2-4Âë®',
                        nextEvent: 'Á¨¨5Âë®Èô¢ÈôÖÊØîËµõ',
                        // ÁÆÄÂåñË¶ÅÊ±ÇÔºöÂè™ÁúãÊäÄËÉΩÔºå‰ªªÊÑè2È°πÊäÄËÉΩ‚â•15Âç≥ÂèØ
                        criteria: {
                            skillCount: {
                                minSkills: 2,  // Ëá≥Â∞ë2È°πÊäÄËÉΩËææÊ†á
                                threshold: 15  // ÊØèÈ°πÊäÄËÉΩÁöÑÈó®Êßõ
                            }
                        },
                        requirements: {  // ‰øùÁïôÁî®‰∫éÊòæÁ§∫
                            anyTwo: 15  // ‰ªªÊÑè2È°π‚â•15
                        },
                        tips: 'Âª∫ËÆÆÁ¨¨4Âë®ÂâçÂÆåÊàêÈÄâÊãîÔºå‰∏∫ÊØîËµõÂÅöÂáÜÂ§á',
                        nextGoal: 'collegeMatch'
                    },
                    collegeMatch: {
                        id: 'collegeMatch',
                        type: 'match',  // ÊØîËµõÁ±ª
                        title: 'üèê Èô¢ÈôÖÊØîËµõ',
                        icon: 'üèê',
                        triggerWeek: 5,
                        description: 'Â∞ΩÂèØËÉΩÂèñÂæóÂ•ΩÊàêÁª©',
                        tips: '‰øùÊåÅÊúÄ‰Ω≥Áä∂ÊÄÅÂèÇËµõ',  // Ê∑ªÂä†tipsÂ≠óÊÆµ‰Ωú‰∏∫ÂêéÂ§á
                        preparation: [
                            'ÊèêÂçá‰∏ªË¶ÅÊäÄËÉΩÂà∞20+',
                            '‰øùÊåÅËâØÂ•ΩÁä∂ÊÄÅÔºàÂøÉÊÉÖ„ÄÅ‰ΩìÂäõÔºâ',
                            'ÈÄâÊã©ÂêàÈÄÇÁöÑÂú∫‰∏ä‰ΩçÁΩÆ'
                        ],
                        performanceLevels: [
                            '‰ºòÁßÄÔºöÂÖ®Èù¢ÂèëÊå•Ôºå‰∏ªÂØºÊØîËµõ',
                            'ËâØÂ•ΩÔºöÁ®≥ÂÆöÂèëÊå•ÔºåÂ∏ÆÂä©ÁêÉÈòü',
                            '‰∏ÄËà¨Ôºö‰∏≠ËßÑ‰∏≠Áü©',
                            '‰∏ç‰Ω≥ÔºöÂèëÊå•Â§±Â∏∏'
                        ],
                        nextGoal: 'universityTryout'
                    },
                    universityTryout: {
                        id: 'universityTryout',
                        type: 'tryout',  // ÈÄâÊãîÁ±ª
                        title: 'üéØ Âä†ÂÖ•Ê†°Èòü',
                        icon: 'üéØ',
                        timeWindow: 'Á¨¨8-11Âë®',
                        nextEvent: 'Á¨¨12Âë®Ê†°ÈôÖËÅîËµõ',
                        // ‰øÆÊîπË¶ÅÊ±ÇÔºö‰ªªÊÑè3È°πÊäÄËÉΩ‚â•50ÔºåÊÄªÂíå‚â•180
                        criteria: {
                            skillCount: {
                                minSkills: 3,
                                threshold: 50
                            },
                            skillSum: {
                                min: 180
                            },
                            stats: {
                                reputation: { min: 50 }
                            }
                        },
                        requirements: {
                            anyThree: 50,
                            totalSum: 180,
                            reputation: 50
                        },
                        tips: 'Âª∫ËÆÆÁ¨¨11Âë®ÂâçÂÆåÊàêÈÄâÊãîÔºå‰∏∫ËÅîËµõÂÅöÂáÜÂ§á„ÄÇÈô¢ÈôÖÊØîËµõË°®Áé∞Â•ΩÂèØËé∑ÂæóÂ§ßÈáèÂ£∞Êúõ',
                        nextGoal: 'universityLeague'
                    },
                    universityLeague: {
                        id: 'universityLeague',
                        type: 'match',  // ÊØîËµõÁ±ª
                        title: 'üèÜ Ê†°ÈôÖËÅîËµõ',
                        icon: 'üèÜ',
                        triggerWeek: 12,
                        description: 'ËøôÊòØÊúÄÂêéÁöÑÊØîËµõÔºÅ‰Ω†ÁöÑË°®Áé∞Â∞ÜÂÜ≥ÂÆöÊúÄÁªàÁªìÂ±Ä',
                        tips: 'ÂÖ®Âäõ‰ª•Ëµ¥ÔºåÂàõÈÄ†Â•áËøπÔºÅ',  // Ê∑ªÂä†tipsÂ≠óÊÆµ‰Ωú‰∏∫ÂêéÂ§á
                        preparation: [
                            'ÂÖ®Èù¢ÊèêÂçáÊäÄËÉΩÂà∞50+',
                            'Ë¥≠‰π∞Ë£ÖÂ§áÊèêÂçáËÆ≠ÁªÉÊïàÁéá',
                            '‰øùÊåÅÊúÄ‰Ω≥Áä∂ÊÄÅÂèÇËµõ'
                        ],
                        endings: [
                            'üèÜ ÂÜ†ÂÜõÔºöÂÆåÁæéË°®Áé∞ÔºåÊ®™Êâ´ÂØπÊâã',
                            'ü•à ‰∫öÂÜõÔºöÂá∫Ëâ≤ÂèëÊå•ÔºåÊÉúË¥•ÂÜ≥Ëµõ',
                            'üèê ÂõõÂº∫ÔºöÁ®≥ÂÆöË°®Áé∞ÔºåÊ≠¢Ê≠•ÂçäÂÜ≥Ëµõ',
                            'üìñ Âá∫Â±ÄÔºöÈ¶ñËΩÆÊ∑òÊ±∞ÔºåÁªßÁª≠Âä™Âäõ'
                        ],
                        nextGoal: null  // ÊØîËµõÂêéËøõÂÖ•ÁªìÂ±Ä
                    }
                };
                
                return goals[this.currentGoal] || goals.collegeTryout;
            }
            
            getAllGoals() {
                // ËøîÂõûÊâÄÊúâÁõÆÊ†áÁöÑÊúâÂ∫èÂàóË°®ÔºàÂåÖÊã¨ÈÄâÊãîÂíåÊØîËµõÔºâ
                return [
                    'collegeTryout',      // Èò∂ÊÆµ‰∏ÄÔºöÂä†ÂÖ•Èô¢ÈòüÔºàÁ¨¨1-4Âë®ÈÄâÊãîÔºâ
                    'collegeMatch',       // Èò∂ÊÆµ‰∫åÔºöÈô¢ÈôÖÊØîËµõÔºàÁ¨¨5Âë®Ëá™Âä®Ôºâ
                    'universityTryout',   // Èò∂ÊÆµ‰∏âÔºöÂä†ÂÖ•Ê†°ÈòüÔºàÁ¨¨8-11Âë®ÈÄâÊãîÔºâ
                    'universityLeague'    // Èò∂ÊÆµÂõõÔºöÊ†°ÈôÖËÅîËµõÔºàÁ¨¨12Âë®Ëá™Âä®ÔºåÂÜ≥ÂÆöÁªìÂ±ÄÔºâ
                ];
            }
            
            getGoalStatus(goalId) {
                const allGoals = this.getAllGoals();
                const currentIndex = allGoals.indexOf(this.currentGoal);
                const goalIndex = allGoals.indexOf(goalId);
                
                if (goalIndex < currentIndex) {
                    return 'completed';
                } else if (goalIndex === currentIndex) {
                    return 'current';
                } else if (goalIndex === currentIndex + 1) {
                    return 'next';
                } else {
                    return 'future';
                }
            }
            
            // Êñ∞Â¢ûÔºöÂ§öÁª¥Â∫¶ÁõÆÊ†áËØÑ‰º∞
            evaluateGoal(goal) {
                if (!goal || !goal.criteria) {
                    return { passed: false, score: 0, breakdown: {} };
                }
                
                let totalScore = 0;
                let maxScore = 0;
                let breakdown = {
                    skillCount: { score: 0, max: 0, details: {} },
                    skillSum: { score: 0, max: 0, details: {} },
                    stats: { score: 0, max: 0, details: {} },
                    performance: { score: 0, max: 0, details: {} }
                };
                
                // ËØÑ‰º∞ÊäÄËÉΩÊï∞ÈáèÊ†áÂáÜÔºàÊñ∞Â¢ûÔºâ
                if (goal.criteria.skillCount) {
                    const sc = goal.criteria.skillCount;
                    const weight = sc.weight || 1.0;  // ÈªòËÆ§ÊùÉÈáç1.0
                    maxScore += weight;
                    breakdown.skillCount.max += weight;
                    
                    // ÁªüËÆ°ËææÊ†áÁöÑÊäÄËÉΩÊï∞Èáè
                    const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                    let qualifiedSkills = [];
                    
                    skills.forEach(skill => {
                        if (this.player.skills[skill] >= sc.threshold) {
                            qualifiedSkills.push({
                                name: skill,
                                value: this.player.skills[skill]
                            });
                        }
                    });
                    
                    // ËÆ°ÁÆóÂæóÂàÜÔºöËææÊ†áÊäÄËÉΩÊï∞ / Ë¶ÅÊ±ÇÊäÄËÉΩÊï∞
                    const progress = Math.min(qualifiedSkills.length / sc.minSkills, 1.0);
                    const score = progress * weight;
                    
                    totalScore += score;
                    breakdown.skillCount.score += score;
                    breakdown.skillCount.details = {
                        qualified: qualifiedSkills.length,
                        required: sc.minSkills,
                        threshold: sc.threshold,
                        qualifiedSkills: qualifiedSkills,
                        progress: progress,
                        score: score,
                        weight: weight
                    };
                }
                
                // ËØÑ‰º∞ÊäÄËÉΩÊÄªÂíåÊ†áÂáÜÔºàÊñ∞Â¢ûÔºâ
                if (goal.criteria.skillSum) {
                    const ss = goal.criteria.skillSum;
                    const weight = ss.weight || 1.0;
                    maxScore += weight;
                    breakdown.skillSum.max += weight;
                    
                    // ËÆ°ÁÆóÂΩìÂâçÊäÄËÉΩÊÄªÂíå
                    const currentSum = this.player.skills.serve + this.player.skills.spike + 
                                     this.player.skills.block + this.player.skills.dig + this.player.skills.set;
                    
                    // ËÆ°ÁÆóÂæóÂàÜÔºöÂΩìÂâçÊÄªÂíå / Ë¶ÅÊ±ÇÊÄªÂíå
                    const progress = Math.min(currentSum / ss.min, 1.0);
                    const score = progress * weight;
                    
                    totalScore += score;
                    breakdown.skillSum.score += score;
                    breakdown.skillSum.details = {
                        current: currentSum,
                        required: ss.min,
                        progress: progress,
                        score: score,
                        weight: weight
                    };
                }
                
                // ËØÑ‰º∞Â±ûÊÄßÊ†áÂáÜÔºàÂ£∞ÊúõÁ≠âÔºâ
                if (goal.criteria.stats) {
                    for (let [stat, requirement] of Object.entries(goal.criteria.stats)) {
                        const weight = requirement.weight || 1.0;  // ÈªòËÆ§ÊùÉÈáç1.0
                        maxScore += weight;
                        breakdown.stats.max += weight;
                        
                        let statValue = stat === 'reputation' ? this.player.reputation : this.player.skills[stat];
                        let progress = Math.min(statValue / requirement.min, 1.0);
                        let score = progress * weight;
                        
                        totalScore += score;
                        breakdown.stats.score += score;
                        breakdown.stats.details[stat] = {
                            current: statValue,
                            required: requirement.min,
                            progress: progress,
                            score: score,
                            weight: weight
                        };
                    }
                }
                
                // ËØÑ‰º∞Ë°®Áé∞Ê†áÂáÜ
                if (goal.criteria.performance) {
                    for (let [metric, requirement] of Object.entries(goal.criteria.performance)) {
                        const weight = requirement.weight || 1.0;  // ÈªòËÆ§ÊùÉÈáç1.0
                        maxScore += weight;
                        breakdown.performance.max += weight;
                        
                        let metricValue = this.player[metric] || 0;
                        let progress = Math.min(metricValue / requirement.min, 1.0);
                        let score = progress * weight;
                        
                        totalScore += score;
                        breakdown.performance.score += score;
                        breakdown.performance.details[metric] = {
                            current: metricValue,
                            required: requirement.min,
                            progress: progress,
                            score: score,
                            weight: weight
                        };
                    }
                }
                
                // ËÆ°ÁÆóÊúÄÁªàÂæóÂàÜ
                let finalScore = maxScore > 0 ? totalScore / maxScore : 0;
                let passed = finalScore >= (goal.passingScore || 1.0);  // ÈªòËÆ§Ë¶ÅÊ±Ç100%ËææÊ†á
                
                return {
                    passed,
                    score: finalScore,
                    breakdown
                };
            }
            
            // Ê£ÄÊü•ÁõÆÊ†áÊòØÂê¶ËææÊàêÔºà‰ΩøÁî®Êñ∞ÁöÑËØÑ‰º∞Á≥ªÁªüÔºâ
            checkGoalCompletion() {
                const goal = this.getGoalInfo();
                
                // Âè™Ê£ÄÊü•ÈÄâÊãîÁ±ªÁõÆÊ†áÔºåÊØîËµõÁ±ªÁõÆÊ†áËá™Âä®Ëß¶Âèë
                if (!goal || goal.type !== 'tryout') return false;
                
                // ‰ΩøÁî®Êñ∞ÁöÑËØÑ‰º∞Á≥ªÁªü
                const evaluation = this.evaluateGoal(goal);
                
                if (evaluation.passed) {
                    // ÊûÑÂª∫ËØ¶ÁªÜ‰ø°ÊÅØ
                    let detailsText = `ÁªºÂêàËØÑÂàÜÔºö${(evaluation.score * 100).toFixed(1)}%\n\n`;
                    
                    // ÊäÄËÉΩÊï∞ÈáèÂæóÂàÜ
                    if (evaluation.breakdown.skillCount && evaluation.breakdown.skillCount.max > 0) {
                        const sc = evaluation.breakdown.skillCount.details;
                        detailsText += `‚úÖ ÊäÄËÉΩËææÊ†áÔºö${sc.qualified}/${sc.required}È°πÔºàÈó®Êßõ${sc.threshold}Ôºâ\n`;
                        if (sc.qualifiedSkills.length > 0) {
                            detailsText += `   ËææÊ†áÊäÄËÉΩÔºö${sc.qualifiedSkills.map(s => {
                                const names = {serve:'ÂèëÁêÉ',spike:'Êâ£ÁêÉ',block:'Êã¶ÁΩë',dig:'Âû´ÁêÉ',set:'ÊâòÁêÉ'};
                                return names[s.name] + s.value;
                            }).join('„ÄÅ')}\n`;
                        }
                        detailsText += '\n';
                    }
                    
                    // Â±ûÊÄßÂæóÂàÜ
                    if (evaluation.breakdown.stats && evaluation.breakdown.stats.max > 0) {
                        detailsText += `üìä Â±ûÊÄßËØÑÂàÜÔºö${(evaluation.breakdown.stats.score / evaluation.breakdown.stats.max * 100).toFixed(1)}%\n`;
                    }
                    
                    // Ë°®Áé∞ÂæóÂàÜ
                    if (evaluation.breakdown.performance && evaluation.breakdown.performance.max > 0) {
                        detailsText += `üèê Ë°®Áé∞ËØÑÂàÜÔºö${(evaluation.breakdown.performance.score / evaluation.breakdown.performance.max * 100).toFixed(1)}%\n`;
                    }
                    
                    // ÁõÆÊ†áËææÊàê - ‰ΩøÁî®Âú∫ÊôØÁ≥ªÁªüÊòæÁ§∫
                    
                    // ÂàõÂª∫ÁõÆÊ†áËææÊàêÂú∫ÊôØ
                    SCENES.goalAchieved = {
                        text: `<h2>üéâ ÁõÆÊ†áËææÊàêÔºÅ</h2><p>ÊÅ≠Âñú‰Ω†ÂÆåÊàê‰∫Ü${goal.title}ÔºÅ</p><pre>${detailsText}</pre>`,
                        choices: [{
                            text: 'ÁªßÁª≠',
                            next: goal.nextGoal ? 'weeklyHub' : 'ending',
                            effect: goal.nextGoal ? { goalUpdate: goal.nextGoal } : {}
                        }]
                    };
                    
                    this.showScene('goalAchieved');
                    return true;
                } else {
                    // ÊûÑÂª∫Êú™ËææÊàêËØ¶ÁªÜ‰ø°ÊÅØ
                    const scorePercent = (evaluation.score * 100).toFixed(1);
                    const neededPercent = ((goal.passingScore || 0.7) * 100).toFixed(0);
                    
                    let detailsText = `‰Ω†ÁöÑÁªºÂêàËØÑÂàÜÔºö${scorePercent}%\nÈúÄË¶ÅËææÂà∞Ôºö${neededPercent}%\n\n`;
                    
                    // ÊòæÁ§∫Â∑ÆË∑ù
                    if (evaluation.breakdown.skillCount && evaluation.breakdown.skillCount.max > 0) {
                        const sc = evaluation.breakdown.skillCount.details;
                        detailsText += `‚ùå ÊäÄËÉΩËææÊ†áÔºö${sc.qualified}/${sc.required}È°πÔºàËøòÂ∑Æ${sc.required - sc.qualified}È°πÔºâ\n`;
                    }
                    
                    // ÁõÆÊ†áÊú™ËææÊàê - ‰ΩøÁî®Âú∫ÊôØÁ≥ªÁªüÊòæÁ§∫
                    SCENES.goalFailed = {
                        text: `<h2>üò¢ ÁõÆÊ†áÊú™ËææÊàê</h2><p>ÂæàÈÅóÊÜæÔºå‰Ω†Êú™ËÉΩÂÆåÊàê${goal.title}„ÄÇ</p><pre>${detailsText}</pre><p>‰∏çË¶ÅÊ∞îÈ¶ÅÔºåÁªßÁª≠Âä™ÂäõÔºÅÊ∏∏ÊàèÂ∞ÜÁªßÁª≠„ÄÇ</p>`,
                        choices: [{
                            text: 'ÁªßÁª≠',
                            next: 'weeklyHub'
                        }]
                    };
                    
                    this.showScene('goalFailed');
                    return false;
                }
            }
            
            updateGoalDisplay() {
                const goalInfo = this.getGoalInfo();
                const goalText = document.getElementById('goal-text');
                
                if (!goalText) return;
                
                let html = `<strong>${goalInfo.title}</strong><br>`;
                
                // Ê†πÊçÆÁõÆÊ†áÁ±ªÂûãÊòæÁ§∫‰∏çÂêåÂÜÖÂÆπ
                if (goalInfo.type === 'tryout') {
                    // ÈÄâÊãîÁ±ªÁõÆÊ†áÔºöÊòæÁ§∫Ë¶ÅÊ±ÇÂíåËææÊ†áÊÉÖÂÜµ
                    const evaluation = this.evaluateGoal(goalInfo);
                    
                    html += `<span style="font-size: 12px; color: #374151; font-weight: 600;">‚è∞ ${goalInfo.timeWindow}ÂèØÈÄâÊãî</span><br><br>`;
                    
                    // ÊòæÁ§∫ÊäÄËÉΩÊï∞ÈáèË¶ÅÊ±Ç
                    if (goalInfo.criteria && goalInfo.criteria.skillCount) {
                        const sc = goalInfo.criteria.skillCount;
                        const details = evaluation.breakdown.skillCount.details;
                        
                        html += `<span style="font-size: 13px;">üìã ÈÄâÊãîË¶ÅÊ±ÇÔºö</span><br>`;
                        
                        const statusClass = details.qualified >= sc.minSkills ? 'goal-met' : 'goal-not-met';
                        const statusIcon = details.qualified >= sc.minSkills ? '‚úì' : '‚óã';
                        
                        let reqText = '';
                        if (goalInfo.requirements.anyTwo) {
                            reqText = `‰ªªÊÑè2È°π‚â•${goalInfo.requirements.anyTwo}`;
                        } else if (goalInfo.requirements.anyThree) {
                            reqText = `‰ªªÊÑè3È°π‚â•${goalInfo.requirements.anyThree}`;
                        }
                        
                        html += `<span class="${statusClass}">${statusIcon} ${reqText}ÔºàÂ∑≤ËææÊ†á${details.qualified}È°πÔºâ</span><br>`;
                        
                        // ÊòæÁ§∫ÊÄªÂíåË¶ÅÊ±ÇÔºàÂ¶ÇÊûúÊúâÔºâ
                        if (goalInfo.requirements.totalSum) {
                            const currentSum = this.player.skills.serve + this.player.skills.spike + 
                                             this.player.skills.block + this.player.skills.dig + this.player.skills.set;
                            const requiredSum = goalInfo.requirements.totalSum;
                            const sumMet = currentSum >= requiredSum;
                            const sumStatusClass = sumMet ? 'goal-met' : 'goal-not-met';
                            const sumStatusIcon = sumMet ? '‚úì' : '‚óã';
                            html += `<span class="${sumStatusClass}">${sumStatusIcon} ÊÄªÂíå‚â•${requiredSum}ÔºàÂΩìÂâç${currentSum}Ôºâ</span><br>`;
                        }
                        
                        // ÊòæÁ§∫ÂΩìÂâçÊäÄËÉΩÂÄº
                        html += `<div style="font-size: 12px; margin-top: 5px; color: #374151;">`;
                        const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                        const skillNames = {serve:'ÂèëÁêÉ',spike:'Êâ£ÁêÉ',block:'Êã¶ÁΩë',dig:'Âû´ÁêÉ',set:'ÊâòÁêÉ'};
                        skills.forEach(skill => {
                            const value = this.player.skills[skill];
                            const qualified = value >= sc.threshold;
                            const color = qualified ? '#059669' : '#6b7280';
                            html += `<span style="color: ${color};">${skillNames[skill]}${value}</span> `;
                        });
                        html += `</div>`;
                    }
                    
                    // ÊòæÁ§∫Â£∞ÊúõË¶ÅÊ±Ç
                    if (goalInfo.requirements.reputation) {
                        html += `<br><span style="font-size: 13px;">‚≠ê Â£∞ÊúõË¶ÅÊ±ÇÔºö</span><br>`;
                        const current = this.player.reputation;
                        const required = goalInfo.requirements.reputation;
                        const met = current >= required;
                        const statusClass = met ? 'goal-met' : 'goal-not-met';
                        const statusIcon = met ? '‚úì' : '‚óã';
                        html += `<span class="${statusClass}">${statusIcon} Â£∞Êúõ: ${current}/${required}</span><br>`;
                    }
                    
                    html += `<br><span style="font-size: 11px; color: #374151; font-weight: 600;">‚è∞ ${goalInfo.nextEvent}</span><br>`;
                    html += `<span style="font-size: 11px; color: #6b7280;">üí° ${goalInfo.tips}</span>`;
                    
                } else if (goalInfo.type === 'match') {
                    // ÊØîËµõÁ±ªÁõÆÊ†áÔºöÊòæÁ§∫ÊØîËµõ‰ø°ÊÅØÂíåÂáÜÂ§áÂª∫ËÆÆ
                    const weeksUntil = goalInfo.triggerWeek - this.player.week;
                    
                    if (weeksUntil > 0) {
                        html += `<span style="font-size: 12px; color: #6b7280;">üìÖ Á¨¨${goalInfo.triggerWeek}Âë®Ëá™Âä®ÂºÄÂßãÔºàËøòÊúâ${weeksUntil}Âë®Ôºâ</span><br><br>`;
                    } else if (weeksUntil === 0) {
                        html += `<span style="font-size: 12px; color: #f39c12;">ÔøΩ Êú¨Âë®Â∞ÜËøõË°åÊØîËµõÔºÅ</span><br><br>`;
                    } else {
                        html += `<span style="font-size: 12px; color: #059669;">üìÖ ÊØîËµõÂ∑≤ÂÆåÊàê</span><br><br>`;
                    }
                    
                    html += `<span style="font-size: 13px;">üéØ ÊØîËµõÁõÆÊ†áÔºö</span><br>`;
                    html += `<span style="font-size: 12px; color: #6b7280;">${goalInfo.description}</span><br><br>`;
                    
                    html += `<span style="font-size: 13px;">üí™ ÂáÜÂ§áÂª∫ËÆÆÔºö</span><br>`;
                    html += `<div style="font-size: 11px; color: #6b7280; line-height: 1.6;">`;
                    goalInfo.preparation.forEach(tip => {
                        html += `‚Ä¢ ${tip}<br>`;
                    });
                    html += `</div>`;
                    
                    // Â¶ÇÊûúÊòØÊ†°ÈôÖËÅîËµõÔºåÊòæÁ§∫ÂèØËÉΩÁöÑÁªìÂ±Ä
                    if (goalInfo.endings) {
                        html += `<br><span style="font-size: 13px;">üèÖ ÂèØËÉΩÁöÑÁªìÂ±ÄÔºö</span><br>`;
                        html += `<div style="font-size: 11px; color: #6b7280; line-height: 1.6;">`;
                        goalInfo.endings.forEach(ending => {
                            html += `${ending}<br>`;
                        });
                        html += `</div>`;
                    } else if (goalInfo.performanceLevels) {
                        // ÂÖ∂‰ªñÊØîËµõÊòæÁ§∫Ë°®Áé∞ËØÑÁ∫ß
                        html += `<br><span style="font-size: 13px;">üìä Ë°®Áé∞ËØÑÁ∫ßÔºö</span><br>`;
                        html += `<div style="font-size: 11px; color: #6b7280; line-height: 1.6;">`;
                        goalInfo.performanceLevels.forEach(level => {
                            html += `${level}<br>`;
                        });
                        html += `</div>`;
                    }
                }
                
                goalText.innerHTML = html;
            }
            
            toggleGoalsPanel() {
                const panel = document.getElementById('goals-panel');
                if (panel.classList.contains('show')) {
                    panel.classList.remove('show');
                } else {
                    this.renderGoalsPanel();
                    panel.classList.add('show');
                }
            }
            
            renderGoalsPanel() {
                const goalsList = document.getElementById('goals-list');
                const allGoalIds = this.getAllGoals();
                
                let html = '';
                
                allGoalIds.forEach(goalId => {
                    // ‰ΩøÁî®getGoalInfoËé∑ÂèñÊ≠£Á°ÆÁöÑÁõÆÊ†á‰ø°ÊÅØ
                    const tempGame = { currentGoal: goalId, player: this.player };
                    const goal = this.getGoalInfo.call(tempGame);
                    
                    const status = this.getGoalStatus(goalId);
                    
                    let badgeText = '';
                    let badgeClass = '';
                    if (status === 'current') {
                        badgeText = 'ËøõË°å‰∏≠';
                        badgeClass = 'current';
                    } else if (status === 'next') {
                        badgeText = '‰∏ã‰∏Ä‰∏™';
                        badgeClass = 'next';
                    } else if (status === 'completed') {
                        badgeText = 'Â∑≤ÂÆåÊàê';
                        badgeClass = 'completed';
                    } else {
                        badgeText = 'Êú™Ëß£ÈîÅ';
                        badgeClass = 'future';
                    }
                    
                    html += `<div class="goal-card ${status}">
                        <div class="goal-header">
                            <div class="goal-title">${goal.title}</div>
                            <div class="goal-badge ${badgeClass}">${badgeText}</div>
                        </div>`;
                    
                    // Ê†πÊçÆÁõÆÊ†áÁ±ªÂûãÊòæÁ§∫‰∏çÂêåÂÜÖÂÆπ
                    if (goal.type === 'tryout') {
                        // ÈÄâÊãîÁ±ªÁõÆÊ†áÔºöÊòæÁ§∫Êó∂Èó¥Á™óÂè£ÂíåË¶ÅÊ±Ç
                        html += `<div class="goal-description">${goal.timeWindow}ÂèØÈÄâÊãî</div>`;
                        
                        // ÊòæÁ§∫Ë¶ÅÊ±Ç
                        if (goal.requirements) {
                            html += `<div class="goal-requirements">
                                <h4>üìã Ë¶ÅÊ±ÇÔºö</h4>`;
                            
                            // ÊòæÁ§∫ÊäÄËÉΩÊï∞ÈáèË¶ÅÊ±Ç
                            if (goal.requirements.anyTwo) {
                                html += `<div class="requirement-item">
                                    <span>üéØ ‰ªªÊÑè2È°πÊäÄËÉΩ</span>
                                    <span>‚â• ${goal.requirements.anyTwo}</span>
                                </div>`;
                            } else if (goal.requirements.anyThree) {
                                html += `<div class="requirement-item">
                                    <span>üéØ ‰ªªÊÑè3È°πÊäÄËÉΩ</span>
                                    <span>‚â• ${goal.requirements.anyThree}</span>
                                </div>`;
                            }
                            
                            // ÊòæÁ§∫ÊäÄËÉΩÊÄªÂíåË¶ÅÊ±Ç
                            if (goal.requirements.totalSum) {
                                const currentSum = Object.values(this.player.skills).reduce((a, b) => a + b, 0);
                                const required = goal.requirements.totalSum;
                                const met = currentSum >= required;
                                const statusClass = met ? 'requirement-met' : 'requirement-not-met';
                                const statusIcon = met ? '‚úì' : '‚óã';
                                
                                html += `<div class="requirement-item ${statusClass}">
                                    <span>${statusIcon} ÊäÄËÉΩÊÄªÂíå</span>
                                    <span>${currentSum} / ${required}</span>
                                </div>`;
                            }
                            
                            // ÊòæÁ§∫Â£∞ÊúõË¶ÅÊ±Ç
                            if (goal.requirements.reputation) {
                                const current = this.player.reputation;
                                const required = goal.requirements.reputation;
                                const met = current >= required;
                                const statusClass = met ? 'requirement-met' : 'requirement-not-met';
                                const statusIcon = met ? '‚úì' : '‚óã';
                                
                                html += `<div class="requirement-item ${statusClass}">
                                    <span>${statusIcon} Â£∞Êúõ</span>
                                    <span>${current} / ${required}</span>
                                </div>`;
                            }
                            
                            html += `</div>`;
                        }
                        
                        html += `<div class="goal-tips">üí° ${goal.tips}</div>`;
                        
                    } else if (goal.type === 'match') {
                        // ÊØîËµõÁ±ªÁõÆÊ†áÔºöÊòæÁ§∫ÊØîËµõÊó∂Èó¥ÂíåÂáÜÂ§áÂª∫ËÆÆ
                        html += `<div class="goal-description">Á¨¨${goal.triggerWeek}Âë®Ëá™Âä®ÂºÄÂßã</div>`;
                        html += `<div class="goal-requirements">
                            <h4>üéØ ÊØîËµõÁõÆÊ†áÔºö</h4>
                            <p style="margin: 5px 0; color: #333; font-size: 14px;">${goal.description}</p>
                        </div>`;
                        
                        if (goal.preparation && goal.preparation.length > 0) {
                            html += `<div class="goal-requirements">
                                <h4>üí™ ÂáÜÂ§áÂª∫ËÆÆÔºö</h4>`;
                            goal.preparation.forEach(tip => {
                                html += `<p style="margin: 5px 0; color: #333; font-size: 13px;">‚Ä¢ ${tip}</p>`;
                            });
                            html += `</div>`;
                        }
                    }
                    
                    html += `</div>`;
                });
                
                goalsList.innerHTML = html;
            }
            
            renderLifeChoice() {
                const storyText = document.getElementById('story-text');
                const choicesDiv = document.getElementById('choices');
                
                storyText.innerHTML = `<h2>üåü ËØæ‰ΩôÁîüÊ¥ª</h2>
                    <p>ËÆ≠ÁªÉÁªìÊùü‰∫ÜÔºå‰Ω†ÊÉ≥ÂÅö‰∫õ‰ªÄ‰πàÊù•ÊîæÊùæ‰∏Ä‰∏ãÔºü</p>`;
                
                // ÂÆö‰πâÂàÜÁ±ª
                const categories = {
                    sports: {
                        title: 'üèê ËøêÂä®Â®±‰πê',
                        color: '#ff6b6b',
                        choices: [
                            {
                                icon: 'üèê',
                                title: 'ÊâìÈáéÁêÉ',
                                effects: '25ÂàÜÂà∂ÊØîËµõ ‰ΩìÂäõ-20',
                                next: 'casualMatch',
                                requirement: { energy: 20 },
                                effect: { matchType: 'casual', energy: -20, lifeActivity: 'casualMatch' }
                            }
                        ]
                    },
                    rest: {
                        title: 'üéÆ ‰ºëÈó≤Â®±‰πê',
                        color: '#4ecdc4',
                        choices: [
                            {
                                icon: 'üò¥',
                                title: 'Êó©ÁÇπ‰ºëÊÅØ',
                                effects: '‰ΩìÂäõ+25 ÂøÉÊÉÖ+10 ÂéãÂäõ-8',
                                next: 'checkRandomEvent',
                                effect: { energy: 25, mood: 10, stress: -8, eventType: 'life', lifeActivity: 'rest' }
                            },
                            {
                                icon: 'üíÜ',
                                title: 'È©¨ÊùÄÈ∏°ÔºàÊåâÊë©Ôºâ',
                                effects: '‰ΩìÂäõ+40 ÂøÉÊÉÖ+18 ÂéãÂäõ-15 üí∞120',
                                next: 'checkRandomEvent',
                                requirement: { money: 120 },
                                effect: { energy: 40, mood: 18, stress: -15, money: -120, eventType: 'life', lifeActivity: 'massage' }
                            },
                            {
                                icon: 'üéÆ',
                                title: 'ÊâìÊ∏∏Êàè',
                                effects: '‰ΩìÂäõ+8 ÂøÉÊÉÖ+12 ÂéãÂäõ-10',
                                next: 'checkRandomEvent',
                                effect: { energy: 8, mood: 12, stress: -10, eventType: 'life', lifeActivity: 'game' }
                            },
                            {
                                icon: 'üé´',
                                title: '‰π∞ÂàÆÂàÆ‰πê',
                                effects: this.playerStats.permanentBuffs.scratchCardDiscount ? 'üí∞27 ËØïËØïÊâãÊ∞îÔºÅ(VIP 9Êäò)' : 'üí∞30 ËØïËØïÊâãÊ∞îÔºÅ',
                                next: 'scratchCard',
                                requirement: { money: this.playerStats.permanentBuffs.scratchCardDiscount ? 27 : 30 },
                                effect: { special: 'scratchCard', lifeActivity: 'scratchCard' }
                            },
                            {
                                icon: 'üçø',
                                title: 'ÁúãÁîµÂΩ±',
                                effects: '‰ΩìÂäõ+12 ÂøÉÊÉÖ+20 ÂéãÂäõ-12 üí∞50',
                                next: 'checkRandomEvent',
                                requirement: { money: 50 },
                                effect: { energy: 12, mood: 20, stress: -12, money: -50, eventType: 'life', lifeActivity: 'movie' }
                            },
                            {
                                icon: 'üìö',
                                title: 'ÂéªÂõæ‰π¶È¶Ü',
                                effects: '‰ΩìÂäõ+5 ÂøÉÊÉÖ+8 ÂéãÂäõ-3 Â£∞Êúõ+3',
                                next: 'checkRandomEvent',
                                effect: { energy: 5, mood: 8, stress: -3, reputation: 3, eventType: 'life', lifeActivity: 'library' }
                            }
                        ]
                    },
                    social: {
                        title: 'üë• Á§æ‰∫§Ê¥ªÂä®',
                        color: '#95e1d3',
                        choices: [
                            {
                                icon: 'üë•',
                                title: 'ÂíåÈòüÂèãËÅäÂ§©',
                                effects: '‰ΩìÂäõ+10 ÂøÉÊÉÖ+15 ÂéãÂäõ-8 ÂÖ≥Á≥ª+5',
                                next: 'checkRandomEvent',
                                effect: { energy: 10, mood: 15, stress: -8, relationship: 5, eventType: 'life', lifeActivity: 'social' }
                            },
                            {
                                icon: 'ÔøΩ',
                                title: 'ÁªôÈòüÂèã‰π∞Á§ºÁâ©',
                                effects: 'ÂøÉÊÉÖ+10 ÂÖ≥Á≥ª+15 Â£∞Êúõ+5 üí∞80',
                                next: 'checkRandomEvent',
                                requirement: { money: 80 },
                                effect: { relationship: 15, reputation: 5, mood: 10, money: -80, eventType: 'life', lifeActivity: 'social' }
                            }
                        ]
                    },
                    food: {
                        title: 'üçî ÁæéÈ£ü‰∫´Âèó',
                        color: '#ffd93d',
                        choices: [
                            {
                                icon: 'üçú',
                                title: 'ÂêÉÂ§úÂÆµ',
                                effects: '‰ΩìÂäõ+8 ÂøÉÊÉÖ+15 ÂéãÂäõ-5 üí∞20',
                                next: 'checkRandomEvent',
                                requirement: { money: 20 },
                                effect: { energy: 8, mood: 15, stress: -5, money: -20, eventType: 'life', lifeActivity: 'food' }
                            },
                            {
                                icon: 'üçî',
                                title: 'ÂêÉÂ§ßÈ§ê',
                                effects: '‰ΩìÂäõ+15 ÂøÉÊÉÖ+25 ÂéãÂäõ-10 üí∞100',
                                next: 'checkRandomEvent',
                                requirement: { money: 100 },
                                effect: { energy: 15, mood: 25, stress: -10, money: -100, eventType: 'life', lifeActivity: 'food' }
                            }
                        ]
                    },
                    work: {
                        title: 'üíº ÂÖºËÅåËµöÈí±',
                        color: '#6c5ce7',
                        choices: [
                            {
                                icon: 'üì¶',
                                title: 'ËΩªÊùæÂÖºËÅå',
                                effects: 'üí∞+100 ‰ΩìÂäõ-10 ÂéãÂäõ+3',
                                next: 'checkRandomEvent',
                                requirement: { energy: 10 },
                                effect: { money: 120, energy: -10, stress: 3, mood: -1, eventType: 'life', lifeActivity: 'work' }
                            },
                            {
                                icon: 'üíº',
                                title: 'È´òÂº∫Â∫¶ÊâìÂ∑•',
                                effects: 'üí∞+250 ‰ΩìÂäõ-25 ÂéãÂäõ+12',
                                next: 'checkRandomEvent',
                                requirement: { energy: 25 },
                                effect: { money: 250, energy: -25, stress: 12, mood: -5, eventType: 'life', lifeActivity: 'work' }
                            }
                        ]
                    }
                };
                
                let html = '<div class="life-categories">';
                
                for (let catKey in categories) {
                    const category = categories[catKey];
                    html += `<div class="life-category ${catKey}">
                        <div class="category-title">${category.title}</div>
                        <div class="category-choices">`;
                    
                    category.choices.forEach(choice => {
                        const meetsRequirement = choice.requirement ? this.checkRequirement(choice.requirement) : true;
                        const disabledClass = meetsRequirement ? '' : 'disabled';
                        const disabledAttr = meetsRequirement ? '' : 'disabled';
                        
                        // Âä®ÊÄÅÁîüÊàêÊïàÊûúÊñáÊú¨
                        const effectText = this.getEffectPreview(choice.effect);
                        
                        html += `<button class="life-choice-card ${disabledClass}" ${disabledAttr} 
                            onclick="game.handleLifeChoice('${choice.next}', ${JSON.stringify(choice.effect || {}).replace(/"/g, '&quot;')})">
                            <div class="life-choice-icon">${choice.icon}</div>
                            <div class="life-choice-title">${choice.title}</div>
                            <div class="life-choice-effects">${effectText || choice.effects}</div>
                            ${!meetsRequirement ? '<div style="color: #ffeb3b; font-size: 10px; margin-top: 3px;">Êù°‰ª∂‰∏çË∂≥</div>' : ''}
                        </button>`;
                    });
                    
                    html += `</div></div>`;
                }
                
                html += '</div>';
                
                choicesDiv.innerHTML = html;
            }
            
            handleLifeChoice(nextScene, effect) {
                if (effect && Object.keys(effect).length > 0) {
                    // ÁâπÊÆäÂ§ÑÁêÜÔºöÂàÆÂàÆ‰πê
                    if (effect.special === 'scratchCard') {
                        // ËÆ°ÁÆóÂÆûÈôÖ‰ª∑Ê†ºÔºàËÄÉËôëVIPÊäòÊâ£Ôºâ
                        const price = this.playerStats.permanentBuffs.scratchCardDiscount ? 27 : 30;
                        
                        // Ê£ÄÊü•ÈáëÈí±ÊòØÂê¶Ë∂≥Â§ü
                        if (this.player.money < price) {
                            alert(`ÈáëÈí±‰∏çË∂≥ÔºÅÈúÄË¶Å${price}ÂÖÉË¥≠‰π∞ÂàÆÂàÆ‰πê„ÄÇ`);
                            return;
                        }
                        
                        // Á°Æ‰øùmodalÂ§Ñ‰∫éÂπ≤ÂáÄÁä∂ÊÄÅ
                        const modal = document.getElementById('event-modal');
                        if (modal) {
                            modal.style.display = '';
                            modal.classList.remove('show');
                        }
                        
                        // Êâ£Èô§ÈáëÈí±
                        this.player.money -= price;
                        this.updateUI();
                        
                        // ÊâßË°åÂàÆÂàÆ‰πêÊäΩÂ•ñÔºà‰º†ÂÖ•ÂèÇÊï∞Ë°®Á§∫ÈúÄË¶ÅÊ£ÄÊü•Â•áÈÅá‰∫ã‰ª∂Ôºâ
                        this.buyScratchCard(true);
                        
                        return;
                    }
                    
                    this.applyEffect(effect);
                    
                    // ËøΩË∏™ËØæ‰ΩôÊ¥ªÂä®ÔºàÁî®‰∫éÂ•áÈÅá‰∫ã‰ª∂Ôºâ
                    if (effect.lifeActivity) {
                        this.trackLifeActivity(effect.lifeActivity);
                    }
                    
                    // Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅËß¶ÂèëÈöèÊú∫‰∫ã‰ª∂
                    if (effect.eventType) {
                        const event = this.triggerRandomEvent(effect.eventType);
                        if (event) {
                            this.showRandomEvent(event);
                            return;
                        }
                    }
                    
                    // Ê£ÄÊü•ÊòØÂê¶Ëß¶ÂèëÂ•áÈÅá‰∫ã‰ª∂ÔºàÊéíÈô§ÂàÆÂàÆ‰πêÔºåÂõ†‰∏∫Â∑≤ÁªèÂú®‰∏äÈù¢Â§ÑÁêÜÔºâ
                    const adventureTriggered = this.checkAdventureEvents('general');
                    if (adventureTriggered) {
                        // Â¶ÇÊûúËß¶Âèë‰∫ÜÂ•áÈÅá‰∫ã‰ª∂Ôºå‰∏çÂÜçÊâßË°åÂêéÁª≠ÁöÑshowScene
                        return;
                    }
                }
                
                if (nextScene) {
                    this.currentScene = nextScene;
                    this.showScene(nextScene);
                }
            }
            
            // ÂïÜÂ∫óÁ≥ªÁªüÊñπÊ≥ï
            renderShopMain() {
                const storyText = document.getElementById('story-text');
                const choicesDiv = document.getElementById('choices');
                
                storyText.innerHTML = `<h2>üõí ÂïÜÂ∫ó</h2>
                    <p>üí∞ ÂΩìÂâçÈáëÈí±Ôºö<strong>${this.player.money}ÂÖÉ</strong></p>`;
                
                let html = '';
                
                // ÈÅçÂéÜÊâÄÊúâÂàÜÁ±ªÔºåÁõ¥Êé•ÊòæÁ§∫ÂïÜÂìÅ
                for (let catKey in this.shopItems) {
                    const category = this.shopItems[catKey];
                    
                    html += `<div class="shop-category-section">
                        <div class="shop-category-header">${category.icon} ${category.name}</div>
                        <div class="shop-items-compact">`;
                    
                    category.items.forEach(item => {
                        const canAfford = this.player.money >= item.price;
                        const owned = this.checkItemOwned(item);
                        
                        // Ê£ÄÊü•Ë¥≠‰π∞Ê¨°Êï∞ÈôêÂà∂
                        let reachedLimit = false;
                        let purchaseInfo = '';
                        if (item.maxPurchases) {
                            const currentCount = this.player.purchaseCount[item.id] || 0;
                            reachedLimit = currentCount >= item.maxPurchases;
                            purchaseInfo = `(${currentCount}/${item.maxPurchases})`;
                        }
                        
                        const disabledClass = (!canAfford || owned || reachedLimit) ? 'disabled' : '';
                        
                        html += `<div class="shop-item-compact ${disabledClass}" onclick="game.buyItem('${catKey}', '${item.id}')">
                            <div class="item-compact-name">${item.name}</div>
                            <div class="item-compact-desc">${item.description} ${purchaseInfo}</div>
                            <div class="item-compact-price">üí∞${item.price}</div>
                            ${owned ? '<div class="item-compact-badge owned">‚úì</div>' : ''}
                            ${reachedLimit ? '<div class="item-compact-badge locked">üö´</div>' : ''}
                            ${!canAfford && !owned && !reachedLimit ? '<div class="item-compact-badge locked">üîí</div>' : ''}
                        </div>`;
                    });
                    
                    html += `</div></div>`;
                }
                
                html += '<div class="choices"><button class="choice-btn" onclick="game.showScene(\'weeklyHub\')">üîô ËøîÂõû</button></div>';
                
                choicesDiv.innerHTML = html;
            }
            
            renderShopCategory(categoryKey) {
                const storyText = document.getElementById('story-text');
                const choicesDiv = document.getElementById('choices');
                const category = this.shopItems[categoryKey];
                
                console.log('=== renderShopCategory Debug ===');
                console.log('categoryKey:', categoryKey);
                console.log('purchaseCount:', this.player.purchaseCount);
                
                if (!category) {
                    alert('ÂïÜÂìÅÂàÜÁ±ª‰∏çÂ≠òÂú®');
                    this.showScene('shopMain');
                    return;
                }
                
                storyText.innerHTML = `<h2>${category.icon} ${category.name}</h2>
                    <p>üí∞ ÂΩìÂâçÈáëÈí±Ôºö<strong>${this.player.money}ÂÖÉ</strong></p>`;
                
                let html = '<div class="shop-items-grid">';
                
                category.items.forEach(item => {
                    const canAfford = this.player.money >= item.price;
                    const owned = this.checkItemOwned(item);
                    
                    // Ê£ÄÊü•Ë¥≠‰π∞Ê¨°Êï∞ÈôêÂà∂
                    let reachedLimit = false;
                    let purchaseInfo = '';
                    if (item.maxPurchases) {
                        const currentCount = this.player.purchaseCount[item.id] || 0;
                        reachedLimit = currentCount >= item.maxPurchases;
                        purchaseInfo = `<div class="item-purchase-count" style="font-size: 12px; color: ${reachedLimit ? '#e74c3c' : '#3b82f6'}; margin: 8px 0;">Â∑≤Ë¥≠‰π∞Ôºö${currentCount}/${item.maxPurchases}</div>`;
                        console.log(`Item ${item.id}: currentCount=${currentCount}, maxPurchases=${item.maxPurchases}, reachedLimit=${reachedLimit}`);
                    }
                    
                    const disabledClass = (!canAfford || owned || reachedLimit) ? 'disabled' : '';
                    
                    html += `<div class="shop-item-card ${disabledClass}">
                        <div class="item-name">${item.name}</div>
                        <div class="item-description">${item.description}</div>
                        ${purchaseInfo}
                        <div class="item-price">üí∞ ${item.price}ÂÖÉ</div>
                        ${owned ? '<div class="item-owned">‚úì Â∑≤Êã•Êúâ</div>' : ''}
                        ${reachedLimit ? '<div class="item-locked">üö´ Â∑≤ËææË¥≠‰π∞‰∏äÈôê</div>' : ''}
                        ${!canAfford && !owned && !reachedLimit ? '<div class="item-locked">üí∞ ÈáëÈí±‰∏çË∂≥</div>' : ''}
                        <button onclick="game.buyItem('${categoryKey}', '${item.id}')" ${!canAfford || owned || reachedLimit ? 'disabled' : ''}>
                            Ë¥≠‰π∞
                        </button>
                    </div>`;
                });
                
                html += '</div>';
                html += '<div class="choices">';
                html += '<button class="choice-btn" onclick="game.showScene(\'shopMain\')">üîô ËøîÂõûÂïÜÂ∫ó</button>';
                html += '<button class="choice-btn" onclick="game.showScene(\'weeklyHub\')">üè† ËøîÂõûÂë®ÈÄâÊã©</button>';
                html += '</div>';
                
                choicesDiv.innerHTML = html;
            }
            
            checkItemOwned(item) {
                if (item.type !== 'permanent') return false;
                
                // Ê£ÄÊü•ÂêÑÁ±ªÊ∞∏‰πÖÁâ©ÂìÅÊòØÂê¶Â∑≤Êã•Êúâ
                if (item.id === 'pro_shoes') return this.player.ownedItems.shoes === 'pro';
                if (item.id === 'protection') return this.player.ownedItems.protection;
                if (item.id === 'jersey') return this.player.ownedItems.jersey;
                if (item.id === 'training_ball') return this.player.ownedItems.trainingEquipment.includes('ball');
                if (item.id === 'sports_watch') return this.player.ownedItems.electronics.includes('watch');
                if (item.id === 'new_phone') return this.player.ownedItems.electronics.includes('phone');
                if (item.id === 'health_supplement') return this.player.ownedItems.electronics.includes('supplement');
                
                return false;
            }
            
            buyItem(categoryKey, itemId) {
                const category = this.shopItems[categoryKey];
                const item = category.items.find(i => i.id === itemId);
                
                console.log('=== buyItem Debug ===');
                console.log('categoryKey:', categoryKey);
                console.log('itemId:', itemId);
                console.log('item:', item);
                console.log('Before purchase - purchaseCount:', this.player.purchaseCount);
                
                if (!item) {
                    alert('ÂïÜÂìÅ‰∏çÂ≠òÂú®');
                    return;
                }
                
                if (this.player.money < item.price) {
                    alert('ÈáëÈí±‰∏çË∂≥ÔºÅ');
                    return;
                }
                
                if (this.checkItemOwned(item)) {
                    alert('‰Ω†Â∑≤ÁªèÊã•ÊúâËøô‰∏™Áâ©ÂìÅ‰∫ÜÔºÅ');
                    return;
                }
                
                // Ê£ÄÊü•Ë¥≠‰π∞Ê¨°Êï∞ÈôêÂà∂
                if (item.maxPurchases) {
                    const currentCount = this.player.purchaseCount[item.id] || 0;
                    console.log(`Purchase limit check: currentCount=${currentCount}, maxPurchases=${item.maxPurchases}`);
                    if (currentCount >= item.maxPurchases) {
                        alert(`${item.name}Â∑≤ËææÂà∞Ë¥≠‰π∞‰∏äÈôêÔºà${item.maxPurchases}Ê¨°ÔºâÔºÅ`);
                        return;
                    }
                }
                
                // Êâ£Èô§ÈáëÈí±
                this.player.money -= item.price;
                
                // Êõ¥Êñ∞Ë¥≠‰π∞Ê¨°Êï∞
                if (item.maxPurchases) {
                    if (!this.player.purchaseCount) this.player.purchaseCount = {};
                    this.player.purchaseCount[item.id] = (this.player.purchaseCount[item.id] || 0) + 1;
                    console.log(`After purchase - purchaseCount[${item.id}]:`, this.player.purchaseCount[item.id]);
                }
                
                // ÁªüËÆ°Ê∂àË¥π
                this.playerStats.totalMoneySpent += item.price;
                
                // Ê†πÊçÆÁ±ªÂà´ÁªüËÆ°
                if (categoryKey === 'training') {
                    this.playerStats.coachingPurchased++;
                } else if (categoryKey === 'equipment') {
                    this.playerStats.equipmentPurchased++;
                } else if (categoryKey === 'daily') {
                    this.playerStats.entertainmentSpent += item.price;
                }
                
                // Â§ÑÁêÜÁâπÊÆäÊïàÊûú
                let resultMessage = `Ë¥≠‰π∞ÊàêÂäüÔºÅ\n\n${item.name}\n\n`;
                
                // Êä§ËÜùÊä§ËÖïÁâπÊÆäÊèêÁ§∫
                if (item.id === 'protection') {
                    resultMessage = `Ë¥≠‰π∞ÊàêÂäüÔºÅ\n\n‰Ω†Ë£ÖÂ§á‰∏ä‰∫Ü‰∏ì‰∏öÁöÑÊä§ËÜùÊä§ËÖïÂ•óË£Ö„ÄÇ\nÊüîËΩØÁöÑÊä§Âû´Á¥ßË¥¥ÂÖ≥ËäÇÔºåÊèê‰æõ‰∫ÜÂèØÈù†ÁöÑ‰øùÊä§„ÄÇ\nÁé∞Âú®‰Ω†ÂèØ‰ª•Êõ¥ÊîæÂøÉÂú∞ËøõË°åÈ´òÂº∫Â∫¶ËÆ≠ÁªÉ‰∫ÜÔºÅ\n\n‚úì Âèó‰º§Ê¶ÇÁéáÈôç‰Ωé70%`;
                }
                
                // Â§ÑÁêÜÈöèÊú∫ÊäÄËÉΩ‰π¶
                else if (item.effect && item.effect.randomSkill) {
                    const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                    const randomSkill = skills[Math.floor(Math.random() * skills.length)];
                    this.player.skills[randomSkill] = Math.min(100, this.player.skills[randomSkill] + item.effect.randomSkill);
                    resultMessage += `‰Ω†ÁöÑ${this.getSkillName(randomSkill)}ÊèêÂçá‰∫Ü${item.effect.randomSkill}ÁÇπÔºÅ`;
                } else {
                    // Â∫îÁî®ÊôÆÈÄöÊïàÊûú
                    if (item.effect) {
                        // Â§ÑÁêÜÂç≥Êó∂ÊïàÊûú
                        if (item.effect.serve) this.player.skills.serve = Math.min(100, this.player.skills.serve + item.effect.serve);
                        if (item.effect.spike) this.player.skills.spike = Math.min(100, this.player.skills.spike + item.effect.spike);
                        if (item.effect.block) this.player.skills.block = Math.min(100, this.player.skills.block + item.effect.block);
                        if (item.effect.dig) this.player.skills.dig = Math.min(100, this.player.skills.dig + item.effect.dig);
                        if (item.effect.set) this.player.skills.set = Math.min(100, this.player.skills.set + item.effect.set);
                        if (item.effect.energy) this.player.energy = Math.max(0, Math.min(this.player.maxEnergy, this.player.energy + item.effect.energy));
                        if (item.effect.mood) this.player.mood = Math.max(0, Math.min(100, this.player.mood + item.effect.mood));
                        if (item.effect.stress) this.player.stress = Math.max(0, Math.min(100, this.player.stress + item.effect.stress));
                        if (item.effect.reputation) this.player.reputation += item.effect.reputation;
                        if (item.effect.relationship) this.player.relationships.teammates = Math.min(100, this.player.relationships.teammates + item.effect.relationship);
                    }
                    resultMessage += item.description;
                }
                
                // Â§ÑÁêÜÊ∞∏‰πÖÁâ©ÂìÅ
                if (item.type === 'permanent') {
                    if (!this.player.ownedItems) {
                        this.player.ownedItems = { shoes: 'none', protection: null, jersey: false, trainingEquipment: [], electronics: [] };
                    }
                    
                    if (item.id === 'pro_shoes') this.player.ownedItems.shoes = 'pro';
                    if (item.id === 'protection') this.player.ownedItems.protection = item.effect;
                    if (item.id === 'jersey') this.player.ownedItems.jersey = true;
                    if (item.id === 'training_ball') {
                        if (!this.player.ownedItems.trainingEquipment) this.player.ownedItems.trainingEquipment = [];
                        this.player.ownedItems.trainingEquipment.push('ball');
                    }
                    if (item.id === 'sports_watch') {
                        if (!this.player.ownedItems.electronics) this.player.ownedItems.electronics = [];
                        this.player.ownedItems.electronics.push('watch');
                    }
                    if (item.id === 'new_phone') {
                        if (!this.player.ownedItems.electronics) this.player.ownedItems.electronics = [];
                        this.player.ownedItems.electronics.push('phone');
                    }
                    if (item.id === 'health_supplement') {
                        if (!this.player.ownedItems.electronics) this.player.ownedItems.electronics = [];
                        this.player.ownedItems.electronics.push('supplement');
                    }
                }
                
                // Â§ÑÁêÜbuffÁ±ªÁâ©ÂìÅ
                if (item.type === 'buff') {
                    if (!this.player.activeBuffs) this.player.activeBuffs = [];
                    this.player.activeBuffs.push({
                        id: item.id,
                        name: item.name,
                        effect: item.effect,
                        remainingWeeks: item.duration || 1
                    });
                    
                    // Ëê•ÂÖªÈ§êËÆ°ÂàíÔºöÁ´ãÂç≥Â¢ûÂä†‰ΩìÂäõ‰∏äÈôê
                    if (item.id === 'nutrition_plan' && item.effect.maxEnergyBonus) {
                        this.player.maxEnergy += item.effect.maxEnergyBonus;
                    }
                }
                
                alert(resultMessage);
                this.updateUI();
                // Âà∑Êñ∞ÂïÜÂ∫ó‰∏ªÁïåÈù¢ÔºåÊòæÁ§∫Êõ¥Êñ∞ÂêéÁöÑË¥≠‰π∞Ê¨°Êï∞
                this.showScene('shopMain');
            }
            
            getSkillName(skill) {
                const names = { serve: 'ÂèëÁêÉ', spike: 'Êâ£ÁêÉ', block: 'Êã¶ÁΩë', dig: 'Âû´ÁêÉ', set: 'ÊâòÁêÉ' };
                return names[skill] || skill;
            }
            
            // ====================================================
            // Â•áÈÅá‰∫ã‰ª∂Á≥ªÁªüÊñπÊ≥ï
            // ====================================================
            
            // ËøΩË∏™ËØæ‰ΩôÊ¥ªÂä®
            trackLifeActivity(activityType) {
                if (!this.playerStats.lifeActivities) {
                    this.playerStats.lifeActivities = {};
                }
                
                // Êõ¥Êñ∞Ê¥ªÂä®ËÆ°Êï∞
                this.playerStats.lifeActivities[activityType] = 
                    (this.playerStats.lifeActivities[activityType] || 0) + 1;
                
                // Êõ¥Êñ∞ÊóßÁöÑÁªüËÆ°Ôºà‰øùÊåÅÂÖºÂÆπÊÄßÔºâ
                if (activityType === 'game') this.playerStats.gamesPlayed++;
                if (activityType === 'movie') this.playerStats.moviesWatched++;
                if (activityType === 'social') this.playerStats.socialEvents++;
                if (activityType === 'rest') this.playerStats.restTaken++;
            }
            
            // Ê£ÄÊü•ÊòØÂê¶Ëß¶ÂèëÂ•áÈÅá‰∫ã‰ª∂
            checkAdventureEvents(type = 'general') {
                const eligibleEvents = this.adventureEvents.filter(event => {
                    // Ê£ÄÊü•ÊòØÂê¶Â∑≤Ëß¶ÂèëËøáÔºà‰∏ÄÊ¨°ÊÄß‰∫ã‰ª∂Ôºâ
                    if (event.once && this.playerStats.triggeredEvents.includes(event.id)) {
                        return false;
                    }
                    
                    // Â¶ÇÊûúÊòØ‰∏ÄËà¨Ê£ÄÊü•ÔºåÊéíÈô§ÂàÆÂàÆ‰πêÁõ∏ÂÖ≥‰∫ã‰ª∂
                    if (type === 'general' && ['lucky_customer', 'mysterious_elder'].includes(event.id)) {
                        return false;
                    }
                    
                    // Ê£ÄÊü•Ëß¶ÂèëÊù°‰ª∂
                    if (!this.checkEventCondition(event.condition)) {
                        return false;
                    }
                    
                    // Ê£ÄÊü•Ê¶ÇÁéá
                    if (Math.random() > event.probability) {
                        return false;
                    }
                    
                    return true;
                });
                
                // Â¶ÇÊûúÊúâÁ¨¶ÂêàÊù°‰ª∂ÁöÑ‰∫ã‰ª∂ÔºåÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™Ëß¶Âèë
                if (eligibleEvents.length > 0) {
                    const event = eligibleEvents[Math.floor(Math.random() * eligibleEvents.length)];
                    this.triggerAdventureEvent(event);
                    return true;  // ËøîÂõûtrueË°®Á§∫Ëß¶Âèë‰∫Ü‰∫ã‰ª∂
                }
                
                return false;  // ËøîÂõûfalseË°®Á§∫Ê≤°ÊúâËß¶Âèë‰∫ã‰ª∂
            }
            
            // Ê£ÄÊü•ÁâπÂÆöÁ±ªÂûãÁöÑÂ•áÈÅá‰∫ã‰ª∂ÔºàÁî®‰∫éÂàÆÂàÆ‰πêÁ≠âÁâπÊÆäÂú∫ÊôØÔºâ
            checkSpecificAdventureEvent(activityType) {
                let eventIds = [];
                
                // Ê†πÊçÆÊ¥ªÂä®Á±ªÂûãÁ°ÆÂÆöË¶ÅÊ£ÄÊü•ÁöÑ‰∫ã‰ª∂
                if (activityType === 'scratchCard') {
                    eventIds = ['lucky_customer', 'mysterious_elder'];
                }
                
                const eligibleEvents = this.adventureEvents.filter(event => {
                    // Âè™Ê£ÄÊü•ÊåáÂÆöÁöÑ‰∫ã‰ª∂
                    if (!eventIds.includes(event.id)) {
                        return false;
                    }
                    
                    // Ê£ÄÊü•ÊòØÂê¶Â∑≤Ëß¶ÂèëËøáÔºà‰∏ÄÊ¨°ÊÄß‰∫ã‰ª∂Ôºâ
                    if (event.once && this.playerStats.triggeredEvents.includes(event.id)) {
                        return false;
                    }
                    
                    // Ê£ÄÊü•Ëß¶ÂèëÊù°‰ª∂
                    if (!this.checkEventCondition(event.condition)) {
                        return false;
                    }
                    
                    // Ê£ÄÊü•Ê¶ÇÁéá
                    if (Math.random() > event.probability) {
                        return false;
                    }
                    
                    return true;
                });
                
                // Â¶ÇÊûúÊúâÁ¨¶ÂêàÊù°‰ª∂ÁöÑ‰∫ã‰ª∂ÔºåÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™Ëß¶Âèë
                if (eligibleEvents.length > 0) {
                    const event = eligibleEvents[Math.floor(Math.random() * eligibleEvents.length)];
                    this.triggerAdventureEvent(event);
                    return true;
                }
                
                return false;
            }
            
            // Ê£ÄÊü•‰∫ã‰ª∂Ëß¶ÂèëÊù°‰ª∂
            checkEventCondition(condition) {
                // Ê£ÄÊü•Ê¥ªÂä®Ê¨°Êï∞
                if (condition.activities) {
                    for (let activity in condition.activities) {
                        const required = condition.activities[activity];
                        const current = this.playerStats.lifeActivities[activity] || 0;
                        if (current < required) {
                            return false;
                        }
                    }
                }
                
                // Ê£ÄÊü•Â±ûÊÄß
                if (condition.mood && this.player.mood < condition.mood) return false;
                if (condition.reputation && this.player.reputation < condition.reputation) return false;
                if (condition.relationship && this.player.relationships.teammates < condition.relationship) return false;
                if (condition.maxEnergy && this.player.maxEnergy < condition.maxEnergy) return false;
                
                // Ê£ÄÊü•ÊäÄËÉΩÊÄªÂíå
                if (condition.totalSkills) {
                    const total = Object.values(this.player.skills).reduce((a, b) => a + b, 0);
                    if (total < condition.totalSkills) return false;
                }
                
                // Ê£ÄÊü•ÂàÆÂàÆ‰πê‰∏≠Â•ñÊ¨°Êï∞
                if (condition.scratchCardJackpots && 
                    this.playerStats.scratchCardJackpots < condition.scratchCardJackpots) {
                    return false;
                }
                
                // Ê£ÄÊü•ÊÅãÁà±Áä∂ÊÄÅ
                if (condition.hasLoveInterest && !this.playerStats.hasLoveInterest) {
                    return false;
                }
                
                // Ê£ÄÊü•Â§öÊ†∑ÂåñÊ¥ªÂä®ÔºàËá≥Â∞ëNÁßçÊ¥ªÂä®ÂêÑÂÅöËøá3Ê¨°Ôºâ
                if (condition.diverseActivities) {
                    const diverseCount = Object.values(this.playerStats.lifeActivities)
                        .filter(count => count >= 3).length;
                    if (diverseCount < condition.diverseActivities) {
                        return false;
                    }
                }
                
                // Ê£ÄÊü•ÊúÄÂ§ß‰ºëÊÅØÊ¨°Êï∞ÔºàÁî®‰∫éÁñ≤ÊÉ´Êúü‰∫ã‰ª∂Ôºâ
                if (condition.maxRest) {
                    const restCount = this.playerStats.lifeActivities.rest || 0;
                    if (restCount > condition.maxRest) {
                        return false;
                    }
                }
                
                // Ê£ÄÊü•Êú¨Âë®ËÆ≠ÁªÉÊ¨°Êï∞
                if (condition.weeklyTraining && this.player.trainingCount < condition.weeklyTraining) {
                    return false;
                }
                
                // Ê£ÄÊü•Êú¨Âë®Á∫¶‰ºöÊ¨°Êï∞
                if (condition.weeklyDate !== undefined && 
                    this.playerStats.weeklyDateCount !== condition.weeklyDate) {
                    return false;
                }
                
                // Ê£ÄÊü•Âπ≥Âùá‰ΩìÂäõ
                if (condition.avgEnergy) {
                    // ÁÆÄÂåñÔºöÁõ¥Êé•Áî®ÂΩìÂâç‰ΩìÂäõ‰Ωú‰∏∫Âπ≥ÂùáÂÄº
                    if (this.player.energy < condition.avgEnergy) {
                        return false;
                    }
                }
                
                return true;
            }
            
            // Ëß¶ÂèëÂ•áÈÅá‰∫ã‰ª∂
            triggerAdventureEvent(event) {
                // Ê†áËÆ∞‰∏∫Â∑≤Ëß¶ÂèëÔºà‰∏ÄÊ¨°ÊÄß‰∫ã‰ª∂Ôºâ
                if (event.once) {
                    this.playerStats.triggeredEvents.push(event.id);
                }
                
                // ÊòæÁ§∫‰∫ã‰ª∂ÂÜÖÂÆπ
                this.showAdventureEvent(event);
            }
            
            // ÊòæÁ§∫Â•áÈÅá‰∫ã‰ª∂
            showAdventureEvent(event) {
                const modal = document.getElementById('event-modal');
                const title = document.getElementById('event-modal-title');
                const text = document.getElementById('event-modal-text');
                const choicesDiv = document.getElementById('event-modal-choices');
                
                if (!modal || !title || !text || !choicesDiv) {
                    console.error('Event modal elements not found');
                    return;
                }
                
                const content = event.content;
                
                // ËÆæÁΩÆÊ†áÈ¢òÂíåÊñáÊú¨
                title.innerHTML = content.title;
                text.innerHTML = `<p style="white-space: pre-line; line-height: 1.6;">${content.text}</p>`;
                
                // Ê∏ÖÁ©∫Âπ∂ÈáçÂª∫ÈÄâÊã©ÊåâÈíÆ
                choicesDiv.innerHTML = '';
                
                content.choices.forEach((choice, index) => {
                    const meetsRequirement = choice.requirement ? 
                        this.checkRequirement(choice.requirement) : true;
                    
                    const button = document.createElement('button');
                    button.className = meetsRequirement ? 'choice-btn' : 'choice-btn disabled';
                    button.disabled = !meetsRequirement;
                    
                    let buttonText = choice.text;
                    if (!meetsRequirement) {
                        buttonText += '\n(Êù°‰ª∂‰∏çË∂≥)';
                    }
                    button.textContent = buttonText;
                    
                    button.onclick = () => {
                        this.handleAdventureChoice(index, event.id);
                    };
                    
                    choicesDiv.appendChild(button);
                });
                
                // ÊòæÁ§∫modal
                modal.style.display = '';
                modal.classList.add('show');
            }
            
            // Â§ÑÁêÜÂ•áÈÅá‰∫ã‰ª∂ÈÄâÊã©
            handleAdventureChoice(choiceIndex, eventId) {
                const event = this.adventureEvents.find(e => e.id === eventId);
                if (!event) return;
                
                const choice = event.content.choices[choiceIndex];
                const effect = choice.effect;
                
                // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
                const modal = document.getElementById('event-modal');
                if (modal) {
                    modal.style.display = 'none';
                    modal.classList.remove('show');
                }
                
                // Â∫îÁî®ÊïàÊûú
                this.applyAdventureEffect(effect);
                
                // Êõ¥Êñ∞UI
                this.updateUI();
                
                // ÁªßÁª≠Ê∏∏ÊàèÊµÅÁ®ã
                if (this.currentScene === 'lifeChoice') {
                    this.showScene('weeklyHub');
                }
            }
            
            // Â∫îÁî®Â•áÈÅá‰∫ã‰ª∂ÊïàÊûú
            applyAdventureEffect(effect) {
                // Âü∫Á°ÄÂ±ûÊÄßÂèòÂåñ
                if (effect.money) this.player.money += effect.money;
                if (effect.mood) this.player.mood += effect.mood;
                if (effect.stress) this.player.stress += effect.stress;
                if (effect.energy) this.player.energy += effect.energy;
                if (effect.reputation) this.player.reputation += effect.reputation;
                if (effect.relationship) this.player.relationships.teammates += effect.relationship;
                if (effect.maxEnergy) this.player.maxEnergy += effect.maxEnergy;
                
                // ÊäÄËÉΩÂèòÂåñ
                const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                skills.forEach(skill => {
                    if (effect[skill]) {
                        this.player.skills[skill] += effect[skill];
                    }
                });
                
                // ÈöèÊú∫ÊäÄËÉΩÊèêÂçá
                if (effect.randomSkill) {
                    const randomSkill = skills[Math.floor(Math.random() * skills.length)];
                    this.player.skills[randomSkill] += effect.randomSkill;
                }
                
                // Ê∞∏‰πÖbuff
                if (effect.buff) {
                    this.applyPermanentBuff(effect.buff);
                }
                
                // Áß∞Âè∑
                if (effect.title) {
                    if (!this.playerStats.titles.includes(effect.title)) {
                        this.playerStats.titles.push(effect.title);
                    }
                }
                
                // ÁâπÊÆäÊïàÊûú
                if (effect.special) {
                    this.handleSpecialAdventureEffect(effect.special);
                }
            }
            
            // Â∫îÁî®Ê∞∏‰πÖbuff
            applyPermanentBuff(buffType) {
                switch (buffType) {
                    case 'scratchCardDiscount':
                        this.playerStats.permanentBuffs.scratchCardDiscount = true;
                        break;
                    case 'movieMembership':
                        this.playerStats.permanentBuffs.movieMembership = true;
                        break;
                    case 'foodDiscount':
                        this.playerStats.permanentBuffs.foodDiscount = true;
                        break;
                    case 'workBonus':
                        this.playerStats.permanentBuffs.workBonus = true;
                        break;
                    case 'teamBonus':
                        this.playerStats.permanentBuffs.trainingBonus += 5;
                        break;
                    case 'captainBonus':
                        this.playerStats.permanentBuffs.trainingBonus += 10;
                        break;
                    case 'stressReduction':
                        this.playerStats.permanentBuffs.stressReduction += 10;
                        break;
                    case 'selfTherapy':
                        this.playerStats.permanentBuffs.energyRecovery += 5;
                        this.playerStats.permanentBuffs.injuryReduction += 20;
                        break;
                    case 'perfectRoutine':
                        this.playerStats.permanentBuffs.energyRecovery += 10;
                        this.playerStats.permanentBuffs.trainingBonus += 5;
                        break;
                    case 'nutritionPlan':
                        this.playerStats.permanentBuffs.energyRecovery += 5;
                        break;
                    case 'campusStar':
                        this.playerStats.permanentBuffs.reputationGrowth += 3;
                        break;
                    case 'mentor':
                        this.playerStats.permanentBuffs.moodRecovery += 5;
                        break;
                    case 'focusBonus':
                        this.playerStats.permanentBuffs.trainingBonus += 10;
                        break;
                    case 'dedicationBonus':
                        this.playerStats.permanentBuffs.trainingBonus += 15;
                        break;
                }
            }
            
            // Â§ÑÁêÜÁâπÊÆäÂ•áÈÅáÊïàÊûú
            handleSpecialAdventureEffect(specialType) {
                switch (specialType) {
                    case 'freeScratchCard':
                        // ÂÖçË¥πÂàÆÂàÆ‰πêÔºåÊèêÈ´ò‰∏≠Â•ñÊ¶ÇÁéá
                        const result = this.scratchCardDraw(true);
                        // Âª∂ËøüÊòæÁ§∫ÁªìÊûúÔºåÁ°Æ‰øùmodalÂ∑≤ÁªèÂÖ≥Èó≠
                        setTimeout(() => {
                            this.showScratchCardResult(result);
                        }, 300);
                        break;
                    case 'startLove':
                        this.playerStats.hasLoveInterest = true;
                        break;
                    case 'mysteryGift':
                        // ÈöèÊú∫Ëé∑ÂæóË£ÖÂ§áÊàñÈáëÈí±
                        if (Math.random() < 0.5) {
                            this.player.money += 200;
                        } else {
                            // ÈöèÊú∫ÊäÄËÉΩ+3
                            const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                            const randomSkill = skills[Math.floor(Math.random() * skills.length)];
                            this.player.skills[randomSkill] += 3;
                        }
                        break;
                    case 'gameFriend':
                        // Ëß£ÈîÅÊ∏∏ÊàèÂ•ΩÂèãÔºåÊØèÊ¨°ÊâìÊ∏∏ÊàèÈ¢ùÂ§ñÂøÉÊÉÖ+5
                        this.playerStats.permanentBuffs.gameFriend = true;
                        break;
                    case 'esportsTournament':
                        // ÂèÇÂä†ÁîµÁ´ûÊØîËµõ
                        this.player.energy -= 15;
                        const totalSkills = Object.values(this.player.skills).reduce((a, b) => a + b, 0);
                        const rand = Math.random();
                        if (rand < 0.3) {
                            // ÂÜ†ÂÜõ
                            this.player.money += 1000;
                            this.player.reputation += 15;
                            alert('üèÜ ÊÅ≠ÂñúÔºÅ‰Ω†Ëé∑Âæó‰∫ÜÁîµÁ´ûÊØîËµõÂÜ†ÂÜõÔºÅ\nüí∞ ÈáëÈí±+1000\n‚≠ê Â£∞Êúõ+15');
                        } else if (rand < 0.7) {
                            // ‰∫öÂÜõ
                            this.player.money += 500;
                            this.player.reputation += 8;
                            alert('ü•à ‰Ω†Ëé∑Âæó‰∫ÜÁîµÁ´ûÊØîËµõ‰∫öÂÜõÔºÅ\nüí∞ ÈáëÈí±+500\n‚≠ê Â£∞Êúõ+8');
                        } else {
                            // Â≠£ÂÜõ
                            this.player.money += 200;
                            this.player.reputation += 3;
                            alert('ü•â ‰Ω†Ëé∑Âæó‰∫ÜÁîµÁ´ûÊØîËµõÂ≠£ÂÜõÔºÅ\nüí∞ ÈáëÈí±+200\n‚≠ê Â£∞Êúõ+3');
                        }
                        break;
                    case 'seniorNotes':
                        // Ëé∑ÂæóÂ≠¶ÂßêÁ¨îËÆ∞ÔºåÂèØÈáçÂ§ç‰ΩøÁî®3Ê¨°
                        this.playerStats.seniorNotesUses = 3;
                        break;
                    case 'sportsStoreJob':
                        // Ëß£ÈîÅ‰ΩìËÇ≤Â∫óÂÖºËÅå
                        this.playerStats.permanentBuffs.sportsStoreJob = true;
                        break;
                    case 'luckyWeek':
                        // Êú¨Âë®ËÆ≠ÁªÉÊïàÊûú+20%
                        this.playerStats.luckyWeekBonus = 0.2;
                        break;
                    case 'restBuff':
                        // Ëé∑Âæó‰ºëÊÅØbuff
                        this.playerStats.restBuffWeeks = 2;
                        break;
                    case 'burnoutPenalty':
                        // ‰∏ãÂë®‰ΩìÂäõ‰∏äÈôê-10
                        this.playerStats.burnoutPenalty = true;
                        break;
                    case 'planDate':
                        // ËÆ°ÂàíÁ∫¶‰ºö
                        this.playerStats.plannedDate = true;
                        break;
                    case 'breakup':
                        // ÂàÜÊâã
                        this.playerStats.hasLoveInterest = false;
                        break;
                }
            }
            
            // ËÅå‰∏öÁ≥ªÁªüÊñπÊ≥ï
            renderPositionSelection() {
                const storyText = document.getElementById('story-text');
                const choicesDiv = document.getElementById('choices');
                
                storyText.innerHTML = `<h2>üèê ÈÄâÊã©‰Ω†ÁöÑÂú∫‰∏ä‰ΩçÁΩÆ</h2>
                    <p>ÊïôÁªÉÔºö"‰Ω†Â∑≤ÁªèÊéåÊè°‰∫ÜÂü∫Êú¨ÊäÄËÉΩÔºåÁé∞Âú®ÈúÄË¶ÅÈÄâÊã©‰∏Ä‰∏™‰∏ìÁ≤æÁöÑ‰ΩçÁΩÆ„ÄÇ"</p>
                    <p>"ÊØè‰∏™‰ΩçÁΩÆÈÉΩÊúâ‰∏çÂêåÁöÑËÅåË¥£ÂíåË¶ÅÊ±ÇÔºåÈÄâÊã©ÈÄÇÂêà‰Ω†ÁöÑ‰ΩçÁΩÆÂêßÔºÅ"</p>`;
                
                // ËÆ°ÁÆóÊâÄÊúâËÅå‰∏öÁöÑÂåπÈÖçÂ∫¶Âπ∂ÊéíÂ∫è
                const positionsWithMatch = Object.keys(this.positions).map(posKey => {
                    const pos = this.positions[posKey];
                    const matchScore = this.calculatePositionMatch(pos);
                    const meetsRequirement = this.checkPositionRequirement(pos);
                    return { key: posKey, pos, matchScore, meetsRequirement };
                }).sort((a, b) => b.matchScore - a.matchScore);
                
                let html = '<div class="position-cards">';
                
                for (let item of positionsWithMatch) {
                    const { key: posKey, pos, matchScore, meetsRequirement } = item;
                    const disabledClass = meetsRequirement ? '' : 'disabled';
                    const recommendedClass = matchScore >= 80 && meetsRequirement ? 'recommended' : '';
                    
                    // Ëé∑ÂèñÊ†∏ÂøÉÊäÄËÉΩË¶ÅÊ±Ç
                    const reqText = Object.entries(pos.baseRequirements)
                        .map(([skill, value]) => {
                            const skillNames = { serve: 'ÂèëÁêÉ', spike: 'Êâ£ÁêÉ', block: 'Êã¶ÁΩë', dig: 'Âû´ÁêÉ', set: 'ÊâòÁêÉ' };
                            const currentValue = this.player.skills[skill];
                            const met = currentValue >= value;
                            const gap = met ? 0 : value - currentValue;
                            return `${skillNames[skill]} ${currentValue}/${value} ${met ? '‚úì' : `‚úó(ËøòÂ∑Æ${gap})`}`;
                        }).join(' ');
                    
                    html += `<div class="position-card ${disabledClass} ${recommendedClass}" onclick="game.selectPosition('${pos.id}', ${meetsRequirement})">
                        <div class="position-icon">${pos.icon}</div>
                        <div class="position-name">${pos.name}</div>
                        ${recommendedClass ? '<div class="position-recommended">‚≠ê Êé®Ëçê</div>' : ''}
                        <div class="position-match">ÂåπÈÖçÂ∫¶Ôºö${matchScore}%</div>
                        <div class="position-desc">${pos.description}</div>
                        <div class="position-skills">
                            <strong>Ê†∏ÂøÉÊäÄËÉΩÔºö</strong>${pos.coreSkills.map(s => {
                                const names = { serve: 'ÂèëÁêÉ', spike: 'Êâ£ÁêÉ', block: 'Êã¶ÁΩë', dig: 'Âû´ÁêÉ', set: 'ÊâòÁêÉ' };
                                return names[s];
                            }).join('„ÄÅ')}
                        </div>
                        <div class="position-requirements">${reqText}</div>
                        ${pos.restrictions ? `<div class="position-restrictions">ÈôêÂà∂Ôºö${pos.restrictions.join('„ÄÅ')}</div>` : ''}
                        ${!meetsRequirement ? '<div class="position-locked">üîí Êù°‰ª∂‰∏çË∂≥</div>' : ''}
                    </div>`;
                }
                
                html += '</div>';
                
                // Ê∑ªÂä†"ÊöÇ‰∏çÈÄâÊã©"ÈÄâÈ°π
                html += `<div class="choices">
                    <button class="choice-button" onclick="game.skipPositionSelection()">
                        ‚è≠Ô∏è ÊöÇ‰∏çÈÄâÊã©ÔºåÁªßÁª≠ËÆ≠ÁªÉ
                    </button>
                </div>`;
                
                choicesDiv.innerHTML = html;
            }
            
            calculatePositionMatch(position) {
                let score = 0;
                let maxScore = 0;
                
                for (let [skill, required] of Object.entries(position.baseRequirements)) {
                    maxScore += required;
                    score += Math.min(this.player.skills[skill], required);
                }
                
                return maxScore > 0 ? Math.round(score / maxScore * 100) : 0;
            }
            
            skipPositionSelection() {
                alert('‰Ω†ÂÜ≥ÂÆöÊöÇÊó∂‰∏çÈÄâÊã©‰ΩçÁΩÆÔºåÁªßÁª≠ÊèêÂçáÊäÄËÉΩ„ÄÇ\n\n‰Ω†ÂèØ‰ª•ÈöèÊó∂ÂõûÂà∞ËøôÈáåÈÄâÊã©‰ΩçÁΩÆÔºÅ');
                this.currentScene = 'weeklyHub';
                this.showScene('weeklyHub');
                this.updateUI();
            }
            
            checkPositionRequirement(position) {
                const req = position.baseRequirements;
                for (let skill in req) {
                    if (this.player.skills[skill] < req[skill]) {
                        return false;
                    }
                }
                return true;
            }
            
            selectPosition(positionId, meetsRequirement) {
                if (!meetsRequirement) {
                    alert('‰Ω†ÁöÑÊäÄËÉΩËøò‰∏çÊª°Ë∂≥Ëøô‰∏™‰ΩçÁΩÆÁöÑË¶ÅÊ±ÇÔºÅ');
                    return;
                }
                
                const position = this.positions[positionId];
                this.player.position = positionId;
                this.player.positionLevel = 1;
                
                alert(`‰Ω†ÈÄâÊã©‰∫Ü ${position.icon} ${position.name}ÔºÅ\n\n${position.description}\n\nÊ†∏ÂøÉÊäÄËÉΩËÆ≠ÁªÉÂ∞ÜËé∑ÂæóÈ¢ùÂ§ñÂä†ÊàêÔºÅ`);
                
                // ‰∏ç‰øÆÊîπÁõÆÊ†áÔºå‰øùÊåÅ‰πãÂâçËÆæÁΩÆÁöÑÁõÆÊ†á
                this.currentScene = 'weeklyHub';
                this.showScene('weeklyHub');
                this.updateUI();
            }
            
            getPositionInfo() {
                if (this.player.position === 'none') {
                    return null;
                }
                return this.positions[this.player.position];
            }
            
            getTrainingBonus(skill) {
                let totalBonus = 0;
                
                // ËÅå‰∏öÂä†Êàê
                const posInfo = this.getPositionInfo();
                if (posInfo) {
                    // ÈÄÇÂ∫îÊúüÊÉ©ÁΩö
                    if (this.player.adaptationWeeks > 0) {
                        totalBonus += -0.2;
                    } else {
                        if (posInfo.coreSkills.includes(skill)) {
                            totalBonus += posInfo.trainingBonus.core;
                        } else if (posInfo.secondarySkills.includes(skill)) {
                            totalBonus += posInfo.trainingBonus.secondary;
                        } else {
                            totalBonus += posInfo.trainingBonus.other;
                        }
                    }
                }
                
                // Ë£ÖÂ§áÂä†Êàê
                if (this.player.ownedItems) {
                    // ‰∏ì‰∏öÁêÉÈûã +10%
                    if (this.player.ownedItems.shoes === 'pro') {
                        totalBonus += 0.10;
                    }
                    // ‰∏ì‰∏öÁêÉË°£ +5%
                    if (this.player.ownedItems.jersey) {
                        totalBonus += 0.05;
                    }
                    // ‰∏ì‰∏öËÆ≠ÁªÉÁêÉ +15%
                    if (this.player.ownedItems.trainingEquipment && this.player.ownedItems.trainingEquipment.includes('ball')) {
                        totalBonus += 0.15;
                    }
                }
                
                // BuffÂä†Êàê
                if (this.player.activeBuffs) {
                    this.player.activeBuffs.forEach(buff => {
                        // ÊïôÁªÉÁ§ºÁâ©ÔºöËÆ≠ÁªÉË¥®Èáè+10%
                        if (buff.id === 'coach_gift' && buff.effect.trainingQuality) {
                            totalBonus += buff.effect.trainingQuality / 100;
                        }
                    });
                }
                
                return totalBonus;
            }
            
            // ËÆ°ÁÆóÂπ∂Ê†ºÂºèÂåñÊïàÊûúÈ¢ÑËßàÔºàÂåÖÂê´Ë£ÖÂ§áÂä†ÊàêÔºâ
            getEffectPreview(effect) {
                if (!effect) return '';
                
                const parts = [];
                const skillIcons = {
                    serve: 'üéØ',
                    spike: '‚ö°',
                    block: 'üõ°Ô∏è',
                    dig: 'ü§∏',
                    set: 'üôå'
                };
                
                // ÊäÄËÉΩÊïàÊûúÔºàÂåÖÂê´ËÅå‰∏öÂä†ÊàêÔºâ
                ['serve', 'spike', 'block', 'dig', 'set'].forEach(skill => {
                    if (effect[skill]) {
                        const bonus = this.getTrainingBonus(skill);
                        const baseValue = effect[skill];
                        const finalValue = Math.round(baseValue * (1 + bonus));
                        
                        if (bonus !== 0 && effect.trained) {
                            // ÊúâÂä†ÊàêÊó∂ÊòæÁ§∫ËØ¶ÁªÜ‰ø°ÊÅØ
                            const bonusText = bonus > 0 ? `+${Math.round(bonus * 100)}%` : `${Math.round(bonus * 100)}%`;
                            parts.push(`${skillIcons[skill]}${this.getSkillName(skill)}+${finalValue}(Âü∫Á°Ä${baseValue}${bonusText})`);
                        } else {
                            parts.push(`${skillIcons[skill]}${this.getSkillName(skill)}${baseValue > 0 ? '+' : ''}${baseValue}`);
                        }
                    }
                });
                
                // ÂÖ∂‰ªñÊïàÊûúÔºàËÆ≠ÁªÉÊó∂‰∏çÊòæÁ§∫‰ΩìÂäõÊ∂àËÄóÔºåÂõ†‰∏∫Â∑≤Âú®ÂàÜÁ±ªÊ†áÈ¢ò‰∏≠ÊòæÁ§∫Ôºâ
                if (!effect.trained && effect.energy) parts.push(`üí™‰ΩìÂäõ${effect.energy > 0 ? '+' : ''}${effect.energy}`);
                if (effect.mood) parts.push(`üòäÂøÉÊÉÖ${effect.mood > 0 ? '+' : ''}${effect.mood}`);
                if (effect.stress) parts.push(`üò∞ÂéãÂäõ${effect.stress > 0 ? '+' : ''}${effect.stress}`);
                if (effect.reputation) parts.push(`‚≠êÂ£∞Êúõ${effect.reputation > 0 ? '+' : ''}${effect.reputation}`);
                if (effect.money) parts.push(`üí∞${effect.money > 0 ? '+' : ''}${effect.money}ÂÖÉ`);
                
                return parts.length > 0 ? `Ôºà${parts.join('Ôºå')}Ôºâ` : '';
            }
            
            getSkillName(skill) {
                const names = {
                    serve: 'ÂèëÁêÉ',
                    spike: 'Êâ£ÁêÉ',
                    block: 'Êã¶ÁΩë',
                    dig: 'Âû´ÁêÉ',
                    set: 'ÊâòÁêÉ'
                };
                return names[skill] || skill;
            }
            
            getMatchWeight(skill) {
                const posInfo = this.getPositionInfo();
                if (!posInfo) {
                    // Ê≤°ÊúâËÅå‰∏öÊó∂Âπ≥ÂùáÊùÉÈáç
                    return 20;
                }
                return posInfo.matchWeights[skill] || 0;
            }
            
            getPositionDescription(skill, success) {
                const posInfo = this.getPositionInfo();
                if (!posInfo || !posInfo.specialDescriptions[skill]) {
                    return null;
                }
                
                const descriptions = posInfo.specialDescriptions[skill];
                return descriptions[Math.floor(Math.random() * descriptions.length)];
            }
            
            // Êñ∞Â¢ûÔºöËÆ°ÁÆóÁé©ÂÆ∂ÁªºÂêàÂÆûÂäõÔºàÁî®‰∫éÊØîËµõËÉúÁéáÔºâ
            calculateMyStrength() {
                const skills = this.player.skills;
                const posInfo = this.getPositionInfo();
                
                // Âü∫Á°ÄÊäÄËÉΩÂÄºÔºàÂä†ÊùÉÂπ≥ÂùáÔºâ
                let baseStrength = 0;
                const skillWeights = {
                    serve: 0.20,   // ÂèëÁêÉ 20%
                    spike: 0.25,   // Êâ£ÁêÉ 25%
                    block: 0.20,   // Êã¶ÁΩë 20%
                    dig: 0.20,     // Âû´ÁêÉ 20%
                    set: 0.15      // ÊâòÁêÉ 15%
                };
                
                for (let skill in skillWeights) {
                    baseStrength += skills[skill] * skillWeights[skill];
                }
                
                // ËÅå‰∏öÂä†ÊàêÔºàÊ†∏ÂøÉÊäÄËÉΩÊùÉÈáçÊèêÂçáÔºâ
                let positionBonus = 1.0;
                if (posInfo) {
                    let weightedSkills = 0;
                    let totalWeight = 0;
                    
                    for (let skill in skillWeights) {
                        let weight = skillWeights[skill];
                        
                        // Ê†∏ÂøÉÊäÄËÉΩÊùÉÈáç √ó 1.5
                        if (posInfo.coreSkills.includes(skill)) {
                            weight *= 1.5;
                        }
                        // Ê¨°Ë¶ÅÊäÄËÉΩÊùÉÈáç √ó 1.2
                        else if (posInfo.secondarySkills.includes(skill)) {
                            weight *= 1.2;
                        }
                        
                        weightedSkills += skills[skill] * weight;
                        totalWeight += weight;
                    }
                    
                    positionBonus = weightedSkills / totalWeight / baseStrength;
                }
                
                // Áä∂ÊÄÅÂä†Êàê
                let stateBonus = 1.0;
                
                // ÂøÉÊÉÖÂΩ±Âìç (-20% ~ +20%)
                const moodEffect = (this.player.mood - 50) / 250;
                stateBonus += moodEffect;
                
                // ÂéãÂäõÂΩ±Âìç (-15% ~ 0%)
                const stressEffect = -this.player.stress / 667;
                stateBonus += stressEffect;
                
                // ‰ΩìÂäõÂΩ±Âìç (-10% ~ 0%)
                const energyEffect = Math.min(0, (this.player.energy - 50) / 500);
                stateBonus += energyEffect;
                
                // Á°Æ‰øùÁä∂ÊÄÅÂä†ÊàêÂú®ÂêàÁêÜËåÉÂõ¥
                stateBonus = Math.max(0.7, Math.min(1.3, stateBonus));
                
                return baseStrength * positionBonus * stateBonus;
            }
            
            // Êñ∞Â¢ûÔºöËÆ°ÁÆóÂØπÊâãÂÆûÂäõ
            calculateOpponentStrength(matchType) {
                const myAvgSkill = (
                    this.player.skills.serve + 
                    this.player.skills.spike + 
                    this.player.skills.block + 
                    this.player.skills.dig + 
                    this.player.skills.set
                ) / 5;
                
                let baseOpponent = 0;
                let randomRange = 0;
                
                switch(matchType) {
                    case 'casual':
                        // ÈáéÁêÉÔºöÂØπÊâãÂÆûÂäõÊé•ËøëÁé©ÂÆ∂
                        baseOpponent = myAvgSkill;
                        randomRange = myAvgSkill * 0.15;
                        break;
                        
                    case 'collegeMatch':
                        // Èô¢ÈôÖÊØîËµõÔºöÂØπÊâã = Áé©ÂÆ∂Âπ≥Âùá √ó 0.85 ¬± 10%
                        baseOpponent = myAvgSkill * 0.85;
                        randomRange = myAvgSkill * 0.1;
                        break;
                        
                    case 'tournament':
                        // Èî¶Ê†áËµõÔºö‰ΩøÁî®ÂΩìÂâçËΩÆÊ¨°ÁöÑÂõ∫ÂÆöÂÆûÂäõ
                        if (this.tournament.active && this.tournament.currentRound) {
                            const roundInfo = this.TOURNAMENT_ROUNDS[this.tournament.currentRound];
                            baseOpponent = roundInfo.opponentStrength;
                            randomRange = 5;  // Â∞èËåÉÂõ¥ÈöèÊú∫
                        } else {
                            baseOpponent = myAvgSkill;
                            randomRange = myAvgSkill * 0.1;
                        }
                        break;
                        
                    case 'universityLeague':
                        // Ê†°ÈôÖËÅîËµõÔºöÂØπÊâã = Áé©ÂÆ∂Âπ≥Âùá √ó 1.0 ¬± 10%
                        baseOpponent = myAvgSkill * 1.0;
                        randomRange = myAvgSkill * 0.1;
                        break;
                        
                    case 'cityLeague':
                        // Â∏ÇÁ∫ßËÅîËµõÔºöÂØπÊâã = Áé©ÂÆ∂Âπ≥Âùá √ó 1.15 ¬± 10%
                        baseOpponent = myAvgSkill * 1.15;
                        randomRange = myAvgSkill * 0.1;
                        break;
                        
                    default:
                        baseOpponent = myAvgSkill;
                        randomRange = myAvgSkill * 0.15;
                }
                
                // Ê∑ªÂä†ÈöèÊú∫Ê≥¢Âä®
                const opponent = baseOpponent + (Math.random() - 0.5) * 2 * randomRange;
                
                // Á°Æ‰øùÂØπÊâãÂÆûÂäõÂú®ÂêàÁêÜËåÉÂõ¥
                return Math.max(20, Math.min(90, opponent));
            }
            
            // Êñ∞Â¢ûÔºöËÆ°ÁÆóÂçïÂàÜËÉúÁéá
            calculatePointWinRate(myStrength, opponentStrength) {
                // Âü∫Á°ÄËÉúÁéáÂÖ¨Âºè
                let winRate = myStrength / (myStrength + opponentStrength);
                
                // Ê∑ªÂä†‰∏ªÂú∫‰ºòÂäøÔºàÊ≠£ÂºèÊØîËµõÔºâ
                if (this.currentMatch && this.currentMatch.type === 'formal') {
                    winRate += 0.05;  // +5% ‰∏ªÂú∫‰ºòÂäø
                }
                
                // Á°Æ‰øùËÉúÁéáÂú® 10% ~ 90% ‰πãÈó¥ÔºàÈÅøÂÖçÊûÅÁ´ØÊÉÖÂÜµÔºâ
                winRate = Math.max(0.1, Math.min(0.9, winRate));
                
                return winRate;
            }
            
            // ÊØîËµõÁ≥ªÁªü
            startMatch(matchType) {
                // ËøΩË∏™ÊâìÈáéÁêÉÊ¥ªÂä®
                if (matchType === 'casual') {
                    this.trackLifeActivity('casualMatch');
                }
                
                // ÂàùÂßãÂåñÊØîËµõÊï∞ÊçÆ
                this.currentMatch = {
                    type: matchType, // 'casual' ÈáéÁêÉ, 'formal' Ê≠£ÂºèÊØîËµõ
                    targetScore: matchType === 'casual' ? 25 : 25,
                    myScore: 0,
                    opponentScore: 0,
                    scoreLog: [],
                    mySkills: {
                        serve: this.player.skills.serve,
                        spike: this.player.skills.spike,
                        block: this.player.skills.block,
                        dig: this.player.skills.dig,
                        set: this.player.skills.set
                    }
                };
                
                // Ê®°ÊãüÊØîËµõËøáÁ®ã
                this.simulateMatch();
            }
            
            // Êñ∞Â¢ûÔºöÊ≠£ÂºèÊØîËµõÁ≥ªÁªüÔºà‰∫îÂ±Ä‰∏âËÉúÔºâ
            startFormalMatch(matchType, matchName) {
                console.log('=== ÂºÄÂßãÊ≠£ÂºèÊØîËµõ ===');
                console.log('ÊØîËµõÁ±ªÂûã:', matchType);
                console.log('ÊØîËµõÂêçÁß∞:', matchName);
                
                this.currentMatch = {
                    type: 'formal',
                    matchType: matchType,  // 'collegeMatch', 'universityLeague', 'cityLeague'
                    matchName: matchName,  // ÊØîËµõÂêçÁß∞
                    
                    // Â§ßÂ±ÄÂàÜ
                    mySets: 0,
                    opponentSets: 0,
                    targetSets: 3,  // ‰∫îÂ±Ä‰∏âËÉú
                    
                    // ÂΩìÂâçÂ±Ä
                    currentSet: 1,
                    myScore: 0,
                    opponentScore: 0,
                    targetScore: 25,
                    
                    // ÊØèÂ±ÄËØ¶ÊÉÖ
                    setResults: [],
                    
                    // ÊØîËµõÊó•Âøó
                    scoreLog: [],
                    
                    // ÊäÄËÉΩÊï∞ÊçÆ
                    mySkills: {
                        serve: this.player.skills.serve,
                        spike: this.player.skills.spike,
                        block: this.player.skills.block,
                        dig: this.player.skills.dig,
                        set: this.player.skills.set
                    },
                    
                    // ÂØπÊâãÂÆûÂäõ
                    opponentStrength: this.calculateOpponentStrength(matchType)
                };
                
                console.log('ÊØîËµõÊï∞ÊçÆÂàùÂßãÂåñÂÆåÊàêÔºåÂºÄÂßãÊ®°ÊãüÊØîËµõ...');
                
                // Ê®°ÊãüÊ≠£ÂºèÊØîËµõ
                this.simulateFormalMatch();
                
                // ÊòæÁ§∫ÊØîËµõÂä®Áîª
                this.showFormalMatchAnimation();
            }
            
            // Êñ∞Â¢ûÔºöÊ®°ÊãüÊ≠£ÂºèÊØîËµõÔºà‰∫îÂ±Ä‰∏âËÉúÔºâ
            simulateFormalMatch() {
                const match = this.currentMatch;
                
                console.log('ÂºÄÂßãÊ≠£ÂºèÊØîËµõ:', match.matchName);
                console.log('ÁõÆÊ†áÂ±ÄÊï∞:', match.targetSets, '(ÈúÄË¶ÅËµ¢', match.targetSets, 'Â±Ä)');
                
                // Ê®°ÊãüÊØè‰∏ÄÂ±Ä
                while (match.mySets < match.targetSets && match.opponentSets < match.targetSets) {
                    console.log(`\nÂºÄÂßãÁ¨¨${match.currentSet}Â±Ä (ÂΩìÂâçÂ§ßÂ±ÄÂàÜ: ${match.mySets}:${match.opponentSets})`);
                    
                    this.simulateSet();
                    
                    console.log(`Á¨¨${match.currentSet}Â±ÄÁªìÊùü: ${match.myScore}-${match.opponentScore}`);
                    
                    // ËÆ∞ÂΩïÊú¨Â±ÄÁªìÊûú
                    match.setResults.push({
                        setNumber: match.currentSet,
                        myScore: match.myScore,
                        opponentScore: match.opponentScore,
                        winner: match.myScore > match.opponentScore ? 'my' : 'opponent'
                    });
                    
                    // Êõ¥Êñ∞Â§ßÂ±ÄÂàÜ
                    if (match.myScore > match.opponentScore) {
                        match.mySets++;
                        console.log('ÊàëÊñπËµ¢ÂæóÊú¨Â±ÄÔºÅÂ§ßÂ±ÄÂàÜ:', match.mySets, ':', match.opponentSets);
                    } else {
                        match.opponentSets++;
                        console.log('ÂØπÊñπËµ¢ÂæóÊú¨Â±ÄÔºÅÂ§ßÂ±ÄÂàÜ:', match.mySets, ':', match.opponentSets);
                    }
                    
                    // ÂáÜÂ§á‰∏ã‰∏ÄÂ±Ä
                    match.currentSet++;
                    match.myScore = 0;
                    match.opponentScore = 0;
                    
                    // ÂÜ≥ËÉúÂ±ÄÊîπ‰∏∫15ÂàÜÂà∂
                    if (match.currentSet === 5) {
                        match.targetScore = 15;
                    } else {
                        match.targetScore = 25;
                    }
                }
                
                console.log('\nÊØîËµõÁªìÊùüÔºÅÊúÄÁªàÂ§ßÂ±ÄÂàÜ:', match.mySets, ':', match.opponentSets);
                console.log('ÂÖ±ËøõË°å‰∫Ü', match.setResults.length, 'Â±Ä');
                
                // ‰∏çÂÜçÁ´ãÂç≥ÊòæÁ§∫ÁªìÊûúÔºåÁ≠âÂæÖÂä®ÁîªÂÆåÊàê
            }
            
            // Êñ∞Â¢ûÔºöÊ®°ÊãüÂçïÂ±ÄÊØîËµõ
            simulateSet() {
                const match = this.currentMatch;
                
                // Ê®°ÊãüÊú¨Â±ÄÊØè‰∏ÄÂàÜ
                while (match.myScore < match.targetScore && match.opponentScore < match.targetScore) {
                    // Â¶ÇÊûúÊØîÂàÜÊé•ËøëÔºåÈúÄË¶ÅÈ¢ÜÂÖà2ÂàÜÊâçËÉΩËé∑ËÉú
                    if (match.myScore >= match.targetScore - 1 && match.opponentScore >= match.targetScore - 1) {
                        if (Math.abs(match.myScore - match.opponentScore) >= 2) {
                            break;
                        }
                    }
                    
                    const point = this.simulatePoint(match.mySkills, match.opponentStrength);
                    
                    if (point.scorer === 'my') {
                        match.myScore++;
                    } else {
                        match.opponentScore++;
                    }
                    
                    match.scoreLog.push({
                        set: match.currentSet,
                        myScore: match.myScore,
                        opponentScore: match.opponentScore,
                        description: point.description,
                        scorer: point.scorer
                    });
                }
            }
            
            simulateMatch() {
                const match = this.currentMatch;
                const mySkills = match.mySkills;
                
                // ‰ΩøÁî®Êñ∞ÁöÑÂØπÊâãÂÆûÂäõËÆ°ÁÆóÊñπÊ≥ï
                const opponentSkill = this.calculateOpponentStrength(match.type);
                
                // Ê®°ÊãüÊØè‰∏ÄÂàÜ
                // ÊéíÁêÉËßÑÂàôÔºöÂÖàÂà∞25ÂàÜ‰∏îÈ¢ÜÂÖà2ÂàÜËé∑ËÉúÔºåÂ¶ÇÊûú24:24ÂàôÁªßÁª≠ÊØîËµõÁõ¥Âà∞È¢ÜÂÖà2ÂàÜ
                while (true) {
                    // Ê£ÄÊü•ÊòØÂê¶Êúâ‰∏ÄÊñπËé∑ËÉú
                    const myWin = match.myScore >= match.targetScore && match.myScore - match.opponentScore >= 2;
                    const opponentWin = match.opponentScore >= match.targetScore && match.opponentScore - match.myScore >= 2;
                    
                    if (myWin || opponentWin) {
                        break;
                    }
                    
                    // Ê®°Êãü‰∏ÄÂàÜ
                    const point = this.simulatePoint(mySkills, opponentSkill);
                    
                    if (point.scorer === 'my') {
                        match.myScore++;
                    } else {
                        match.opponentScore++;
                    }
                    
                    match.scoreLog.push({
                        myScore: match.myScore,
                        opponentScore: match.opponentScore,
                        description: point.description,
                        scorer: point.scorer
                    });
                }
                
                // ÊòæÁ§∫ÊØîËµõÁªìÊûú
                this.showMatchResult();
            }
            
            simulatePoint(mySkills, opponentSkill) {
                // ÈöèÊú∫ÂÜ≥ÂÆöÂì™ÊñπÂèëÁêÉ
                const myServe = Math.random() > 0.5;
                
                // ÂæóÂàÜÊñπÂºèÊùÉÈáçÔºàÂü∫‰∫éËÅå‰∏öÂíåÊäÄËÉΩÔºâ
                const scoreTypes = [
                    { type: 'serve', weight: this.getMatchWeight('serve') * (mySkills.serve / 100), name: 'ÂèëÁêÉ' },
                    { type: 'spike', weight: this.getMatchWeight('spike') * (mySkills.spike / 100), name: 'Êâ£ÁêÉ' },
                    { type: 'block', weight: this.getMatchWeight('block') * (mySkills.block / 100), name: 'Êã¶ÁΩë' },
                    { type: 'dig', weight: this.getMatchWeight('dig') * (mySkills.dig / 100), name: 'Âû´ÁêÉ' },
                    { type: 'set', weight: this.getMatchWeight('set') * (mySkills.set / 100), name: 'ÊâòÁêÉ' }
                ];
                
                // ÈÄâÊã©ÂæóÂàÜÊñπÂºè
                const totalWeight = scoreTypes.reduce((sum, st) => sum + st.weight, 0);
                let random = Math.random() * totalWeight;
                let selectedType = scoreTypes[0];
                
                for (let st of scoreTypes) {
                    random -= st.weight;
                    if (random <= 0) {
                        selectedType = st;
                        break;
                    }
                }
                
                // ‰ΩøÁî®Êñ∞ÁöÑËÉúÁéáËÆ°ÁÆóÊñπÊ≥ï
                const myStrength = this.calculateMyStrength();
                const winRate = this.calculatePointWinRate(myStrength, opponentSkill);
                const iWin = Math.random() < winRate;
                
                // ÁîüÊàêÂæóÂàÜÊèèËø∞Ôºà‰ºòÂÖà‰ΩøÁî®ËÅå‰∏ö‰∏ìÂ±ûÊèèËø∞Ôºâ
                let description = '';
                if (iWin) {
                    const posDesc = this.getPositionDescription(selectedType.type, true);
                    if (posDesc) {
                        description = posDesc;
                    } else {
                        const descriptions = {
                            serve: [
                                '‰Ω†ÂèëÂá∫‰∏ÄËÆ∞Âº∫ÂäõË∑≥ÂèëÁêÉÔºåÂØπÊñπÊé•ÂèëÂ§±ËØØÔºÅ',
                                'Á≤æÂáÜÁöÑÂèëÁêÉÁõ¥Êé•ÂæóÂàÜÔºåÂØπÊñπÊé™Êâã‰∏çÂèäÔºÅ',
                                '‰Ω†ÁöÑÂèëÁêÉËêΩÂú®ÂØπÊñπÁ©∫Ê°£ÔºåÁõ¥Êé•ÂæóÂàÜÔºÅ'
                            ],
                            spike: [
                                '‰Ω†È´òÈ´òË∑ÉËµ∑ÔºåÂ§ßÂäõÊâ£ÁêÉÂæóÂàÜÔºÅ',
                                'ÊºÇ‰∫ÆÁöÑÊâ£ÁêÉÔºåÂØπÊñπÈò≤ÂÆàÂ§±ËØØÔºÅ',
                                '‰Ω†Êäì‰ΩèÊú∫‰ºöÔºå‰∏ÄËÆ∞ÈáçÊâ£Êãø‰∏ãËøôÂàÜÔºÅ',
                                'ÂÆåÁæéÁöÑÊâ£ÁêÉËßíÂ∫¶ÔºåÂØπÊñπÊó†Ê≥ïÈò≤ÂÆàÔºÅ'
                            ],
                            block: [
                                '‰Ω†ÊàêÂäüÊã¶ÁΩëÔºåÁõ¥Êé•ÂæóÂàÜÔºÅ',
                                'Á≤æÂáÜÁöÑÊã¶ÁΩëÂà§Êñ≠ÔºåÁêÉÁõ¥Êé•ÂºπÂõûÂØπÊñπÂú∫Âú∞ÔºÅ',
                                '‰Ω†ÁöÑÊã¶ÁΩëËÆ©ÂØπÊñπÁöÑÊâ£ÁêÉÊó†ÂäüËÄåËøîÔºÅ'
                            ],
                            dig: [
                                '‰Ω†ÊàêÂäüÂû´Ëµ∑ÂØπÊñπÁöÑÊâ£ÁêÉÔºåÈòüÂèãÂèçÂáªÂæóÂàÜÔºÅ',
                                'Á≤æÂΩ©ÁöÑÂû´ÁêÉÔºåÂåñËß£ÂØπÊñπÊîªÂäøÂπ∂ÂèçÂáªÊàêÂäüÔºÅ',
                                '‰Ω†ÁöÑÂû´ÁêÉÂà∞‰ΩçÔºåÈòüÂèãÂÆåÊàêÂèçÂáªÔºÅ'
                            ],
                            set: [
                                '‰Ω†ÁöÑ‰∫å‰º†Á≤æÂáÜÂà∞‰ΩçÔºåÈòüÂèãÊâ£ÁêÉÂæóÂàÜÔºÅ',
                                'ÂÆåÁæéÁöÑÊâòÁêÉÔºåÂä©ÊîªÈòüÂèãÂæóÂàÜÔºÅ',
                                '‰Ω†ÁöÑ‰º†ÁêÉÁªÑÁªáËøõÊîªÔºåÈòüÂèãÂÆåÊàêÂæóÂàÜÔºÅ'
                            ]
                        };
                        description = descriptions[selectedType.type][Math.floor(Math.random() * descriptions[selectedType.type].length)];
                    }
                } else {
                    const descriptions = {
                        serve: [
                            '‰Ω†ÁöÑÂèëÁêÉÂá∫Áïå‰∫ÜÔºåÂØπÊñπÂæóÂàÜ„ÄÇ',
                            'ÂèëÁêÉÂ§±ËØØÔºåÂØπÊñπÊãø‰∏ãËøôÂàÜ„ÄÇ',
                            'ÂèëÁêÉ‰∏ãÁΩëÔºåÂØπÊñπÂæóÂàÜ„ÄÇ'
                        ],
                        spike: [
                            'Êâ£ÁêÉË¢´ÂØπÊñπÊã¶ÁΩëÔºåÂØπÊñπÂæóÂàÜ„ÄÇ',
                            '‰Ω†ÁöÑÊâ£ÁêÉÂá∫Áïå‰∫ÜÔºåÂØπÊñπÂæóÂàÜ„ÄÇ',
                            'ÂØπÊñπÈò≤ÂÆàÊàêÂäüÂπ∂ÂèçÂáªÂæóÂàÜ„ÄÇ'
                        ],
                        block: [
                            'Êã¶ÁΩëÂà§Êñ≠Â§±ËØØÔºåÂØπÊñπÊâ£ÁêÉÂæóÂàÜ„ÄÇ',
                            'ÂØπÊñπÁöÑÊâ£ÁêÉÁ™ÅÁ†¥‰∫Ü‰Ω†ÁöÑÊã¶ÁΩë„ÄÇ',
                            'Êã¶ÁΩëÊ≤°ÊúâÊàêÂäüÔºåÂØπÊñπÂæóÂàÜ„ÄÇ'
                        ],
                        dig: [
                            'Âû´ÁêÉÂ§±ËØØÔºåÂØπÊñπÊâ£ÁêÉÂæóÂàÜ„ÄÇ',
                            '‰Ω†Ê≤°ËÉΩÂû´Ëµ∑ÂØπÊñπÁöÑËøõÊîª„ÄÇ',
                            'Âû´ÁêÉ‰∏çÂà∞‰ΩçÔºåÂØπÊñπÂæóÂàÜ„ÄÇ'
                        ],
                        set: [
                            'ÊâòÁêÉÂ§±ËØØÔºåÂØπÊñπÂèçÂáªÂæóÂàÜ„ÄÇ',
                            '‰∫å‰º†‰∏çÂà∞‰ΩçÔºåËøõÊîªÂ§±Ë¥•„ÄÇ',
                            '‰º†ÁêÉË¢´ÂØπÊñπÊã¶Êà™ÔºåÂØπÊñπÂæóÂàÜ„ÄÇ'
                        ]
                    };
                    description = descriptions[selectedType.type][Math.floor(Math.random() * descriptions[selectedType.type].length)];
                }
                
                return {
                    scorer: iWin ? 'my' : 'opponent',
                    description: description,
                    type: selectedType.type
                };
            }
            
            showMatchResult() {
                const match = this.currentMatch;
                
                // ÊòæÁ§∫ÊØîËµõÂºπÁ™ó
                const modal = document.getElementById('match-modal');
                const title = document.getElementById('match-modal-title');
                const myScoreEl = document.getElementById('my-score');
                const opponentScoreEl = document.getElementById('opponent-score');
                const matchLog = document.getElementById('match-log');
                const choicesDiv = document.getElementById('match-modal-choices');
                const skipBtn = document.getElementById('skip-match-btn');
                
                title.textContent = 'üèê ÊØîËµõËøõË°å‰∏≠';
                myScoreEl.textContent = '0';
                opponentScoreEl.textContent = '0';
                matchLog.innerHTML = '';
                choicesDiv.innerHTML = '';
                skipBtn.style.display = 'block';
                skipBtn.disabled = false;
                
                modal.classList.add('show');
                
                // ÈÄêË°åÊòæÁ§∫ÂæóÂàÜËÆ∞ÂΩï
                let currentIndex = 0;
                this.matchDisplayInterval = setInterval(() => {
                    if (currentIndex >= match.scoreLog.length) {
                        clearInterval(this.matchDisplayInterval);
                        this.matchDisplayInterval = null;
                        // ÊâÄÊúâÂæóÂàÜÊòæÁ§∫ÂÆåÊØïÔºåÊòæÁ§∫ÊúÄÁªàÁªìÊûú
                        this.showFinalMatchResult();
                        return;
                    }
                    
                    const log = match.scoreLog[currentIndex];
                    
                    // Êõ¥Êñ∞ÊØîÂàÜÊòæÁ§∫
                    myScoreEl.textContent = log.myScore;
                    opponentScoreEl.textContent = log.opponentScore;
                    
                    // Ê∑ªÂä†ÂæóÂàÜËÆ∞ÂΩï
                    const logItem = document.createElement('div');
                    logItem.className = `match-log-item ${log.scorer === 'my' ? 'my-point' : 'opponent-point'}`;
                    
                    const scoreColor = log.scorer === 'my' ? '#2ecc71' : '#e74c3c';
                    logItem.innerHTML = `
                        <div class="match-log-score" style="color: ${scoreColor};">
                            ${log.myScore} : ${log.opponentScore}
                        </div>
                        <div class="match-log-description">${log.description}</div>
                    `;
                    
                    matchLog.appendChild(logItem);
                    
                    // Ëá™Âä®ÊªöÂä®Âà∞Â∫ïÈÉ®
                    matchLog.scrollTop = matchLog.scrollHeight;
                    
                    currentIndex++;
                }, 500); // ÊØè0.5ÁßíÊòæÁ§∫‰∏ÄÊù°
            }
            
            skipMatch() {
                // Ê∏ÖÈô§Âä®ÁîªÂÆöÊó∂Âô®
                if (this.matchDisplayInterval) {
                    clearInterval(this.matchDisplayInterval);
                    this.matchDisplayInterval = null;
                }
                
                const match = this.currentMatch;
                const modal = document.getElementById('match-modal');
                const matchLog = document.getElementById('match-log');
                const skipBtn = document.getElementById('skip-match-btn');
                
                // ÈöêËóèË∑≥ËøáÊåâÈíÆ
                skipBtn.style.display = 'none';
                
                // Ê∏ÖÁ©∫Âπ∂ÊòæÁ§∫ÁÆÄÂåñÁöÑÊØîËµõËÆ∞ÂΩï
                matchLog.innerHTML = '<div style="text-align: center; padding: 20px; color: #ddd;">Â∑≤Ë∑≥ËøáÊØîËµõËøáÁ®ã</div>';
                
                // Ê†πÊçÆÊØîËµõÁ±ªÂûãÊòæÁ§∫‰∏çÂêåÁöÑÁªìÊûú
                if (match.type === 'formal') {
                    // Ê≠£ÂºèÊØîËµõÔºöÊòæÁ§∫ÊâÄÊúâÂ±ÄÁöÑÁªìÊûú
                    match.setResults.forEach((set, i) => {
                        const setItem = document.createElement('div');
                        setItem.style.cssText = 'padding: 10px; margin: 5px 0; background: rgba(255,255,255,0.1); border-radius: 5px;';
                        const color = set.winner === 'my' ? '#2ecc71' : '#e74c3c';
                        setItem.innerHTML = `<div style="color: ${color}; font-weight: bold;">Á¨¨${i+1}Â±Ä: ${set.myScore}-${set.opponentScore}</div>`;
                        matchLog.appendChild(setItem);
                    });
                    
                    // 1ÁßíÂêéÂÖ≥Èó≠ÂºπÁ™óÂπ∂ÊòæÁ§∫ÁªìÊûú
                    setTimeout(() => {
                        modal.classList.remove('show');
                        // ÊÅ¢Â§çÈáéÁêÉÁöÑËÉåÊôØËâ≤
                        const modalContent = document.getElementById('match-modal-content');
                        modalContent.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                        this.showFormalMatchResult();
                    }, 1000);
                } else {
                    // ÈáéÁêÉÔºöÁõ¥Êé•ÊòæÁ§∫ÊúÄÁªàÁªìÊûú
                    const myScoreEl = document.getElementById('my-score');
                    const opponentScoreEl = document.getElementById('opponent-score');
                    const finalLog = match.scoreLog[match.scoreLog.length - 1];
                    myScoreEl.textContent = finalLog.myScore;
                    opponentScoreEl.textContent = finalLog.opponentScore;
                    this.showFinalMatchResult();
                }
            }
            
            // Êñ∞Â¢ûÔºöÊòæÁ§∫Ê≠£ÂºèÊØîËµõÂä®Áîª
            showFormalMatchAnimation() {
                const match = this.currentMatch;
                
                // ÊòæÁ§∫ÊØîËµõÂºπÁ™ó
                const modal = document.getElementById('match-modal');
                const modalContent = document.getElementById('match-modal-content');
                const title = document.getElementById('match-modal-title');
                const myScoreEl = document.getElementById('my-score');
                const opponentScoreEl = document.getElementById('opponent-score');
                const matchLog = document.getElementById('match-log');
                const choicesDiv = document.getElementById('match-modal-choices');
                const skipBtn = document.getElementById('skip-match-btn');
                
                // Ê≠£ÂºèÊØîËµõ‰ΩøÁî®ÈáëËâ≤Ê∏êÂèòËÉåÊôØ
                modalContent.style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 50%, #ffd700 100%)';
                
                // ÂàùÂßãÂåñÊòæÁ§∫ÔºàÂ§ßÂ±ÄÂàÜ‰ªé0:0ÂºÄÂßãÔºâ
                let displayedMySets = 0;
                let displayedOpponentSets = 0;
                
                title.innerHTML = `üèê ${match.matchName}<br><span style="font-size: 18px; color: #ffd700;">Â§ßÂ±Ä: ${displayedMySets} : ${displayedOpponentSets}</span>`;
                myScoreEl.textContent = '0';
                opponentScoreEl.textContent = '0';
                matchLog.innerHTML = '';
                choicesDiv.innerHTML = '';
                skipBtn.style.display = 'block';
                skipBtn.disabled = false;
                
                modal.classList.add('show');
                
                // ÊòæÁ§∫"Á¨¨1Â±ÄÂºÄÂßã"ÊèêÁ§∫
                this.showSetStartMessage(1, matchLog);
                
                // ÈÄêË°åÊòæÁ§∫ÂæóÂàÜËÆ∞ÂΩï
                let currentIndex = 0;
                let currentSetNumber = 1;
                let isPaused = true;  // ÂàùÂßãÊöÇÂÅúÔºåËÆ©"Á¨¨1Â±ÄÂºÄÂßã"ÊèêÁ§∫ÊòæÁ§∫1Áßí
                
                // 1ÁßíÂêéÂºÄÂßãÂä®Áîª
                setTimeout(() => {
                    isPaused = false;
                }, 1000);
                
                this.matchDisplayInterval = setInterval(() => {
                    // Â¶ÇÊûúÊ≠£Âú®ÊöÇÂÅúÔºåË∑≥ËøáËøôÊ¨°Êõ¥Êñ∞
                    if (isPaused) {
                        return;
                    }
                    
                    if (currentIndex >= match.scoreLog.length) {
                        clearInterval(this.matchDisplayInterval);
                        this.matchDisplayInterval = null;
                        
                        // ÊòæÁ§∫ÊúÄÂêé‰∏ÄÂ±ÄÁöÑÁªìÊûú
                        const lastSetResult = match.setResults[match.setResults.length - 1];
                        const isLastSetWin = lastSetResult.winner === 'my';
                        
                        if (isLastSetWin) {
                            displayedMySets++;
                        } else {
                            displayedOpponentSets++;
                        }
                        
                        // ÊòæÁ§∫ÊúÄÂêé‰∏ÄÂ±ÄÁªìÊùüÊèêÁ§∫
                        const lastSetEndItem = document.createElement('div');
                        lastSetEndItem.className = 'match-log-item';
                        const bgColor = isLastSetWin ? 'rgba(46,204,113,0.5)' : 'rgba(231,76,60,0.5)';
                        const borderColor = isLastSetWin ? '#2ecc71' : '#e74c3c';
                        const resultText = isLastSetWin ? '‚úÖ ËÉúÂà©' : '‚ùå Â§±Ë¥•';
                        const resultColor = isLastSetWin ? '#2ecc71' : '#e74c3c';
                        
                        // Âº∫Âà∂ÊòæÁ§∫Ôºå‰∏ç‰æùËµñÂä®Áîª
                        lastSetEndItem.style.cssText = `background: ${bgColor}; border: 3px solid ${borderColor}; font-weight: bold; text-align: center; padding: 15px; margin: 10px 0; box-shadow: 0 4px 15px ${bgColor}; opacity: 1 !important; display: block !important;`;
                        lastSetEndItem.innerHTML = `
                            <div style="color: #ffd700; font-size: 22px; margin-bottom: 8px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
                                ‚≠ê Á¨¨${match.setResults.length}Â±ÄÁªìÊùü ‚≠ê
                            </div>
                            <div style="color: #fff; font-size: 20px; margin: 8px 0; text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                                ${lastSetResult.myScore} - ${lastSetResult.opponentScore}
                            </div>
                            <div style="color: ${resultColor}; font-size: 18px; margin: 8px 0; text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                                ${resultText}
                            </div>
                            <div style="color: #ffd700; font-size: 18px; margin-top: 8px; text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                                Â§ßÂ±ÄÊØîÂàÜ: ${displayedMySets} : ${displayedOpponentSets}
                            </div>
                        `;
                        matchLog.appendChild(lastSetEndItem);
                        matchLog.scrollTop = matchLog.scrollHeight;
                        
                        // Êõ¥Êñ∞Ê†áÈ¢ò‰∏≠ÁöÑÂ§ßÂ±ÄÂàÜ
                        title.innerHTML = `üèê ${match.matchName}<br><span style="font-size: 18px; color: #ffd700;">Â§ßÂ±Ä: ${displayedMySets} : ${displayedOpponentSets}</span>`;
                        
                        // 2ÁßíÂêéÊòæÁ§∫ÊúÄÁªàÁªìÊûú
                        setTimeout(() => {
                            const finalWin = displayedMySets > displayedOpponentSets;
                            const finalResultItem = document.createElement('div');
                            finalResultItem.className = 'match-log-item';
                            const finalBgColor = finalWin ? 'rgba(46,204,113,0.6)' : 'rgba(231,76,60,0.6)';
                            const finalBorderColor = finalWin ? '#2ecc71' : '#e74c3c';
                            const finalIcon = finalWin ? 'üéâ' : 'üòî';
                            const finalText = finalWin ? '‰Ω†ÂèñÂæó‰∫ÜÊØîËµõÁöÑËÉúÂà©ÔºÅ' : 'ÂæàÈÅóÊÜæÔºåÊØîËµõÂ§±Ë¥•‰∫Ü...';
                            const finalTextColor = finalWin ? '#2ecc71' : '#e74c3c';
                            
                            // Âº∫Âà∂ÊòæÁ§∫Ôºå‰∏ç‰æùËµñÂä®Áîª
                            finalResultItem.style.cssText = `background: ${finalBgColor}; border: 4px solid ${finalBorderColor}; font-weight: bold; text-align: center; padding: 20px; margin: 15px 0; box-shadow: 0 6px 20px ${finalBgColor}; opacity: 1 !important; display: block !important;`;
                            finalResultItem.innerHTML = `
                                <div style="color: #ffd700; font-size: 28px; margin-bottom: 12px; text-shadow: 2px 2px 6px rgba(0,0,0,0.8);">
                                    ${finalIcon} ÊØîËµõÁªìÊùü ${finalIcon}
                                </div>
                                <div style="color: #fff; font-size: 24px; margin: 10px 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
                                    ÊúÄÁªàÂ§ßÂ±ÄÊØîÂàÜ
                                </div>
                                <div style="color: #ffd700; font-size: 32px; margin: 10px 0; font-weight: bold; text-shadow: 2px 2px 6px rgba(0,0,0,0.8);">
                                    ${displayedMySets} : ${displayedOpponentSets}
                                </div>
                                <div style="color: ${finalTextColor}; font-size: 20px; margin-top: 12px; text-shadow: 1px 1px 4px rgba(0,0,0,0.8);">
                                    ${finalText}
                                </div>
                            `;
                            matchLog.appendChild(finalResultItem);
                            matchLog.scrollTop = matchLog.scrollHeight;
                            
                            // ÂÜçÁ≠â3ÁßíÂêéÂÖ≥Èó≠ÂºπÁ™ó
                            setTimeout(() => {
                                modal.classList.remove('show');
                                // ÊÅ¢Â§çÈáéÁêÉÁöÑËÉåÊôØËâ≤
                                modalContent.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                                this.showFormalMatchResult();
                            }, 3000);
                        }, 2000);
                        
                        return;
                    }
                    
                    const log = match.scoreLog[currentIndex];
                    
                    // Ê£ÄÊü•ÊòØÂê¶ËøõÂÖ•Êñ∞ÁöÑ‰∏ÄÂ±Ä
                    if (log.set !== currentSetNumber) {
                        // ÊöÇÂÅúÂä®Áîª
                        isPaused = true;
                        
                        // ÊòæÁ§∫Â±ÄÂàÜÊèêÁ§∫
                        const setResult = match.setResults[currentSetNumber - 1];
                        const isWin = setResult.winner === 'my';
                        
                        if (isWin) {
                            displayedMySets++;
                        } else {
                            displayedOpponentSets++;
                        }
                        
                        // ÊòæÁ§∫Â±ÄÁªìÊùüÊèêÁ§∫
                        const setEndItem = document.createElement('div');
                        setEndItem.className = 'match-log-item';
                        const bgColor = isWin ? 'rgba(46,204,113,0.5)' : 'rgba(231,76,60,0.5)';
                        const borderColor = isWin ? '#2ecc71' : '#e74c3c';
                        const resultText = isWin ? '‚úÖ ËÉúÂà©' : '‚ùå Â§±Ë¥•';
                        const resultColor = isWin ? '#2ecc71' : '#e74c3c';
                        
                        // Âº∫Âà∂ÊòæÁ§∫Ôºå‰∏ç‰æùËµñÂä®Áîª
                        setEndItem.style.cssText = `background: ${bgColor}; border: 3px solid ${borderColor}; font-weight: bold; text-align: center; padding: 15px; margin: 10px 0; box-shadow: 0 4px 15px ${bgColor}; opacity: 1 !important; display: block !important;`;
                        setEndItem.innerHTML = `
                            <div style="color: #ffd700; font-size: 22px; margin-bottom: 8px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
                                ‚≠ê Á¨¨${currentSetNumber}Â±ÄÁªìÊùü ‚≠ê
                            </div>
                            <div style="color: #fff; font-size: 20px; margin: 8px 0; text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                                ${setResult.myScore} - ${setResult.opponentScore}
                            </div>
                            <div style="color: ${resultColor}; font-size: 18px; margin: 8px 0; text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                                ${resultText}
                            </div>
                            <div style="color: #ffd700; font-size: 18px; margin-top: 8px; text-shadow: 1px 1px 3px rgba(0,0,0,0.8);">
                                Â§ßÂ±ÄÊØîÂàÜ: ${displayedMySets} : ${displayedOpponentSets}
                            </div>
                        `;
                        matchLog.appendChild(setEndItem);
                        matchLog.scrollTop = matchLog.scrollHeight;
                        
                        currentSetNumber = log.set;
                        
                        // Êõ¥Êñ∞Ê†áÈ¢ò‰∏≠ÁöÑÂ§ßÂ±ÄÂàÜ
                        title.innerHTML = `üèê ${match.matchName}<br><span style="font-size: 18px; color: #ffd700;">Â§ßÂ±Ä: ${displayedMySets} : ${displayedOpponentSets}</span>`;
                        
                        // ÈáçÁΩÆÂ∞èÂ±ÄÊØîÂàÜÊòæÁ§∫
                        myScoreEl.textContent = '0';
                        opponentScoreEl.textContent = '0';
                        
                        // 2ÁßíÂêéÊòæÁ§∫"Á¨¨XÂ±ÄÂºÄÂßã"Âπ∂ÁªßÁª≠
                        setTimeout(() => {
                            this.showSetStartMessage(currentSetNumber, matchLog);
                            // ÂÜçÁ≠â1ÁßíÂêéÊÅ¢Â§çÂä®Áîª
                            setTimeout(() => {
                                isPaused = false;
                            }, 1000);
                        }, 2000);
                        
                        return;
                    }
                    
                    // Êõ¥Êñ∞ÊØîÂàÜÊòæÁ§∫
                    myScoreEl.textContent = log.myScore;
                    opponentScoreEl.textContent = log.opponentScore;
                    
                    // Ê∑ªÂä†ÂæóÂàÜËÆ∞ÂΩï
                    const logItem = document.createElement('div');
                    logItem.className = `match-log-item ${log.scorer === 'my' ? 'my-point' : 'opponent-point'}`;
                    
                    const scoreColor = log.scorer === 'my' ? '#2ecc71' : '#e74c3c';
                    logItem.innerHTML = `
                        <div class="match-log-score" style="color: ${scoreColor};">
                            ${log.myScore} : ${log.opponentScore}
                        </div>
                        <div class="match-log-description">${log.description}</div>
                    `;
                    
                    matchLog.appendChild(logItem);
                    matchLog.scrollTop = matchLog.scrollHeight;
                    
                    currentIndex++;
                }, 500); // Êîπ‰∏∫ÊØè0.5ÁßíÊòæÁ§∫‰∏ÄÂàÜÔºåÊõ¥‰ªéÂÆπ
            }
            
            // Êñ∞Â¢ûÔºöÊòæÁ§∫Â±ÄÂºÄÂßãÊèêÁ§∫
            showSetStartMessage(setNumber, matchLog) {
                const setStartItem = document.createElement('div');
                setStartItem.className = 'match-log-item';
                
                let setName = `Á¨¨${setNumber}Â±Ä`;
                let emoji = 'üèê';
                let specialStyle = '';
                
                if (setNumber === 5) {
                    setName = 'ÂÜ≥ËÉúÂ±Ä';
                    emoji = 'üî•';
                    specialStyle = 'background: linear-gradient(135deg, #ff6b6b 0%, #ffd700 100%); border: 3px solid #ff6b6b; box-shadow: 0 4px 15px rgba(255,107,107,0.5);';
                } else {
                    specialStyle = 'background: rgba(0,0,0,0.5); border: 2px solid #ffd700; box-shadow: 0 2px 10px rgba(255,215,0,0.3);';
                }
                
                // Âº∫Âà∂ÊòæÁ§∫Ôºå‰∏ç‰æùËµñÂä®Áîª
                setStartItem.style.cssText = `${specialStyle} font-weight: bold; text-align: center; padding: 15px; margin: 10px 0; opacity: 1 !important; display: block !important;`;
                
                setStartItem.innerHTML = `
                    <div style="color: #ffd700; font-size: 24px; padding: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
                        ${emoji} ${setName}ÂºÄÂßãÔºÅ${emoji}
                    </div>
                `;
                matchLog.appendChild(setStartItem);
                matchLog.scrollTop = matchLog.scrollHeight;
            }
            
            // Êñ∞Â¢ûÔºöÊòæÁ§∫Ê≠£ÂºèÊØîËµõÁªìÊûú
            showFormalMatchResult() {
                const match = this.currentMatch;
                const won = match.mySets > match.opponentSets;
                
                // Ê£ÄÊü•ÊòØÂê¶ÊòØÈî¶Ê†áËµõÊ®°Âºè
                if (match.matchType === 'tournament' && this.tournament.active) {
                    // Èî¶Ê†áËµõÊ®°ÂºèÔºöË∞ÉÁî®Èî¶Ê†áËµõÁªìÊûúÂ§ÑÁêÜ
                    this.onTournamentRoundComplete(won);
                    return;
                }
                
                // ÈùûÈî¶Ê†áËµõÊ®°ÂºèÔºöÂéüÊúâÈÄªËæë
                // ËÆ°ÁÆóË°®Áé∞ËØÑÁ∫ß
                const performance = this.evaluateMatchPerformance();
                
                // Ê†πÊçÆË°®Áé∞Á≠âÁ∫ßÊòæÁ§∫‰∏çÂêåÁªìÊûú
                this.showMatchResultByPerformance(performance, won);
            }
            
            // Êñ∞Â¢ûÔºöËØÑ‰º∞ÊØîËµõË°®Áé∞
            evaluateMatchPerformance() {
                const match = this.currentMatch;
                
                // Âü∫‰∫éÊØîËµõÁªìÊûúËÆ°ÁÆóË°®Áé∞ËØÑÂàÜ
                const mySets = match.mySets;
                const opponentSets = match.opponentSets;
                const totalSets = mySets + opponentSets;
                
                // ËÆ°ÁÆóÂ±ÄÂàÜ‰ºòÂäø
                const setAdvantage = mySets - opponentSets;
                
                // ËÆ°ÁÆóÊØèÂ±ÄÁöÑÂ∞èÂàÜÂ∑ÆË∑ù
                let totalPointDiff = 0;
                let dominantSets = 0;  // Â§ßÊØîÂàÜËé∑ËÉúÁöÑÂ±ÄÊï∞ÔºàÂ∑ÆË∑ù>=5ÂàÜÔºâ
                
                match.setResults.forEach(set => {
                    const pointDiff = set.myScore - set.opponentScore;
                    totalPointDiff += pointDiff;
                    
                    // Â¶ÇÊûúËµ¢‰∫ÜËøôÂ±Ä‰∏îÂàÜÂ∑Æ>=5ÔºåÁÆó‰Ωú‰∏ªÂØºÂ±Ä
                    if (set.winner === 'my' && pointDiff >= 5) {
                        dominantSets++;
                    }
                });
                
                const avgPointDiff = totalPointDiff / totalSets;
                
                // ÁªºÂêàËØÑÂàÜÈÄªËæëÔºö
                // 1. 3:0Êàñ3:1Ê®™Êâ´ ‚Üí excellent
                // 2. 3:2Èô©ËÉú‰ΩÜÊúâÂ§ö‰∏™‰∏ªÂØºÂ±Ä ‚Üí good
                // 3. 3:2Èô©ËÉú ‚Üí average
                // 4. Ëæì‰∫Ü ‚Üí Ê†πÊçÆÂ±ÄÂàÜÂíåÂ∞èÂàÜÂà§Êñ≠
                
                if (mySets >= 3) {
                    // Ëµ¢‰∫ÜÊØîËµõ
                    if (opponentSets === 0) {
                        // 3:0Ê®™Êâ´
                        return 'excellent';
                    } else if (opponentSets === 1) {
                        // 3:1Â§ßËÉú
                        return dominantSets >= 2 ? 'excellent' : 'good';
                    } else {
                        // 3:2Èô©ËÉú
                        return dominantSets >= 2 ? 'good' : 'average';
                    }
                } else {
                    // Ëæì‰∫ÜÊØîËµõ
                    if (mySets === 2) {
                        // 2:3ÊÉúË¥•
                        return avgPointDiff >= -2 ? 'average' : 'poor';
                    } else if (mySets === 1) {
                        // 1:3Â§±Âà©
                        return 'poor';
                    } else {
                        // 0:3ÊÉ®Ë¥•
                        return 'poor';
                    }
                }
            }
            
            // Êñ∞Â¢ûÔºöÊ†πÊçÆË°®Áé∞ÊòæÁ§∫ÊØîËµõÁªìÊûú
            showMatchResultByPerformance(performance, won) {
                const match = this.currentMatch;
                
                // ÊûÑÂª∫Â±ÄÂàÜÊòæÁ§∫
                let setsDisplay = `<div class="sets-result" style="margin: 20px 0;">`;
                setsDisplay += `<div class="final-sets" style="font-size: 28px; font-weight: bold; margin-bottom: 15px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">`;
                setsDisplay += `Â§ßÂ±ÄÊØîÂàÜÔºö<span style="color: #2ecc71;">${match.mySets}</span> : <span style="color: #e74c3c;">${match.opponentSets}</span>`;
                setsDisplay += `</div>`;
                setsDisplay += `<div class="set-details" style="font-size: 16px;">`;
                match.setResults.forEach((set, i) => {
                    const setClass = set.winner === 'my' ? 'won' : 'lost';
                    const color = set.winner === 'my' ? '#2ecc71' : '#e74c3c';
                    setsDisplay += `<div class="set-result ${setClass}" style="padding: 8px; margin: 5px 0; background: rgba(255,255,255,0.05); border-radius: 5px;">`;
                    setsDisplay += `Á¨¨${i+1}Â±Ä: <span style="color: ${color}; font-weight: bold;">${set.myScore}-${set.opponentScore}</span>`;
                    setsDisplay += `</div>`;
                });
                setsDisplay += `</div></div>`;
                
                // Ê†πÊçÆË°®Áé∞Á≠âÁ∫ßÁ°ÆÂÆöÂ•ñÂä±
                let rewards = this.getMatchRewards(match.matchType, performance, won);
                
                // ÊòæÁ§∫ÁªìÊûúÂú∫ÊôØ
                const resultText = this.getMatchResultText(match.matchType, performance, won, setsDisplay);
                
                // Ê£ÄÊü•ÊòØÂê¶ÊòØÊ†°ÈôÖËÅîËµõÔºàËß¶ÂèëÁªìÂ±ÄÔºâ
                if (match.matchType === 'universityLeague' && rewards.ending) {
                    // Ê†°ÈôÖËÅîËµõÁªìÊùüÔºåËß¶ÂèëÁªìÂ±Ä
                    SCENES.matchResult = {
                        text: resultText,
                        choices: [{
                            text: 'Êü•ÁúãÁªìÂ±Ä',
                            next: rewards.ending,  // Ë∑≥ËΩ¨Âà∞ÁªìÂ±ÄÂú∫ÊôØ
                            effect: rewards
                        }]
                    };
                } else {
                    // ÂÖ∂‰ªñÊØîËµõÔºåËøîÂõûÂë®ÈÄâÊã©ÔºåÂπ∂Êõ¥Êñ∞ÁõÆÊ†á
                    // Èô¢ÈôÖÊØîËµõÂêéÂàáÊç¢Âà∞Âä†ÂÖ•Ê†°ÈòüÁõÆÊ†á
                    if (match.matchType === 'collegeMatch') {
                        rewards.goalUpdate = 'universityTryout';
                    }
                    
                    SCENES.matchResult = {
                        text: resultText,
                        choices: [{
                            text: 'ÁªßÁª≠',
                            next: 'weeklyHub',
                            effect: rewards
                        }]
                    };
                }
                
                console.log('ÊòæÁ§∫ÊØîËµõÁªìÊûúÂú∫ÊôØ');
                this.showScene('matchResult');
            }
            
            // Êñ∞Â¢ûÔºöËé∑ÂèñÊØîËµõÂ•ñÂä±
            getMatchRewards(matchType, performance, won) {
                const rewards = {
                    reputation: 0,
                    serve: 0,
                    spike: 0,
                    block: 0,
                    dig: 0,
                    set: 0,
                    mood: 0,
                    stress: 0,
                    nextGoal: null
                };
                
                // Ê†πÊçÆÊØîËµõÁ±ªÂûãÂíåË°®Áé∞Á≠âÁ∫ßËÆæÁΩÆÂ•ñÂä±
                if (matchType === 'collegeMatch') {
                    rewards.nextGoal = 'universityTryout';
                    if (performance === 'excellent') {
                        rewards.reputation = 40;
                        rewards.serve = rewards.spike = rewards.block = rewards.dig = rewards.set = 8;
                        rewards.mood = 25;
                        rewards.stress = -15;
                    } else if (performance === 'good') {
                        rewards.reputation = 30;
                        rewards.serve = rewards.spike = rewards.block = rewards.dig = rewards.set = 5;
                        rewards.mood = 20;
                        rewards.stress = -10;
                    } else if (performance === 'average') {
                        rewards.reputation = 15;
                        rewards.serve = rewards.spike = rewards.block = 3;
                        rewards.mood = 5;
                        rewards.stress = 5;
                    } else {
                        rewards.reputation = 5;
                        rewards.mood = -20;
                        rewards.stress = 15;
                    }
                } else if (matchType === 'universityLeague') {
                    // Ê†°ÈôÖËÅîËµõÔºöÊ†πÊçÆË°®Áé∞Ëß¶Âèë‰∏çÂêåÁªìÂ±Ä
                    if (performance === 'excellent') {
                        rewards.reputation = 70;
                        rewards.serve = rewards.spike = rewards.block = rewards.dig = rewards.set = 12;
                        rewards.mood = 30;
                        rewards.stress = -20;
                        rewards.ending = 'champion';  // ÂÜ†ÂÜõÁªìÂ±Ä
                    } else if (performance === 'good') {
                        rewards.reputation = 50;
                        rewards.serve = rewards.spike = rewards.block = rewards.dig = rewards.set = 8;
                        rewards.mood = 25;
                        rewards.stress = -15;
                        rewards.ending = 'runner_up';  // ‰∫öÂÜõÁªìÂ±Ä
                    } else if (performance === 'average') {
                        rewards.reputation = 25;
                        rewards.serve = rewards.spike = rewards.block = rewards.dig = rewards.set = 5;
                        rewards.mood = 10;
                        rewards.stress = 5;
                        rewards.ending = 'participant';  // ÂèÇ‰∏éÁªìÂ±Ä
                    } else {
                        rewards.reputation = 10;
                        rewards.mood = -25;
                        rewards.stress = 20;
                        rewards.ending = 'early_exit';  // Êó©ÈÄÄÁªìÂ±Ä
                    }
                }
                
                return rewards;
            }
            
            // Êñ∞Â¢ûÔºöËé∑ÂèñÊØîËµõÁªìÊûúÊñáÊú¨
            getMatchResultText(matchType, performance, won, setsDisplay) {
                let matchName = '';
                if (matchType === 'collegeMatch') matchName = 'Èô¢ÈôÖÊØîËµõ';
                else if (matchType === 'universityLeague') matchName = 'Ê†°ÈôÖËÅîËµõ';
                
                let text = `<h2>üèê ${matchName}</h2>`;
                
                // ÊòæÁ§∫Â§ßÂ±ÄÂàÜÔºàÂä†Â§ßÂ≠ó‰ΩìÔºâ
                text += `<div style="font-size: 32px; font-weight: bold; margin: 20px 0; color: ${won ? '#2ecc71' : '#e74c3c'};">`;
                text += won ? 'üéâ ËÉúÂà©ÔºÅ' : 'üòî Â§±Ë¥•';
                text += `</div>`;
                
                text += setsDisplay;
                
                // Ê†πÊçÆËÉúË¥üÂíåË°®Áé∞ÊòæÁ§∫‰∏çÂêåÊñáÊú¨
                if (won) {
                    if (performance === 'excellent') {
                        text += `<p><strong>üåü MVPË°®Áé∞ÔºÅ</strong></p>`;
                        text += `<p>‰Ω†Âú®ÊØîËµõ‰∏≠Ë°®Áé∞Âá∫Ëâ≤ÔºåÂÆåÂÖ®‰∏ªÂØº‰∫ÜÊØîËµõÔºÅ</p>`;
                        text += `<p>ËßÇ‰ºó‰ª¨‰∏∫‰Ω†Ê¨¢ÂëºÔºåÊïôÁªÉÂØπ‰Ω†Ëµû‰∏çÁªùÂè£ÔºÅ</p>`;
                    } else if (performance === 'good') {
                        text += `<p><strong>‚ú® Âá∫Ëâ≤Ë°®Áé∞ÔºÅ</strong></p>`;
                        text += `<p>‰Ω†Âú®ÊØîËµõ‰∏≠ÂèëÊå•Á®≥ÂÆöÔºåÂ∏ÆÂä©ÁêÉÈòüËé∑ÂæóËÉúÂà©ÔºÅ</p>`;
                        text += `<p>ÈòüÂèã‰ª¨ÂØπ‰Ω†Á´ñËµ∑Â§ßÊãáÊåáÔºÅ</p>`;
                    } else if (performance === 'average') {
                        text += `<p><strong>üìä Èô©ËÉú</strong></p>`;
                        text += `<p>ÊØîËµõÂæàÊøÄÁÉàÔºå‰Ω†ÁöÑË°®Áé∞‰∏≠ËßÑ‰∏≠Áü©Ôºå‰ΩÜÊúÄÁªàËµ¢Âæó‰∫ÜÊØîËµõ„ÄÇ</p>`;
                        text += `<p>ËøòÊúâÊèêÂçáÁöÑÁ©∫Èó¥ÔºåÁªßÁª≠Âä™ÂäõÔºÅ</p>`;
                    } else {
                        text += `<p><strong>üçÄ Âπ∏ËøêËé∑ËÉú</strong></p>`;
                        text += `<p>ËôΩÁÑ∂‰Ω†ÁöÑÂèëÊå•‰∏çÂ§™ÁêÜÊÉ≥Ôºå‰ΩÜÈòüÂèã‰ª¨Â∏ÆÂä©‰Ω†Ëµ¢Âæó‰∫ÜÊØîËµõ„ÄÇ</p>`;
                        text += `<p>ÈúÄË¶ÅÊõ¥Â§öÁöÑËÆ≠ÁªÉÊù•ÊèêÂçáÂÆûÂäõ„ÄÇ</p>`;
                    }
                } else {
                    if (performance === 'excellent') {
                        text += `<p><strong>üí™ ËôΩË¥•ÁäπËç£</strong></p>`;
                        text += `<p>‰Ω†Ë°®Áé∞Âá∫Ëâ≤Ôºå‰ΩÜÂØπÊâãÊõ¥Âº∫„ÄÇËøôÊòØ‰∏ÄÂú∫Á≤æÂΩ©ÁöÑÊØîËµõÔºÅ</p>`;
                        text += `<p>ÁªßÁª≠‰øùÊåÅÔºå‰Ω†‰ºöÂèòÂæóÊõ¥Âº∫ÔºÅ</p>`;
                    } else if (performance === 'good') {
                        text += `<p><strong>üòî ÊÉúË¥•</strong></p>`;
                        text += `<p>‰Ω†ÂèëÊå•‰∏çÈîôÔºå‰ΩÜÂØπÊâãÁï•ËÉú‰∏ÄÁ≠π„ÄÇ</p>`;
                        text += `<p>ÁªßÁª≠Âä™ÂäõÔºå‰∏ãÊ¨°‰∏ÄÂÆöËÉΩËµ¢ÔºÅ</p>`;
                    } else if (performance === 'average') {
                        text += `<p><strong>üìâ Ë°®Áé∞‰∏ÄËà¨</strong></p>`;
                        text += `<p>ÊØîËµõÂæàÊøÄÁÉàÔºå‰ΩÜ‰Ω†ÁöÑË°®Áé∞‰∏çÂ§üÂá∫Ëâ≤„ÄÇ</p>`;
                        text += `<p>ÈúÄË¶ÅÊõ¥Â§öËÆ≠ÁªÉÊù•ÊèêÂçáÂÆûÂäõ„ÄÇ</p>`;
                    } else {
                        text += `<p><strong>üòû Ë°®Áé∞‰∏ç‰Ω≥</strong></p>`;
                        text += `<p>ËøôÂú∫ÊØîËµõ‰Ω†ÁöÑÂèëÊå•‰∏çÂ§™ÁêÜÊÉ≥ÔºåËæìÊéâ‰∫ÜÊØîËµõ„ÄÇ</p>`;
                        text += `<p>‰∏çË¶ÅÊ∞îÈ¶ÅÔºåÂä†Âº∫ËÆ≠ÁªÉÔºå‰∏ãÊ¨°‰ºöÊõ¥Â•ΩÔºÅ</p>`;
                    }
                }
                
                return text;
            }
            
            showFinalMatchResult() {
                const match = this.currentMatch;
                const won = match.myScore >= match.targetScore;
                
                const title = document.getElementById('match-modal-title');
                const choicesDiv = document.getElementById('match-modal-choices');
                const skipBtn = document.getElementById('skip-match-btn');
                
                // ÈöêËóèË∑≥ËøáÊåâÈíÆ
                skipBtn.style.display = 'none';
                
                // Êõ¥Êñ∞Ê†áÈ¢ò
                title.textContent = won ? 'üéâ ËÉúÂà©ÔºÅ' : 'üòî Â§±Ë¥•';
                
                // Êõ¥Êñ∞ÊØîËµõÁªüËÆ°
                this.player.matchesPlayed = (this.player.matchesPlayed || 0) + 1;
                if (won) {
                    this.player.matchesWon = (this.player.matchesWon || 0) + 1;
                }
                
                // ËÆ°ÁÆóÊØîËµõË°®Áé∞ËØÑÂàÜÔºàÁÆÄÂåñÁâàÔºâ
                const performanceRating = this.calculateMatchPerformance(match, won);
                this.player.performanceHistory.push(performanceRating);
                
                // Êõ¥Êñ∞Âπ≥ÂùáË°®Áé∞
                if (this.player.performanceHistory.length > 0) {
                    this.player.averagePerformance = Math.round(
                        this.player.performanceHistory.reduce((a, b) => a + b, 0) / 
                        this.player.performanceHistory.length
                    );
                }
                
                // ËÆ°ÁÆóÂ•ñÂä±
                const rewards = this.calculateMatchRewards(won, performanceRating);
                
                // ÊòæÁ§∫ÁªìÊûúÊåâÈíÆ
                choicesDiv.innerHTML = '';
                
                // Ê∑ªÂä†ÁªìÊûúËØ¥Êòé
                const resultDiv = document.createElement('div');
                resultDiv.style.cssText = 'margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px; text-align: center;';
                resultDiv.innerHTML = `
                    <h3 style="margin-bottom: 10px;">${won ? 'ÊÅ≠ÂñúËé∑ËÉúÔºÅ' : 'ËôΩË¥•ÁäπËç£ÔºÅ'}</h3>
                    <p style="margin-bottom: 10px;">${rewards.message}</p>
                    <p style="font-size: 14px; color: #f39c12;">üìä Êú¨Âú∫Ë°®Áé∞ËØÑÂàÜÔºö${performanceRating}/100</p>
                    <div style="text-align: left; font-size: 14px; margin-top: 15px;">
                        <strong>üí´ ÊØîËµõÊî∂Ëé∑Ôºö</strong><br>
                        ${rewards.serve > 0 ? `üéØ ÂèëÁêÉ +${rewards.serve}<br>` : ''}
                        ${rewards.spike > 0 ? `‚ö° Êâ£ÁêÉ +${rewards.spike}<br>` : ''}
                        ${rewards.block > 0 ? `üõ°Ô∏è Êã¶ÁΩë +${rewards.block}<br>` : ''}
                        ${rewards.dig > 0 ? `ü§∏ Âû´ÁêÉ +${rewards.dig}<br>` : ''}
                        ${rewards.set > 0 ? `üôå ÊâòÁêÉ +${rewards.set}<br>` : ''}
                        ${rewards.energy !== 0 ? `üí™ ‰ΩìÂäõ ${rewards.energy > 0 ? '+' : ''}${rewards.energy}<br>` : ''}
                        ${rewards.mood !== 0 ? `üòä ÂøÉÊÉÖ ${rewards.mood > 0 ? '+' : ''}${rewards.mood}<br>` : ''}
                        ${rewards.stress !== 0 ? `üò∞ ÂéãÂäõ ${rewards.stress > 0 ? '+' : ''}${rewards.stress}<br>` : ''}
                        ${rewards.reputation > 0 ? `‚≠ê Â£∞Êúõ +${rewards.reputation}<br>` : ''}
                        ${rewards.reputation < 0 ? `‚≠ê Â£∞Êúõ ${rewards.reputation}<br>` : ''}
                    </div>
                `;
                choicesDiv.appendChild(resultDiv);
                
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.textContent = 'Á°ÆÂÆö';
                button.onclick = () => {
                    // Â∫îÁî®Â•ñÂä±
                    this.applyEffect(rewards);
                    
                    // ÂÖ≥Èó≠ÂºπÁ™ó
                    const modal = document.getElementById('match-modal');
                    modal.classList.remove('show');
                    
                    // Êõ¥Êñ∞ÁõÆÊ†áÊòæÁ§∫
                    this.updateGoalDisplay();
                    
                    // ËøîÂõûÂë®ÈÄâÊã©
                    this.currentScene = 'weeklyHub';
                    this.showScene('weeklyHub');
                };
                
                choicesDiv.appendChild(button);
            }
            
            // Êñ∞Â¢ûÔºöËÆ°ÁÆóÊØîËµõË°®Áé∞ËØÑÂàÜ
            calculateMatchPerformance(match, won) {
                // Âü∫Á°ÄÂàÜÔºöÊ†πÊçÆÊØîÂàÜÂ∑ÆË∑ù
                const scoreDiff = match.myScore - match.opponentScore;
                let baseScore = 50;
                
                if (won) {
                    baseScore = 60 + Math.min(scoreDiff * 2, 20); // 60-80ÂàÜ
                } else {
                    baseScore = 40 + Math.max(scoreDiff * 2, -20); // 20-40ÂàÜ
                }
                
                // ÊäÄËÉΩÂä†ÊàêÔºöÂπ≥ÂùáÊäÄËÉΩË∂äÈ´òÔºåË°®Áé∞Ë∂äÂ•Ω
                const avgSkill = (
                    this.player.skills.serve +
                    this.player.skills.spike +
                    this.player.skills.block +
                    this.player.skills.dig +
                    this.player.skills.set
                ) / 5;
                
                const skillBonus = Math.min(avgSkill / 5, 20); // ÊúÄÂ§ö+20ÂàÜ
                
                const finalScore = Math.round(Math.min(baseScore + skillBonus, 100));
                return finalScore;
            }
            
            calculateMatchRewards(won, performanceRating) {
                const match = this.currentMatch;
                const isCasual = match.type === 'casual';
                
                if (won) {
                    return {
                        message: isCasual ? 
                            'ÈÄöËøáÂÆûÊàòÔºå‰Ω†ÁöÑÊäÄËÉΩÂæóÂà∞‰∫ÜÊèêÂçáÔºÅ' :
                            'Ëµ¢ÂæóÊØîËµõËÆ©‰Ω†‰ø°ÂøÉÂ§ßÂ¢ûÔºåÊäÄËÉΩÂíåÂ£∞ÊúõÈÉΩÊúâÊèêÂçáÔºÅ',
                        serve: isCasual ? 1 : 4,
                        spike: isCasual ? 1 : 4,
                        block: isCasual ? 1 : 3,
                        dig: isCasual ? 1 : 4,
                        set: isCasual ? 1 : 3,
                        energy: isCasual ? 0 : -15,  // ÈáéÁêÉ‰∏çÈ¢ùÂ§ñÊ∂àËÄó‰ΩìÂäõÔºåÊ≠£ÂºèÊØîËµõÊ∂àËÄó
                        mood: isCasual ? 10 : 20,
                        stress: isCasual ? -5 : -12,
                        reputation: isCasual ? 1 : 6
                    };
                } else {
                    const rewards = {
                        message: isCasual ?
                            'ËôΩÁÑ∂Ëæì‰∫ÜÔºå‰ΩÜ‰Ω†‰ªéÊØîËµõ‰∏≠Â≠¶Âà∞‰∫ÜÂæàÂ§ö„ÄÇ' :
                            'Â§±Ë¥•ÊòØÊàêÂäü‰πãÊØçÔºå‰Ω†‰ªéËøôÂú∫ÊØîËµõ‰∏≠Âê∏Âèñ‰∫ÜÁªèÈ™å„ÄÇ',
                        serve: isCasual ? 0 : 2,
                        spike: isCasual ? 0 : 2,
                        block: isCasual ? 0 : 1,
                        dig: isCasual ? 0 : 2,
                        set: isCasual ? 0 : 1,
                        energy: isCasual ? 0 : -12,  // ÈáéÁêÉ‰∏çÈ¢ùÂ§ñÊ∂àËÄó‰ΩìÂäõÔºåÊ≠£ÂºèÊØîËµõÊ∂àËÄó
                        mood: isCasual ? -3 : -10,
                        stress: isCasual ? 3 : 8,
                        reputation: isCasual ? 0 : -2
                    };
                    
                    // ÈáéÁêÉÂ§±Ë¥•‰πüÊúâÊî∂Ëé∑ÔºöÈöèÊú∫2‰∏™ÊäÄËÉΩ+1
                    if (isCasual) {
                        const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                        const shuffled = skills.sort(() => Math.random() - 0.5);
                        const selectedSkills = shuffled.slice(0, 2);
                        
                        selectedSkills.forEach(skill => {
                            rewards[skill] = (rewards[skill] || 0) + 1;
                        });
                        
                        console.log('ÈáéÁêÉÂ§±Ë¥•Â•ñÂä± - ÈöèÊú∫ÊäÄËÉΩ:', selectedSkills, 'ÂÆåÊï¥Â•ñÂä±:', rewards);
                    }
                    
                    return rewards;
                }
            }
            
            // ====================================================
            // Èî¶Ê†áËµõÁ≥ªÁªü
            // ====================================================
            
            // ÂºÄÂßãÈî¶Ê†áËµõ
            startTournament(type) {
                console.log('=== ÂºÄÂßãÈî¶Ê†áËµõ ===');
                console.log('Á±ªÂûã:', type);
                
                this.tournament = {
                    active: true,
                    type: type,
                    currentRound: 'round16',
                    roundsCompleted: [],
                    matchesWon: 0,
                    matchesLost: 0,
                    eliminated: false,
                    finalRank: null
                };
                
                // ÊòæÁ§∫Èî¶Ê†áËµõÂºÄÂπïÂú∫ÊôØ
                this.showScene('tournamentStart');
            }
            
            // ÂºÄÂßãÊüê‰∏ÄËΩÆÊØîËµõ
            startTournamentRound(roundId) {
                console.log('=== ÂºÄÂßãÈî¶Ê†áËµõËΩÆÊ¨° ===');
                console.log('ËΩÆÊ¨°:', roundId);
                
                this.tournament.currentRound = roundId;
                const roundInfo = this.TOURNAMENT_ROUNDS[roundId];
                
                // ÊòæÁ§∫ËΩÆÊ¨°ÂºÄÂßãÂú∫ÊôØ
                SCENES[`roundStart_${roundId}`] = {
                    text: this.getRoundStartText(roundInfo),
                    choices: [
                        {
                            text: 'ÂºÄÂßãÊØîËµõ',
                            next: null,  // ‰∏çË∑≥ËΩ¨Âú∫ÊôØ
                            effect: () => {
                                // Áõ¥Êé•ÂºÄÂßã‰∫îÂ±Ä‰∏âËÉúÊØîËµõ
                                this.startFormalMatch('tournament', roundInfo.name);
                            }
                        }
                    ]
                };
                
                this.showScene(`roundStart_${roundId}`);
            }
            
            // Ëé∑ÂèñËΩÆÊ¨°ÂºÄÂßãÊñáÊú¨
            getRoundStartText(roundInfo) {
                const progress = this.renderTournamentProgress();
                const opponentStars = '‚òÖ'.repeat(Math.floor(roundInfo.opponentStrength / 20)) + 
                                     '‚òÜ'.repeat(5 - Math.floor(roundInfo.opponentStrength / 20));
                
                let coachTip = '';
                if (roundInfo.id === 'round16') {
                    coachTip = '"ËøôÊòØÂçïË¥•Ê∑òÊ±∞ÔºåËæì‰∫ÜÂ∞±ÂõûÂÆ∂„ÄÇÂÖ®Âäõ‰ª•Ëµ¥Ôºå‰∏çÁïôÈÅóÊÜæÔºÅ"';
                } else if (roundInfo.id === 'round8') {
                    coachTip = '"‰Ω†Â∑≤ÁªèËØÅÊòé‰∫ÜËá™Â∑±ÁöÑÂÆûÂäõ„ÄÇÁªßÁª≠‰øùÊåÅÔºåÁ®≥ÊâéÁ®≥ÊâìÔºÅ"';
                } else if (roundInfo.id === 'round4') {
                    coachTip = '"ÂçäÂÜ≥Ëµõ‰∫ÜÔºÅË∑ùÁ¶ªÂÜ†ÂÜõÂè™Êúâ‰∏§Ê≠•‰πãÈÅ•ÔºåÂä†Ê≤πÔºÅ"';
                } else if (roundInfo.id === 'final') {
                    coachTip = '"‰Ω†Â∑≤ÁªèËØÅÊòé‰∫ÜËá™Â∑±„ÄÇÁé∞Âú®ÔºåÂéªÊãø‰∏ãÈÇ£Â∫ßÂÜ†ÂÜõÂ•ñÊùØÂêßÔºÅ"';
                }
                
                let text = `<h2>${roundInfo.emoji} ${roundInfo.name}</h2>`;
                text += `<div style="margin: 20px 0;">`;
                text += `<h3>üèÜ Èî¶Ê†áËµõËøõÂ∫¶</h3>`;
                text += `<p>‚úÖ Â∑≤ÊôãÁ∫ßÔºö${this.tournament.roundsCompleted.length}ËΩÆ</p>`;
                text += `<p>üìç ÂΩìÂâçËΩÆÊ¨°Ôºö${roundInfo.shortName}</p>`;
                if (roundInfo.nextRound) {
                    const nextRoundInfo = this.TOURNAMENT_ROUNDS[roundInfo.nextRound];
                    text += `<p>üéØ ‰∏ã‰∏ÄËΩÆÔºö${nextRoundInfo.shortName}</p>`;
                }
                text += `</div>`;
                
                text += progress;
                
                text += `<div style="margin: 20px 0;">`;
                text += `<p><strong>üí™ ÂØπÊâãÂÆûÂäõÔºö${opponentStars}</strong></p>`;
                
                if (roundInfo.id === 'round16') {
                    text += `<p>ËøôÊòØ‰Ω†ÁöÑÁ¨¨‰∏ÄÂú∫Ê∑òÊ±∞ËµõÔºåÂØπÊâãÂÆûÂäõ‰∏≠Á≠âÂÅè‰∏ä„ÄÇ‰øùÊåÅÂÜ∑ÈùôÔºåÂèëÊå•ÂÆûÂäõÔºÅ</p>`;
                } else if (roundInfo.id === 'round8') {
                    text += `<p>ËøõÂÖ•8Âº∫ÔºåÂØπÊâãÂÆûÂäõÊòéÊòæÊèêÂçá„ÄÇÈúÄË¶ÅÊõ¥Âä†‰∏ìÊ≥®ÂíåÂä™ÂäõÔºÅ</p>`;
                } else if (roundInfo.id === 'round4') {
                    text += `<p>ÂçäÂÜ≥ËµõÁöÑÂØπÊâãÈùûÂ∏∏Âº∫Â§ßÔºåËøôÂ∞ÜÊòØ‰∏ÄÂú∫Á°¨‰ªóÔºÅ</p>`;
                } else if (roundInfo.id === 'final') {
                    text += `<p>ÂÜ≥ËµõÂØπÊâãÊòØÊú¨Â±äËÅîËµõÊúÄÂº∫ÁöÑÈòü‰ºçÔºÅËøôÂ∞ÜÊòØ‰∏ÄÂú∫Âè≤ËØóÁ∫ßÁöÑÂØπÂÜ≥ÔºÅ</p>`;
                    text += `<p style="margin-top: 10px;">üéØ <strong>ËÉúÂà© ‚Üí üèÜ ÂÜ†ÂÜõ</strong></p>`;
                    text += `<p>üòî <strong>Â§±Ë¥• ‚Üí ü•à ‰∫öÂÜõ</strong></p>`;
                }
                text += `</div>`;
                
                text += `<div style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">`;
                text += `<p><strong>üí° ÊïôÁªÉÊèêÈÜíÔºö</strong></p>`;
                text += `<p>${coachTip}</p>`;
                text += `</div>`;
                
                return text;
            }
            
            // Ê∏≤ÊüìÈî¶Ê†áËµõËøõÂ∫¶Êù°
            renderTournamentProgress() {
                const rounds = ['round16', 'round8', 'round4', 'final'];
                const currentIndex = rounds.indexOf(this.tournament.currentRound);
                
                let html = `<div style="margin: 20px 0; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px;">`;
                html += `<div style="display: flex; justify-content: space-between; align-items: center; font-size: 14px;">`;
                
                rounds.forEach((roundId, index) => {
                    const roundInfo = this.TOURNAMENT_ROUNDS[roundId];
                    let status = '';
                    let color = '#666';
                    
                    if (this.tournament.roundsCompleted.includes(roundId)) {
                        status = '‚úÖ';
                        color = '#2ecc71';
                    } else if (roundId === this.tournament.currentRound) {
                        status = 'üìç';
                        color = '#f39c12';
                    } else {
                        status = '‚≠ï';
                        color = '#666';
                    }
                    
                    html += `<div style="text-align: center; flex: 1;">`;
                    html += `<div style="font-size: 20px;">${status}</div>`;
                    html += `<div style="color: ${color}; margin-top: 5px;">${roundInfo.shortName}</div>`;
                    html += `</div>`;
                    
                    if (index < rounds.length - 1) {
                        html += `<div style="color: #666;">‚Üí</div>`;
                    }
                });
                
                html += `<div style="text-align: center; flex: 1;">`;
                html += `<div style="font-size: 20px;">üèÜ</div>`;
                html += `<div style="color: #ffd700; margin-top: 5px;">ÂÜ†ÂÜõ</div>`;
                html += `</div>`;
                
                html += `</div></div>`;
                
                return html;
            }
            
            // ËΩÆÊ¨°ÊØîËµõÁªìÊùü
            onTournamentRoundComplete(won) {
                console.log('=== ËΩÆÊ¨°ÊØîËµõÁªìÊùü ===');
                console.log('ËÉúÂà©:', won);
                
                const roundInfo = this.TOURNAMENT_ROUNDS[this.tournament.currentRound];
                
                if (won) {
                    // ÊôãÁ∫ß
                    this.tournament.matchesWon++;
                    this.tournament.roundsCompleted.push(this.tournament.currentRound);
                    
                    // ÊòæÁ§∫ÊôãÁ∫ßÁïåÈù¢
                    this.showTournamentRoundResult(true, roundInfo);
                } else {
                    // Ê∑òÊ±∞
                    this.tournament.matchesLost++;
                    this.tournament.eliminated = true;
                    this.tournament.finalRank = roundInfo.eliminationRank;
                    
                    // ÊòæÁ§∫Ê∑òÊ±∞ÁïåÈù¢
                    this.showTournamentRoundResult(false, roundInfo);
                }
            }
            
            // ÊòæÁ§∫ËΩÆÊ¨°ÁªìÊûú
            showTournamentRoundResult(won, roundInfo) {
                const match = this.currentMatch;
                
                // ÊûÑÂª∫Â±ÄÂàÜÊòæÁ§∫
                let setsDisplay = `<div class="sets-result" style="margin: 20px 0;">`;
                setsDisplay += `<div class="final-sets" style="font-size: 24px; font-weight: bold; margin-bottom: 15px;">`;
                setsDisplay += `Â§ßÂ±ÄÊØîÂàÜÔºö<span style="color: #2ecc71;">${match.mySets}</span> : <span style="color: #e74c3c;">${match.opponentSets}</span>`;
                setsDisplay += `</div>`;
                setsDisplay += `<div class="set-details" style="font-size: 14px;">`;
                match.setResults.forEach((set, i) => {
                    const color = set.winner === 'my' ? '#2ecc71' : '#e74c3c';
                    setsDisplay += `<div style="padding: 5px; margin: 3px 0;">`;
                    setsDisplay += `Á¨¨${i+1}Â±Ä: <span style="color: ${color}; font-weight: bold;">${set.myScore}-${set.opponentScore}</span>`;
                    if (set.winner === 'my') setsDisplay += ` ‚úÖ`;
                    else setsDisplay += ` ‚ùå`;
                    setsDisplay += `</div>`;
                });
                setsDisplay += `</div></div>`;
                
                // ËÆ°ÁÆóÂ•ñÂä±
                const rewards = this.getTournamentRoundRewards(won, roundInfo);
                
                let text = '';
                if (won) {
                    text = `<h2>üéâ ÊôãÁ∫ßÊàêÂäüÔºÅ</h2>`;
                    text += `<h3>${roundInfo.emoji} ${roundInfo.name}</h3>`;
                    text += setsDisplay;
                    text += `<p><strong>‚≠ê Âá∫Ëâ≤Ë°®Áé∞ÔºÅ</strong></p>`;
                    text += `<p>‰Ω†Âú®ÊØîËµõ‰∏≠ÂèëÊå•Á®≥ÂÆöÔºåÊàêÂäüÊàòËÉúÂØπÊâãÔºåÊôãÁ∫ß‰∏ã‰∏ÄËΩÆÔºÅ</p>`;
                } else {
                    text = `<h2>üòî ÈÅóÊÜæÂá∫Â±Ä</h2>`;
                    text += `<h3>${roundInfo.emoji} ${roundInfo.name}</h3>`;
                    text += setsDisplay;
                    text += `<p>ËôΩÁÑ∂‰Ω†Âä™ÂäõÊãºÊêèÔºå‰ΩÜÂØπÊâãÊõ¥ËÉú‰∏ÄÁ≠π„ÄÇ‰Ω†ÁöÑÊ†°ÈôÖËÅîËµõ‰πãÊóÖÊ≠¢Ê≠•‰∫éÊ≠§„ÄÇ</p>`;
                }
                
                // ÊòæÁ§∫Â•ñÂä±
                text += `<div style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">`;
                text += `<p><strong>üí´ ÊØîËµõÊî∂Ëé∑Ôºö</strong></p>`;
                text += `<div style="text-align: left; font-size: 14px;">`;
                
                // Âè™ÊòæÁ§∫ÈùûÈõ∂ÁöÑÊäÄËÉΩÂ•ñÂä±
                const hasSkillRewards = rewards.serve > 0 || rewards.spike > 0 || rewards.block > 0 || 
                                       rewards.dig > 0 || rewards.set > 0;
                
                if (hasSkillRewards) {
                    if (rewards.serve > 0) text += `üéØ ÂèëÁêÉ +${rewards.serve}<br>`;
                    if (rewards.spike > 0) text += `‚ö° Êâ£ÁêÉ +${rewards.spike}<br>`;
                    if (rewards.block > 0) text += `üõ°Ô∏è Êã¶ÁΩë +${rewards.block}<br>`;
                    if (rewards.dig > 0) text += `ü§∏ Âû´ÁêÉ +${rewards.dig}<br>`;
                    if (rewards.set > 0) text += `ÔøΩ ÊâòÁêÉ +${rewards.set}<br>`;
                }
                
                // Â£∞Êúõ„ÄÅÂøÉÊÉÖ„ÄÅÂéãÂäõÂßãÁªàÊòæÁ§∫ÔºàÂèØËÉΩ‰∏∫Ë¥üÔºâ
                if (rewards.reputation !== 0) text += `‚≠ê Â£∞Êúõ ${rewards.reputation > 0 ? '+' : ''}${rewards.reputation}<br>`;
                if (rewards.mood !== 0) text += `üòä ÂøÉÊÉÖ ${rewards.mood > 0 ? '+' : ''}${rewards.mood}<br>`;
                if (rewards.stress !== 0) text += `üò∞ ÂéãÂäõ ${rewards.stress > 0 ? '+' : ''}${rewards.stress}<br>`;
                
                text += `</div></div>`;
                
                if (won) {
                    // Ê£ÄÊü•ÊòØÂê¶ÊòØÂÜ≥Ëµõ
                    if (!roundInfo.nextRound) {
                        // ÂÜ≥ËµõËÉúÂà©ÔºöÊòæÁ§∫ÂÜ†ÂÜõÁ•ùË¥∫
                        text += `<div style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); border-radius: 10px; border: 3px solid #ffd700;">`;
                        text += `<h3 style="color: #000; font-size: 24px; margin-bottom: 10px;">üèÜ ÊÅ≠ÂñúÂ§∫ÂÜ†ÔºÅüèÜ</h3>`;
                        text += `<p style="color: #333; font-size: 16px;">‰Ω†ÊàòËÉú‰∫ÜÊâÄÊúâÂØπÊâãÔºåÁ´ô‰∏ä‰∫ÜÊúÄÈ´òÈ¢ÜÂ•ñÂè∞ÔºÅ</p>`;
                        text += `<p style="color: #333; font-size: 16px;">‰ªé16Âº∫Âà∞ÂÜ†ÂÜõÔºå‰Ω†Áî®ÂÆûÂäõËØÅÊòé‰∫ÜËá™Â∑±ÔºÅ</p>`;
                        text += `</div>`;
                    } else {
                        // ÈùûÂÜ≥ËµõÔºöÊòæÁ§∫ËøõÂ∫¶Êõ¥Êñ∞
                        text += `<div style="margin: 20px 0;">`;
                        text += `<h3>üèÜ Èî¶Ê†áËµõËøõÂ∫¶Êõ¥Êñ∞</h3>`;
                        text += `<p>‚úÖ Â∑≤ÊôãÁ∫ßÔºö${this.tournament.roundsCompleted.length}ËΩÆ`;
                        
                        const nextRoundInfo = this.TOURNAMENT_ROUNDS[roundInfo.nextRound];
                        text += ` ÔºàËøõÂÖ•${nextRoundInfo.shortName}Ôºâ</p>`;
                        text += `<p>üìç ‰∏ã‰∏ÄËΩÆÔºö${nextRoundInfo.name}</p>`;
                        text += `</div>`;
                        
                        text += this.renderTournamentProgress();
                    }
                } else {
                    // Ê∑òÊ±∞ÔºöÊòæÁ§∫ÊúÄÁªàÊàêÁª©
                    let rankText = '';
                    if (roundInfo.eliminationRank === 'top16') rankText = '16Âº∫';
                    else if (roundInfo.eliminationRank === 'top8') rankText = '8Âº∫';
                    else if (roundInfo.eliminationRank === 'top4') rankText = '4Âº∫';
                    else if (roundInfo.eliminationRank === 'runner_up') rankText = '‰∫öÂÜõ';
                    
                    text += `<div style="margin: 20px 0; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px;">`;
                    text += `<p><strong>üèÜ ÊúÄÁªàÊàêÁª©Ôºö${rankText}</strong></p>`;
                    text += `<p>"ËôΩÁÑ∂ÁªìÊûú‰∏çÂ∞ΩÂ¶Ç‰∫∫ÊÑèÔºå‰ΩÜ‰Ω†Â∑≤ÁªèËµ∞Âà∞‰∫ÜËøôÈáå„ÄÇËøôÊòØ‰∏Ä‰∏™Êñ∞ÁöÑËµ∑ÁÇπ„ÄÇ"</p>`;
                    text += `</div>`;
                }
                
                // ÂàõÂª∫ÁªìÊûúÂú∫ÊôØ
                const nextRoundId = roundInfo.nextRound;
                const self = this;
                
                SCENES.tournamentRoundResult = {
                    text: text,
                    choices: won ? [
                        {
                            text: nextRoundId ? 'ÁªßÁª≠‰∏ã‰∏ÄËΩÆ' : 'Êü•ÁúãÁªìÂ±Ä',
                            next: nextRoundId ? null : this.getTournamentEnding(),
                            effect: nextRoundId ? Object.assign({}, rewards, {
                                callback: () => {
                                    self.startTournamentRound(nextRoundId);
                                }
                            }) : rewards
                        }
                    ] : [
                        {
                            text: 'Êü•ÁúãÁªìÂ±Ä',
                            next: this.getTournamentEnding(),
                            effect: rewards
                        }
                    ]
                };
                
                this.showScene('tournamentRoundResult');
            }
            
            // Ëé∑ÂèñÈî¶Ê†áËµõËΩÆÊ¨°Â•ñÂä±
            getTournamentRoundRewards(won, roundInfo) {
                const rewards = {
                    serve: 0,
                    spike: 0,
                    block: 0,
                    dig: 0,
                    set: 0,
                    reputation: 0,
                    mood: 0,
                    stress: 0
                };
                
                // ÂÜ≥ËµõÈò∂ÊÆµÔºàÁ¨¨12Âë®Ôºâ‰∏çÂÜçÁªôÊäÄËÉΩÂ•ñÂä±ÔºåÂõ†‰∏∫Ê∏∏ÊàèÂç≥Â∞ÜÁªìÊùü
                // Âè™ÁªôÂøÉÊÉÖÂíåÂ£∞ÊúõÂ•ñÂä±‰Ωú‰∏∫Ëç£Ë™â
                const isFinalStage = roundInfo.id === 'final';
                
                if (won) {
                    if (!isFinalStage) {
                        // ÈùûÂÜ≥ËµõÔºöÊ†πÊçÆËΩÆÊ¨°ÈÄíÂ¢ûÊäÄËÉΩÂ•ñÂä±ÔºàÈôç‰ΩéÔºö5/7/10 ‚Üí 3/4/5Ôºâ
                        const baseReward = roundInfo.id === 'round16' ? 3 :
                                          roundInfo.id === 'round8' ? 4 :
                                          roundInfo.id === 'round4' ? 5 : 0;
                        
                        rewards.serve = rewards.spike = rewards.block = rewards.dig = rewards.set = baseReward;
                    }
                    // ÂÜ≥Ëµõ‰∏çÁªôÊäÄËÉΩÂ•ñÂä±ÔºàÊ∏∏ÊàèÂç≥Â∞ÜÁªìÊùüÔºåÊäÄËÉΩÊèêÂçáÂ∑≤Êó†ÊÑè‰πâÔºâ
                    
                    // ÊâÄÊúâËΩÆÊ¨°ÈÉΩÁªôÂ£∞ÊúõÂíåÂøÉÊÉÖÂ•ñÂä±
                    const reputationBonus = isFinalStage ? 100 : // ÂÜ≥ËµõÂÜ†ÂÜõÔºöÂ∑®È¢ùÂ£∞Êúõ
                                           roundInfo.id === 'round4' ? 50 :
                                           roundInfo.id === 'round8' ? 35 : 25;
                    
                    rewards.reputation = reputationBonus;
                    rewards.mood = isFinalStage ? 30 : 20; // ÂÜ≥ËµõËÉúÂà©ÂøÉÊÉÖÊõ¥È´ò
                    rewards.stress = isFinalStage ? 5 : 10; // ÂÜ≥ËµõÂêéÂéãÂäõËæÉÂ∞èÔºàÂ∞òÂüÉËêΩÂÆöÔºâ
                } else {
                    // Â§±Ë¥•Ôºö‰∏çÁªôÊäÄËÉΩÂ•ñÂä±ÔºàÂ∑≤ÁªèÊòØÊúÄÂêéÈò∂ÊÆµÔºâ
                    rewards.reputation = isFinalStage ? 50 : 10; // ÂÜ≥Ëµõ‰∫öÂÜõ‰πüÊúâ‰∏çÈîôÁöÑÂ£∞Êúõ
                    rewards.mood = isFinalStage ? -10 : -15; // ÂÜ≥ËµõÂ§±Ë¥•Ê≤°ÈÇ£‰πàÊ≤Æ‰∏ßÔºàÂ∑≤ÁªèÂæàÊ£í‰∫ÜÔºâ
                    rewards.stress = 15;
                }
                
                return rewards;
            }
            
            // Ëé∑ÂèñÈî¶Ê†áËµõÁªìÂ±Ä
            getTournamentEnding() {
                const rank = this.tournament.finalRank;
                
                if (rank === 'top16') return 'early_exit';
                else if (rank === 'top8' || rank === 'top4') return 'participant';
                else if (rank === 'runner_up') return 'runner_up';
                else return 'champion';  // Ëµ¢ÂæóÂÜ≥Ëµõ
            }
            
            // ====================================================
            // ÁªìÊùüÈî¶Ê†áËµõÁ≥ªÁªü
            // ====================================================
            
            // ====================================================
            // ÁªìÂ±ÄÊñáÊú¨ÁîüÊàêÁ≥ªÁªü
            // ====================================================
            
            // ÁîüÊàêÂä®ÊÄÅÁªìÂ±ÄÊñáÊú¨
            generateEndingText(endingType) {
                const stats = this.playerStats;
                const player = this.player;
                
                // ËÆ°ÁÆóÊäÄËÉΩÁõ∏ÂÖ≥Êï∞ÊçÆ
                const skills = player.skills;
                const skillValues = [skills.serve, skills.spike, skills.block, skills.dig, skills.set];
                const avgSkill = Math.round(skillValues.reduce((a, b) => a + b, 0) / 5);
                const maxSkill = Math.max(...skillValues);
                const minSkill = Math.min(...skillValues);
                const maxSkillName = ['ÂèëÁêÉ', 'Êâ£ÁêÉ', 'Êã¶ÁΩë', 'Âû´ÁêÉ', 'ÊâòÁêÉ'][skillValues.indexOf(maxSkill)];
                
                // ËÆ°ÁÆóÂàùÂßãÂπ≥ÂùáÊäÄËÉΩ
                const initialSkillValues = Object.values(stats.initialSkills);
                const initialAvg = Math.round(initialSkillValues.reduce((a, b) => a + b, 0) / 5);
                const totalGrowth = avgSkill - initialAvg;
                
                // ÁîüÊàê‰∏ªÊ†áÈ¢òÂíåÂâØÊ†áÈ¢ò
                let mainTitle = '';
                let subTitle = '';
                
                switch(endingType) {
                    case 'champion':
                        mainTitle = 'üèÜ ÂÜ†ÂÜõ‰πãË∑Ø';
                        break;
                    case 'runner_up':
                        mainTitle = 'ü•à ‰∫öÂÜõËç£ËÄÄ';
                        break;
                    case 'participant':
                        mainTitle = 'üèê ÂèÇ‰∏éËÄÖ';
                        break;
                    case 'early_exit':
                        mainTitle = 'üìñ Êñ∞ÁöÑÂºÄÂßã';
                        break;
                }
                
                // ÁîüÊàê‰∏™ÊÄßÂåñÁß∞Âè∑
                const titles = [];
                if (stats.totalTrainings >= 30) titles.push('ËÆ≠ÁªÉÁãÇ‰∫∫');
                else if (stats.totalTrainings >= 25) titles.push('ÂàªËã¶‰πãÊòü');
                else if (stats.totalTrainings < 10) titles.push('‰ΩõÁ≥ªÁé©ÂÆ∂');
                
                if (stats.totalMoneySpent >= 5000) titles.push('ÂúüË±™Áé©ÂÆ∂');
                else if (stats.equipmentPurchased >= 5) titles.push('Ë£ÖÂ§áÂÖö');
                else if (player.money >= 3000) titles.push('ÁêÜË¥¢È´òÊâã');
                
                if (stats.casualMatchesPlayed >= 10 && stats.casualMatchesWon / stats.casualMatchesPlayed >= 0.7) {
                    titles.push('ÈáéÁêÉÁéãËÄÖ');
                }
                
                subTitle = titles.slice(0, 2).join(' ¬∑ ') || 'ÊéíÁêÉÊñ∞Êòü';
                
                // ÁîüÊàêÊñáÊú¨
                let text = `<h2>${mainTitle}</h2>`;
                text += `<p style="color: #ffd700; font-size: 18px; margin-bottom: 20px;">${subTitle}</p>`;
                
                // ÊØîËµõÂõûÈ°æ
                text += `<div style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">`;
                text += `<h3>üèê ÊØîËµõÂõûÈ°æ</h3>`;
                if (endingType === 'champion') {
                    text += `<p>Ê†°ÈôÖËÅîËµõÂÜ≥ËµõÔºå‰Ω†‰ª¨ÊàòËÉúÂØπÊâãÔºåÂ§∫ÂæóÂÜ†ÂÜõÔºÅ</p>`;
                    text += `<p>‰ªé16Âº∫Âà∞ÂÜ†ÂÜõÔºå‰Ω†ËøûÁª≠Ëµ¢Âæó4Âú∫ÊØîËµõÔºåÂ±ïÁé∞‰∫ÜÂº∫Â§ßÁöÑÂÆûÂäõ„ÄÇ</p>`;
                } else if (endingType === 'runner_up') {
                    text += `<p>Ê†°ÈôÖËÅîËµõÂÜ≥ËµõÔºå‰Ω†‰ª¨ÊãºÂ∞ΩÂÖ®ÂäõÔºåÊúÄÁªàËé∑Âæó‰∫öÂÜõ„ÄÇ</p>`;
                    text += `<p>ËôΩÁÑ∂Êúâ‰∫õÈÅóÊÜæÔºå‰ΩÜ‰Ω†‰ª¨Â∑≤ÁªèÂàõÈÄ†‰∫ÜÂ≠¶Ê†°ÁöÑÊúÄÂ•ΩÊàêÁª©„ÄÇ</p>`;
                } else if (endingType === 'participant') {
                    text += `<p>Ê†°ÈôÖËÅîËµõ‰∏≠Ôºå‰Ω†‰ª¨Ê≠¢Ê≠•‰∫éÂõõÂº∫„ÄÇ</p>`;
                    text += `<p>ËôΩÁÑ∂Ê≤°ËÉΩËµ∞Âà∞ÊúÄÂêéÔºå‰ΩÜËøôÂ∑≤ÁªèÊòØÂæàÂ•ΩÁöÑÊàêÁª©‰∫Ü„ÄÇ</p>`;
                } else {
                    text += `<p>Ê†°ÈôÖËÅîËµõÈ¶ñËΩÆÔºå‰Ω†‰ª¨ÈÅóÊÜæÂá∫Â±Ä„ÄÇ</p>`;
                    text += `<p>ËôΩÁÑ∂ÁªìÊûú‰∏çÂ∞ΩÂ¶Ç‰∫∫ÊÑèÔºå‰ΩÜËøô12Âë®ÁöÑÁªèÂéÜËÆ©‰Ω†Êî∂Ëé∑ËâØÂ§ö„ÄÇ</p>`;
                }
                text += `</div>`;
                
                // 12Âë®ÁöÑÊéíÁêÉÁîüÊ¥ª
                text += `<div style="margin: 20px 0;">`;
                text += `<h3 style="color: #ffd700;">„Äê12Âë®ÁöÑÊéíÁêÉÁîüÊ¥ª„Äë</h3>`;
                
                // ËÆ≠ÁªÉÂéÜÁ®ã
                text += `<div style="margin: 15px 0; padding: 12px; background: rgba(255,255,255,0.03); border-left: 3px solid #3b82f6; border-radius: 5px;">`;
                text += `<p><strong>üìä ËÆ≠ÁªÉÂéÜÁ®ã</strong></p>`;
                text += `<p>‚Ä¢ ÂÖ±ËøõË°å‰∫Ü ${stats.totalTrainings} Ê¨°ËÆ≠ÁªÉ</p>`;
                
                // ÊâæÂá∫ËÆ≠ÁªÉÊúÄÂ§öÁöÑÊäÄËÉΩ
                const trainingTypes = stats.trainingByType;
                const maxTrainingType = Object.keys(trainingTypes).reduce((a, b) => 
                    trainingTypes[a] > trainingTypes[b] ? a : b
                );
                const typeNames = {serve: 'ÂèëÁêÉ', spike: 'Êâ£ÁêÉ', block: 'Êã¶ÁΩë', dig: 'Âû´ÁêÉ', set: 'ÊâòÁêÉ', composite: 'ÁªÑÂêà'};
                if (trainingTypes[maxTrainingType] > 0) {
                    text += `<p>‚Ä¢ ÊúÄ‰∏ìÊ≥®‰∫é ${typeNames[maxTrainingType]} ËÆ≠ÁªÉÔºà${trainingTypes[maxTrainingType]}Ê¨°Ôºâ</p>`;
                }
                
                if (player.position !== 'none') {
                    const posName = this.positions[player.position]?.name || 'Êú™Áü•';
                    text += `<p>‚Ä¢ ÈÄâÊã©‰∫Ü ${posName} ‰Ωú‰∏∫‰∏ªË¶Å‰ΩçÁΩÆ</p>`;
                }
                
                // ÁâπÊÆäËØÑ‰ª∑
                if (stats.totalTrainings >= 30) {
                    text += `<p style="color: #fbbf24;">‰Ω†ÊòØ‰∏™ËÆ≠ÁªÉÁãÇÔºåÂá†‰πéÊØèÂë®ÈÉΩÂú®ÁêÉÂú∫‰∏äÊå•Ê±óÂ¶ÇÈõ®</p>`;
                } else if (stats.totalTrainings < 10) {
                    text += `<p style="color: #fbbf24;">‰Ω†‰∏çÊòØ‰∏™ËÆ≠ÁªÉÁãÇÔºåÊõ¥Ê≥®Èáç‰∫´ÂèóËøáÁ®ã</p>`;
                }
                text += `</div>`;
                
                // ÊØîËµõÁªèÂéÜ
                if (stats.casualMatchesPlayed > 0 || stats.formalMatchesPlayed > 0) {
                    text += `<div style="margin: 15px 0; padding: 12px; background: rgba(255,255,255,0.03); border-left: 3px solid #10b981; border-radius: 5px;">`;
                    text += `<p><strong>üèê ÊØîËµõÁªèÂéÜ</strong></p>`;
                    if (stats.casualMatchesPlayed > 0) {
                        const winRate = Math.round((stats.casualMatchesWon / stats.casualMatchesPlayed) * 100);
                        text += `<p>‚Ä¢ ÂèÇÂä†‰∫Ü ${stats.casualMatchesPlayed} Âú∫ÈáéÁêÉÔºåËÉúÁéá ${winRate}%</p>`;
                        if (stats.casualMatchesPlayed >= 10 && winRate >= 70) {
                            text += `<p style="color: #fbbf24;">‰Ω†ÊòØÈáéÁêÉÂú∫ÁöÑÂ∏∏ÂÆ¢ÔºåÂú®ÂÆûÊàò‰∏≠Âø´ÈÄüÊàêÈïø</p>`;
                        } else if (stats.casualMatchesPlayed < 3) {
                            text += `<p style="color: #fbbf24;">‰Ω†Êõ¥ÂñúÊ¨¢Ê≠£ÂºèÊØîËµõÁöÑÊ∞õÂõ¥ÔºåÂæàÂ∞ëÊâìÈáéÁêÉ</p>`;
                        }
                    }
                    if (stats.formalMatchesPlayed > 0) {
                        text += `<p>‚Ä¢ Ê≠£ÂºèÊØîËµõ ${stats.formalMatchesPlayed} Âú∫Ôºå${stats.formalMatchesWon} ËÉú</p>`;
                    }
                    text += `</div>`;
                }
                
                // Ê∂àË¥πËÆ∞ÂΩï
                if (stats.totalMoneySpent > 0) {
                    text += `<div style="margin: 15px 0; padding: 12px; background: rgba(255,255,255,0.03); border-left: 3px solid #f59e0b; border-radius: 5px;">`;
                    text += `<p><strong>üí∞ Ê∂àË¥πËÆ∞ÂΩï</strong></p>`;
                    text += `<p>‚Ä¢ ÊÄªÊ∂àË¥πÔºö${stats.totalMoneySpent} ÂÖÉ</p>`;
                    if (stats.equipmentPurchased > 0) text += `<p>‚Ä¢ Ë¥≠‰π∞Ë£ÖÂ§áÔºö${stats.equipmentPurchased} ‰ª∂</p>`;
                    if (stats.coachingPurchased > 0) text += `<p>‚Ä¢ ÁßÅÊïôËØæÁ®ãÔºö${stats.coachingPurchased} Ê¨°</p>`;
                    if (stats.entertainmentSpent > 0) text += `<p>‚Ä¢ Â®±‰πêÊ∂àË¥πÔºö${stats.entertainmentSpent} ÂÖÉ</p>`;
                    
                    if (stats.totalMoneySpent >= 5000) {
                        text += `<p style="color: #fbbf24;">‰Ω†ËàçÂæó‰∏∫Ëá™Â∑±ÊäïËµÑÔºåË£ÖÂ§áÂíåÁßÅÊïô‰∏ÄÊ†∑‰∏çËêΩ</p>`;
                    } else if (player.money >= 3000) {
                        text += `<p style="color: #fbbf24;">‰Ω†Á≤æÊâìÁªÜÁÆóÔºåÁªìÊùüÊó∂ËøòÊúâ‰∏çÂ∞ëÁßØËìÑÔºàÂâ©‰Ωô${player.money}ÂÖÉÔºâ</p>`;
                    }
                    text += `</div>`;
                }
                
                // ËØæ‰ΩôÁîüÊ¥ª
                const hasLifeActivities = stats.gamesPlayed > 0 || stats.moviesWatched > 0 || 
                                         stats.socialEvents > 0 || stats.restTaken > 0;
                if (hasLifeActivities) {
                    text += `<div style="margin: 15px 0; padding: 12px; background: rgba(255,255,255,0.03); border-left: 3px solid #ec4899; border-radius: 5px;">`;
                    text += `<p><strong>üåà ËØæ‰ΩôÁîüÊ¥ª</strong></p>`;
                    if (stats.gamesPlayed > 0) text += `<p>‚Ä¢ Áé©Ê∏∏Êàè ${stats.gamesPlayed} Ê¨°</p>`;
                    if (stats.moviesWatched > 0) text += `<p>‚Ä¢ ÁúãÁîµÂΩ± ${stats.moviesWatched} Ê¨°</p>`;
                    if (stats.socialEvents > 0) text += `<p>‚Ä¢ Á§æ‰∫§Ê¥ªÂä® ${stats.socialEvents} Ê¨°</p>`;
                    if (stats.restTaken > 0) text += `<p>‚Ä¢ ‰ºëÊÅØÊîæÊùæ ${stats.restTaken} Ê¨°</p>`;
                    
                    // ÁîüÊ¥ªÊñπÂºèËØÑ‰ª∑
                    if (stats.gamesPlayed >= 8) {
                        text += `<p style="color: #fbbf24;">‰Ω†ÊòØ‰∏™Ê∏∏ÊàèÁà±Â•ΩËÄÖÔºåÁªèÂ∏∏Âú®Ê∏∏Êàè‰∏≠ÊîæÊùæ</p>`;
                    } else if (stats.moviesWatched >= 6) {
                        text += `<p style="color: #fbbf24;">‰Ω†ÂñúÊ¨¢ÊñáËâ∫Ê¥ªÂä®ÔºåÁîµÂΩ±Èô¢ÊòØÂ∏∏ÂéªÁöÑÂú∞Êñπ</p>`;
                    } else if (stats.socialEvents >= 8) {
                        text += `<p style="color: #fbbf24;">‰Ω†ÂæàÊ≥®Èáç‰∫∫ÈôÖÂÖ≥Á≥ªÔºåÁªèÂ∏∏ÂèÇÂä†Á§æ‰∫§Ê¥ªÂä®</p>`;
                    } else if (stats.restTaken >= 10) {
                        text += `<p style="color: #fbbf24;">‰Ω†ÊáÇÂæó‰ºëÊÅØÁöÑÈáçË¶ÅÊÄßÔºå‰ªé‰∏çËÆ©Ëá™Â∑±ËøáÂ∫¶Áñ≤Âä≥</p>`;
                    } else if (stats.restTaken === 0 && stats.totalTrainings >= 25) {
                        text += `<p style="color: #fbbf24;">‰Ω†ÊòØ‰∏™Â∑•‰ΩúÁãÇÔºåÂá†‰πéÊ≤°Êúâ‰ºëÊÅØÊó∂Èó¥</p>`;
                    } else if (hasLifeActivities) {
                        text += `<p style="color: #fbbf24;">‰Ω†ÊáÇÂæóÂä≥ÈÄ∏ÁªìÂêàÔºå‰∫´ÂèóÂ§ßÂ≠¶ÁîüÊ¥ª</p>`;
                    }
                    text += `</div>`;
                }
                
                // ÊäÄËÉΩÊàêÈïø
                text += `<div style="margin: 15px 0; padding: 12px; background: rgba(255,255,255,0.03); border-left: 3px solid #8b5cf6; border-radius: 5px;">`;
                text += `<p><strong>üìà ÊäÄËÉΩÊàêÈïø</strong></p>`;
                text += `<p>‚Ä¢ ÊúÄÂº∫ÊäÄËÉΩÔºö${maxSkillName}(${maxSkill})</p>`;
                text += `<p>‚Ä¢ ‰ªéÂπ≥Âùá ${initialAvg} ÊàêÈïøÂà∞ ${avgSkill}ÔºàÊèêÂçá${totalGrowth}ÁÇπÔºâ</p>`;
                
                // ËÅå‰∏öÂÆö‰ΩçËØÑ‰ª∑
                if (player.position !== 'none') {
                    const posName = this.positions[player.position]?.name || 'Êú™Áü•';
                    const posLevel = player.positionLevel;
                    text += `<p>‚Ä¢ ËÅå‰∏öÂÆö‰ΩçÔºö${posName}`;
                    if (posLevel >= 3) {
                        text += ` <span style="color: #fbbf24;">ÔºàÁ≤æÈÄöÔºâ</span>`;
                    } else if (posLevel >= 2) {
                        text += ` <span style="color: #60a5fa;">ÔºàÁÜüÁªÉÔºâ</span>`;
                    } else {
                        text += ` <span style="color: #9ca3af;">ÔºàÂÖ•Èó®Ôºâ</span>`;
                    }
                    text += `</p>`;
                }
                
                // ÊäÄËÉΩÁâπÈïøÂàÜÊûê
                if (totalGrowth >= 60) {
                    text += `<p style="color: #fbbf24;">‰Ω†ÁöÑÊàêÈïøÈÄüÂ∫¶ÊÉä‰∫∫ÔºåËøõÊ≠•È£ûÂø´ÔºÅÊïôÁªÉÈÉΩÂØπ‰Ω†ÂàÆÁõÆÁõ∏Áúã</p>`;
                } else if (totalGrowth >= 40) {
                    text += `<p style="color: #fbbf24;">‰Ω†ÁöÑËøõÊ≠•Á®≥ÂÅ•ÊâéÂÆûÔºåÊØè‰∏ÄÂàÜÂä™ÂäõÈÉΩÊúâÂõûÊä•</p>`;
                } else if (maxSkill - minSkill < 15) {
                    text += `<p style="color: #fbbf24;">‰Ω†ËøΩÊ±ÇÂÖ®Èù¢ÂèëÂ±ïÔºåÂêÑÈ°πÊäÄËÉΩÈÉΩÂæàÂùáË°°ÔºåÊòØÊïôÁªÉÁúº‰∏≠ÁöÑÂÖ®ËÉΩÂûãÈÄâÊâã</p>`;
                } else if (maxSkill >= 85) {
                    text += `<p style="color: #fbbf24;">‰Ω†ÁöÑ${maxSkillName}ÊäÄÊúØÂá∫Á±ªÊãîËêÉÔºåÂ∑≤ÁªèËææÂà∞‰∫Ü‰∏ì‰∏öÊ∞¥ÂáÜÔºåÊàê‰∏∫‰∫Ü‰Ω†ÁöÑÊãõÁâåÁªùÊäÄ</p>`;
                } else if (maxSkill >= 70) {
                    text += `<p style="color: #fbbf24;">‰Ω†Âú®${maxSkillName}‰∏äÂ±ïÁé∞Âá∫‰∫ÜÂ§©ËµãÔºåËøôÊòØ‰Ω†ÁöÑÂº∫È°π</p>`;
                }
                
                // ÁâπÊÆäÊäÄËÉΩÊàêÂ∞±
                const skillAchievements = [];
                if (skills.serve >= 80) skillAchievements.push('ÂèëÁêÉÁéãËÄÖ');
                if (skills.spike >= 80) skillAchievements.push('Êâ£ÁêÉÈ´òÊâã');
                if (skills.block >= 80) skillAchievements.push('Êã¶ÁΩëÈìÅÂ£Å');
                if (skills.dig >= 80) skillAchievements.push('Èò≤ÂÆàÂ§ßÂ∏à');
                if (skills.set >= 80) skillAchievements.push('‰º†ÁêÉËâ∫ÊúØÂÆ∂');
                
                if (skillAchievements.length > 0) {
                    text += `<p>‚Ä¢ ÁâπÊÆäÊàêÂ∞±Ôºö${skillAchievements.join('„ÄÅ')}</p>`;
                }
                
                text += `</div>`;
                
                // ‰∏™‰∫∫È£éÊ†º‰∏éÊàêÂ∞±
                text += `<div style="margin: 15px 0; padding: 12px; background: rgba(255,255,255,0.03); border-left: 3px solid #06b6d4; border-radius: 5px;">`;
                text += `<p><strong>üéØ ‰∏™‰∫∫È£éÊ†º</strong></p>`;
                
                // ËÆ≠ÁªÉÈ£éÊ†º
                if (stats.totalTrainings >= 30) {
                    text += `<p>‚Ä¢ <span style="color: #fbbf24;">ËÆ≠ÁªÉÁãÇÈ≠î</span>Ôºö‰Ω†Âá†‰πéÊØèÂë®ÈÉΩÂú®ÁêÉÂú∫‰∏äÊå•Ê±óÂ¶ÇÈõ®ÔºåËøô‰ªΩÊâßÁùÄËÆ©‰∫∫Êï¨‰Ω©</p>`;
                } else if (stats.totalTrainings >= 25) {
                    text += `<p>‚Ä¢ <span style="color: #fbbf24;">ÂàªËã¶ËÆ≠ÁªÉËÄÖ</span>Ôºö‰Ω†Ê∑±Áü•"‰∏ÄÂàÜËÄïËÄò‰∏ÄÂàÜÊî∂Ëé∑"ÁöÑÈÅìÁêÜ</p>`;
                } else if (stats.totalTrainings >= 20) {
                    text += `<p>‚Ä¢ <span style="color: #fbbf24;">Á®≥ÂÅ•ÂûãÈÄâÊâã</span>Ôºö‰Ω†‰øùÊåÅÁùÄËßÑÂæãÁöÑËÆ≠ÁªÉËäÇÂ•è</p>`;
                } else if (stats.totalTrainings < 10) {
                    text += `<p>‚Ä¢ <span style="color: #fbbf24;">‰ΩõÁ≥ªÁé©ÂÆ∂</span>Ôºö‰Ω†Êõ¥Ê≥®Èáç‰∫´ÂèóËøáÁ®ãËÄåÈùûÁªìÊûú</p>`;
                }
                
                // ÂÆûÊàòÈ£éÊ†º
                if (stats.casualMatchesPlayed >= 10) {
                    const winRate = Math.round((stats.casualMatchesWon / stats.casualMatchesPlayed) * 100);
                    if (winRate >= 80) {
                        text += `<p>‚Ä¢ <span style="color: #fbbf24;">ÈáéÁêÉÁéãËÄÖ</span>ÔºöÈáéÁêÉÂú∫‰∏ä‰Ω†Âá†‰πéÊó†ÊïåÔºàËÉúÁéá${winRate}%Ôºâ</p>`;
                    } else if (winRate >= 60) {
                        text += `<p>‚Ä¢ <span style="color: #fbbf24;">ÂÆûÊàòÊ¥æ</span>Ôºö‰Ω†Âú®ÈáéÁêÉÂú∫‰∏äÁßØÁ¥Ø‰∫Ü‰∏∞ÂØåÁöÑÂÆûÊàòÁªèÈ™å</p>`;
                    }
                } else if (stats.casualMatchesPlayed < 3 && stats.formalMatchesPlayed >= 5) {
                    text += `<p>‚Ä¢ <span style="color: #fbbf24;">Ê≠£ÁªüÊ¥æ</span>Ôºö‰Ω†Êõ¥ÂñúÊ¨¢Ê≠£ÂºèÊØîËµõÁöÑÊ∞õÂõ¥ÔºåËøΩÊ±ÇËßÑËåÉÁöÑÁ´ûÊäÄ‰ΩìÈ™å</p>`;
                }
                
                // Ê∂àË¥πÈ£éÊ†º
                if (stats.totalMoneySpent >= 5000) {
                    text += `<p>‚Ä¢ <span style="color: #fbbf24;">ÊäïËµÑÂûãÈÄâÊâã</span>Ôºö‰Ω†ËàçÂæó‰∏∫Ëá™Â∑±ÊäïËµÑÔºåË£ÖÂ§áÂíåÁßÅÊïô‰∏ÄÊ†∑‰∏çËêΩ</p>`;
                } else if (stats.equipmentPurchased >= 5) {
                    text += `<p>‚Ä¢ <span style="color: #fbbf24;">Ë£ÖÂ§áÂÖö</span>Ôºö‰Ω†Áõ∏‰ø°Â•ΩË£ÖÂ§áËÉΩÂ∏¶Êù•Êõ¥Â•ΩÁöÑË°®Áé∞</p>`;
                } else if (player.money >= 3000) {
                    text += `<p>‚Ä¢ <span style="color: #fbbf24;">ÁêÜË¥¢È´òÊâã</span>Ôºö‰Ω†Á≤æÊâìÁªÜÁÆóÔºåÁªìÊùüÊó∂ËøòÊúâ${player.money}ÂÖÉÁßØËìÑ</p>`;
                } else if (stats.totalMoneySpent < 1000) {
                    text += `<p>‚Ä¢ <span style="color: #fbbf24;">ËäÇ‰ø≠Ê¥æ</span>Ôºö‰Ω†ÊääÈí±Ëä±Âú®ÂàÄÂàÉ‰∏äÔºå‰ªé‰∏çÊµ™Ë¥π</p>`;
                }
                
                // ÁîüÊ¥ªÊñπÂºè
                const totalLifeActivities = stats.gamesPlayed + stats.moviesWatched + stats.socialEvents + stats.restTaken;
                if (totalLifeActivities >= 20) {
                    text += `<p>‚Ä¢ <span style="color: #fbbf24;">ÁîüÊ¥ªÂÆ∂</span>Ôºö‰Ω†Ê∑±Áü•Âä≥ÈÄ∏ÁªìÂêàÁöÑÈáçË¶ÅÊÄßÔºå‰∫´Âèó‰∏∞ÂØåÂ§öÂΩ©ÁöÑÂ§ßÂ≠¶ÁîüÊ¥ª</p>`;
                } else if (stats.restTaken === 0 && stats.totalTrainings >= 25) {
                    text += `<p>‚Ä¢ <span style="color: #fbbf24;">ÊãºÂëΩ‰∏âÈÉé</span>Ôºö‰Ω†Âá†‰πéÊ≤°Êúâ‰ºëÊÅØÊó∂Èó¥ÔºåÂÖ®Ë∫´ÂøÉÊäïÂÖ•ËÆ≠ÁªÉ</p>`;
                } else if (stats.gamesPlayed >= 8) {
                    text += `<p>‚Ä¢ <span style="color: #fbbf24;">Ê∏∏ÊàèËææ‰∫∫</span>Ôºö‰Ω†Âú®Ê∏∏Êàè‰∏≠ÊâæÂà∞‰∫ÜÊîæÊùæÁöÑÊñπÂºè</p>`;
                } else if (stats.moviesWatched >= 6) {
                    text += `<p>‚Ä¢ <span style="color: #fbbf24;">ÊñáËâ∫ÈùíÂπ¥</span>ÔºöÁîµÂΩ±Èô¢ÊòØ‰Ω†Â∏∏ÂéªÁöÑÂú∞ÊñπÔºå‰Ω†‰∫´ÂèóÂÖâÂΩ±Â∏¶Êù•ÁöÑÊÑüÂä®</p>`;
                } else if (stats.socialEvents >= 8) {
                    text += `<p>‚Ä¢ <span style="color: #fbbf24;">Á§æ‰∫§Ëææ‰∫∫</span>Ôºö‰Ω†ÂæàÊ≥®Èáç‰∫∫ÈôÖÂÖ≥Á≥ªÔºåÊúãÂèãÈÅçÂ∏ÉÊ†°Âõ≠</p>`;
                }
                
                text += `</div>`;
                
                text += `</div>`;
                
                // ÁªìËØ≠
                text += `<div style="margin: 20px 0; padding: 15px; background: rgba(255,215,0,0.1); border-radius: 10px;">`;
                if (endingType === 'champion') {
                    text += `<p><strong>üéâ ÂÆåÁæéÁªìÂ±ÄÔºöÂÜ†ÂÜõ‰πãÊòü üéâ</strong></p>`;
                    text += `<p>‰Ω†Áî®Ê±óÊ∞¥ÂíåÂä™ÂäõÈì∏Â∞±‰∫ÜÂÜ†ÂÜõ‰πãË∑Ø„ÄÇÁúÅÈòüÊïôÁªÉÂ∑≤ÁªèÂêë‰Ω†ÂèëÂá∫ÈÇÄËØ∑ÔºåÊõ¥Â§ßÁöÑËàûÂè∞Âú®Á≠âÁùÄ‰Ω†...</p>`;
                } else if (endingType === 'runner_up') {
                    text += `<p><strong>üéä ‰ºòÁßÄÁªìÂ±ÄÔºö‰∏çÂ±à‰πãÂøÉ üéä</strong></p>`;
                    text += `<p>ËôΩÁÑ∂Ê≤°ËÉΩÂ§∫ÂÜ†Ôºå‰ΩÜ‰Ω†ËØÅÊòé‰∫ÜËá™Â∑±ÁöÑÂÆûÂäõ„ÄÇÂ§±Ë¥•ËÆ©‰Ω†Êõ¥Âä†ÂùöÂº∫ÔºÅ</p>`;
                } else if (endingType === 'participant') {
                    text += `<p><strong>üéà ËâØÂ•ΩÁªìÂ±ÄÔºöÊàêÈïø‰πãË∑Ø üéà</strong></p>`;
                    text += `<p>ËôΩÁÑ∂Ê≤°ËÉΩËµ∞Âà∞ÊúÄÂêéÔºå‰ΩÜ‰Ω†Êî∂Ëé∑‰∫ÜÊäÄÊúØ„ÄÅÂèãË∞äÂíåÊàêÈïø„ÄÇÊéíÁêÉ‰πãË∑ØËøòÂæàÈïøÔºÅ</p>`;
                } else {
                    text += `<p><strong>üå± ÊôÆÈÄöÁªìÂ±ÄÔºöÂàùÂøÉ‰∏çÊîπ üå±</strong></p>`;
                    text += `<p>ËôΩÁÑ∂ËøôÊ¨°Ê≤°ËÉΩËµ∞ÂæóÊõ¥ËøúÔºå‰ΩÜ‰Ω†Â∑≤ÁªèËøàÂá∫‰∫ÜÁ¨¨‰∏ÄÊ≠•„ÄÇÁªßÁª≠Âä™ÂäõÔºåÊÄªÊúâ‰∏ÄÂ§©‰Ω†‰ºöÁ´ô‰∏äÈ¢ÜÂ•ñÂè∞ÔºÅ</p>`;
                }
                text += `<p><strong>ÊÑüË∞¢Ê∏∏Áé©ÔºÅ</strong></p>`;
                text += `</div>`;
                
                return text;
            }
            
            // ====================================================
            // ÈöêËóèÁªìÂ±ÄÊñáÊú¨ÁîüÊàêÁ≥ªÁªü
            // ====================================================
            
            // ÈöêËóèÁªìÂ±Ä1ÔºöÊóÅËßÇËÄÖ
            generateBystanderEndingText() {
                const stats = this.playerStats;
                const player = this.player;
                
                let text = `<h2>üé≠ ÈöêËóèÁªìÂ±ÄÔºöÊóÅËßÇËÄÖ</h2>`;
                text += `<div style="margin: 20px 0; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px;">`;
                
                text += `<h3 style="color: #fbbf24;">„ÄêÁ¨¨5Âë® - Èô¢ÈôÖÊØîËµõÊó•„Äë</h3>`;
                text += `<p>‰ΩìËÇ≤È¶ÜÈáå‰∫∫Â£∞ÈºéÊ≤∏ÔºåÈô¢ÈôÖÊéíÁêÉËÅîËµõÊ≠£Âú®ËøõË°å„ÄÇ‰Ω†Á´ôÂú®ËßÇ‰ºóÂ∏≠‰∏äÔºåÁúãÁùÄÂú∫‰∏äÊå•Ê¥íÊ±óÊ∞¥ÁöÑÈòüÂëò‰ª¨ÔºåÂøÉ‰∏≠‰∫îÂë≥ÊùÇÈôà„ÄÇ</p>`;
                text += `<p>"Â¶ÇÊûúÂΩìÂàùÊàëÂä†ÂÖ•‰∫ÜÈô¢Èòü..."‰Ω†ÊÉ≥Ëµ∑‰∫ÜÂºÄÂ≠¶Êó∂ÁöÑÈÇ£‰∫õÊú∫‰ºö„ÄÇ</p>`;
                text += `<br>`;
                
                text += `<p>Á¨¨1Âë®ÔºåÂ≠¶ÈïøÂ≠¶ÂßêÁÉ≠ÊÉÖÂú∞ÈÇÄËØ∑‰Ω†ÂèÇÂä†ÈÄâÊãîÔºå‰Ω†ËØ¥"ÂÜçÁúãÁúã"„ÄÇ</p>`;
                text += `<p>Á¨¨2Âë®Ôºå‰Ω†Âú®ËÆ≠ÁªÉÂíåÂÖ∂‰ªñ‰∫ãÊÉÖ‰πãÈó¥ÁäπË±´‰∏çÂÜ≥„ÄÇ</p>`;
                text += `<p>Á¨¨3Âë®Ôºå‰Ω†ÊÉ≥ÁùÄ"ËøòÊúâÊó∂Èó¥"„ÄÇ</p>`;
                text += `<p>Á¨¨4Âë®ÔºåÈÄâÊãîÁ™óÂè£ÂÖ≥Èó≠‰∫Ü„ÄÇ</p>`;
                text += `<br>`;
                
                text += `<p>Áé∞Âú®ÔºåÊØîËµõÂºÄÂßã‰∫ÜÔºåËÄå‰Ω†Âè™ËÉΩÂú®Âú∫ËæπËßÇÁúã„ÄÇ</p>`;
                text += `<p>Âú∫‰∏äÁöÑÈòüÂëò‰ª¨ÈÖçÂêàÈªòÂ•ëÔºåÊØè‰∏ÄÊ¨°Êâ£ÁêÉ„ÄÅÊØè‰∏ÄÊ¨°Êã¶ÁΩëÈÉΩËÆ©ËßÇ‰ºóÊ¨¢Âëº„ÄÇ‰Ω†ÊÑèËØÜÂà∞ÔºåÊéíÁêÉ‰∏ç‰ªÖ‰ªÖÊòØ‰∏™‰∫∫ÊäÄÊúØÔºåÊõ¥ÊòØÂõ¢ÈòüÁöÑËøêÂä®„ÄÇ</p>`;
                text += `<br>`;
                
                text += `<p style="color: #fbbf24; font-weight: bold;">"‰∏ãÊ¨°ÔºåÊàë‰∏ÄÂÆö‰∏ç‰ºöÂÜçÈîôËøáÊú∫‰ºö„ÄÇ"‰Ω†ÊöóÊöóÂèëË™ì„ÄÇ</p>`;
                text += `</div>`;
                
                // Êï∞ÊçÆÂõûÈ°æ
                text += `<div style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">`;
                text += `<h3>üìä ‰Ω†ÁöÑ5Âë®ÊéíÁêÉÁîüÊ¥ª</h3>`;
                text += `<p>ËôΩÁÑ∂Ê≤°ËÉΩÂèÇÂä†ÊØîËµõÔºå‰ΩÜ‰Ω†‰πüÊúâËá™Â∑±ÁöÑÊî∂Ëé∑Ôºö</p>`;
                text += `<ul style="text-align: left; margin-left: 20px; line-height: 1.8;">`;
                text += `<li>ËÆ≠ÁªÉ‰∫Ü ${stats.totalTrainings} Ê¨°ÔºåÊäÄËÉΩÊúâÊâÄÊèêÂçá</li>`;
                if (stats.casualMatchesPlayed > 0) {
                    text += `<li>Êâì‰∫Ü ${stats.casualMatchesPlayed} Âú∫ÈáéÁêÉÔºåÁßØÁ¥Ø‰∫ÜÂÆûÊàòÁªèÈ™å</li>`;
                }
                text += `<li>ÁªìËØÜ‰∫Ü‰∏Ä‰∫õÊéíÁêÉÁà±Â•ΩËÄÖ</li>`;
                text += `</ul>`;
                text += `<br>`;
                text += `<p>‰ΩÜ‰Ω†ÈîôËøá‰∫ÜÊúÄÈáçË¶ÅÁöÑ‰∏úË•øÔºö</p>`;
                text += `<ul style="text-align: left; margin-left: 20px; line-height: 1.8; color: #e74c3c;">`;
                text += `<li>‚ùå Ê≤°ÊúâÂä†ÂÖ•Ê≠£ÂºèÈòü‰ºç</li>`;
                text += `<li>‚ùå Ê≤°ÊúâÂèÇÂä†Èô¢ÈôÖÊØîËµõ</li>`;
                text += `<li>‚ùå Ê≤°Êúâ‰ΩìÈ™åÂõ¢ÈòüÁöÑÂäõÈáè</li>`;
                text += `</ul>`;
                text += `</div>`;
                
                // ÊïôÁªÉÁöÑËØù
                text += `<div style="margin: 20px 0; padding: 15px; background: rgba(255,215,0,0.1); border-radius: 10px;">`;
                text += `<h3>üí° ÊïôÁªÉÁöÑËØù</h3>`;
                text += `<p>"ÊéíÁêÉÊòØ‰∏ÄÈ°πÈúÄË¶ÅÊääÊè°Êú∫‰ºöÁöÑËøêÂä®„ÄÇÂú∫‰∏äÁöÑÊú∫‰ºöÁ®çÁ∫µÂç≥ÈÄùÔºå‰∫∫ÁîüÁöÑÊú∫‰ºö‰πüÊòØÂ¶ÇÊ≠§„ÄÇ"</p>`;
                text += `<br>`;
                text += `<p>"‰∏çËøáÔºåÂ§±Ë¥•‰∏çÊòØÁªàÁÇπÔºåËÄåÊòØÊñ∞ÁöÑËµ∑ÁÇπ„ÄÇ‰∏ãÊ¨°ÔºåËÆ∞ÂæóÊäì‰ΩèÊú∫‰ºö„ÄÇ"</p>`;
                text += `</div>`;
                
                // ÁªìÂ±ÄÊ†áËØÜ
                text += `<div style="margin: 20px 0; padding: 20px; background: rgba(231,76,60,0.2); border: 2px solid #e74c3c; border-radius: 10px; text-align: center;">`;
                text += `<h3 style="color: #e74c3c;">üîÑ ÈöêËóèÁªìÂ±ÄÔºöÊóÅËßÇËÄÖ</h3>`;
                text += `<p style="color: #fbbf24;">ÊàêÂ∞±Ëß£ÈîÅÔºö„ÄêÈîôËøáÁöÑÊú∫‰ºö„Äë</p>`;
                text += `<br>`;
                text += `<p>Ëøô‰∏çÊòØ‰Ω†ÊÉ≥Ë¶ÅÁöÑÁªìÂ±ÄÔºåÂØπÂêóÔºü</p>`;
                text += `<p><strong>ÈáçÊñ∞ÂºÄÂßãÔºåËøôÊ¨°‰∏çË¶ÅÁäπË±´ÔºÅ</strong></p>`;
                text += `</div>`;
                
                return text;
            }
            
            // ÈöêËóèÁªìÂ±Ä2ÔºöÁã¨Ë°åËÄÖ
            generateLonerEndingText() {
                const stats = this.playerStats;
                const player = this.player;
                
                // ËÆ°ÁÆóÊäÄËÉΩÊï∞ÊçÆ
                const skills = player.skills;
                const skillValues = [skills.serve, skills.spike, skills.block, skills.dig, skills.set];
                const avgSkill = Math.round(skillValues.reduce((a, b) => a + b, 0) / 5);
                const maxSkill = Math.max(...skillValues);
                const maxSkillName = ['ÂèëÁêÉ', 'Êâ£ÁêÉ', 'Êã¶ÁΩë', 'Âû´ÁêÉ', 'ÊâòÁêÉ'][skillValues.indexOf(maxSkill)];
                
                let text = `<h2>üö∂ ÈöêËóèÁªìÂ±ÄÔºöÁã¨Ë°åËÄÖ</h2>`;
                text += `<div style="margin: 20px 0; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px;">`;
                
                text += `<h3 style="color: #fbbf24;">„ÄêÁ¨¨12Âë® - Ê†°ÈôÖËÅîËµõÂºÄÂπï„Äë</h3>`;
                text += `<p>ÂÖ®Ê†°ÊúÄÁõõÂ§ßÁöÑ‰ΩìËÇ≤Ëµõ‰∫ã‚Äî‚ÄîÊ†°ÈôÖÊéíÁêÉËÅîËµõÊãâÂºÄÂ∏∑Âπï„ÄÇÊ†°ÈòüÈòüÂëò‰ª¨Ë∫´Á©øÁªü‰∏ÄÁöÑÈòüÊúçÔºåÂú®ÂºÄÂπïÂºè‰∏äÊé•ÂèóÂÖ®Ê†°Â∏àÁîüÁöÑÊ¨¢Âëº„ÄÇ</p>`;
                text += `<br>`;
                text += `<p>‰Ω†Á´ôÂú®‰∫∫Áæ§‰∏≠ÔºåÁúãÁùÄÈÇ£‰∫õÁÜüÊÇâÁöÑË∫´ÂΩ±„ÄÇ‰ªñ‰ª¨‰∏≠Êúâ‰∫õ‰∫∫ÁöÑÊäÄÊúØ‰∏çÂ¶Ç‰Ω†Ôºå‰ΩÜ‰ªñ‰ª¨Á´ôÂú®‰∫ÜÈÇ£‰∏™ËàûÂè∞‰∏ä„ÄÇ</p>`;
                text += `</div>`;
                
                // Ê†πÊçÆÁé©ÂÆ∂ÊÉÖÂÜµÁîüÊàê‰∏çÂêåÊñáÊ°à
                text += `<div style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">`;
                text += `<h3>üìñ ÂõûÈ°æËøô12Âë®</h3>`;
                text += `<p>‰Ω†ÈÄâÊã©‰∫Ü‰∏ÄÊù°‰∏çÂêåÁöÑÈÅìË∑ØÔºö</p>`;
                text += `<br>`;
                
                // Ê†πÊçÆÈòü‰ºçÁä∂ÊÄÅ
                if (player.team === 'college') {
                    text += `<p style="color: #3b82f6;">‰Ω†Âä†ÂÖ•‰∫ÜÈô¢ÈòüÔºåÂèÇÂä†‰∫ÜÈô¢ÈôÖÊØîËµõÔºå‰ΩÜÊúÄÁªàÊ≤°ËÉΩËøõÂÖ•Ê†°Èòü„ÄÇ</p>`;
                    text += `<p>‰πüËÆ∏ÊòØÊäÄÊúØËøò‰∏çÂ§üÔºå‰πüËÆ∏ÊòØË°®Áé∞‰∏çÂ§üÂá∫Ëâ≤Ôºå‰πüËÆ∏Âè™ÊòØËøêÊ∞î‰∏çÂ•Ω„ÄÇ‰ΩÜ‰Ω†Â∑≤ÁªèÊØîÂæàÂ§ö‰∫∫Ëµ∞ÂæóÊõ¥Ëøú‰∫Ü„ÄÇ</p>`;
                } else {
                    text += `<p style="color: #3b82f6;">‰Ω†ÈÄâÊã©‰∫ÜÁã¨Ëá™ËÆ≠ÁªÉÔºåÂú®ÈáéÁêÉÂú∫‰∏äÁ£®ÁªÉÊäÄÊúØ„ÄÇ</p>`;
                    text += `<p>‰Ω†‰∫´Âèó‰∫ÜËá™Áî±Ôºå‰ΩÜ‰πüÈîôËøá‰∫ÜÂõ¢ÈòüÁöÑÊ∏©ÊöñÂíåÊ≠£ÂºèÊØîËµõÁöÑËàûÂè∞„ÄÇÊéíÁêÉÊòØÂõ¢ÈòüËøêÂä®Ôºå‰∏ãÊ¨°ËØïËØïÂä†ÂÖ•Èòü‰ºçÂêß„ÄÇ</p>`;
                }
                text += `<br>`;
                
                // Ê†πÊçÆÊäÄËÉΩÊ∞¥Âπ≥
                if (avgSkill >= 70) {
                    text += `<p style="color: #10b981;">‰Ω†ÁöÑÊäÄÊúØÂÖ∂ÂÆûÂ∑≤ÁªèÂæà‰∏çÈîô‰∫ÜÔºàÂπ≥ÂùáÊäÄËÉΩÔºö${avgSkill}ÔºâÔºå‰ΩÜÊéíÁêÉ‰∏çÂè™ÊòØÊäÄÊúØÔºåËøòÈúÄË¶ÅÂõ¢Èòü„ÄÅÊú∫‰ºöÂíåÊó∂Êú∫„ÄÇ</p>`;
                    text += `<p>‰πüËÆ∏ÊòØÈîôËøá‰∫ÜÂÖ≥ÈîÆÁöÑÊØîËµõÔºå‰πüËÆ∏ÊòØÊ≤°ÊúâÊääÊè°‰ΩèÊú∫‰ºö„ÄÇ‰∏ãÊ¨°ÔºåËÆ∞ÂæóÂú®Ê≠£Á°ÆÁöÑÊó∂Èó¥ÂÅöÊ≠£Á°ÆÁöÑ‰∫ã„ÄÇ</p>`;
                } else if (avgSkill >= 50) {
                    text += `<p style="color: #f59e0b;">‰Ω†ÁöÑÊäÄÊúØËøòÁÆó‰∏çÈîôÔºàÂπ≥ÂùáÊäÄËÉΩÔºö${avgSkill}ÔºâÔºå‰ΩÜËøòÊúâÊèêÂçáÁöÑÁ©∫Èó¥„ÄÇ</p>`;
                    text += `<p>ÁªßÁª≠Âä™ÂäõËÆ≠ÁªÉÔºåÂêåÊó∂‰πüË¶ÅÊ≥®ÈáçÂõ¢ÈòüÂêà‰ΩúÂíåÊØîËµõÁªèÈ™åÁöÑÁßØÁ¥Ø„ÄÇ</p>`;
                } else {
                    text += `<p style="color: #ef4444;">‰Ω†ÁöÑÊäÄÊúØËøòÊúâÂæàÂ§ßÁöÑÊèêÂçáÁ©∫Èó¥ÔºàÂπ≥ÂùáÊäÄËÉΩÔºö${avgSkill}Ôºâ„ÄÇ</p>`;
                    text += `<p>‰πüËÆ∏ÊòØËÆ≠ÁªÉ‰∏çÂ§üÂàªËã¶Ôºå‰πüËÆ∏ÊòØÊñπÊ≥ï‰∏çÂ§üÊ≠£Á°Æ„ÄÇ‰∏ãÊ¨°ÔºåËØïÁùÄÊõ¥Âä†‰∏ìÊ≥®ÂíåÂä™Âäõ„ÄÇ</p>`;
                }
                text += `<br>`;
                
                // Ê†πÊçÆËÆ≠ÁªÉÊ¨°Êï∞
                if (stats.totalTrainings >= 30) {
                    text += `<p style="color: #8b5cf6;">‰Ω†ÈùûÂ∏∏ÂàªËã¶ÔºåËÆ≠ÁªÉ‰∫Ü${stats.totalTrainings}Ê¨°ÔºåÂá†‰πéÊØèÂë®ÈÉΩÂú®ÁêÉÂú∫‰∏äÊå•Ê±óÂ¶ÇÈõ®„ÄÇ</p>`;
                    text += `<p>‰ΩÜÊéíÁêÉ‰∏çÂè™ÊòØËÆ≠ÁªÉÔºåËøòÈúÄË¶ÅÂÆûÊàò„ÄÅÂõ¢ÈòüÂíåÊØîËµõÁªèÈ™å„ÄÇ‰∏ãÊ¨°ÔºåËØïÁùÄÂ§öÂèÇÂä†ÊØîËµõÔºåÂú®ÂÆûÊàò‰∏≠ÊàêÈïø„ÄÇ</p>`;
                } else if (stats.totalTrainings < 10) {
                    text += `<p style="color: #ec4899;">‰Ω†ÁöÑËÆ≠ÁªÉÊ¨°Êï∞ËæÉÂ∞ëÔºà${stats.totalTrainings}Ê¨°ÔºâÔºå‰πüËÆ∏ÊòØÊó∂Èó¥ÂàÜÈÖçÁöÑÈóÆÈ¢òÔºå‰πüËÆ∏ÊòØÂÖ∂‰ªñÂéüÂõ†„ÄÇ</p>`;
                    text += `<p>Ë¶ÅÊÉ≥Âú®ÊéíÁêÉ‰∏äÊúâÊâÄÊàêÂ∞±ÔºåÂàªËã¶ËÆ≠ÁªÉÊòØÂøÖ‰∏çÂèØÂ∞ëÁöÑ„ÄÇ</p>`;
                }
                text += `</div>`;
                
                // ÊÑüÊÇü
                text += `<div style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">`;
                text += `<h3>üí≠ ‰Ω†ÁöÑÊÑüÊÇü</h3>`;
                text += `<p>Á´ôÂú®‰∫∫Áæ§‰∏≠Ôºå‰Ω†ÊÉ≥Ëµ∑‰∫ÜËøô12Âë®ÁöÑÁÇπÁÇπÊª¥Êª¥Ôºö</p>`;
                text += `<ul style="text-align: left; margin-left: 20px; line-height: 1.8;">`;
                text += `<li>Á¨¨‰∏ÄÊ¨°Êé•Ëß¶ÊéíÁêÉÊó∂ÁöÑÈùíÊ∂©</li>`;
                text += `<li>ÊØè‰∏ÄÊ¨°ËÆ≠ÁªÉÂêéÁöÑÊ±óÊ∞¥</li>`;
                if (stats.casualMatchesPlayed > 0) {
                    text += `<li>ÈáéÁêÉÂú∫‰∏äÁöÑÊ¨¢Á¨ëÂíåÊå´Êäò</li>`;
                }
                if (player.team === 'college') {
                    text += `<li>ÈÇ£Âú∫Èô¢ÈôÖÊØîËµõÁöÑÊøÄÂä®</li>`;
                }
                text += `<li>‰ª•ÂèäÔºåÈÇ£‰∫õÈîôËøáÁöÑÊú∫‰ºö...</li>`;
                text += `</ul>`;
                text += `<br>`;
                text += `<p>‰Ω†Ê≤°ÊúâÁ´ô‰∏äÊ†°ÈôÖËÅîËµõÁöÑËàûÂè∞Ôºå‰ΩÜ‰Ω†Êî∂Ëé∑‰∫ÜÔºö</p>`;
                text += `<ul style="text-align: left; margin-left: 20px; line-height: 1.8; color: #2ecc71;">`;
                text += `<li>‚úì ÂØπÊéíÁêÉÁöÑÁÉ≠Áà±</li>`;
                text += `<li>‚úì ÊäÄËÉΩÁöÑÊèêÂçáÔºà‰ªé ${stats.initialSkills.serve} Âà∞ ${avgSkill}Ôºâ</li>`;
                text += `<li>‚úì ÂØπËá™Â∑±ÁöÑËÆ§ËØÜ</li>`;
                text += `<li>‚úì ÂØπÂõ¢ÈòüËøêÂä®ÁöÑÁêÜËß£</li>`;
                text += `</ul>`;
                text += `</div>`;
                
                // Â≠¶ÊúüÁªìÊùü
                text += `<div style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">`;
                text += `<h3>üéì Â≠¶ÊúüÁªìÊùü</h3>`;
                text += `<p>Â≠¶ÊúüÁªìÊùü‰∫ÜÔºå‰Ω†ÁöÑÂ§ß‰∏ÄÊéíÁêÉ‰πãÊóÖ‰πüÂëä‰∏ÄÊÆµËêΩ„ÄÇ</p>`;
                text += `<br>`;
                text += `<p>ËôΩÁÑ∂Ê≤°ËÉΩÂÆûÁé∞"ÊéíÁêÉ‰πãÊòü"ÁöÑÊ¢¶ÊÉ≥Ôºå‰ΩÜ‰Ω†Âπ∂‰∏çÂêéÊÇî„ÄÇËøô12Âë®ÁöÑÁªèÂéÜËÆ©‰Ω†ÊàêÈïø‰∫ÜËÆ∏Â§öÔºå‰πüËÆ©‰Ω†ÊòéÁôΩ‰∫ÜÂæàÂ§öÈÅìÁêÜ„ÄÇ</p>`;
                text += `<br>`;
                text += `<p>‰πüËÆ∏‰∏ãÂ≠¶ÊúüÔºå‰Ω†‰ºöÊõ¥Âä†Âä™Âäõ„ÄÇ‰πüËÆ∏‰Ω†‰ºöÈÄâÊã©ÂÖ∂‰ªñÁöÑÈÅìË∑Ø„ÄÇ‰ΩÜÊó†ËÆ∫Â¶Ç‰ΩïÔºåËøôÊÆµÁªèÂéÜÈÉΩÂ∞ÜÊàê‰∏∫‰Ω†ÁèçË¥µÁöÑÂõûÂøÜ„ÄÇ</p>`;
                text += `</div>`;
                
                // ÊúÄÁªàÊï∞ÊçÆ
                text += `<div style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">`;
                text += `<h3>üìä ÊúÄÁªàÊï∞ÊçÆ</h3>`;
                text += `<ul style="text-align: left; margin-left: 20px; line-height: 1.8;">`;
                text += `<li>ËÆ≠ÁªÉÊ¨°Êï∞Ôºö${stats.totalTrainings}</li>`;
                text += `<li>ÊØîËµõÂú∫Ê¨°Ôºö${stats.casualMatchesPlayed}ÔºàÈáéÁêÉÔºâ+ ${stats.formalMatchesPlayed}ÔºàÊ≠£ÂºèÔºâ</li>`;
                text += `<li>ÊúÄÈ´òÊäÄËÉΩÔºö${maxSkillName}(${maxSkill})</li>`;
                text += `<li>ÊÄªÊ∂àË¥πÔºö${stats.totalMoneySpent}ÂÖÉ</li>`;
                text += `<li>Â£∞ÊúõÔºö${player.reputation}</li>`;
                text += `</ul>`;
                text += `</div>`;
                
                // ÊïôÁªÉÁöÑÂØÑËØ≠
                text += `<div style="margin: 20px 0; padding: 15px; background: rgba(255,215,0,0.1); border-radius: 10px;">`;
                text += `<h3>üåü ÊïôÁªÉÁöÑÂØÑËØ≠</h3>`;
                text += `<p>"ÊØè‰∏™‰∫∫ÈÉΩÊúâËá™Â∑±ÁöÑËäÇÂ•èÂíåÈÅìË∑Ø„ÄÇ‰Ω†Ê≤°ËÉΩËøõÂÖ•Ê†°ÈòüÔºå‰ΩÜËøô‰∏ç‰ª£Ë°®‰Ω†Â§±Ë¥•‰∫Ü„ÄÇ"</p>`;
                text += `<br>`;
                text += `<p>"ÊéíÁêÉÊïô‰ºöÊàë‰ª¨ÁöÑÔºå‰∏çÂè™ÊòØÂ¶Ç‰ΩïËµ¢ÂæóÊØîËµõÔºåÊõ¥ÊòØÂ¶Ç‰ΩïÈù¢ÂØπÊå´ÊäòÔºåÂ¶Ç‰ΩïÂùöÊåÅÊ¢¶ÊÉ≥„ÄÇ"</p>`;
                text += `<br>`;
                text += `<p>"ËÆ∞‰ΩèËøô12Âë®ÁöÑÁªèÂéÜÔºåÂÆÉ‰ª¨‰ºöËÆ©‰Ω†ÂèòÂæóÊõ¥Âº∫„ÄÇ‰∏ãÊ¨°Ôºå‰Ω†‰∏ÄÂÆöËÉΩÂÅöÂæóÊõ¥Â•Ω„ÄÇ"</p>`;
                text += `</div>`;
                
                // ÁªìÂ±ÄÊ†áËØÜ
                text += `<div style="margin: 20px 0; padding: 20px; background: rgba(100,116,139,0.2); border: 2px solid #64748b; border-radius: 10px; text-align: center;">`;
                text += `<h3 style="color: #94a3b8;">üîÑ ÈöêËóèÁªìÂ±ÄÔºöÁã¨Ë°åËÄÖ</h3>`;
                text += `<p style="color: #fbbf24;">ÊàêÂ∞±Ëß£ÈîÅÔºö„ÄêÂè¶‰∏ÄÊù°Ë∑Ø„Äë</p>`;
                text += `<br>`;
                text += `<p>ËøôÊòØ‰∏ÄÊÆµ‰∏çÂÆåÁæé‰ΩÜÁúüÂÆûÁöÑÊóÖÁ®ã„ÄÇ</p>`;
                text += `<p><strong>ÊÉ≥Ë¶Å‰∏çÂêåÁöÑÁªìÂ±ÄÂêóÔºüÈáçÊñ∞ÂºÄÂßãÂêßÔºÅ</strong></p>`;
                text += `</div>`;
                
                return text;
            }
            
            // ====================================================
            // ÁªìÊùüÈöêËóèÁªìÂ±ÄÊñáÊú¨ÁîüÊàêÁ≥ªÁªü
            // ====================================================
            
            randomName() {
                const randomName = generateRandomName();
                const nameInput = document.getElementById('player-name-input');
                if (nameInput) {
                    nameInput.value = randomName;
                    // Ê∑ªÂä†‰∏Ä‰∏™Â∞èÂä®ÁîªÊïàÊûú
                    nameInput.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        nameInput.style.transform = 'scale(1)';
                    }, 200);
                }
            }
            
            rerollAttributes() {
                if (this.rerollsRemaining <= 0) {
                    return;
                }
                
                this.rerollsRemaining--;
                this.rollAttributes();
                this.updateInitialSkillsDisplay();
                
                // Êõ¥Êñ∞Âë®ÂºÄÂßãÊï∞ÊçÆÂø´ÁÖßÔºàÂõ†‰∏∫ÈáçÊñ∞ÈöèÊú∫‰∫ÜÂàùÂßãÂÄºÔºâ
                this.player.weekStartStats = {
                    serve: this.player.skills.serve,
                    spike: this.player.skills.spike,
                    block: this.player.skills.block,
                    dig: this.player.skills.dig,
                    set: this.player.skills.set,
                    maxEnergy: this.player.maxEnergy
                };
                
                // Êõ¥Êñ∞Ââ©‰ΩôÊ¨°Êï∞ÊòæÁ§∫
                const rerollCount = document.getElementById('reroll-count');
                const rerollBtn = document.getElementById('reroll-btn');
                if (rerollCount) {
                    rerollCount.textContent = `Ââ©‰ΩôÊ¨°Êï∞Ôºö${this.rerollsRemaining}/5`;
                }
                if (rerollBtn && this.rerollsRemaining <= 0) {
                    rerollBtn.disabled = true;
                    rerollBtn.textContent = 'Â∑≤Áî®ÂÆå';
                }
            }
            
            updateInitialSkillsDisplay() {
                document.getElementById('init-serve').textContent = this.player.skills.serve;
                document.getElementById('init-spike').textContent = this.player.skills.spike;
                document.getElementById('init-block').textContent = this.player.skills.block;
                document.getElementById('init-dig').textContent = this.player.skills.dig;
                document.getElementById('init-set').textContent = this.player.skills.set;
                document.getElementById('init-energy').textContent = this.player.maxEnergy;
                document.getElementById('init-money').textContent = this.player.money;
            }
            
            submitName() {
                const nameInput = document.getElementById('player-name-input');
                const name = nameInput.value.trim();
                
                if (name === '') {
                    alert('ËØ∑ËæìÂÖ•‰Ω†ÁöÑÂêçÂ≠óÔºÅ');
                    return;
                }
                
                this.player.name = name;
                // ‰∏çË¶ÅÂÜçÊ¨°Ë∞ÉÁî® rollAttributes()ÔºåÂõ†‰∏∫Â±ûÊÄßÂ∑≤ÁªèÂú® init() Êó∂ÁîüÊàê
                // Âè™ÈúÄË¶ÅÊõ¥Êñ∞ UI Âç≥ÂèØ
                
                // ÊµãËØïÊ®°Âºè‰∏ãÈöêËóèÈáçÊñ∞ÈöèÊú∫ÊåâÈíÆ
                if (TEST_MODE) {
                    const rerollContainer = document.getElementById('reroll-container');
                    if (rerollContainer) {
                        rerollContainer.style.display = 'none';
                    }
                    console.log('ÊµãËØïÊ®°ÂºèÂ∑≤ÂêØÁî®ÔºåÂàùÂßãÊäÄËÉΩ:', this.player.skills);
                }
                
                // ÂàùÂßãÂåñÂë®ÂºÄÂßãÊï∞ÊçÆÂø´ÁÖß
                this.player.weekStartStats = {
                    serve: this.player.skills.serve,
                    spike: this.player.skills.spike,
                    block: this.player.skills.block,
                    dig: this.player.skills.dig,
                    set: this.player.skills.set,
                    maxEnergy: this.player.maxEnergy
                };
                
                // Êõ¥Êñ∞ UIÔºà‰ΩøÁî®ÂΩìÂâçÂ∑≤ÊúâÁöÑÂ±ûÊÄßÔºâ
                this.updateUI();
                
                // ÊòæÁ§∫ËÉΩÂäõÈù¢ÊùøÂíåÊ∏∏ÊàèÂ§¥ÈÉ®
                document.getElementById('character-panel').classList.add('show');
                document.getElementById('game-header').classList.add('show');
                
                // Áõ¥Êé•ËøõÂÖ•Ê∏∏ÊàèÂºÄÂßãÂú∫ÊôØ
                this.currentScene = 'start';
                this.showScene('start');
            }
            
            rollAttributes() {
                // ÊµãËØïÊ®°Âºè‰∏ãË∑≥ËøáÈöèÊú∫ÁîüÊàê
                if (TEST_MODE) {
                    console.log('ÊµãËØïÊ®°ÂºèÔºöË∑≥ËøáÈöèÊú∫Â±ûÊÄßÁîüÊàê');
                    this.updateUI();
                    this.updateInitialSkillsDisplay();
                    return;
                }
                
                // ‰ΩøÁî®Êõ¥Âπ≥Ë°°ÁöÑÈöèÊú∫ÁÆóÊ≥ï
                // ÊÄªÁÇπÊï∞Âõ∫ÂÆöÂú®20-25‰πãÈó¥ÔºåÁÑ∂ÂêéÂàÜÈÖçÂà∞5‰∏™ÊäÄËÉΩ
                const totalPoints = Math.floor(Math.random() * 6) + 20; // 20-25ÁÇπ
                let remainingPoints = totalPoints;
                const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                
                // ÂÖàÁªôÊØè‰∏™ÊäÄËÉΩÂàÜÈÖçÊúÄÂ∞ë1ÁÇπ
                skills.forEach(skill => {
                    this.player.skills[skill] = 1;
                    remainingPoints -= 1;
                });
                
                // ÈöèÊú∫ÂàÜÈÖçÂâ©‰ΩôÁÇπÊï∞
                while (remainingPoints > 0) {
                    const randomSkill = skills[Math.floor(Math.random() * skills.length)];
                    if (this.player.skills[randomSkill] < 8) { // ÂçïÈ°πÊúÄÈ´ò8
                        this.player.skills[randomSkill]++;
                        remainingPoints--;
                    }
                }
                
                // ÈöèÊú∫ÁîüÊàê‰ΩìÂäõ‰∏äÈôêÔºåËåÉÂõ¥Âú®85-105‰πãÈó¥ÔºàÊõ¥ÈõÜ‰∏≠Ôºâ
                this.player.maxEnergy = Math.floor(Math.random() * 21) + 85;
                this.player.energy = this.player.maxEnergy;
                
                // ÈöèÊú∫ÁîüÊàêÂàùÂßãÈáëÈí±ÔºåËåÉÂõ¥Âú®400-600‰πãÈó¥
                this.player.money = Math.floor(Math.random() * 201) + 400;
                
                this.updateUI();
                this.updateInitialSkillsDisplay();
            }
            
            updateWeeklyHub() {
                const canTrain = this.player.trainingCount < this.player.maxTrainingPerWeek;
                const trainingText = canTrain ? 
                    `Êú¨Âë®ËøòÂèØ‰ª•ËÆ≠ÁªÉ ${this.player.maxTrainingPerWeek - this.player.trainingCount} Ê¨°` :
                    `Êú¨Âë®ËÆ≠ÁªÉÊ¨°Êï∞Â∑≤Áî®ÂÆå`;
                
                let statusText = '';
                if (this.player.energy < 30) statusText += '<p style="color: #e74c3c;">‚ö†Ô∏è ‰ΩìÂäõ‰∏çË∂≥ÔºåÈúÄË¶Å‰ºëÊÅØÔºÅ</p>';
                if (this.player.mood < 40) statusText += '<p style="color: #e67e22;">‚ö†Ô∏è ÂøÉÊÉÖ‰ΩéËêΩÔºåÂª∫ËÆÆÊîæÊùæ‰∏Ä‰∏ã</p>';
                if (this.player.stress > 70) statusText += '<p style="color: #e74c3c;">‚ö†Ô∏è ÂéãÂäõËøáÂ§ßÔºåÂ∞èÂøÉÂΩ±ÂìçË°®Áé∞ÔºÅ</p>';
                
                // Âë®ÂàùÊèêÁ§∫ÔºàÁ¨¨2Âë®ÂºÄÂßãÊòæÁ§∫Ôºâ
                let weekStartNotice = '';
                if (this.player.week > 1 && this.player.trainingCount === 0 && !this.weekStartNoticeShown) {
                    const allowance = this.player.weeklyAllowance || 120;
                    console.log(`Âë®ÂàùÊèêÁ§∫ - Âë®Êï∞:${this.player.week}, Èòü‰ºç:${this.player.team}, Èõ∂Ëä±Èí±:${allowance}, Èô¢ÈòüÊèêÁ§∫Â∑≤ÊòæÁ§∫:${this.player.collegeAllowanceNoticeShown}`);
                    
                    weekStartNotice = `<p style="color: #2ecc71; background: rgba(46, 204, 113, 0.1); padding: 10px; border-radius: 5px; margin: 10px 0;">üí∞ Ëé∑ÂæóÊú¨Âë®Èõ∂Ëä±Èí± +${allowance}ÂÖÉÔºåüí™ ‰ΩìÂäõ +60</p>`;
                    
                    // È¶ñÊ¨°Âä†ÂÖ•Èô¢ÈòüÂêéÁöÑÁâπÊÆäÊèêÁ§∫ÔºàÁ¨¨2Âë®ÊàñÁ¨¨3Âë®ÔºåÂàöÂä†ÂÖ•Èô¢ÈòüÔºâ
                    if ((this.player.week === 2 || this.player.week === 3) && this.player.team === 'college' && allowance === 150 && !this.player.collegeAllowanceNoticeShown) {
                        console.log('ÊòæÁ§∫Èô¢ÈòüÈõ∂Ëä±Èí±ÊèêÁ§∫');
                        weekStartNotice += '<p style="color: #ffd700; background: rgba(255, 215, 0, 0.1); padding: 10px; border-radius: 5px; margin: 10px 0;">ÔøΩ  Áà∂ÊØçÂæóÁü•‰Ω†Âä†ÂÖ•Èô¢ÈòüÂêéÂæàÈ´òÂÖ¥Ôºö<br>„ÄåÂ§™Â•Ω‰∫ÜÔºÅ‰ª•ÂêéÊØèÂë®Â§öÁªô‰Ω†30ÂÖÉÈõ∂Ëä±Èí±ÔºåÂ•ΩÂ•ΩËÆ≠ÁªÉÔºÅ„Äç<br><strong>ÊØèÂë®Èõ∂Ëä±Èí±Ôºö120ÂÖÉ ‚Üí 150ÂÖÉ</strong></p>';
                        this.player.collegeAllowanceNoticeShown = true;
                    }
                    
                    // È¶ñÊ¨°Âä†ÂÖ•Ê†°ÈòüÂêéÁöÑÁâπÊÆäÊèêÁ§∫
                    if (this.player.team === 'university' && allowance === 200 && !this.player.universityAllowanceNoticeShown) {
                        console.log('ÊòæÁ§∫Ê†°ÈòüÈõ∂Ëä±Èí±ÊèêÁ§∫');
                        weekStartNotice += '<p style="color: #ffd700; background: rgba(255, 215, 0, 0.1); padding: 10px; border-radius: 5px; margin: 10px 0;">üåü Áà∂ÊØçÂæóÁü•‰Ω†ËøõÂÖ•Ê†°ÈòüÂêéÊøÄÂä®‰∏çÂ∑≤Ôºö<br>„ÄåÂ±ÖÁÑ∂Ëøõ‰∫ÜÊ†°ÈòüÔºÅÁà∏Â¶à‰∏∫‰Ω†È™ÑÂÇ≤ÔºÅ‰ª•ÂêéÊØèÂë®Áªô‰Ω†200ÂÖÉÔºåÈúÄË¶Å‰ªÄ‰πàÂ∞ΩÁÆ°ËØ¥ÔºÅ„Äç<br><strong>ÊØèÂë®Èõ∂Ëä±Èí±Ôºö150ÂÖÉ ‚Üí 200ÂÖÉ</strong></p>';
                        this.player.universityAllowanceNoticeShown = true;
                    }
                    
                    this.weekStartNoticeShown = true;
                }
                
                // Ê£ÄÊü•ÊòØÂê¶Âà∞ËææÁõÆÊ†áÂë®
                const goalInfo = this.getGoalInfo();
                let goalNotice = '';
                
                if (goalInfo.deadline && this.player.week >= goalInfo.deadline) {
                    goalNotice = '<p style="color: #2ecc71; font-weight: bold;">‚ú® ÈÄâÊãî/ÊØîËµõÊó∂Èó¥Â∑≤Âà∞ÔºÅ</p>';
                }
                
                SCENES.weeklyHub.text = `<h2>üìÖ Á¨¨ ${this.player.week} Âë®</h2>
                ${weekStartNotice}
                <p>${trainingText}</p>
                ${statusText}
                ${goalNotice}
                <p style="margin-top: 15px;">‰Ω†ÊÉ≥ÂÅö‰ªÄ‰πàÔºü</p>`;
                
                // Ê†πÊçÆÈòü‰ºçÁä∂ÊÄÅÂÜ≥ÂÆöËÆ≠ÁªÉÂú∫ÊôØ
                let trainingScene = 'trainingChoice'; // ÈªòËÆ§Âü∫Á°ÄËÆ≠ÁªÉ
                if (this.player.team === 'university') {
                    trainingScene = 'universityTeam';
                } else if (this.player.team === 'college') {
                    trainingScene = 'collegeTeam';
                }
                
                SCENES.weeklyHub.choices = [
                    {
                        text: 'üèãÔ∏è ËøõË°åËÆ≠ÁªÉ',
                        next: trainingScene,
                        requirement: { trainingCount: this.player.maxTrainingPerWeek - 1, maxCheck: true }
                    },
                    {
                        text: 'üõí ÂïÜÂ∫ó',
                        next: 'shopMain'
                    },
                    {
                        text: '‚è≠Ô∏è ÁªìÊùüÊú¨Âë®',
                        next: 'weekEnd'
                    }
                ];
                
                // Â¶ÇÊûúÂ∑≤Âä†ÂÖ•Èòü‰ºç‰ΩÜËøòÊ≤°ÈÄâÊã©‰ΩçÁΩÆÔºåÊ∑ªÂä†‰ΩçÁΩÆÈÄâÊã©ÂÖ•Âè£
                if ((this.player.team === 'college' || this.player.team === 'university') && this.player.position === 'none') {
                    SCENES.weeklyHub.choices.splice(SCENES.weeklyHub.choices.length - 1, 0, {
                        text: 'üéØ ÈÄâÊã©Âú∫‰∏ä‰ΩçÁΩÆ',
                        next: 'positionSelection'
                    });
                }
                
                // Â¶ÇÊûúÊúâË∂≥Â§üÁöÑÊäÄËÉΩÔºåÊ∑ªÂä†ÈÄâÊãîÈÄâÈ°πÔºàÂè™‰øùÁïôÈÄâÊãîÔºå‰∏çÂåÖÊã¨ÊØîËµõÔºâ
                // Ê†πÊçÆÂΩìÂâçÁõÆÊ†áÂíåÂë®Êï∞Ê∑ªÂä†ÈÄâÊãîÈÄâÈ°π
                if (this.currentGoal === 'collegeTryout' && this.player.week >= 2 && this.player.team === 'none') {
                    // ‰ΩøÁî®Êñ∞ÁöÑËØÑ‰º∞Á≥ªÁªüÊ£ÄÊü•ÊòØÂê¶Êª°Ë∂≥Êù°‰ª∂
                    const goalInfo = this.getGoalInfo();
                    const evaluation = this.evaluateGoal(goalInfo);
                    const canTryout = evaluation.score >= 0.7; // 70%Âç≥ÂèØÂèÇÂä†
                    
                    SCENES.weeklyHub.choices.splice(SCENES.weeklyHub.choices.length - 1, 0, {
                        text: 'üèÜ ÂèÇÂä†Èô¢ÈòüÈÄâÊãî',
                        next: 'collegeTryout',
                        requirement: canTryout ? {} : { serve: 999 } // Â¶ÇÊûúÊª°Ë∂≥Êù°‰ª∂ÂàôÊó†Ë¶ÅÊ±ÇÔºåÂê¶ÂàôËÆæÁΩÆ‰∏çÂèØËÉΩËææÂà∞ÁöÑË¶ÅÊ±Ç
                    });
                } else if (this.currentGoal === 'universityTryout' && this.player.week >= 8 && this.player.team === 'college') {
                    const goalInfo = this.getGoalInfo();
                    const evaluation = this.evaluateGoal(goalInfo);
                    
                    // Ê†°ÈòüÈÄâÊãîÂøÖÈ°ªÊâÄÊúâÊù°‰ª∂ÈÉΩËææÊ†áÔºà‰∏çÊòØÂä†ÊùÉÂπ≥ÂùáÔºâ
                    const skillCountPassed = evaluation.breakdown.skillCount?.details?.progress >= 1.0;
                    const skillSumPassed = evaluation.breakdown.skillSum?.details?.progress >= 1.0;
                    const reputationPassed = evaluation.breakdown.stats?.details?.reputation?.progress >= 1.0;
                    const canTryout = skillCountPassed && skillSumPassed && reputationPassed;
                    
                    SCENES.weeklyHub.choices.splice(SCENES.weeklyHub.choices.length - 1, 0, {
                        text: '‚≠ê Áî≥ËØ∑Ê†°ÈòüÈÄâÊãî',
                        next: 'universityTryout',
                        requirement: canTryout ? {} : { serve: 999 }
                    });
                }
                
                // ÊØîËµõ‰ºöÂú®Âõ∫ÂÆöÂë®Êï∞Ëá™Âä®Ëß¶ÂèëÔºå‰∏çÈúÄË¶ÅÊåâÈíÆ
            }
            
            triggerRandomEvent(eventType) {
                // 30% Ê¶ÇÁéáËß¶Âèë‰∫ã‰ª∂
                if (Math.random() > 0.3) {
                    return null;
                }
                
                // Á≠õÈÄâÁ¨¶ÂêàÁ±ªÂûãÁöÑ‰∫ã‰ª∂
                let availableEvents = RANDOM_EVENTS.filter(e => e.type === eventType);
                if (availableEvents.length === 0) return null;
                
                // Ê†πÊçÆÊù°‰ª∂ÂíåÊùÉÈáçËÆ°ÁÆóÊØè‰∏™‰∫ã‰ª∂ÁöÑËß¶ÂèëÊ¶ÇÁéá
                const weightedEvents = [];
                availableEvents.forEach(event => {
                    let weight = 1; // ÈªòËÆ§ÊùÉÈáç
                    
                    // Ê£ÄÊü•ÊòØÂê¶Êª°Ë∂≥Êù°‰ª∂
                    if (event.condition) {
                        const { operator } = event.condition;
                        let conditionMet = false;
                        
                        // ÊîØÊåÅÂ§öÂ±ûÊÄßÊù°‰ª∂Ê£ÄÊü•
                        if (operator === '<') {
                            // Â∞è‰∫éÊù°‰ª∂ÔºàÂ¶Ç‰ΩìÂäõ<30Ôºâ
                            for (let key in event.condition) {
                                if (key !== 'operator' && this.player[key] !== undefined) {
                                    if (this.player[key] < event.condition[key]) {
                                        conditionMet = true;
                                        break;
                                    }
                                }
                            }
                        } else if (operator === '>') {
                            // Â§ß‰∫éÊù°‰ª∂ÔºàÂ¶ÇÂ£∞Êúõ>50Ôºâ
                            let allMet = true;
                            for (let key in event.condition) {
                                if (key !== 'operator' && this.player[key] !== undefined) {
                                    if (this.player[key] <= event.condition[key]) {
                                        allMet = false;
                                        break;
                                    }
                                }
                                // Ê£ÄÊü•ÊäÄËÉΩ
                                if (key !== 'operator' && this.player.skills && this.player.skills[key] !== undefined) {
                                    if (this.player.skills[key] <= event.condition[key]) {
                                        allMet = false;
                                        break;
                                    }
                                }
                            }
                            conditionMet = allMet;
                        }
                        
                        // Â¶ÇÊûúÊù°‰ª∂Êª°Ë∂≥ÔºåÂ∫îÁî®ÊùÉÈáçÂä†Êàê
                        if (conditionMet && event.weight) {
                            weight = event.weight;
                        } else if (!conditionMet && event.weight) {
                            // Êù°‰ª∂‰∏çÊª°Ë∂≥‰ΩÜÊúâÊù°‰ª∂ÈôêÂà∂ÁöÑ‰∫ã‰ª∂ÔºåÈôç‰ΩéÊùÉÈáç
                            weight = 0.3;
                        }
                    }
                    
                    // Êä§ËÜùÊä§ËÖïÈôç‰ΩéÂèó‰º§‰∫ã‰ª∂ÊùÉÈáç
                    const injuryEvents = ['injury_risk', 'serious_injury'];
                    if (injuryEvents.includes(event.id) && this.player.ownedItems?.protection) {
                        const resistPercent = this.player.ownedItems.protection.injuryResist || 0;
                        weight = weight * (1 - resistPercent / 100);
                        console.log(`Êä§ËÜùÊä§ËÖïÈôç‰ΩéÂèó‰º§‰∫ã‰ª∂ÊùÉÈáç: ${event.id}, Ë∞ÉÊï¥ÂêéÊùÉÈáç: ${weight.toFixed(2)}`);
                    }
                    
                    // Â∞Ü‰∫ã‰ª∂ÊåâÊùÉÈáçÊ∑ªÂä†Âà∞ÂàóË°®‰∏≠
                    for (let i = 0; i < weight; i++) {
                        weightedEvents.push(event);
                    }
                });
                
                if (weightedEvents.length === 0) return null;
                
                // ‰ªéÂä†ÊùÉÂàóË°®‰∏≠ÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™‰∫ã‰ª∂
                const event = weightedEvents[Math.floor(Math.random() * weightedEvents.length)];
                return event;
            }
            
            showRandomEvent(event) {
                this.currentEvent = event;
                this.currentEventType = event.type; // ËÆ∞ÂΩï‰∫ã‰ª∂Á±ªÂûã
                
                // ‰ΩøÁî®ÂºπÁ™óÊòæÁ§∫‰∫ã‰ª∂
                const modal = document.getElementById('event-modal');
                const title = document.getElementById('event-modal-title');
                const text = document.getElementById('event-modal-text');
                const choicesDiv = document.getElementById('event-modal-choices');
                
                // Á°Æ‰øùÂÖÉÁ¥†Â≠òÂú®
                if (!modal || !title || !text || !choicesDiv) {
                    console.error('Modal elements not found');
                    return;
                }
                
                title.textContent = event.title;
                text.textContent = event.text;
                choicesDiv.innerHTML = '';
                
                event.choices.forEach(choice => {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    button.textContent = choice.text;
                    
                    if (choice.requirement) {
                        const meetsRequirement = this.checkRequirement(choice.requirement);
                        if (!meetsRequirement) {
                            button.disabled = true;
                            button.textContent += ' (Êù°‰ª∂‰∏çË∂≥)';
                        }
                    }
                    
                    button.onclick = () => {
                        // Â∫îÁî®ÊïàÊûú
                        if (choice.effect) {
                            this.applyEffect(choice.effect);
                        }
                        
                        // Âú®ÂºπÁ™ó‰∏≠ÊòæÁ§∫ÁªìÊûú
                        title.textContent = '‚ú® ÁªìÊûú';
                        text.innerHTML = this.formatEventResult(choice.result, choice.effect);
                        choicesDiv.innerHTML = '';
                        
                        const continueBtn = document.createElement('button');
                        continueBtn.className = 'choice-btn';
                        continueBtn.textContent = 'ÁªßÁª≠';
                        continueBtn.onclick = () => {
                            modal.classList.remove('show');
                            
                            // Ê†πÊçÆ‰∫ã‰ª∂Á±ªÂûãÂÜ≥ÂÆö‰∏ã‰∏ÄÊ≠•
                            if (this.currentEventType === 'training') {
                                // ËÆ≠ÁªÉ‰∫ã‰ª∂ÂêéËøõÂÖ•ËØæ‰ΩôÁîüÊ¥ª
                                this.currentScene = 'lifeChoice';
                                this.showScene('lifeChoice');
                            } else {
                                // ÁîüÊ¥ª‰∫ã‰ª∂ÂêéËøîÂõûÂë®ÈÄâÊã©
                                this.currentScene = 'weeklyHub';
                                this.showScene('weeklyHub');
                            }
                        };
                        choicesDiv.appendChild(continueBtn);
                    };
                    
                    choicesDiv.appendChild(button);
                });
                
                // ÊòæÁ§∫ÂºπÁ™ó
                modal.classList.add('show');
            }
            
            formatEventResult(result, effect) {
                let html = `<p>${result}</p>`;
                
                // ÊûÑÂª∫Â±ûÊÄßÂèòÂåñÊòæÁ§∫
                let changesText = '<br><strong>Â±ûÊÄßÂèòÂåñÔºö</strong><br>';
                let hasChanges = false;
                
                if (effect.serve) {
                    changesText += `üéØ ÂèëÁêÉ ${effect.serve > 0 ? '+' : ''}${effect.serve}<br>`;
                    hasChanges = true;
                }
                if (effect.spike) {
                    changesText += `‚ö° Êâ£ÁêÉ ${effect.spike > 0 ? '+' : ''}${effect.spike}<br>`;
                    hasChanges = true;
                }
                if (effect.block) {
                    changesText += `üõ°Ô∏è Êã¶ÁΩë ${effect.block > 0 ? '+' : ''}${effect.block}<br>`;
                    hasChanges = true;
                }
                if (effect.dig) {
                    changesText += `ü§∏ Âû´ÁêÉ ${effect.dig > 0 ? '+' : ''}${effect.dig}<br>`;
                    hasChanges = true;
                }
                if (effect.set) {
                    changesText += `üôå ÊâòÁêÉ ${effect.set > 0 ? '+' : ''}${effect.set}<br>`;
                    hasChanges = true;
                }
                if (effect.energy) {
                    changesText += `üí™ ‰ΩìÂäõ ${effect.energy > 0 ? '+' : ''}${effect.energy}<br>`;
                    hasChanges = true;
                }
                if (effect.mood) {
                    changesText += `üòä ÂøÉÊÉÖ ${effect.mood > 0 ? '+' : ''}${effect.mood}<br>`;
                    hasChanges = true;
                }
                if (effect.stress) {
                    changesText += `üò∞ ÂéãÂäõ ${effect.stress > 0 ? '+' : ''}${effect.stress}<br>`;
                    hasChanges = true;
                }
                if (effect.reputation) {
                    changesText += `‚≠ê Â£∞Êúõ ${effect.reputation > 0 ? '+' : ''}${effect.reputation}<br>`;
                    hasChanges = true;
                }
                if (effect.money) {
                    changesText += `üí∞ ÈáëÈí± ${effect.money > 0 ? '+' : ''}${effect.money}<br>`;
                    hasChanges = true;
                }
                if (effect.relationship) {
                    changesText += `üë• ÈòüÂèãÂÖ≥Á≥ª ${effect.relationship > 0 ? '+' : ''}${effect.relationship}<br>`;
                    hasChanges = true;
                }
                
                if (hasChanges) {
                    html += changesText;
                }
                
                return html;
            }
            
            // ÂàÆÂàÆ‰πêÁ≥ªÁªü
            buyScratchCard(checkAdventure = false) {
                // ËøΩË∏™ÂàÆÂàÆ‰πêÊ¥ªÂä®
                this.trackLifeActivity('scratchCard');
                
                // ÊâßË°åÊäΩÂ•ñ
                const result = this.scratchCardDraw();
                
                // ÊòæÁ§∫ÁªìÊûúÂºπÁ™óÔºà‰º†ÂÖ•ÊòØÂê¶ÈúÄË¶ÅÊ£ÄÊü•Â•áÈÅá‰∫ã‰ª∂Ôºâ
                this.showScratchCardResult(result, checkAdventure);
            }
            
            scratchCardDraw(boostedLuck = false) {
                let random = Math.random() * 100;
                
                // Â¶ÇÊûúÊòØÁ•ûÁßòËÄÅ‰∫∫Ëµ†ÈÄÅÁöÑÂàÆÂàÆ‰πêÔºåÊèêÈ´ò‰∏≠Â•ñÊ¶ÇÁéá
                if (boostedLuck) {
                    // Ë∞¢Ë∞¢ÊÉ†È°æÊ¶ÇÁéáÈôçÂà∞10%
                    if (random >= 70) {
                        random = random * 0.625; // Â∞Ü70-100Êò†Â∞ÑÂà∞0-18.75
                    }
                }
                
                let result;
                if (random < 2) {
                    // ÁâπÁ≠âÂ•ñ 2%
                    result = {
                        level: 'grand',
                        name: 'ÁâπÁ≠âÂ•ñ',
                        icon: 'üèÜ',
                        rewards: { money: 800, mood: 40, reputation: 20 },
                        message: 'ÊÅ≠Âñú‰∏≠ÁâπÁ≠âÂ•ñÔºÅÂ§ßÂ•ñÔºÅ'
                    };
                    // ËøΩË∏™ÁâπÁ≠âÂ•ñÊ¨°Êï∞
                    this.playerStats.scratchCardJackpots = (this.playerStats.scratchCardJackpots || 0) + 1;
                } else if (random < 10) {
                    // ‰∏ÄÁ≠âÂ•ñ 8%
                    result = {
                        level: 'first',
                        name: '‰∏ÄÁ≠âÂ•ñ',
                        icon: 'ü•á',
                        rewards: { money: 300, mood: 25, reputation: 12 },
                        message: 'ÊÅ≠Âñú‰∏≠‰∏ÄÁ≠âÂ•ñÔºÅ'
                    };
                } else if (random < 25) {
                    // ‰∫åÁ≠âÂ•ñ 15%
                    result = {
                        level: 'second',
                        name: '‰∫åÁ≠âÂ•ñ',
                        icon: 'ü•à',
                        rewards: { money: 150, mood: 18, reputation: 5 },
                        message: 'ÊÅ≠Âñú‰∏≠‰∫åÁ≠âÂ•ñÔºÅ'
                    };
                } else if (random < 50) {
                    // ‰∏âÁ≠âÂ•ñ 25%
                    result = {
                        level: 'third',
                        name: '‰∏âÁ≠âÂ•ñ',
                        icon: 'ü•â',
                        rewards: { money: 80, mood: 12 },
                        message: 'ÊÅ≠Âñú‰∏≠‰∏âÁ≠âÂ•ñÔºÅ'
                    };
                } else if (random < 70) {
                    // ÂÆâÊÖ∞Â•ñ 20%
                    result = {
                        level: 'consolation',
                        name: 'ÂÆâÊÖ∞Â•ñ',
                        icon: 'üéÅ',
                        rewards: { money: 40, mood: 8 },
                        message: 'Ëé∑ÂæóÂÆâÊÖ∞Â•ñ'
                    };
                } else {
                    // Ë∞¢Ë∞¢ÊÉ†È°æ 30%
                    result = {
                        level: 'nothing',
                        name: 'Ë∞¢Ë∞¢ÊÉ†È°æ',
                        icon: 'üòÖ',
                        rewards: { mood: 3 },
                        message: 'Ë∞¢Ë∞¢ÊÉ†È°æ'
                    };
                }
                
                return result;
            }
            
            showScratchCardResult(result, checkAdventure = false) {
                // Â∫îÁî®Â•ñÂä±
                if (result.rewards.money) {
                    this.player.money += result.rewards.money;
                }
                if (result.rewards.mood) {
                    this.player.mood = Math.min(100, this.player.mood + result.rewards.mood);
                }
                if (result.rewards.reputation) {
                    this.player.reputation += result.rewards.reputation;
                }
                
                // Êõ¥Êñ∞ÁªüËÆ°
                if (!this.playerStats.scratchCards) {
                    this.playerStats.scratchCards = {
                        total: 0,
                        grand: 0,
                        first: 0,
                        second: 0,
                        third: 0,
                        consolation: 0,
                        nothing: 0,
                        totalSpent: 0,
                        totalEarned: 0
                    };
                }
                this.playerStats.scratchCards.total++;
                this.playerStats.scratchCards[result.level]++;
                this.playerStats.scratchCards.totalSpent += 30;
                this.playerStats.scratchCards.totalEarned += (result.rewards.money || 0);
                
                // ÊûÑÂª∫Â•ñÂä±ÊñáÊú¨
                let rewardsText = '';
                if (result.rewards.money) rewardsText += `üí∞ ÈáëÈí± +${result.rewards.money}<br>`;
                if (result.rewards.mood) rewardsText += `üòä ÂøÉÊÉÖ +${result.rewards.mood}<br>`;
                if (result.rewards.reputation) rewardsText += `‚≠ê Â£∞Êúõ +${result.rewards.reputation}<br>`;
                
                if (rewardsText === '') {
                    rewardsText = 'ÂÜçÊé•ÂÜçÂéâÔºÅ<br>‰∏ãÊ¨°‰∏ÄÂÆöËÉΩ‰∏≠Â•ñÔºÅ';
                }
                
                // ÊòæÁ§∫ÂºπÁ™ó
                const modal = document.getElementById('event-modal');
                const title = document.getElementById('event-modal-title');
                const text = document.getElementById('event-modal-text');
                const choicesDiv = document.getElementById('event-modal-choices');
                const modalContent = document.getElementById('event-modal-content');
                
                // Á°Æ‰øùÊâÄÊúâÂÖÉÁ¥†Â≠òÂú®
                if (!modal || !title || !text || !choicesDiv || !modalContent) {
                    console.error('Modal elements not found');
                    return;
                }
                
                // ÈáçÁΩÆmodalÁöÑdisplayÊ†∑ÂºèÔºàÂèØËÉΩË¢´Â•áÈÅá‰∫ã‰ª∂ËÆæÁΩÆ‰∏∫noneÔºâ
                modal.style.display = '';
                
                // ËÆæÁΩÆÊ†∑ÂºèÁ±ª
                modalContent.className = `scratch-card-result scratch-${result.level}-prize`;
                
                // ËÆæÁΩÆÂÜÖÂÆπ
                title.innerHTML = `<div class="scratch-card-icon">${result.icon}</div>`;
                text.innerHTML = `<h2 class="scratch-card-title">${result.message}</h2>
                    <div class="scratch-card-rewards">${rewardsText}</div>`;
                
                choicesDiv.innerHTML = '';
                const continueBtn = document.createElement('button');
                continueBtn.className = 'choice-btn scratch-card-close';
                continueBtn.textContent = 'Á°ÆÂÆö';
                continueBtn.onclick = () => {
                    modal.classList.remove('show');
                    modal.style.display = ''; // ÈáçÁΩÆdisplay
                    modalContent.className = ''; // ÈáçÁΩÆÊ†∑Âºè
                    
                    // Â¶ÇÊûúÈúÄË¶ÅÊ£ÄÊü•Â•áÈÅá‰∫ã‰ª∂
                    if (checkAdventure) {
                        const hasEvent = this.checkSpecificAdventureEvent('scratchCard');
                        if (hasEvent) {
                            // Ëß¶Âèë‰∫ÜÂ•áÈÅá‰∫ã‰ª∂Ôºå‰∏çËøîÂõûÂë®ÈÄâÊã©ÔºàÂ•áÈÅá‰∫ã‰ª∂‰ºöÂ§ÑÁêÜÔºâ
                            return;
                        }
                    }
                    
                    // ËøîÂõûÂë®ÈÄâÊã©
                    this.currentScene = 'weeklyHub';
                    this.showScene('weeklyHub');
                };
                choicesDiv.appendChild(continueBtn);
                
                // Êõ¥Êñ∞UI
                this.updateUI();
                
                // ÊòæÁ§∫ÂºπÁ™ó
                modal.classList.add('show');
            }
            
            nextWeek() {
                // ‰øùÂ≠òÊú¨Âë®ÂºÄÂßãÊó∂ÁöÑÊï∞ÊçÆÂø´ÁÖß
                this.player.weekStartStats = {
                    serve: this.player.skills.serve,
                    spike: this.player.skills.spike,
                    block: this.player.skills.block,
                    dig: this.player.skills.dig,
                    set: this.player.skills.set,
                    maxEnergy: this.player.maxEnergy
                };
                
                this.player.week++;
                this.player.trainingCount = 0;
                this.player.money += (this.player.weeklyAllowance || 120); // ÊØèÂë®Èõ∂Ëä±Èí±
                this.weekStartNoticeShown = false; // ÈáçÁΩÆÂë®ÂàùÊèêÁ§∫Ê†áÂøó
                
                // Ëá™ÁÑ∂ÊÅ¢Â§ç
                this.player.energy = Math.min(this.player.maxEnergy, this.player.energy + 60);
                this.player.mood = Math.min(100, this.player.mood + 10);
                this.player.stress = Math.max(0, this.player.stress - 10);
                
                // Ê∞∏‰πÖÁâ©ÂìÅÁöÑÊåÅÁª≠ÊïàÊûú
                if (this.player.ownedItems) {
                    // ËøêÂä®ÊâãÁéØÔºöÊØèÂë®Ëá™Âä®ÊÅ¢Â§çÂéãÂäõ-5
                    if (this.player.ownedItems.electronics && this.player.ownedItems.electronics.includes('watch')) {
                        this.player.stress = Math.max(0, this.player.stress - 5);
                    }
                    // Êñ∞ÊâãÊú∫ÔºöÊØèÂë®ÂøÉÊÉÖ+3
                    if (this.player.ownedItems.electronics && this.player.ownedItems.electronics.includes('phone')) {
                        this.player.mood = Math.min(100, this.player.mood + 3);
                    }
                    // Ëê•ÂÖªË°•ÂâÇÂ•óË£ÖÔºöÊØèÂë®‰ΩìÂäõ+10
                    if (this.player.ownedItems.electronics && this.player.ownedItems.electronics.includes('supplement')) {
                        this.player.energy = Math.min(this.player.maxEnergy, this.player.energy + 10);
                    }
                }
                
                // Â§ÑÁêÜbuffÔºàÂáèÂ∞ëÊåÅÁª≠Âë®Êï∞Ôºâ
                if (this.player.activeBuffs) {
                    this.player.activeBuffs = this.player.activeBuffs.filter(buff => {
                        buff.remainingWeeks--;
                        // Ëê•ÂÖªÈ§êËÆ°ÂàíÔºö‰ΩìÂäõ‰∏äÈôêÂä†Êàê
                        if (buff.id === 'nutrition_plan' && buff.effect.maxEnergyBonus) {
                            if (buff.remainingWeeks === 0) {
                                // buffÁªìÊùüÔºåÁßªÈô§‰ΩìÂäõ‰∏äÈôêÂä†Êàê
                                this.player.maxEnergy -= buff.effect.maxEnergyBonus;
                            }
                        }
                        return buff.remainingWeeks > 0;
                    });
                }
                
                this.updateUI();
                
                console.log(`Á¨¨${this.player.week}Âë®ÂºÄÂßãÔºåÂΩìÂâçÈòü‰ºç: ${this.player.team}`);
                
                // Êñ∞Â¢ûÔºöÊ£ÄÊü•ÊòØÂê¶ÊúâÂõ∫ÂÆöÊØîËµõ
                const matchEvent = this.checkScheduledMatch();
                console.log('ÊØîËµõÊ£ÄÊü•ÁªìÊûú:', matchEvent);
                
                if (matchEvent) {
                    // ÊòæÁ§∫ÊØîËµõÈ¢ÑÂëäÂú∫ÊôØÊàñÂêØÂä®Èî¶Ê†áËµõ
                    if (matchEvent.type === 'match') {
                        console.log('Ëß¶ÂèëÊØîËµõÈ¢ÑÂëä:', matchEvent.matchName);
                        this.showMatchPreview(matchEvent.matchType, matchEvent.matchName);
                    } else if (matchEvent.type === 'tournament') {
                        console.log('Ëß¶ÂèëÈî¶Ê†áËµõ:', matchEvent.tournamentType);
                        this.startTournament(matchEvent.tournamentType);
                    } else if (matchEvent.type === 'hiddenEnding') {
                        console.log('Ëß¶ÂèëÈöêËóèÁªìÂ±Ä:', matchEvent.endingId);
                        this.showScene(matchEvent.endingId);
                    } else if (matchEvent.type === 'spectator') {
                        this.showScene(matchEvent.sceneId);
                    } else if (matchEvent.type === 'missed') {
                        this.showScene(matchEvent.sceneId);
                    }
                    return;
                }
                
                // Êñ∞Â¢ûÔºöËß¶ÂèëÂë®Âàù‰∫ã‰ª∂
                const weeklyEvent = this.generateWeeklyEvent();
                if (weeklyEvent) {
                    this.showWeeklyEvent(weeklyEvent);
                    return;
                }
                
                // Ê£ÄÊü•ÂΩìÂâçÁõÆÊ†áÊòØÂê¶Âà∞ËææÊà™Ê≠¢Êó•ÊúüÔºàÈÄâÊãîÁ±ªÔºâ
                const currentGoalInfo = this.getGoalInfo();
                if (currentGoalInfo && currentGoalInfo.deadline && this.player.week >= currentGoalInfo.deadline) {
                    // ÈÄâÊãîÁ±ªÁõÆÊ†áÔºàTryoutÔºâ‰∏çËá™Âä®Ê£ÄÊü•ÔºåÈúÄË¶ÅÁé©ÂÆ∂‰∏ªÂä®Ëß¶Âèë
                    // Âè™ÊúâÊØîËµõÁ±ªÁõÆÊ†áÊâçËá™Âä®Ê£ÄÊü•Ôºà‰ΩÜÁé∞Âú®ÊØîËµõ‰∏çÊòØÁõÆÊ†á‰∫ÜÔºåÊâÄ‰ª•ËøôÊÆµ‰ª£Á†ÅÂÆûÈôÖ‰∏ä‰∏ç‰ºöÊâßË°åÔºâ
                    if (currentGoalInfo.id && !currentGoalInfo.id.includes('Tryout')) {
                        // Âà∞ËææÊà™Ê≠¢Êó•ÊúüÔºåÊ£ÄÊü•ÁõÆÊ†áÂÆåÊàêÊÉÖÂÜµ
                        this.checkGoalCompletion();
                        return;
                    }
                }
                
                // Â¶ÇÊûúÊ≤°ÊúâËß¶Âèë‰ªª‰ΩïÁâπÊÆä‰∫ã‰ª∂ÔºåÊòæÁ§∫Âë®‰∏ªÁïåÈù¢
                this.showScene('weeklyHub');
            }
            
            // Êñ∞Â¢ûÔºöÊ£ÄÊü•Âõ∫ÂÆöÊØîËµõ
            checkScheduledMatch() {
                console.log(`Ê£ÄÊü•Á¨¨${this.player.week}Âë®ÊòØÂê¶ÊúâÊØîËµõ...`);
                
                // Èô¢ÈôÖÊØîËµõÔºöÁ¨¨5Âë®
                if (this.player.week === 5) {
                    console.log('Á¨¨5Âë®Ê£ÄÊü•: Èòü‰ºçÁä∂ÊÄÅ =', this.player.team);
                    if (this.player.team === 'college') {
                        console.log('‚úì Â∑≤Âä†ÂÖ•Èô¢ÈòüÔºåËß¶ÂèëÈô¢ÈôÖÊØîËµõ');
                        return { 
                            type: 'match', 
                            matchType: 'collegeMatch',
                            matchName: 'Èô¢ÈôÖÊØîËµõ'
                        };
                    } else {
                        console.log('‚úó Êú™Âä†ÂÖ•Èô¢ÈòüÔºåËß¶ÂèëÈöêËóèÁªìÂ±ÄÔºöÊóÅËßÇËÄÖ');
                        // Êú™Âä†ÂÖ•Èô¢ÈòüÔºåËß¶ÂèëÈöêËóèÁªìÂ±Ä
                        return {
                            type: 'hiddenEnding',
                            endingId: 'bystander'
                        };
                    }
                }
                
                // Ê†°ÈôÖËÅîËµõÔºöÁ¨¨12Âë®ÔºàÊ∏∏ÊàèÁªìÊùüÔºâ
                if (this.player.week === 12) {
                    console.log('Á¨¨12Âë®Ê£ÄÊü•: Èòü‰ºçÁä∂ÊÄÅ =', this.player.team);
                    if (this.player.team === 'university') {
                        console.log('‚úì Â∑≤Âä†ÂÖ•Ê†°ÈòüÔºåËß¶ÂèëÊ†°ÈôÖËÅîËµõÈî¶Ê†áËµõ');
                        return { 
                            type: 'tournament',  // Êîπ‰∏∫Èî¶Ê†áËµõÁ±ªÂûã
                            tournamentType: 'universityLeague'
                        };
                    } else {
                        console.log('‚úó Êú™Âä†ÂÖ•Ê†°ÈòüÔºåËß¶ÂèëÈöêËóèÁªìÂ±ÄÔºöÁã¨Ë°åËÄÖ');
                        // Êú™Âä†ÂÖ•Ê†°ÈòüÔºåËß¶ÂèëÈöêËóèÁªìÂ±Ä
                        return {
                            type: 'hiddenEnding',
                            endingId: 'loner'
                        };
                    }
                }
                
                return null;
            }
            
            // ====================================================
            // Âë®Âàù‰∫ã‰ª∂Á≥ªÁªü
            // ====================================================
            
            // ÁîüÊàêÂë®Âàù‰∫ã‰ª∂
            generateWeeklyEvent() {
                // Á¨¨1Âë®‰∏çËß¶Âèë‰∫ã‰ª∂
                if (this.player.week === 1) {
                    return null;
                }
                
                const events = this.getWeeklyEventPool();
                const eligibleEvents = events.filter(event => {
                    // Ê£ÄÊü•‰∫ã‰ª∂ÁöÑËß¶ÂèëÊù°‰ª∂
                    if (event.condition) {
                        return event.condition(this.player);
                    }
                    return true;
                });
                
                if (eligibleEvents.length === 0) {
                    return null;
                }
                
                // Ê†πÊçÆÁé©ÂÆ∂Áä∂ÊÄÅËÆ°ÁÆóÊùÉÈáç
                const mood = this.player.mood;
                const stress = this.player.stress;
                
                // ËÆ°ÁÆóÊ≠£Èù¢/Ë¥üÈù¢‰∫ã‰ª∂Ê¶ÇÁéá
                let positiveWeight = 1;
                let negativeWeight = 1;
                
                if (mood >= 70 && stress <= 30) {
                    positiveWeight = 7;
                    negativeWeight = 1;
                } else if (mood >= 50 && stress <= 50) {
                    positiveWeight = 4;
                    negativeWeight = 2;
                } else {
                    positiveWeight = 2;
                    negativeWeight = 5;
                }
                
                // Ê†πÊçÆÊùÉÈáçÁ≠õÈÄâ‰∫ã‰ª∂
                const weightedEvents = eligibleEvents.map(event => {
                    let weight = 1;
                    if (event.mood === 'positive') {
                        weight = positiveWeight;
                    } else if (event.mood === 'negative') {
                        weight = negativeWeight;
                    }
                    return { event, weight };
                });
                
                // Âä†ÊùÉÈöèÊú∫ÈÄâÊã©
                const totalWeight = weightedEvents.reduce((sum, item) => sum + item.weight, 0);
                let random = Math.random() * totalWeight;
                
                for (let item of weightedEvents) {
                    random -= item.weight;
                    if (random <= 0) {
                        return item.event;
                    }
                }
                
                return weightedEvents[0].event;
            }
            
            // ÊòæÁ§∫Âë®Âàù‰∫ã‰ª∂
            showWeeklyEvent(event) {
                // ÂàõÂª∫‰∫ã‰ª∂Âú∫ÊôØ
                const effectText = this.formatEventEffects(event.effects);
                
                SCENES.weeklyEvent = {
                    text: `<h2>üì∞ ${event.title}</h2>
                        <p>${event.text}</p>
                        <div style="margin-top: 15px; padding: 10px; background: #f0f9ff; border-radius: 8px;">
                            <strong>ÂΩ±ÂìçÔºö</strong><br>
                            ${effectText}
                        </div>`,
                    choices: [{
                        text: 'ÁªßÁª≠',
                        next: 'weeklyHub',
                        effect: event.effects
                    }]
                };
                
                this.showScene('weeklyEvent');
            }
            
            // Ê†ºÂºèÂåñ‰∫ã‰ª∂ÊïàÊûúÊòæÁ§∫
            formatEventEffects(effects) {
                let text = '';
                const skillNames = { serve: 'ÂèëÁêÉ', spike: 'Êâ£ÁêÉ', block: 'Êã¶ÁΩë', dig: 'Âû´ÁêÉ', set: 'ÊâòÁêÉ' };
                
                if (effects.serve) text += `üéØ ${skillNames.serve} ${effects.serve > 0 ? '+' : ''}${effects.serve}<br>`;
                if (effects.spike) text += `‚ö° ${skillNames.spike} ${effects.spike > 0 ? '+' : ''}${effects.spike}<br>`;
                if (effects.block) text += `üõ°Ô∏è ${skillNames.block} ${effects.block > 0 ? '+' : ''}${effects.block}<br>`;
                if (effects.dig) text += `ü§∏ ${skillNames.dig} ${effects.dig > 0 ? '+' : ''}${effects.dig}<br>`;
                if (effects.set) text += `üôå ${skillNames.set} ${effects.set > 0 ? '+' : ''}${effects.set}<br>`;
                if (effects.energy) text += `üí™ ‰ΩìÂäõ ${effects.energy > 0 ? '+' : ''}${effects.energy}<br>`;
                if (effects.mood) text += `üòä ÂøÉÊÉÖ ${effects.mood > 0 ? '+' : ''}${effects.mood}<br>`;
                if (effects.stress) text += `üò∞ ÂéãÂäõ ${effects.stress > 0 ? '+' : ''}${effects.stress}<br>`;
                if (effects.reputation) text += `‚≠ê Â£∞Êúõ ${effects.reputation > 0 ? '+' : ''}${effects.reputation}<br>`;
                if (effects.money) text += `üí∞ ÈáëÈí± ${effects.money > 0 ? '+' : ''}${effects.money}<br>`;
                if (effects.relationship) text += `ü§ù ÂÖ≥Á≥ª ${effects.relationship > 0 ? '+' : ''}${effects.relationship}<br>`;
                
                return text || 'Êó†ÂΩ±Âìç';
            }
            
            // Ëé∑ÂèñÂë®Âàù‰∫ã‰ª∂Ê±†
            getWeeklyEventPool() {
                return [
                    // ÊäÄËÉΩÁõ∏ÂÖ≥Ê≠£Èù¢‰∫ã‰ª∂
                    { id: 'serve_master', title: 'ÂèëÁêÉËææ‰∫∫', text: '‰Ω†ÁöÑË∑≥ÂèëÁêÉËßÜÈ¢ëÂú®Ê†°Âõ≠ËÆ∫ÂùõÁÅ´‰∫ÜÔºÅÊúâÂ≠¶ÂºüÂ≠¶Â¶πÂêë‰Ω†ËØ∑ÊïôÔºå‰Ω†ËÄêÂøÉÊåáÂØºÂêéÊÑüËßâËá™Â∑±ÁêÜËß£Êõ¥Ê∑±‰∫Ü„ÄÇ', mood: 'positive', condition: (p) => p.skills.serve >= 30 && p.mood >= 60 && p.stress <= 40, effects: { serve: 3, reputation: 5, mood: 10 } },
                    { id: 'spike_show', title: 'Êâ£ÁêÉË°®Êºî', text: '‰ΩìËÇ≤ËØæ‰∏äËÄÅÂ∏àËÆ©‰Ω†Á§∫ËåÉÊâ£ÁêÉÂä®‰ΩúÔºå‰Ω†ÂÆåÁæéÁöÑÊºîÁ§∫Ëµ¢Âæó‰∫ÜÂÖ®Áè≠ÊéåÂ£∞ÔºåËøûÈöîÂ£ÅÁè≠ÈÉΩÊù•Âõ¥ËßÇ‰∫Ü„ÄÇ', mood: 'positive', condition: (p) => p.skills.spike >= 30 && p.mood >= 60 && p.stress <= 40, effects: { spike: 2, reputation: 8, mood: 12 } },
                    { id: 'block_teaching', title: 'Êã¶ÁΩëÊïôÂ≠¶', text: 'ÈòüÂèãËØ∑‰Ω†ÂàÜ‰∫´Êã¶ÁΩëÊäÄÂ∑ßÔºå‰Ω†Âú®ËÆ≤Ëß£Êó∂Á™ÅÁÑ∂È°øÊÇü‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑÂà§Êñ≠ÊñπÊ≥ï„ÄÇÊïôÂ≠¶Áõ∏ÈïøÔºÅ', mood: 'positive', condition: (p) => p.skills.block >= 30 && p.mood >= 60 && p.stress <= 40, effects: { block: 3, relationship: 5, mood: 8 } },
                    { id: 'dig_hero', title: 'ÊïëÁêÉËã±ÈõÑ', text: 'ËÆ≠ÁªÉÊó∂‰Ω†‰∏Ä‰∏™È±ºË∑ÉÊïëÁêÉÊàêÂäüÔºåÊïôÁªÉÂΩìÂú∫Ë°®Êâ¨Ôºö"ËøôÂ∞±ÊòØÊ∞∏‰∏çÊîæÂºÉÁöÑÁ≤æÁ•ûÔºÅ"ÂÖ®ÈòüÂ£´Ê∞îÂ§ßÊåØ„ÄÇ', mood: 'positive', condition: (p) => p.skills.dig >= 30 && p.mood >= 60 && p.stress <= 40, effects: { dig: 2, reputation: 6, mood: 10, stress: -5 } },
                    { id: 'set_master', title: '‰∫å‰º†Â§ßÂ∏à', text: '‰Ω†Á≤æÂáÜÁöÑ‰º†ÁêÉËÆ©ÈòüÂèãËøûÁª≠Êâ£ÁêÉÂæóÂàÜÔºåÂ§ßÂÆ∂ÈÉΩËØ¥Âíå‰Ω†ÈÖçÂêàÁâπÂà´ËàíÊúç„ÄÇÈªòÂ•ëÂ∫¶UPÔºÅ', mood: 'positive', condition: (p) => p.skills.set >= 30 && p.mood >= 60 && p.stress <= 40, effects: { set: 3, relationship: 8, mood: 10 } },
                    // ÊäÄËÉΩÁõ∏ÂÖ≥Ë¥üÈù¢‰∫ã‰ª∂
                    { id: 'demo_fail', title: 'ÊºîÁ§∫Â§±ËØØ', text: 'Êúâ‰∫∫ËØ∑ÊïôÂèëÁêÉÊäÄÂ∑ßÔºå‰Ω†ÊºîÁ§∫Ë∑≥ÂèëÊó∂Âõ†‰∏∫Â§™Á¥ØËÑö‰∏ã‰∏ÄÊªëÔºåÊâ≠Âà∞‰∫ÜËÑöË∏ù...‰∏¢‰∫∫ÂèàÁñº„ÄÇ', mood: 'negative', condition: (p) => p.skills.serve >= 25 && (p.mood <= 40 || p.stress >= 60), effects: { serve: -5, mood: -10, stress: 5 } },
                    { id: 'over_training', title: 'ËøáÂ∫¶ËÆ≠ÁªÉ', text: '‰Ω†ÊÉ≥Á™ÅÁ†¥Êâ£ÁêÉÁì∂È¢àÔºåÁªìÊûúÁªÉÂæóÂ§™ÁåõÊâãËáÇÈÖ∏ÁóõÔºåÊïôÁªÉÊâπËØÑ‰Ω†‰∏çÊáÇÂä≥ÈÄ∏ÁªìÂêà„ÄÇ', mood: 'negative', condition: (p) => p.skills.spike >= 25 && (p.mood <= 40 || p.stress >= 60), effects: { spike: -3, energy: -15, stress: 8 } },
                    { id: 'skill_regress', title: 'ÊäÄÊúØÈÄÄÊ≠•', text: 'Áä∂ÊÄÅ‰∏çÂ•ΩÂØºËá¥ËÆ≠ÁªÉÊó∂È¢ëÈ¢ëÂ§±ËØØÔºåÈòüÂèãÂÖ≥ÂøÉÂú∞ÈóÆ‰Ω†ÊòØ‰∏çÊòØÊúâ‰ªÄ‰πàÂøÉ‰∫ã„ÄÇ', mood: 'negative', condition: (p) => p.mood <= 40, effects: { serve: -2, spike: -2, mood: -5, relationship: 3 } },
                    // Á§æ‰∫§Áõ∏ÂÖ≥‰∫ã‰ª∂
                    { id: 'birthday_surprise', title: 'ÁîüÊó•ÊÉäÂñú', text: 'ÈòüÂèã‰ª¨ÂÅ∑ÂÅ∑Áªô‰Ω†ÂáÜÂ§á‰∫ÜÁîüÊó•ËõãÁ≥ïÔºàËôΩÁÑ∂‰∏çÊòØ‰Ω†ÁîüÊó•ÔºâÔºåËØ¥ÊòØÂ∫ÜÁ•ù‰Ω†Âä†ÂÖ•ÁêÉÈòü„ÄÇÊÑüÂä®Âì≠‰∫ÜÔºÅ', mood: 'positive', condition: (p) => p.relationships.teammates >= 60, effects: { mood: 20, stress: -10, relationship: 10 } },
                    { id: 'late_night_food', title: 'Ê∑±Â§úÈ£üÂ†Ç', text: 'ÈòüÈïøËØ∑Â§ßÂÆ∂ÂêÉÂ§úÂÆµÔºåËÅäÂ§©Êó∂‰Ω†‰ª¨ÂèëÁé∞ÂΩºÊ≠§ÈÉΩÊòØÂä®Êº´Ëø∑ÔºåÁû¨Èó¥Êàê‰∫ÜÂ•ΩÂÖÑÂºü„ÄÇ', mood: 'positive', condition: (p) => p.relationships.teammates >= 60, effects: { mood: 15, stress: -8, relationship: 8, money: -30 } },
                    { id: 'game_night', title: 'Ê∏∏Êàè‰πãÂ§ú', text: 'ÂÆ§ÂèãÁªÑÁªáÊ∏∏ÊàèËÅîÊú∫Ôºå‰Ω†‰ª¨‰∏ÄËµ∑ÈÄöÂÆµÊâìÊ∏∏ÊàèÔºåËôΩÁÑ∂Á¨¨‰∫åÂ§©ÂæàÂõ∞‰ΩÜË∂ÖÂºÄÂøÉÔºÅ', mood: 'positive', condition: (p) => p.mood >= 50, effects: { mood: 18, stress: -12, energy: -20 } },
                    { id: 'isolated', title: 'Ë¢´Â≠§Á´ã', text: 'È£üÂ†ÇÂêÉÈ•≠Êó∂ÂèëÁé∞ÈòüÂèã‰ª¨ÈÉΩÂùêÂú®‰∏ÄËµ∑Ôºå‰ΩÜÊ≤°‰∫∫Âè´‰Ω†...ÊòØ‰∏çÊòØËá™Â∑±Â§™‰∏çÂêàÁæ§‰∫ÜÔºü', mood: 'negative', condition: (p) => p.relationships.teammates <= 30, effects: { mood: -15, stress: 10 } },
                    { id: 'gossip', title: 'ÊµÅË®ÄËúöËØ≠', text: 'Âê¨ËØ¥Êúâ‰∫∫Âú®ËÉåÂêéËØ¥‰Ω†"Âè™‰ºöËÆ≠ÁªÉ‰∏ç‰ºöÂÅö‰∫∫"ÔºåËôΩÁÑ∂‰∏çÊÉ≥Âú®ÊÑè‰ΩÜËøòÊòØÂæàÈöæÂèó„ÄÇ', mood: 'negative', condition: (p) => p.relationships.teammates <= 30, effects: { mood: -12, stress: 8, relationship: -5 } },
                    // ÈáëÈí±Áõ∏ÂÖ≥‰∫ã‰ª∂
                    { id: 'treat_dinner', title: 'ËØ∑ÂÆ¢ÂêÉÈ•≠', text: '‰Ω†ËØ∑ÈòüÂèãÂêÉ‰∫ÜÈ°øÂ•ΩÁöÑÔºåÂ§ßÂÆ∂ÈÉΩËØ¥‰Ω†Â§üÊÑèÊÄùÔºÅÈòüÂÜÖÊ∞õÂõ¥Êõ¥ËûçÊ¥Ω‰∫Ü„ÄÇ', mood: 'positive', condition: (p) => p.money >= 300, effects: { money: -150, relationship: 12, reputation: 5, mood: 10 } },
                    { id: 'new_shoes', title: 'Ë£ÖÂ§áÂçáÁ∫ß', text: '‰Ω†‰π∞‰∫ÜÂèåÊñ∞ÁêÉÈûãÔºåÁ©øÁùÄÊÑüËßâËá™Â∑±ÂÉèËÅå‰∏öÈÄâÊâãÔºåËÆ≠ÁªÉÊó∂‰ø°ÂøÉÊª°Êª°ÔºÅ', mood: 'positive', condition: (p) => p.money >= 300, effects: { money: -200, mood: 15 } },
                    { id: 'broke', title: 'Âõä‰∏≠ÁæûÊ∂©', text: 'ÈòüÂèãÁ∫¶‰Ω†Âá∫ÂéªÁé©Ôºå‰Ω†Âè™ËÉΩËØ¥"‰∏ãÊ¨°Âêß"...Èí±ÂåÖÁ©∫Á©∫ÁöÑÊÑüËßâÁúüÈöæÂèó„ÄÇ', mood: 'negative', condition: (p) => p.money <= 50, effects: { mood: -10, stress: 5 } },
                    { id: 'instant_noodles', title: 'Ê≥°Èù¢Â∫¶Êó•', text: 'ËøôÂë®Âè™ËÉΩÂêÉÊ≥°Èù¢‰∫ÜÔºåËê•ÂÖªË∑ü‰∏ç‰∏äÂØºËá¥ËÆ≠ÁªÉÊïàÊûú‰∏ãÈôçÔºåËøòË¢´ÂÆ§ÂèãÂò≤Á¨ë"ÊéíÁêÉÁéãÂ≠êÂèòÊ≥°Èù¢ÁéãÂ≠ê"„ÄÇ', mood: 'negative', condition: (p) => p.money <= 50, effects: { mood: -8, energy: -10 } },
                    // ÂéãÂäõ/ÂøÉÊÉÖÁõ∏ÂÖ≥‰∫ã‰ª∂
                    { id: 'stress_burst', title: 'ÂéãÂäõÁàÜÂèë', text: 'ËÆ≠ÁªÉÊó∂‰Ω†Á™ÅÁÑ∂ÊÉÖÁª™Â§±ÊéßÂØπÈòüÂèãÂèëÁÅ´Ôºå‰∫ãÂêéÈùûÂ∏∏ÂêéÊÇî...Â§ßÂÆ∂ÈÉΩÂæàÊãÖÂøÉ‰Ω†ÁöÑÁä∂ÊÄÅ„ÄÇ', mood: 'negative', condition: (p) => p.stress >= 70, effects: { stress: -20, mood: -15, relationship: -10 } },
                    { id: 'insomnia', title: 'Â§±Áú†‰πãÂ§ú', text: 'ÂéãÂäõÂ§™Â§ßÂØºËá¥Â§±Áú†ÔºåÁ¨¨‰∫åÂ§©‰∏äËØæÂ∑ÆÁÇπÁù°ÁùÄÔºåËÆ≠ÁªÉÊó∂‰πüÊó†Á≤æÊâìÈáá„ÄÇ', mood: 'negative', condition: (p) => p.stress >= 70, effects: { stress: -10, energy: -25, mood: -10 } },
                    { id: 'lucky_day', title: 'Â•ΩËøêËøûËøû', text: 'ÂøÉÊÉÖÂ•ΩËøêÊ∞î‰πüÂ•ΩÔºÅË∑Ø‰∏äÊç°Âà∞100ÂùóÔºåÈ£üÂ†ÇÈòøÂß®Â§öÊâì‰∫Ü‰ªΩËÇâÔºåËÆ≠ÁªÉÊó∂Áä∂ÊÄÅÁàÜÊ£öÔºÅ', mood: 'positive', condition: (p) => p.mood >= 80, effects: { money: 100, energy: 10, mood: 5, serve: 1, spike: 1 } },
                    { id: 'inspiration', title: 'ÁÅµÊÑüËø∏Âèë', text: 'ÂøÉÊÉÖÊÑâÊÇ¶Êó∂‰Ω†Á™ÅÁÑ∂È¢ÜÊÇü‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑÊäÄÊúØË¶ÅÈ¢ÜÔºåÊÑüËßâËá™Â∑±ÂºÄÁ™ç‰∫ÜÔºÅ', mood: 'positive', condition: (p) => p.mood >= 80, effects: { block: 3, dig: 2, mood: 5 } },
                    // Èòü‰ºçÁõ∏ÂÖ≥‰∫ã‰ª∂
                    { id: 'college_honor', title: 'Èô¢ÈòüËç£Ë™â', text: 'Èô¢ÈòüÂú®ÂèãË∞äËµõ‰∏≠Ëé∑ËÉúÔºåÊïôÁªÉËØ∑Â§ßÂÆ∂ÂêÉÈ•≠Â∫ÜÁ•ùÔºå‰Ω†ÊÑüÂèóÂà∞‰∫ÜÈõÜ‰ΩìÁöÑÊ∏©Êöñ„ÄÇ', mood: 'positive', condition: (p) => p.team === 'college', effects: { mood: 15, stress: -10, relationship: 8 } },
                    { id: 'college_pressure', title: 'Èô¢ÈòüÂéãÂäõ', text: 'Èô¢ÈòüËÆ≠ÁªÉÂº∫Â∫¶Á™ÅÁÑ∂Âä†Â§ßÔºåÊïôÁªÉËØ¥Ë¶Å‰∏∫‰∏ãÊ¨°ÊØîËµõÂÅöÂáÜÂ§áÔºå‰Ω†ÊÑüËßâÊúâÁÇπÂêÉ‰∏çÊ∂à„ÄÇ', mood: 'neutral', condition: (p) => p.team === 'college', effects: { energy: -20, stress: 10, serve: 2, spike: 1 } },
                    { id: 'university_star', title: 'Ê†°ÈòüÊòéÊòü', text: 'Ê†°Êä•ÈááËÆø‰∫Ü‰Ω†ÔºåÊ†áÈ¢òÊòØ"Êñ∞ÊòüÂ¥õËµ∑"ÔºåËµ∞Âú®Ë∑Ø‰∏äÈÉΩÊúâ‰∫∫ËÆ§Âá∫‰Ω†‰∫ÜÔºÅ', mood: 'positive', condition: (p) => p.team === 'university', effects: { reputation: 15, mood: 20, stress: 5 } },
                    { id: 'university_competition', title: 'Ê†°ÈòüÁ´û‰∫â', text: 'Ê†°ÈòüÂÜÖÈÉ®Á´û‰∫âÊøÄÁÉàÔºå‰Ω†ÊãÖÂøÉËá™Â∑±‰ºöË¢´ÊõøË°•...ÂøÖÈ°ªÊõ¥Âä†Âä™ÂäõÊâçË°å„ÄÇ', mood: 'negative', condition: (p) => p.team === 'university', effects: { stress: 15, mood: -10 } },
                    // Á∫ØÈöèÊú∫Êó•Â∏∏‰∫ã‰ª∂ÔºàÊó†Êù°‰ª∂ÊàñÊù°‰ª∂ÂÆΩÊùæÔºâ
                    { id: 'library_encounter', title: 'Âõæ‰π¶È¶ÜÂ•áÈÅá', text: 'Âú®Âõæ‰π¶È¶ÜËá™‰π†Êó∂ÔºåÈöîÂ£ÅÊ°åÁöÑÂ≠¶Èú∏‰∏ªÂä®Êïô‰Ω†È´òÊï∞È¢òÔºå‰Ω†ÊÑüÂä®ÂæóÂ∑ÆÁÇπÂì≠Âá∫Êù•„ÄÇËôΩÁÑ∂ËøòÊòØÊ≤°Âê¨ÊáÇ„ÄÇ', mood: 'positive', effects: { mood: 8, stress: -5 } },
                    { id: 'bike_stolen', title: 'Ëá™Ë°åËΩ¶Ë¢´ÂÅ∑', text: '‰Ω†ÁöÑËá™Ë°åËΩ¶‰∏çËßÅ‰∫ÜÔºÅÊä•Ê°àÂêéÂèëÁé∞ÊòØË¢´ÈöîÂ£ÅÂÆøËàçÁöÑ‰∫∫"ÂÄü"Ëµ∞‰∫ÜÔºå‰ªñËØ¥‰ª•‰∏∫ÊòØÂÖ±‰∫´ÂçïËΩ¶...', mood: 'negative', effects: { mood: -12, stress: 8, money: -50 } },
                    { id: 'midterm_exam', title: 'Êúü‰∏≠ËÄÉËØï', text: 'Êúü‰∏≠ËÄÉËØïÂë®Âà∞‰∫ÜÔºå‰Ω†Âú®ÊéíÁêÉËÆ≠ÁªÉÂíåÂ§ç‰π†‰πãÈó¥ÁñØÁãÇÂàáÊç¢ÔºåÊÑüËßâËÑëÂ≠êË¶ÅÁÇ∏‰∫Ü„ÄÇ', mood: 'negative', effects: { stress: 15, energy: -15, mood: -8 } },
                    { id: 'confession_scene', title: 'Ê†°Âõ≠Ë°®ÁôΩ', text: 'Êúâ‰∫∫Âú®ÊìçÂú∫‰∏äË°®ÁôΩÔºåÂõ¥ËßÇÁæ§‰ºóÈáåÊúâ‰∫∫Ëµ∑ÂìÑËÆ©‰Ω†‰πüË°®ÁôΩÔºå‰Ω†Â∞¥Â∞¨ÂæóÊÉ≥Êâæ‰∏™Âú∞ÁºùÈíªËøõÂéª„ÄÇ', mood: 'neutral', effects: { mood: -5, stress: 5 } },
                    { id: 'movie_night', title: 'ÁîµÂΩ±‰πãÂ§ú', text: 'ÂÆ§ÂèãÊãâ‰Ω†ÂéªÁúãÂçàÂ§úÂú∫ÁîµÂΩ±ÔºåÁúãÂÆåÂ∑≤ÁªèÂáåÊô®2ÁÇπÔºåÁ¨¨‰∫åÂ§©ËÆ≠ÁªÉÊó∂Âõ∞Âæó‰∏çË°å„ÄÇ', mood: 'positive', effects: { mood: 15, energy: -20, stress: -10 } },
                    { id: 'data_overcharge', title: 'ÊµÅÈáèË∂ÖÊ†á', text: 'ÊúàÂ∫ïÂèëÁé∞ÊµÅÈáèË∂Ö‰∫ÜÔºåË¢´Êâ£‰∫Ü100ÂùóÔºåÂéüÊù•ÊòØÂÆ§ÂèãÁî®‰Ω†ÊâãÊú∫ÂºÄÁÉ≠ÁÇπ‰∏ãÊ∏∏Êàè...', mood: 'negative', effects: { mood: -10, money: -100, stress: 5 } },
                    { id: 'new_dish', title: 'È£üÂ†ÇÊñ∞Ëèú', text: 'È£üÂ†ÇÊé®Âá∫Êñ∞ËèúÂìÅ"ÊéíÁêÉÂ•óÈ§ê"ÔºåËôΩÁÑ∂‰∏çÁü•ÈÅì‰∏∫‰ªÄ‰πàÂè´Ëøô‰∏™ÂêçÂ≠óÔºå‰ΩÜÂë≥ÈÅìËøò‰∏çÈîôÔºÅ', mood: 'positive', effects: { mood: 10, energy: 10 } },
                    { id: 'ktv_party', title: 'Ë¢´ÊãâÂéªÂî±Ê≠å', text: 'Áè≠Á∫ßËÅö‰ºöË¢´ÊãâÂéªKTVÔºå‰Ω†Âî±‰∫ÜÈ¶ñ„ÄäÂÄîÂº∫„ÄãÔºåÂ§ßÂÆ∂ËØ¥‰Ω†Âî±Âá∫‰∫ÜÊéíÁêÉ‰∫∫ÁöÑÁ≤æÁ•ûÔºÅ', mood: 'positive', effects: { mood: 12, stress: -8, money: -60, relationship: 5 } },
                    { id: 'power_outage', title: 'ÂÆøËàçÊñ≠Áîµ', text: 'ÂÆøËàçÁ™ÅÁÑ∂Êñ≠ÁîµÔºå‰Ω†ÁöÑÊâãÊú∫‰πüÊ≤°Áîµ‰∫ÜÔºåÂè™ËÉΩÊó©Êó©Áù°Ëßâ„ÄÇÊÑèÂ§ñÂú∞Áù°‰∫Ü‰∏™Â•ΩËßâÔºÅ', mood: 'positive', effects: { energy: 20, mood: 5 } },
                    { id: 'game_all_night', title: 'Ê∏∏ÊàèÈÄöÂÆµ', text: 'ÂÆ§ÂèãÊñ∞‰π∞‰∫ÜÊ∏∏ÊàèÊú∫Ôºå‰Ω†‰ª¨ÈÄöÂÆµÊâì„ÄäÈ©¨ÈáåÂ••Ê¥æÂØπ„ÄãÔºåÁ¨ëÂà∞ËÇöÂ≠êÁñº„ÄÇÁ¨¨‰∫åÂ§©ÂêéÊÇî‰∫Ü„ÄÇ', mood: 'positive', effects: { mood: 20, energy: -30, stress: -15 } },
                    { id: 'dorm_inspection', title: 'ÂÆøËàçÊ£ÄÊü•', text: 'Á™ÅÂáªÂç´ÁîüÊ£ÄÊü•ÔºÅ‰Ω†‰ª¨ÁñØÁãÇÊâìÊâ´‰∫Ü2Â∞èÊó∂ÔºåÁ¥ØÂæóÂçäÊ≠ª‰ΩÜÈÄöËøá‰∫ÜÊ£ÄÊü•„ÄÇ', mood: 'neutral', effects: { energy: -15, stress: 10, mood: -5 } },
                    { id: 'midnight_snack', title: 'Ê∑±Â§úÂ§ñÂçñ', text: 'ÂáåÊô®1ÁÇπ‰Ω†‰ª¨ÁÇπ‰∫ÜÁÇ∏È∏°ÂíåÂèØ‰πêÔºåËæπÂêÉËæπËÅä‰∫∫ÁîüÁêÜÊÉ≥ÔºåÊÑüËßâÈùíÊò•Â∞±ËØ•ËøôÊ†∑ÔºÅ', mood: 'positive', effects: { mood: 15, energy: 10, money: -80, stress: -10 } },
                    { id: 'cockroach', title: 'ÂÆøËàçÊúâËô´', text: 'ÂÆøËàçÂá∫Áé∞‰∫Ü‰∏ÄÂè™Â§ßËüëËûÇÔºå‰Ω†‰ª¨Âõõ‰∏™Â§ßÁî∑ÁîüÂêìÂæóË∑≥‰∏äÂ∫äÔºåÊúÄÂêéËøòÊòØÂÆøÁÆ°ÈòøÂß®Â∏ÆÂøôËß£ÂÜ≥ÁöÑ„ÄÇ', mood: 'neutral', effects: { mood: -8, stress: 5, relationship: 3 } },
                    { id: 'water_splash', title: 'Ë¢´Ê∞¥Ê≥º', text: 'Ë∑ØËøáÂÆøËàçÊ•º‰∏ãÊó∂Ë¢´Ê•º‰∏äÊ≥ºÊ∞¥ÁõÜÁöÑÊ∞¥Ê∑ã‰∫Ü‰∏ÄË∫´ÔºåÊä¨Â§¥‰∏ÄÁúãÊòØ‰Ω†ËÆ§ËØÜÁöÑÂ≠¶Â¶πÔºåÂ•πÂêìÂæóËøûËøûÈÅìÊ≠â„ÄÇ', mood: 'neutral', effects: { mood: -5, relationship: 2 } },
                    { id: 'lottery_win', title: '‰∏≠Â•ñ‰∫Ü', text: 'Â≠¶Ê†°ÊäΩÂ•ñÊ¥ªÂä®‰Ω†‰∏≠‰∫Ü‰∏âÁ≠âÂ•ñ‚Äî‚Äî‰∏Ä‰∏™‰øùÊ∏©ÊùØÔºåËôΩÁÑ∂‰∏çÊòØ‰ªÄ‰πàÂ§ßÂ•ñ‰ΩÜËøòÊå∫ÂÆûÁî®ÁöÑÔºÅ', mood: 'positive', effects: { mood: 10, money: 50 } },
                    { id: 'heater_broken', title: 'ÁÉ≠Ê∞¥Âô®Âùè‰∫Ü', text: 'Ê¥óÊæ°Ê¥óÂà∞‰∏ÄÂçäÁÉ≠Ê∞¥Âô®Âùè‰∫ÜÔºå‰Ω†È°∂ÁùÄÊª°Â§¥Ê≥°Ê≤´ÂÜ≤‰∫Ü‰∏™ÂÜ∑Ê∞¥Êæ°ÔºåÂ∑ÆÁÇπÊÑüÂÜí„ÄÇ', mood: 'negative', effects: { energy: -10, mood: -12, stress: 5 } },
                    { id: 'package_lost', title: 'Âø´ÈÄí‰∏¢Â§±', text: '‰Ω†‰π∞ÁöÑÊñ∞ÁêÉÈûãÂø´ÈÄíÊòæÁ§∫Â∑≤Á≠æÊî∂Ôºå‰ΩÜ‰Ω†Ê†πÊú¨Ê≤°Êî∂Âà∞ÔºÅÂÆ¢ÊúçËØ¥Ë¶ÅË∞ÉÊü•Ôºå‰Ω†Âè™ËÉΩÁ≠âÂæÖ„ÄÇ', mood: 'negative', effects: { mood: -15, stress: 10 } },
                    { id: 'sudden_rain', title: 'Á™ÅÁÑ∂‰∏ãÈõ®', text: 'ËÆ≠ÁªÉÂÆåÂõûÂÆøËàçË∑Ø‰∏äÁ™ÅÁÑ∂‰∏ãÂ§ßÈõ®Ôºå‰Ω†ÂíåÈòüÂèãÂú®Â±ãÊ™ê‰∏ãË∫≤Èõ®ÔºåËÅä‰∫ÜÂæàÂ§öÂπ≥Êó∂‰∏ç‰ºöËÅäÁöÑËØùÈ¢ò„ÄÇ', mood: 'positive', effects: { mood: 8, relationship: 8, energy: -5 } },
                    { id: 'confession_received', title: 'Ë¢´‰∫∫ÂëäÁôΩ', text: 'ÊúâÂ≠¶Â¶πÁªô‰Ω†ÈÄíÊÉÖ‰π¶Ôºå‰Ω†‰∏çÁü•ÈÅìÊÄé‰πàÂõûÂ∫îÔºåÊï¥Â§©ÈÉΩÂøÉÁ•û‰∏çÂÆÅÔºåËÆ≠ÁªÉÊó∂È¢ëÈ¢ëÂ§±ËØØ„ÄÇ', mood: 'neutral', effects: { mood: 5, stress: 12 } },
                    { id: 'roommate_birthday', title: 'ÂÆ§ÂèãÁîüÊó•', text: 'ÂÆ§ÂèãËøáÁîüÊó•Ôºå‰Ω†‰ª¨‰∏ÄËµ∑Â∫ÜÁ•ùÂà∞Ê∑±Â§úÔºåËôΩÁÑ∂Á¨¨‰∫åÂ§©ÂæàÂõ∞‰ΩÜÂèãÊÉÖÊõ¥Ê∑±‰∫Ü„ÄÇ', mood: 'positive', effects: { mood: 15, energy: -15, money: -100, relationship: 10 } },
                    { id: 'photo_leaked', title: 'Ë¢´ÂÅ∑Êãç', text: 'ÂèëÁé∞Ê†°Âõ≠ËÆ∫Âùõ‰∏äÊúâ‰Ω†ËÆ≠ÁªÉÊó∂ÁöÑÁÖßÁâáÔºåÊ†áÈ¢òÊòØ"ÊéíÁêÉÂú∫‰∏äÁöÑÈò≥ÂÖâÁî∑Â≠©"ÔºåËØÑËÆ∫Âå∫ÈÉΩÂú®Â§∏‰Ω†Â∏Ö„ÄÇ', mood: 'positive', effects: { mood: 18, reputation: 10, stress: 5 } },
                    { id: 'senior_advice', title: 'Â≠¶ÈïøÊåáÂØº', text: '‰∏Ä‰ΩçÊØï‰∏öÁöÑÂ≠¶ÈïøÂõûÊ†°ÔºåÁúãÂà∞‰Ω†ËÆ≠ÁªÉÂêé‰∏ªÂä®ÂàÜ‰∫´‰∫Ü‰∏Ä‰∫õÁªèÈ™åÔºåËÆ©‰Ω†ÂèóÁõäÂå™ÊµÖ„ÄÇ', mood: 'positive', effects: { serve: 2, spike: 1, mood: 10, reputation: 5 } },
                    { id: 'banana_peel', title: 'Ë∏©Âà∞È¶ôËïâÁöÆ', text: 'ÁúüÁöÑÊúâ‰∫∫‰ºöË∏©Âà∞È¶ôËïâÁöÆÔºÅ‰Ω†Âú®È£üÂ†ÇÈó®Âè£Âçé‰∏ΩÂú∞ÊªëÂÄí‰∫ÜÔºåÂë®Âõ¥ÁöÑ‰∫∫ÈÉΩÁ¨ëÁñØ‰∫Ü„ÄÇ', mood: 'negative', effects: { mood: -10, reputation: -5, energy: -5 } },
                    { id: 'wrong_person', title: 'ËÆ§Èîô‰∫∫', text: '‰Ω†Âú®Ë∑Ø‰∏äÁÉ≠ÊÉÖÂú∞Ë∑ü"ÈòüÂèã"ÊâìÊãõÂëºÔºåÁªìÊûúÂèëÁé∞ËÆ§Èîô‰∫∫‰∫ÜÔºåÂØπÊñπ‰∏ÄËÑ∏ÊáµÈÄºÂú∞ÁúãÁùÄ‰Ω†„ÄÇ', mood: 'neutral', effects: { mood: -8, stress: 5 } },
                    { id: 'food_poisoning', title: 'ÂêÉÂùèËÇöÂ≠ê', text: 'Ë∑ØËæπÊëäÁöÑÁÉ§‰∏≤Â§™ËØ±‰∫∫Ôºå‰Ω†Ê≤°Âøç‰Ωè...ÁªìÊûúÂçäÂ§úË∑ë‰∫Ü‰∏âÊ¨°ÂéïÊâÄÔºåÁ¨¨‰∫åÂ§©ËôöÂº±Êó†Âäõ„ÄÇ', mood: 'negative', effects: { energy: -25, mood: -10 } },
                    { id: 'performance_show', title: 'Ë¢´ÊãâÂéªË°®Êºî', text: 'Â≠¶Ê†°ÊñáËâ∫Êôö‰ºöÁº∫‰∫∫Ôºå‰Ω†Ë¢´ÊãâÂéªË°®Êºî"ÊéíÁêÉÊìç"ÔºåËôΩÁÑ∂ÂæàÂ∞¥Â∞¨‰ΩÜÊÑèÂ§ñÂú∞ÂèóÊ¨¢Ëøé„ÄÇ', mood: 'positive', effects: { mood: 10, reputation: 8, stress: 10 } },
                    { id: 'chased_by_dog', title: 'Ë¢´ÁãóËøΩ', text: 'Êô®Ë∑ëÊó∂Ë¢´ÊµÅÊµ™ÁãóËøΩ‰∫Ü‰∏§Êù°Ë°óÔºå‰Ω†Ë∑ëÂá∫‰∫ÜÁôæÁ±≥ÂÜ≤Âà∫ÁöÑÈÄüÂ∫¶ÔºåÈòüÂèãËØ¥‰Ω†ËØ•ÂéªÁªÉÁî∞ÂæÑ„ÄÇ', mood: 'neutral', effects: { energy: -15, mood: -5 } },
                    { id: 'phone_broken', title: 'ÊâãÊú∫ÊëîÁ¢é', text: 'Êé•ÁêÉÊó∂ÊâãÊú∫‰ªéÂè£Ë¢ãÈáåÈ£ûÂá∫ÂéªÔºåÂ±èÂπïÊëîÂæóÁ≤âÁ¢é„ÄÇ‰Ω†ÁöÑÈí±ÂåÖ‰πüÁ¢é‰∫Ü„ÄÇ', mood: 'negative', effects: { mood: -20, money: -300 } },
                    { id: 'found_money', title: 'Êç°Âà∞Èí±', text: 'Âú®ÊìçÂú∫‰∏äÊç°Âà∞200ÂùóÔºåÁ≠â‰∫ÜÂçäÂ∞èÊó∂Ê≤°‰∫∫Êù•ËÆ§È¢ÜÔºå‰Ω†ÂÜ≥ÂÆöÊãøÂéªËØ∑ÈòüÂèãÂêÉÈ•≠„ÄÇ', mood: 'positive', effects: { money: 50, mood: 10, relationship: 8 } },
                    { id: 'free_lunch', title: 'ÂÖçË¥πÂçàÈ§ê', text: 'È£üÂ†ÇÈòøÂß®ËØ¥‰Ω†ÊòØÁ¨¨1000‰ΩçÈ°æÂÆ¢ÔºåÂÖçË¥πÈÄÅ‰Ω†‰∏Ä‰ªΩË±™ÂçéÂ•óÈ§êÔºÅ‰ªäÂ§©ËøêÊ∞îÁúüÂ•ΩÔºÅ', mood: 'positive', effects: { mood: 15, energy: 15 } },
                    { id: 'exam_leak', title: 'ËÄÉËØïÈáçÁÇπ', text: 'Â≠¶Èïø"‰∏çÂ∞èÂøÉ"ÈÄèÈú≤‰∫ÜËÄÉËØïÈáçÁÇπÔºå‰Ω†Á™ÅÂáªÂ§ç‰π†ÂêéËÄÉÂæóËøò‰∏çÈîôÔºåÂéãÂäõÂáèËΩª‰∫Ü‰∏çÂ∞ë„ÄÇ', mood: 'positive', effects: { stress: -15, mood: 12 } },
                    { id: 'concert_ticket', title: 'ÊºîÂî±‰ºöÈó®Á•®', text: 'ÊäΩÂ•ñÊäΩÂà∞‰∫ÜÊºîÂî±‰ºöÈó®Á•®ÔºÅËôΩÁÑ∂‰∏çËÆ§ËØÜÊ≠åÊâãÔºå‰ΩÜÂÖçË¥πÁöÑÂø´‰πêÂ∞±ÊòØËøô‰πàÁÆÄÂçï„ÄÇ', mood: 'positive', effects: { mood: 20, stress: -10 } }
                ];
            }
            
            // Êñ∞Â¢ûÔºöÊòæÁ§∫ÊØîËµõÈ¢ÑÂëä
            showMatchPreview(matchType, matchName) {
                let previewText = '';
                let matchInfo = '';
                
                if (matchType === 'collegeMatch') {
                    matchInfo = `
                        <h2>üèê ${matchName}</h2>
                        <p>Êú¨Âë®Êú´Â∞Ü‰∏æË°åÈô¢ÈôÖÊéíÁêÉÊØîËµõÔºÅ</p>
                        <p>‰Ωú‰∏∫Èô¢ÈòüÁöÑ‰∏ÄÂëòÔºå‰Ω†Â∞Ü‰ª£Ë°®Â≠¶Èô¢Âá∫Êàò„ÄÇ</p>
                        <p><strong>ÊØîËµõËßÑÂàôÔºö</strong>‰∏âÂ±Ä‰∏§ËÉúÂà∂ÔºåÊØèÂ±Ä25ÂàÜÔºàÂÜ≥ËÉúÂ±Ä15ÂàÜÔºâ</p>
                        <p><strong>ÂØπÊâãÂÆûÂäõÔºö</strong>‰∏é‰Ω†‰ª¨Ê∞¥Âπ≥Áõ∏ÂΩìÁöÑÂÖ∂‰ªñÂ≠¶Èô¢Èòü‰ºç</p>
                        <p>ËøôÊòØ‰Ω†ËØÅÊòéËá™Â∑±ÁöÑÂ•ΩÊú∫‰ºöÔºåÂä†Ê≤πÔºÅ</p>
                    `;
                } else if (matchType === 'universityLeague') {
                    matchInfo = `
                        <h2>üèê ${matchName}</h2>
                        <p>Êú¨Âë®Êú´Â∞Ü‰∏æË°åÊ†°ÈôÖÊéíÁêÉËÅîËµõÔºÅ</p>
                        <p>‰Ωú‰∏∫Ê†°ÈòüÁöÑ‰∏ªÂäõÔºå‰Ω†Â∞Ü‰ª£Ë°®Â≠¶Ê†°‰∏éÂÖ∂‰ªñÈ´òÊ†°ÂØπÂÜ≥„ÄÇ</p>
                        <p><strong>ÊØîËµõËßÑÂàôÔºö</strong>‰∏âÂ±Ä‰∏§ËÉúÂà∂ÔºåÊØèÂ±Ä25ÂàÜÔºàÂÜ≥ËÉúÂ±Ä15ÂàÜÔºâ</p>
                        <p><strong>ÂØπÊâãÂÆûÂäõÔºö</strong>ÂÖ∂‰ªñÈ´òÊ†°ÁöÑÁ≤æËã±ÈÄâÊâã</p>
                        <p>ËøôÊòØÂ±ïÁé∞‰Ω†ÂÆûÂäõÁöÑËàûÂè∞ÔºåÂÖ®Âäõ‰ª•Ëµ¥ÔºÅ</p>
                    `;
                } else if (matchType === 'cityLeague') {
                    matchInfo = `
                        <h2>üèê ${matchName}</h2>
                        <p>Êú¨Âë®Êú´Â∞Ü‰∏æË°åÂ∏ÇÁ∫ßÊéíÁêÉËÅîËµõÔºÅ</p>
                        <p>ËøôÊòØÊú¨ËµõÂ≠£ÊúÄÈáçË¶ÅÁöÑÊØîËµõÔºå‰Ω†Â∞ÜÈù¢ÂØπÂÖ®Â∏ÇÊúÄÂº∫ÁöÑÈòü‰ºç„ÄÇ</p>
                        <p><strong>ÊØîËµõËßÑÂàôÔºö</strong>‰∏âÂ±Ä‰∏§ËÉúÂà∂ÔºåÊØèÂ±Ä25ÂàÜÔºàÂÜ≥ËÉúÂ±Ä15ÂàÜÔºâ</p>
                        <p><strong>ÂØπÊâãÂÆûÂäõÔºö</strong>Â∏ÇÁ∫ßÈ°∂Â∞ñÈÄâÊâã</p>
                        <p>ËøôÊòØ‰Ω†ÁöÑÂ∑ÖÂ≥∞‰πãÊàòÔºåËØÅÊòé‰Ω†ÁöÑ‰ª∑ÂÄºÔºÅ</p>
                    `;
                }
                
                // ÂàõÂª∫È¢ÑÂëäÂú∫ÊôØ
                SCENES.matchPreview = {
                    text: matchInfo,
                    choices: [{
                        text: 'ÂºÄÂßãÊØîËµõ',
                        effect: { 
                            startFormalMatch: { 
                                matchType: matchType, 
                                matchName: matchName 
                            } 
                        }
                    }]
                };
                
                this.showScene('matchPreview');
            }
            
            generateWeeklySummary() {
                const scene = SCENES.weekEnd;
                
                // ËÆ°ÁÆóÊäÄËÉΩÂèòÂåñ
                const changes = {
                    serve: this.player.skills.serve - this.player.weekStartStats.serve,
                    spike: this.player.skills.spike - this.player.weekStartStats.spike,
                    block: this.player.skills.block - this.player.weekStartStats.block,
                    dig: this.player.skills.dig - this.player.weekStartStats.dig,
                    set: this.player.skills.set - this.player.weekStartStats.set,
                    maxEnergy: this.player.maxEnergy - this.player.weekStartStats.maxEnergy
                };
                
                // Ëé∑ÂèñÂΩìÂâçÈò∂ÊÆµ
                const teamNames = {
                    'none': 'Âü∫Á°ÄËÆ≠ÁªÉ',
                    'college': 'Èô¢Èòü',
                    'university': 'Ê†°Èòü'
                };
                const currentStage = teamNames[this.player.team];
                
                // ÁîüÊàêÊäÄËÉΩÂèòÂåñHTMLÔºàÁ¥ßÂáëÁâàÔºâ
                let skillChangesHTML = '<div style="background: #f8fafc; padding: 8px; border-radius: 6px; margin: 8px 0; font-size: 14px;">';
                skillChangesHTML += '<strong>Êú¨Âë®ÊàêÈïø</strong><br>';
                
                const skillIcons = {
                    serve: 'üéØ',
                    spike: '‚ö°',
                    block: 'üõ°Ô∏è',
                    dig: 'üèê',
                    set: 'ü§≤'
                };
                
                const skillNames = {
                    serve: 'ÂèëÁêÉ',
                    spike: 'Êâ£ÁêÉ',
                    block: 'Êã¶ÁΩë',
                    dig: 'Âû´ÁêÉ',
                    set: 'ÊâòÁêÉ'
                };
                
                for (let skill in skillIcons) {
                    const change = changes[skill];
                    const icon = skillIcons[skill];
                    const name = skillNames[skill];
                    const newVal = this.player.skills[skill];
                    
                    if (change > 0) {
                        skillChangesHTML += `<span style="color: #22c55e;">${icon}${name} ${newVal}(+${change})</span> `;
                    } else if (change === 0) {
                        skillChangesHTML += `<span style="color: #9ca3af;">${icon}${name} ${newVal}</span> `;
                    } else {
                        skillChangesHTML += `<span style="color: #ef4444;">${icon}${name} ${newVal}(${change})</span> `;
                    }
                }
                
                if (changes.maxEnergy > 0) {
                    skillChangesHTML += `<br><span style="color: #22c55e;">üí™‰ΩìÂäõ‰∏äÈôê+${changes.maxEnergy}</span>`;
                }
                
                skillChangesHTML += '</div>';
                
                // ÁîüÊàêÁõÆÊ†áËøõÂ∫¶HTMLÔºàÁ¥ßÂáëÁâàÔºâ
                const goalProgressHTML = this.generateGoalProgress();
                
                // ÁîüÊàêÊô∫ËÉΩÂª∫ËÆÆHTMLÔºàÁ¥ßÂáëÁâàÔºâ
                const suggestionsHTML = this.generateWeeklySuggestions(changes);
                
                // ÁªÑÂêàÂÆåÊï¥ÁöÑÊÄªÁªìÊñáÊú¨ÔºàÁ¥ßÂáëÁâàÔºâ
                scene.text = `<h2>üìä Á¨¨${this.player.week}Âë®¬∑${currentStage}</h2>
                
                ${skillChangesHTML}
                
                ${goalProgressHTML}
                
                ${suggestionsHTML}`;
            }
            
            generateGoalProgress() {
                const goalInfo = this.getGoalInfo();
                
                // Â¶ÇÊûúÁõÆÊ†áÂ∑≤ÂÆåÊàêÔºå‰∏çÊòæÁ§∫ÁõÆÊ†áËøõÂ∫¶
                if (!goalInfo || goalInfo.completed) {
                    return '';
                }
                
                let progressHTML = '<div style="background: #f0fdf4; padding: 8px; border-radius: 6px; margin: 8px 0; font-size: 14px;">';
                progressHTML += `<strong>${goalInfo.icon} ${goalInfo.title}</strong>`;
                
                if (goalInfo.type === 'tryout') {
                    // ÈÄâÊãîÁ±ªÁõÆÊ†áÔºöÊòæÁ§∫Ë¶ÅÊ±ÇÂíåËææÊ†áÊÉÖÂÜµ
                    progressHTML += ` <span style="color: #6b7280; font-size: 12px;">(${goalInfo.timeWindow})</span><br>`;
                    
                    const req = goalInfo.requirements;
                    const skillIcons = {
                        serve: 'üéØ', spike: '‚ö°', block: 'üõ°Ô∏è', dig: 'üèê', set: 'ü§≤', reputation: '‚≠ê'
                    };
                    const skillNames = { 
                        serve: 'ÂèëÁêÉ', spike: 'Êâ£ÁêÉ', block: 'Êã¶ÁΩë', dig: 'Âû´ÁêÉ', set: 'ÊâòÁêÉ', reputation: 'Â£∞Êúõ' 
                    };
                    
                    let metCount = 0;
                    let totalCount = 0;
                    let unmetItems = [];
                    
                    // Â§ÑÁêÜÊäÄËÉΩË¶ÅÊ±Ç
                    if (req.anyTwo !== undefined) {
                        const threshold = req.anyTwo;
                        const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                        const qualifiedSkills = skills.filter(s => this.player.skills[s] >= threshold);
                        
                        totalCount = 1;
                        if (qualifiedSkills.length >= 2) {
                            metCount = 1;
                        } else {
                            const sortedSkills = skills
                                .map(s => ({ skill: s, value: this.player.skills[s], diff: threshold - this.player.skills[s] }))
                                .filter(s => s.diff > 0)
                                .sort((a, b) => a.diff - b.diff)
                                .slice(0, 2);
                            sortedSkills.forEach(item => {
                                unmetItems.push({ key: item.skill, required: threshold, current: item.value, diff: item.diff });
                            });
                        }
                    } else if (req.anyThree !== undefined) {
                        const threshold = req.anyThree;
                        const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                        const qualifiedSkills = skills.filter(s => this.player.skills[s] >= threshold);
                        
                        totalCount = 1;
                        if (qualifiedSkills.length >= 3) {
                            metCount = 1;
                        } else {
                            const sortedSkills = skills
                                .map(s => ({ skill: s, value: this.player.skills[s], diff: threshold - this.player.skills[s] }))
                                .filter(s => s.diff > 0)
                                .sort((a, b) => a.diff - b.diff)
                                .slice(0, 3);
                            sortedSkills.forEach(item => {
                                unmetItems.push({ key: item.skill, required: threshold, current: item.value, diff: item.diff });
                            });
                        }
                    }
                    
                    // Â§ÑÁêÜÂ£∞ÊúõË¶ÅÊ±Ç
                    if (req.reputation !== undefined) {
                        totalCount++;
                        if (this.player.reputation >= req.reputation) {
                            metCount++;
                        } else {
                            unmetItems.push({
                                key: 'reputation',
                                required: req.reputation,
                                current: this.player.reputation,
                                diff: req.reputation - this.player.reputation
                            });
                        }
                    }
                    
                    // ÊòæÁ§∫ËøõÂ∫¶
                    if (metCount === totalCount) {
                        progressHTML += `<span style="color: #22c55e;">‚úÖ ÂÖ®ÈÉ®ËææÊ†áÔºÅÂèØ‰ª•ÊåëÊàòÁõÆÊ†á‰∫Ü</span><br>`;
                    } else {
                        progressHTML += `<span style="color: #f59e0b;">ËøõÂ∫¶Ôºö${metCount}/${totalCount}</span><br>`;
                        progressHTML += `<span style="color: #6b7280; font-size: 12px;">Áü≠ÊùøÔºö`;
                        unmetItems.slice(0, 2).forEach((item, idx) => {
                            if (idx > 0) progressHTML += 'Ôºå';
                            progressHTML += `${skillNames[item.key]}${item.current}(Â∑Æ${item.diff})`;
                        });
                        progressHTML += `</span>`;
                    }
                    
                } else if (goalInfo.type === 'match') {
                    // ÊØîËµõÁ±ªÁõÆÊ†áÔºöÊòæÁ§∫ÊØîËµõÊó∂Èó¥ÂíåÊèêÁ§∫
                    const weeksUntil = goalInfo.triggerWeek - this.player.week;
                    
                    if (weeksUntil > 0) {
                        progressHTML += `<br><span style="color: #f59e0b;">üìÖ Á¨¨${goalInfo.triggerWeek}Âë®Ëá™Âä®ÂºÄÂßãÔºàËøòÊúâ${weeksUntil}Âë®Ôºâ</span><br>`;
                        progressHTML += `<span style="color: #6b7280; font-size: 12px;">üí° ${goalInfo.description}</span>`;
                    } else if (weeksUntil === 0) {
                        progressHTML += `<br><span style="color: #ef4444;">üìÖ Êú¨Âë®Â∞ÜËøõË°åÊØîËµõÔºÅ</span><br>`;
                        progressHTML += `<span style="color: #6b7280; font-size: 12px;">üí™ ‰øùÊåÅÊúÄ‰Ω≥Áä∂ÊÄÅÂèÇËµõ</span>`;
                    } else {
                        progressHTML += `<br><span style="color: #22c55e;">‚úÖ ÊØîËµõÂ∑≤ÂÆåÊàê</span>`;
                    }
                }
                
                progressHTML += '</div>';
                return progressHTML;
            }
            
            generateWeeklySuggestions(changes) {
                const suggestions = [];
                const goalInfo = this.getGoalInfo();
                
                // 1. Ê£ÄÊü•Á¥ßÊÄ•Áä∂ÊÄÅ
                if (this.player.energy < 20) {
                    suggestions.push({ priority: 1, text: '‚ö†Ô∏è ‰ΩìÂäõ‰∏•Èáç‰∏çË∂≥ÔºåÂª∫ËÆÆ‰ºòÂÖà‰ºëÊÅØÊÅ¢Â§ç' });
                }
                if (this.player.stress > 80) {
                    suggestions.push({ priority: 1, text: '‚ö†Ô∏è ÂéãÂäõËøáÂ§ßÔºåÂøÖÈ°ªËøõË°åÊîæÊùæÊ¥ªÂä®' });
                }
                if (this.player.money < 100) {
                    suggestions.push({ priority: 1, text: 'üí∞ ÈáëÈí±‰∏çË∂≥ÔºåËÄÉËôëÂÖºËÅåËµöÈí±' });
                }
                if (this.player.mood < 30) {
                    suggestions.push({ priority: 1, text: 'üòî ÂøÉÊÉÖ‰ΩéËêΩÔºåÂª∫ËÆÆ‰ºëÈó≤Â®±‰πêÊèêÂçáÂøÉÊÉÖ' });
                }
                
                // 2. Ê†πÊçÆÁõÆÊ†áÁ±ªÂûãÁªôÂá∫Âª∫ËÆÆ
                if (goalInfo.type === 'tryout') {
                    // ÈÄâÊãîÁ±ªÁõÆÊ†áÔºöÊ£ÄÊü•ËøõÂ∫¶
                    const req = goalInfo.requirements;
                    let metCount = 0;
                    let totalCount = 0;
                    let shortfalls = [];
                    
                    const skillNames = { serve: 'ÂèëÁêÉ', spike: 'Êâ£ÁêÉ', block: 'Êã¶ÁΩë', dig: 'Âû´ÁêÉ', set: 'ÊâòÁêÉ', reputation: 'Â£∞Êúõ' };
                    
                    // Â§ÑÁêÜÊäÄËÉΩË¶ÅÊ±Ç
                    if (req.anyTwo !== undefined) {
                        const threshold = req.anyTwo;
                        const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                        const qualifiedSkills = skills.filter(s => this.player.skills[s] >= threshold);
                        
                        totalCount = 1;
                        if (qualifiedSkills.length >= 2) {
                            metCount = 1;
                        } else {
                            const sortedSkills = skills
                                .map(s => ({ skill: s, value: this.player.skills[s], diff: threshold - this.player.skills[s] }))
                                .filter(s => s.diff > 0)
                                .sort((a, b) => a.diff - b.diff)
                                .slice(0, 2);
                            sortedSkills.forEach(item => {
                                shortfalls.push({ skill: skillNames[item.skill], diff: item.diff, key: item.skill });
                            });
                        }
                    } else if (req.anyThree !== undefined) {
                        const threshold = req.anyThree;
                        const skills = ['serve', 'spike', 'block', 'dig', 'set'];
                        const qualifiedSkills = skills.filter(s => this.player.skills[s] >= threshold);
                        
                        totalCount++;
                        if (qualifiedSkills.length >= 3) {
                            metCount++;
                        } else {
                            const sortedSkills = skills
                                .map(s => ({ skill: s, value: this.player.skills[s], diff: threshold - this.player.skills[s] }))
                                .filter(s => s.diff > 0)
                                .sort((a, b) => a.diff - b.diff)
                                .slice(0, 3);
                            sortedSkills.forEach(item => {
                                shortfalls.push({ skill: skillNames[item.skill], diff: item.diff, key: item.skill });
                            });
                        }
                    }
                    
                    // Ê£ÄÊü•Â£∞Êúõ
                    if (req.reputation !== undefined) {
                        totalCount++;
                        if (this.player.reputation >= req.reputation) {
                            metCount++;
                        } else {
                            shortfalls.push({ 
                                skill: 'Â£∞Êúõ', 
                                diff: req.reputation - this.player.reputation, 
                                key: 'reputation' 
                            });
                        }
                    }
                    
                    const progressPercent = totalCount > 0 ? (metCount / totalCount) * 100 : 0;
                    
                    if (progressPercent >= 100) {
                        suggestions.push({ priority: 2, text: `üéâ Â∑≤ËææÊ†áÔºÅÂèØ‰ª•ÊåëÊàòÁõÆÊ†á‰∫Ü` });
                    } else if (progressPercent >= 80) {
                        const topShortfall = shortfalls.sort((a, b) => b.diff - a.diff)[0];
                        if (topShortfall) {
                            suggestions.push({ priority: 2, text: `üí° Êé•ËøëÁõÆÊ†áÔºÅÈáçÁÇπÊèêÂçá${topShortfall.skill}(Â∑Æ${topShortfall.diff})` });
                        }
                    } else if (progressPercent >= 50) {
                        const top2Shortfalls = shortfalls.sort((a, b) => b.diff - a.diff).slice(0, 2);
                        if (top2Shortfalls.length > 0) {
                            suggestions.push({ priority: 2, text: `üí™ Á®≥Ê≠•ÂâçËøõÔºÅÁü≠ÊùøÔºö${top2Shortfalls.map(s => `${s.skill}(${s.diff})`).join('„ÄÅ')}` });
                        }
                    } else {
                        suggestions.push({ priority: 2, text: `‚ö° Âä†Âø´ËäÇÂ•èÔºÅÂª∫ËÆÆÊØèÂë®ËÆ≠ÁªÉÊª°3Ê¨°` });
                    }
                    
                } else if (goalInfo.type === 'match') {
                    // ÊØîËµõÁ±ªÁõÆÊ†áÔºöÁªôÂá∫ÂáÜÂ§áÂª∫ËÆÆ
                    const weeksUntil = goalInfo.triggerWeek - this.player.week;
                    
                    if (weeksUntil > 0) {
                        suggestions.push({ priority: 2, text: `üìÖ Ë∑ùÁ¶ª${goalInfo.title}ËøòÊúâ${weeksUntil}Âë®ÔºåÊäìÁ¥ßÂáÜÂ§á` });
                        
                        // Ê†πÊçÆÂπ≥ÂùáÊäÄËÉΩÁªôÂá∫Âª∫ËÆÆ
                        const avgSkill = (this.player.skills.serve + this.player.skills.spike + 
                                         this.player.skills.block + this.player.skills.dig + 
                                         this.player.skills.set) / 5;
                        
                        if (avgSkill < 30) {
                            suggestions.push({ priority: 3, text: `üí™ ÊäÄËÉΩÂÅè‰ΩéÔºåÂª∫ËÆÆÂä†Âº∫ËÆ≠ÁªÉ` });
                        } else if (avgSkill < 50) {
                            suggestions.push({ priority: 3, text: `üìà ÁªßÁª≠ÊèêÂçáÔºå‰∫âÂèñÊõ¥Â•ΩË°®Áé∞` });
                        } else {
                            suggestions.push({ priority: 3, text: `üåü ÂÆûÂäõ‰∏çÈîôÔºå‰øùÊåÅÁä∂ÊÄÅÂç≥ÂèØ` });
                        }
                    } else if (weeksUntil === 0) {
                        suggestions.push({ priority: 2, text: `üèê Êú¨Âë®ÊØîËµõÔºÅ‰øùÊåÅÊúÄ‰Ω≥Áä∂ÊÄÅ` });
                    }
                }
                
                // 3. ËÅå‰∏öÁõ∏ÂÖ≥Âª∫ËÆÆÔºàÁÆÄÂåñÔºâ
                if (this.player.position !== 'none') {
                    const posInfo = this.getPositionInfo();
                    const skillNames = { serve: 'ÂèëÁêÉ', spike: 'Êâ£ÁêÉ', block: 'Êã¶ÁΩë', dig: 'Âû´ÁêÉ', set: 'ÊâòÁêÉ' };
                    const coreSkillsMet = posInfo.coreSkills.every(skill => {
                        const baseReq = posInfo.baseRequirements[skill] || 0;
                        return this.player.skills[skill] >= baseReq;
                    });
                    
                    if (!coreSkillsMet) {
                        const coreNames = posInfo.coreSkills.map(s => skillNames[s]).join('„ÄÅ');
                        suggestions.push({ priority: 3, text: `${posInfo.icon} ${posInfo.name}Ê†∏ÂøÉÊäÄËÉΩÔºö${coreNames}(+50%Âä†Êàê)` });
                    }
                }
                
                // 4. ËÆ≠ÁªÉÊïàÁéáÂª∫ËÆÆÔºàÁÆÄÂåñÔºâ
                if (this.player.trainingCount < 2) {
                    suggestions.push({ priority: 4, text: `üìà Êú¨Âë®ËÆ≠ÁªÉËæÉÂ∞ë(${this.player.trainingCount}/3)ÔºåÂª∫ËÆÆÂ¢ûÂä†ËÆ≠ÁªÉ` });
                }
                
                // ËÆ°ÁÆóÊÄªÊèêÂçá
                const totalGrowth = Math.abs(changes.serve) + Math.abs(changes.spike) + Math.abs(changes.block) + Math.abs(changes.dig) + Math.abs(changes.set);
                
                if (totalGrowth === 0 && this.player.trainingCount > 0) {
                    suggestions.push({ priority: 4, text: `ü§î ËÆ≠ÁªÉ‰∫Ü‰ΩÜÊó†ÊèêÂçáÔºåÊ≥®ÊÑè‰øùÊåÅËâØÂ•ΩÁä∂ÊÄÅ` });
                } else if (totalGrowth >= 20) {
                    suggestions.push({ priority: 5, text: `üåü Êú¨Âë®Ë°®Áé∞Âá∫Ëâ≤ÔºÅÊèêÂçá${totalGrowth}ÁÇπ` });
                }
                
                // Êåâ‰ºòÂÖàÁ∫ßÊéíÂ∫èÔºåÂèñÂâç2Êù°ÔºàÊâãÊú∫ÁâàÂè™ÊòæÁ§∫2Êù°Ôºâ
                const topSuggestions = suggestions.sort((a, b) => a.priority - b.priority).slice(0, 2);
                
                let html = '<div style="background: #dbeafe; padding: 8px; border-radius: 6px; margin: 8px 0; font-size: 14px;">';
                html += '<strong>üí° Âª∫ËÆÆ</strong><br>';
                topSuggestions.forEach(s => {
                    html += `<div style="margin: 4px 0; color: #1e40af;">‚Ä¢ ${s.text}</div>`;
                });
                html += '</div>';
                
                return html;
            }
            
            updateUI() {
                document.getElementById('week').textContent = this.player.week;
                document.getElementById('training-count').textContent = `${this.player.trainingCount}/${this.player.maxTrainingPerWeek}`;
                document.getElementById('energy').textContent = this.player.energy;
                document.getElementById('mood').textContent = this.player.mood;
                document.getElementById('stress').textContent = this.player.stress;
                document.getElementById('reputation').textContent = this.player.reputation;
                document.getElementById('money').textContent = this.player.money;
                
                const teamNames = {
                    'none': 'Êó†',
                    'college': 'Èô¢Èòü',
                    'university': 'Ê†°Èòü'
                };
                document.getElementById('team').textContent = teamNames[this.player.team];
                
                // ÊòæÁ§∫ËÅå‰∏ö‰ø°ÊÅØ
                const positionStat = document.getElementById('position-stat');
                const positionElement = document.getElementById('position');
                if (this.player.position !== 'none') {
                    const posInfo = this.getPositionInfo();
                    positionStat.style.display = 'block';
                    positionElement.textContent = `${posInfo.icon} ${posInfo.name}`;
                } else {
                    positionStat.style.display = 'none';
                }
                
                for (let skill in this.player.skills) {
                    const value = this.player.skills[skill];
                    document.getElementById(`${skill}-value`).textContent = value;
                    const bar = document.getElementById(`${skill}-bar`);
                    bar.style.width = `${value}%`;
                    bar.textContent = value;
                }
                
                this.drawRadarChart();
                this.updateGoalDisplay();
            }
            
            drawRadarChart() {
                const canvas = document.getElementById('skills-radar');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = 75;
                
                // Ê∏ÖÁ©∫ÁîªÂ∏É
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // ÊäÄËÉΩÊï∞ÊçÆÔºà‰∫îËæπÂΩ¢Ôºå‰ªéÊ≠£‰∏äÊñπÂºÄÂßãÔºåÈ°∫Êó∂ÈíàÔºâ
                const skills = [
                    { name: 'ÂèëÁêÉ', value: this.player.skills.serve, angle: -Math.PI / 2 },
                    { name: 'Êâ£ÁêÉ', value: this.player.skills.spike, angle: -Math.PI / 2 + Math.PI * 2 / 5 },
                    { name: 'Êã¶ÁΩë', value: this.player.skills.block, angle: -Math.PI / 2 + Math.PI * 4 / 5 },
                    { name: 'Âû´ÁêÉ', value: this.player.skills.dig, angle: -Math.PI / 2 + Math.PI * 6 / 5 },
                    { name: 'ÊâòÁêÉ', value: this.player.skills.set, angle: -Math.PI / 2 + Math.PI * 8 / 5 }
                ];
                
                // ÁªòÂà∂ËÉåÊôØÁΩëÊ†º
                ctx.strokeStyle = '#ddd';
                ctx.lineWidth = 1;
                for (let i = 1; i <= 5; i++) {
                    ctx.beginPath();
                    const r = (radius / 5) * i;
                    skills.forEach((skill, index) => {
                        const x = centerX + r * Math.cos(skill.angle);
                        const y = centerY + r * Math.sin(skill.angle);
                        if (index === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    });
                    ctx.closePath();
                    ctx.stroke();
                }
                
                // ÁªòÂà∂ËΩ¥Á∫ø
                ctx.strokeStyle = '#ccc';
                ctx.lineWidth = 1;
                skills.forEach(skill => {
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    const x = centerX + radius * Math.cos(skill.angle);
                    const y = centerY + radius * Math.sin(skill.angle);
                    ctx.lineTo(x, y);
                    ctx.stroke();
                });
                
                // ÁªòÂà∂Êï∞ÊçÆÂå∫Âüü
                ctx.fillStyle = 'rgba(102, 126, 234, 0.3)';
                ctx.strokeStyle = 'rgba(102, 126, 234, 0.8)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                skills.forEach((skill, index) => {
                    const value = Math.min(skill.value, 100);
                    const r = (radius / 100) * value;
                    const x = centerX + r * Math.cos(skill.angle);
                    const y = centerY + r * Math.sin(skill.angle);
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                ctx.closePath();
                ctx.fill();
                ctx.stroke();
                
                // ÁªòÂà∂Êï∞ÊçÆÁÇπ
                ctx.fillStyle = '#667eea';
                skills.forEach(skill => {
                    const value = Math.min(skill.value, 100);
                    const r = (radius / 100) * value;
                    const x = centerX + r * Math.cos(skill.angle);
                    const y = centerY + r * Math.sin(skill.angle);
                    ctx.beginPath();
                    ctx.arc(x, y, 4, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                // ÁªòÂà∂Ê†áÁ≠æ
                ctx.fillStyle = '#333';
                ctx.font = 'bold 13px "Microsoft YaHei", Arial, sans-serif';
                
                skills.forEach((skill, index) => {
                    const labelRadius = radius + 30;
                    const x = centerX + labelRadius * Math.cos(skill.angle);
                    const y = centerY + labelRadius * Math.sin(skill.angle);
                    
                    // Ê†πÊçÆÁ¥¢ÂºïÁ≤æÁ°ÆËÆæÁΩÆÊØè‰∏™Ê†áÁ≠æÁöÑÂØπÈΩêÊñπÂºè
                    switch(index) {
                        case 0: // ÂèëÁêÉ - Ê≠£‰∏äÊñπ
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'bottom';
                            break;
                        case 1: // Êâ£ÁêÉ - Âè≥‰∏ä
                            ctx.textAlign = 'left';
                            ctx.textBaseline = 'middle';
                            break;
                        case 2: // Êã¶ÁΩë - Âè≥‰∏ã
                            ctx.textAlign = 'left';
                            ctx.textBaseline = 'middle';
                            break;
                        case 3: // Âû´ÁêÉ - Â∑¶‰∏ã
                            ctx.textAlign = 'right';
                            ctx.textBaseline = 'middle';
                            break;
                        case 4: // ÊâòÁêÉ - Â∑¶‰∏ä
                            ctx.textAlign = 'right';
                            ctx.textBaseline = 'middle';
                            break;
                    }
                    
                    ctx.fillText(skill.name, x, y);
                });
            }

            
            applyEffect(effect) {
                if (effect.reset) {
                    this.player = {
                        name: 'Êñ∞Áîü',
                        week: TEST_MODE ? TEST_CONFIG.skipToWeek : 1,
                        trainingCount: 0,
                        maxTrainingPerWeek: TEST_MODE ? TEST_CONFIG.maxTrainingPerWeek : 3,
                        energy: TEST_MODE ? TEST_CONFIG.initialEnergy : 100,
                        maxEnergy: TEST_MODE ? TEST_CONFIG.initialEnergy : 100,
                        mood: TEST_MODE ? TEST_CONFIG.initialMood : 80,
                        stress: TEST_MODE ? TEST_CONFIG.initialStress : 20,
                        reputation: TEST_MODE ? TEST_CONFIG.initialReputation : 10,
                        money: TEST_MODE ? TEST_CONFIG.initialMoney : 100,
                        weeklyAllowance: 120,  // ÊØèÂë®Èõ∂Ëä±Èí±
                        team: 'none',
                        position: 'none',
                        positionLevel: 0,
                        adaptationWeeks: 0,
                        skills: {
                            serve: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                            spike: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                            block: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                            dig: TEST_MODE ? TEST_CONFIG.initialSkills : 0,
                            set: TEST_MODE ? TEST_CONFIG.initialSkills : 0
                        },
                        attributes: {
                            strength: 0,
                            agility: 0,
                            stamina: 0,
                            coordination: 0
                        },
                        relationships: {
                            coach: 50,
                            teammates: 50
                        },
                        achievements: []
                    };
                    this.rerollsRemaining = 5;
                    this.currentScene = 'nameInput';
                    document.getElementById('character-panel').classList.remove('show');
                    document.getElementById('game-header').classList.remove('show');
                    this.updateUI();
                    return;
                }
                
                // Êñ∞Â¢ûÔºöÂ§ÑÁêÜÊ≠£ÂºèÊØîËµõÂêØÂä®
                if (effect.startFormalMatch) {
                    this.startFormalMatch(
                        effect.startFormalMatch.matchType, 
                        effect.startFormalMatch.matchName
                    );
                    return;
                }
                
                if (effect.nextWeek) {
                    this.nextWeek();
                    return;
                }
                
                if (effect.eventResult) {
                    // ÊûÑÂª∫Â±ûÊÄßÂèòÂåñÊòæÁ§∫
                    let changesText = '<br><br><strong>Â±ûÊÄßÂèòÂåñÔºö</strong><br>';
                    let hasChanges = false;
                    
                    if (effect.serve) {
                        changesText += `üéØ ÂèëÁêÉ ${effect.serve > 0 ? '+' : ''}${effect.serve}<br>`;
                        hasChanges = true;
                    }
                    if (effect.spike) {
                        changesText += `‚ö° Êâ£ÁêÉ ${effect.spike > 0 ? '+' : ''}${effect.spike}<br>`;
                        hasChanges = true;
                    }
                    if (effect.block) {
                        changesText += `üõ°Ô∏è Êã¶ÁΩë ${effect.block > 0 ? '+' : ''}${effect.block}<br>`;
                        hasChanges = true;
                    }
                    if (effect.dig) {
                        changesText += `üèê Âû´ÁêÉ ${effect.dig > 0 ? '+' : ''}${effect.dig}<br>`;
                        hasChanges = true;
                    }
                    if (effect.set) {
                        changesText += `ü§≤ ÊâòÁêÉ ${effect.set > 0 ? '+' : ''}${effect.set}<br>`;
                        hasChanges = true;
                    }
                    if (effect.energy) {
                        changesText += `üí™ ‰ΩìÂäõ ${effect.energy > 0 ? '+' : ''}${effect.energy}<br>`;
                        hasChanges = true;
                    }
                    if (effect.mood) {
                        changesText += `üòä ÂøÉÊÉÖ ${effect.mood > 0 ? '+' : ''}${effect.mood}<br>`;
                        hasChanges = true;
                    }
                    if (effect.stress) {
                        changesText += `üò∞ ÂéãÂäõ ${effect.stress > 0 ? '+' : ''}${effect.stress}<br>`;
                        hasChanges = true;
                    }
                    if (effect.reputation) {
                        changesText += `‚≠ê Â£∞Êúõ ${effect.reputation > 0 ? '+' : ''}${effect.reputation}<br>`;
                        hasChanges = true;
                    }
                    if (effect.money) {
                        changesText += `üí∞ ÈáëÈí± ${effect.money > 0 ? '+' : ''}${effect.money}<br>`;
                        hasChanges = true;
                    }
                    if (effect.relationship) {
                        changesText += `üë• ÈòüÂèãÂÖ≥Á≥ª ${effect.relationship > 0 ? '+' : ''}${effect.relationship}<br>`;
                        hasChanges = true;
                    }
                    
                    SCENES.eventResult.text = `<h2>‚ú® ÁªìÊûú</h2>
                    <p>${effect.eventResult}</p>
                    ${hasChanges ? changesText : ''}`;
                }
                
                if (effect.goalUpdate) {
                    this.currentGoal = effect.goalUpdate;
                }
                
                if (effect.eventType) {
                    this.lastEventType = effect.eventType;
                    
                    // ËøΩË∏™ÁîüÊ¥ªÊ¥ªÂä®ÁªüËÆ°
                    if (effect.lifeActivity) {
                        switch(effect.lifeActivity) {
                            case 'game':
                                this.playerStats.gamesPlayed++;
                                break;
                            case 'movie':
                                this.playerStats.moviesWatched++;
                                break;
                            case 'social':
                                this.playerStats.socialEvents++;
                                break;
                            case 'rest':
                                this.playerStats.restTaken++;
                                break;
                        }
                    }
                }
                
                if (effect.trained) {
                    this.player.trainingCount++;
                    
                    // ÁªüËÆ°ËÆ≠ÁªÉÊ¨°Êï∞
                    this.playerStats.totalTrainings++;
                    
                    // ÁªüËÆ°ÂêÑÊäÄËÉΩËÆ≠ÁªÉÊ¨°Êï∞ÔºàÁÆÄÂåñÔºöÊ†πÊçÆeffect‰∏≠ÁöÑÊäÄËÉΩÂà§Êñ≠Ôºâ
                    if (effect.serve) this.playerStats.trainingByType.serve++;
                    if (effect.spike) this.playerStats.trainingByType.spike++;
                    if (effect.block) this.playerStats.trainingByType.block++;
                    if (effect.dig) this.playerStats.trainingByType.dig++;
                    if (effect.set) this.playerStats.trainingByType.set++;
                    
                    // Â¶ÇÊûúÂ§ö‰∏™ÊäÄËÉΩÈÉΩÊúâÊèêÂçáÔºåÁÆó‰ΩúÁªÑÂêàËÆ≠ÁªÉ
                    const skillCount = [effect.serve, effect.spike, effect.block, effect.dig, effect.set].filter(v => v).length;
                    if (skillCount >= 3) {
                        this.playerStats.trainingByType.composite++;
                    }
                }
                
                // Â∫îÁî®ËÅå‰∏öËÆ≠ÁªÉÂä†Êàê
                const skillEffects = ['serve', 'spike', 'block', 'dig', 'set'];
                skillEffects.forEach(skill => {
                    if (effect[skill]) {
                        const bonus = this.getTrainingBonus(skill);
                        const finalValue = Math.round(effect[skill] * (1 + bonus));
                        this.player.skills[skill] = Math.min(100, this.player.skills[skill] + finalValue);
                        
                        // Â¶ÇÊûúÊúâÂä†ÊàêÔºåÊòæÁ§∫ÊèêÁ§∫
                        if (bonus > 0 && effect.trained) {
                            console.log(`${skill} ËÆ≠ÁªÉËé∑ÂæóËÅå‰∏öÂä†Êàê: ${bonus * 100}%`);
                        }
                    }
                });
                
                if (effect.energy) this.player.energy = Math.max(0, Math.min(this.player.maxEnergy, this.player.energy + effect.energy));
                if (effect.maxEnergyBonus) this.player.maxEnergy = Math.min(150, this.player.maxEnergy + effect.maxEnergyBonus);
                if (effect.mood) this.player.mood = Math.max(0, Math.min(100, this.player.mood + effect.mood));
                if (effect.stress) this.player.stress = Math.max(0, Math.min(100, this.player.stress + effect.stress));
                if (effect.reputation) this.player.reputation += effect.reputation;
                if (effect.money) this.player.money += effect.money;
                if (effect.weeklyAllowance) this.player.weeklyAllowance = effect.weeklyAllowance;
                if (effect.team) this.player.team = effect.team;
                if (effect.relationship) {
                    this.player.relationships.teammates = Math.min(100, this.player.relationships.teammates + effect.relationship);
                }
                
                // Â§ÑÁêÜbuffÊïàÊûú
                if (effect.buff) {
                    this.playerStats.permanentBuffs[effect.buff] = true;
                    console.log(`Ëé∑Âæóbuff: ${effect.buff}`);
                }
                
                // Â§ÑÁêÜÁß∞Âè∑
                if (effect.title) {
                    if (!this.playerStats.titles) {
                        this.playerStats.titles = [];
                    }
                    if (!this.playerStats.titles.includes(effect.title)) {
                        this.playerStats.titles.push(effect.title);
                        console.log(`Ëé∑ÂæóÁß∞Âè∑: ${effect.title}`);
                    }
                }
                
                this.updateUI();
                
                // Êñ∞Â¢ûÔºöÊîØÊåÅÂõûË∞ÉÂáΩÊï∞
                if (effect.callback && typeof effect.callback === 'function') {
                    effect.callback();
                }
            }
            
            checkRequirement(req) {
                if (req.energy && this.player.energy < req.energy) return false;
                if (req.mood && this.player.mood < req.mood) return false;
                if (req.money && this.player.money < req.money) return false;
                if (req.team && this.player.team !== req.team) return false;
                if (req.reputation && this.player.reputation < req.reputation) return false;
                if (req.serve && this.player.skills.serve < req.serve) return false;
                if (req.spike && this.player.skills.spike < req.spike) return false;
                if (req.block && this.player.skills.block < req.block) return false;
                if (req.dig && this.player.skills.dig < req.dig) return false;
                if (req.set && this.player.skills.set < req.set) return false;
                if (req.maxCheck && req.trainingCount !== undefined) {
                    if (this.player.trainingCount > req.trainingCount) return false;
                }
                return true;
            }

            
            showScene(sceneId) {
                console.log('showScene called with:', sceneId);
                
                // ÂÖàÂ§ÑÁêÜÁâπÊÆäÂú∫ÊôØÔºà‰∏çÈúÄË¶ÅÂú®SCENES‰∏≠ÂÆö‰πâÔºâ
                // ËØæ‰ΩôÁîüÊ¥ªÂú∫ÊôØÁâπÊÆäÊ∏≤Êüì
                if (sceneId === 'lifeChoice') {
                    this.renderLifeChoice();
                    return;
                }
                
                // ÂïÜÂ∫óÂú∫ÊôØÁâπÊÆäÊ∏≤Êüì
                if (sceneId === 'shopMain') {
                    this.renderShopMain();
                    return;
                }
                
                if (sceneId.startsWith('shopCategory_')) {
                    const category = sceneId.replace('shopCategory_', '');
                    this.renderShopCategory(category);
                    return;
                }
                
                // ËÅå‰∏öÈÄâÊã©Âú∫ÊôØÁâπÊÆäÊ∏≤Êüì
                if (sceneId === 'positionSelection') {
                    this.renderPositionSelection();
                    return;
                }
                
                // ÊØîËµõÂú∫ÊôØ
                if (sceneId === 'casualMatch') {
                    this.startMatch('casual');
                    return;
                }
                
                // matchResult Âú∫ÊôØÁé∞Âú®‰Ωú‰∏∫ÊôÆÈÄöÂú∫ÊôØÂ§ÑÁêÜÔºàÁî± showMatchResultByPerformance ÂàõÂª∫Ôºâ
                // ‰∏çÂÜçÁâπÊÆäÂ§ÑÁêÜ
                
                // Ê£ÄÊü•SCENES‰∏≠ÁöÑÂ∏∏ËßÑÂú∫ÊôØ
                const scene = SCENES[sceneId];
                if (!scene) {
                    console.error('Scene not found:', sceneId);
                    alert('Âú∫ÊôØÊú™ÊâæÂà∞: ' + sceneId);
                    return;
                }
                
                // Âä®ÊÄÅÊõ¥Êñ∞ÁâπÂÆöÂú∫ÊôØ
                if (sceneId === 'start' && this.player.name !== 'Êñ∞Áîü') {
                    scene.text = `<h2>üéì Â§ßÂ≠¶Êñ∞ÁîüÊ¥ª</h2>
                    <p><strong>${this.player.name}</strong>Ôºå‰Ω†ÊòØ‰∏ÄÂêçÂàöÂÖ•Â≠¶ÁöÑÂ§ß‰∏ÄÊñ∞ÁîüÔºå‰ªéÊú™Êé•Ëß¶ËøáÊéíÁêÉ„ÄÇ</p>
                    <p>ÂºÄÂ≠¶Á¨¨‰∏ÄÂë®Ôºå‰Ω†Ë∑ØËøá‰ΩìËÇ≤È¶ÜÔºåÁúãÂà∞ÊéíÁêÉÁ§æÂõ¢Ê≠£Âú®ÊãõÊñ∞„ÄÇÈò≥ÂÖâÈÄèËøáÁ™óÊà∑Ê¥íÂú®ÁêÉÂú∫‰∏äÔºåÂ≠¶ÈïøÂ≠¶Âßê‰ª¨Áü´ÂÅ•ÁöÑË∫´ÂΩ±ËÆ©‰Ω†ÂøÉÁîüÂêëÂæÄ„ÄÇ</p>
                    <p>"ÊÉ≥ËØïËØïÂêóÔºü"‰∏Ä‰ΩçÂ≠¶ÂßêÁ¨ëÁùÄÂêë‰Ω†ÊãõÊâã„ÄÇ</p>`;
                }
                
                if (sceneId === 'weeklyHub') {
                    this.updateWeeklyHub();
                }
                
                if (sceneId === 'weekEnd') {
                    this.generateWeeklySummary();
                }
                
                // Ê£ÄÊü•ÊòØÂê¶Ëß¶ÂèëÈöèÊú∫‰∫ã‰ª∂
                if (sceneId === 'checkRandomEvent' && this.lastEventType) {
                    const event = this.triggerRandomEvent(this.lastEventType);
                    this.lastEventType = null;
                    
                    if (event) {
                        this.showRandomEvent(event);
                        return;
                    } else {
                        // Ê≤°ÊúâËß¶Âèë‰∫ã‰ª∂ÔºåÊ†πÊçÆ‰πãÂâçÁöÑÁ±ªÂûãÂÜ≥ÂÆö‰∏ã‰∏ÄÊ≠•
                        this.currentScene = 'weeklyHub';
                        this.showScene('weeklyHub');
                        return;
                    }
                }
                
                const storyText = document.getElementById('story-text');
                const choicesDiv = document.getElementById('choices');
                
                // Â§ÑÁêÜÊñáÊú¨ÔºöÂ¶ÇÊûúÊòØÂáΩÊï∞ÂàôË∞ÉÁî®ÔºåÂê¶ÂàôÁõ¥Êé•‰ΩøÁî®
                const textContent = typeof scene.text === 'function' ? scene.text() : scene.text;
                storyText.innerHTML = textContent;
                choicesDiv.innerHTML = '';
                
                scene.choices.forEach(choice => {
                    // Â¶ÇÊûúÊúâÂàÜÈöîÁ¨¶ÔºåÂÖàÊ∑ªÂä†ÂàÜÈöîÁ¨¶
                    if (choice.separator && choice.separatorText) {
                        const separator = document.createElement('div');
                        separator.innerHTML = choice.separatorText;
                        separator.style.marginTop = '10px';
                        choicesDiv.appendChild(separator);
                    }
                    
                    // Â¶ÇÊûúÂè™ÊòØÂàÜÈöîÁ¨¶ÔºàÊ≤°ÊúâtextÔºâÔºå‰∏çÂàõÂª∫ÊåâÈíÆ
                    if (!choice.text || choice.text.trim() === '') {
                        return;
                    }
                    
                    const button = document.createElement('button');
                    
                    // Âà§Êñ≠ÊòØÂê¶ÊòØÈáçË¶ÅÊåâÈíÆÔºàÈÄâÊãî„ÄÅÊØîËµõÁ≠âÂÖ≥ÈîÆÊµÅÁ®ãÔºâ
                    const importantKeywords = ['ÈÄâÊãî', 'ÂºÄÂßãÊØîËµõ', 'Âä†ÂÖ•', 'ÊåëÊàò', 'ÂèÇÂä†ÊØîËµõ'];
                    const isImportant = importantKeywords.some(keyword => choice.text.includes(keyword));
                    
                    button.className = isImportant ? 'choice-btn-important' : 'choice-btn';
                    
                    // Â¶ÇÊûúÊúâeffect‰∏îÊòØËÆ≠ÁªÉÁ±ªÂûãÔºåÂä®ÊÄÅÁîüÊàêÂ∏¶Âä†ÊàêÁöÑÊñáÊú¨
                    if (choice.effect && choice.effect.trained) {
                        // ÊèêÂèñÂéüÂßãÊñáÊú¨ÁöÑÂõæÊ†áÂíåÂêçÁß∞ÈÉ®ÂàÜ
                        const match = choice.text.match(/^([üéØ‚ö°üõ°Ô∏èü§∏üôåüî•]+\s*[\u4e00-\u9fa5]+)/);
                        const baseName = match ? match[1] : choice.text.split('Ôºà')[0];
                        const effectPreview = this.getEffectPreview(choice.effect);
                        button.textContent = baseName + effectPreview;
                    } else {
                        button.textContent = choice.text;
                    }
                    
                    if (choice.requirement) {
                        const meetsRequirement = this.checkRequirement(choice.requirement);
                        if (!meetsRequirement) {
                            button.disabled = true;
                            button.textContent += ' (Êù°‰ª∂‰∏çË∂≥)';
                        }
                    }
                    
                    button.onclick = () => {
                        let shouldContinue = true;
                        
                        if (choice.effect) {
                            // Â¶ÇÊûú effect ÊòØÂáΩÊï∞ÔºåÁõ¥Êé•ÊâßË°åÂÆÉ
                            if (typeof choice.effect === 'function') {
                                choice.effect();
                                // ÂáΩÊï∞ÂèØËÉΩ‰ºöÂ§ÑÁêÜÂú∫ÊôØË∑≥ËΩ¨ÔºåÊâÄ‰ª•Ê£ÄÊü•ÊòØÂê¶Êúâ next
                                if (!choice.next) {
                                    return;  // Ê≤°Êúâ nextÔºåÂáΩÊï∞Ëá™Â∑±Â§ÑÁêÜË∑≥ËΩ¨
                                }
                            } else {
                                // effect ÊòØÂØπË±°Ôºå‰ΩøÁî® applyEffect Â§ÑÁêÜ
                                // Ê£ÄÊü•ÊòØÂê¶Êúâ‰ºöÊîπÂèòÂú∫ÊôØÁöÑÁâπÊÆäÊïàÊûú
                                if (choice.effect.nextWeek || choice.effect.startFormalMatch) {
                                    // Ëøô‰∫õÊïàÊûú‰ºöËá™Â∑±Â§ÑÁêÜÂú∫ÊôØË∑≥ËΩ¨Ôºå‰∏çÈúÄË¶ÅÁªßÁª≠
                                    this.applyEffect(choice.effect);
                                    return;  // Áõ¥Êé•ËøîÂõûÔºå‰∏çÊâßË°åÂêéÈù¢ÁöÑ showScene
                                }
                                
                                this.applyEffect(choice.effect);
                                
                                // Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅËß¶ÂèëÈöèÊú∫‰∫ã‰ª∂
                                if (choice.effect.eventType) {
                                    const event = this.triggerRandomEvent(choice.effect.eventType);
                                    if (event) {
                                        // Ëß¶Âèë‰∫ã‰ª∂ÔºåÊöÇ‰∏çË∑≥ËΩ¨Âú∫ÊôØ
                                        this.showRandomEvent(event);
                                        return;
                                    }
                                }
                            }
                        }
                        
                        if (choice.next) {
                            this.currentScene = choice.next;
                            this.showScene(choice.next);
                        }
                    };
                    
                    choicesDiv.appendChild(button);
                });
            }
        }
        
        // ÂêØÂä®Ê∏∏Êàè
        let game;
        
        // ÂàÜ‰∫´ÂäüËÉΩ
        function shareGame() {
            const shareData = {
                title: 'ÊéíÁêÉ‰πãÊòü - ‰ªéËèúÈ∏üÂà∞ÂÜ†ÂÜõ',
                text: 'ÊàëÂú®Áé©ÊéíÁêÉ‰πãÊòüÔºå‰ªéËèúÈ∏üÂà∞ÂÜ†ÂÜõÁöÑÊàêÈïø‰πãË∑ØÔºÅÂø´Êù•‰∏ÄËµ∑Áé©ÂêßÔºÅ',
                url: window.location.href
            };
            
            // Ê£ÄÊü•ÊòØÂê¶ÊîØÊåÅÂéüÁîüÂàÜ‰∫´APIÔºàÁßªÂä®Á´ØÔºâ
            if (navigator.share) {
                navigator.share(shareData)
                    .then(() => {
                        console.log('ÂàÜ‰∫´ÊàêÂäü');
                    })
                    .catch((error) => {
                        if (error.name !== 'AbortError') {
                            console.log('ÂàÜ‰∫´Â§±Ë¥•', error);
                            fallbackShare();
                        }
                    });
            } else {
                // Ê°åÈù¢Á´ØÊàñ‰∏çÊîØÊåÅÁöÑÊµèËßàÂô®ÔºåÂ§çÂà∂ÈìæÊé•
                fallbackShare();
            }
        }
        
        function fallbackShare() {
            const url = window.location.href;
            
            // Â∞ùËØï‰ΩøÁî®Ââ™Ë¥¥ÊùøAPI
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(url)
                    .then(() => {
                        showShareMessage('‚úÖ ÈìæÊé•Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ\nÂø´ÂéªÂàÜ‰∫´ÁªôÊúãÂèãÂêßÔºÅ');
                    })
                    .catch(() => {
                        showShareMessage('üìã ËØ∑Â§çÂà∂ÈìæÊé•Ôºö\n' + url);
                    });
            } else {
                // ÈôçÁ∫ßÊñπÊ°àÔºöÊòæÁ§∫ÈìæÊé•ËÆ©Áî®Êà∑ÊâãÂä®Â§çÂà∂
                showShareMessage('üìã ËØ∑Â§çÂà∂ÈìæÊé•Ôºö\n' + url);
            }
        }
        
        function showShareMessage(message) {
            // ÂàõÂª∫‰∏¥Êó∂ÊèêÁ§∫Ê°Ü
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.85);
                color: white;
                padding: 20px 30px;
                border-radius: 12px;
                font-size: 14px;
                z-index: 10000;
                text-align: center;
                white-space: pre-line;
                max-width: 80%;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // 3ÁßíÂêéËá™Âä®Ê∂àÂ§±
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }
        
        window.addEventListener('DOMContentLoaded', () => {
            console.log('DOMContentLoaded fired');
            try {
                console.log('Creating game instance...');
                game = new VolleyballGame();
                console.log('Game instance created:', game);
            } catch (e) {
                console.error('Error creating game:', e);
                alert('Ê∏∏ÊàèÂàùÂßãÂåñÂ§±Ë¥•: ' + e.message);
            }
        });
    </script>
</body>
</html>

